<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>spacr.gui_utils &mdash; spacr 0.0.70 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/documentation_options.js?v=29ed05f3"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            spacr
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">spacr</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">spacr.gui_utils</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for spacr.gui_utils</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">spacr</span><span class="o">,</span> <span class="nn">inspect</span><span class="o">,</span> <span class="nn">traceback</span><span class="o">,</span> <span class="nn">io</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">ast</span><span class="o">,</span> <span class="nn">ctypes</span><span class="o">,</span> <span class="nn">matplotlib</span><span class="o">,</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">csv</span><span class="o">,</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;Agg&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">tkinter</span> <span class="k">as</span> <span class="nn">tk</span>
<span class="kn">from</span> <span class="nn">tkinter</span> <span class="kn">import</span> <span class="n">ttk</span><span class="p">,</span> <span class="n">messagebox</span>
<span class="kn">import</span> <span class="nn">tkinter.font</span> <span class="k">as</span> <span class="nn">tkFont</span>
<span class="kn">from</span> <span class="nn">torchvision</span> <span class="kn">import</span> <span class="n">models</span>
<span class="c1">#from ttf_opensans import opensans</span>

<span class="kn">from</span> <span class="nn">tkinter</span> <span class="kn">import</span> <span class="n">font</span> <span class="k">as</span> <span class="n">tkFont</span>


<span class="kn">from</span> <span class="nn">.logger</span> <span class="kn">import</span> <span class="n">log_function_call</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">ctypes</span><span class="o">.</span><span class="n">windll</span><span class="o">.</span><span class="n">shcore</span><span class="o">.</span><span class="n">SetProcessDpiAwareness</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
    <span class="k">pass</span>

<div class="viewcode-block" id="ToolTip">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.ToolTip">[docs]</a>
<span class="k">class</span> <span class="nc">ToolTip</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_window</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Enter&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_tooltip</span><span class="p">)</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Leave&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hide_tooltip</span><span class="p">)</span>

<div class="viewcode-block" id="ToolTip.show_tooltip">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.ToolTip.show_tooltip">[docs]</a>
    <span class="k">def</span> <span class="nf">show_tooltip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">x_root</span> <span class="o">+</span> <span class="mi">20</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">y_root</span> <span class="o">+</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_window</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Toplevel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_window</span><span class="o">.</span><span class="n">wm_overrideredirect</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_window</span><span class="o">.</span><span class="n">wm_geometry</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;+</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">+</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tooltip_window</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">relief</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span> <span class="n">borderwidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">pack</span><span class="p">()</span></div>


<div class="viewcode-block" id="ToolTip.hide_tooltip">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.ToolTip.hide_tooltip">[docs]</a>
    <span class="k">def</span> <span class="nf">hide_tooltip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_window</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_window</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_window</span> <span class="o">=</span> <span class="kc">None</span></div>
</div>



<div class="viewcode-block" id="load_app">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.load_app">[docs]</a>
<span class="k">def</span> <span class="nf">load_app</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">app_name</span><span class="p">,</span> <span class="n">app_func</span><span class="p">):</span>
    <span class="c1"># Destroy the current window</span>
    <span class="n">root</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
    <span class="c1"># Create a new window for the app</span>
    <span class="n">app_window</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Tk</span><span class="p">()</span>
    <span class="n">app_window</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SpaCr - </span><span class="si">{</span><span class="n">app_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">app_window</span><span class="o">.</span><span class="n">geometry</span><span class="p">(</span><span class="s2">&quot;1200x800&quot;</span><span class="p">)</span>
    <span class="c1">#app_window.attributes(&#39;-fullscreen&#39;, True)</span>
    <span class="n">app_window</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">bg</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
    <span class="n">create_menu_bar</span><span class="p">(</span><span class="n">app_window</span><span class="p">)</span>  <span class="c1"># Add menu to the new window</span>
    <span class="n">app_func</span><span class="p">(</span><span class="n">app_window</span><span class="p">,</span> <span class="n">app_window</span><span class="o">.</span><span class="n">winfo_width</span><span class="p">(),</span> <span class="n">app_window</span><span class="o">.</span><span class="n">winfo_height</span><span class="p">())</span></div>


<div class="viewcode-block" id="create_menu_bar">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.create_menu_bar">[docs]</a>
<span class="k">def</span> <span class="nf">create_menu_bar</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>

    <span class="kn">from</span> <span class="nn">.gui_mask_app</span> <span class="kn">import</span> <span class="n">initiate_mask_root</span>
    <span class="kn">from</span> <span class="nn">.gui_measure_app</span> <span class="kn">import</span> <span class="n">initiate_measure_root</span>
    <span class="kn">from</span> <span class="nn">.annotate_app</span> <span class="kn">import</span> <span class="n">initiate_annotation_app_root</span>
    <span class="kn">from</span> <span class="nn">.mask_app</span> <span class="kn">import</span> <span class="n">initiate_mask_app_root</span>
    <span class="kn">from</span> <span class="nn">.gui_classify_app</span> <span class="kn">import</span> <span class="n">initiate_classify_root</span>

    <span class="n">gui_apps</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Mask&quot;</span><span class="p">:</span> <span class="n">initiate_mask_root</span><span class="p">,</span>
        <span class="s2">&quot;Measure&quot;</span><span class="p">:</span> <span class="n">initiate_measure_root</span><span class="p">,</span>
        <span class="s2">&quot;Annotate&quot;</span><span class="p">:</span> <span class="n">initiate_annotation_app_root</span><span class="p">,</span>
        <span class="s2">&quot;Make Masks&quot;</span><span class="p">:</span> <span class="n">initiate_mask_app_root</span><span class="p">,</span>
        <span class="s2">&quot;Classify&quot;</span><span class="p">:</span> <span class="n">initiate_classify_root</span>
    <span class="p">}</span>
    <span class="c1"># Create the menu bar</span>
    <span class="n">menu_bar</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;#008080&quot;</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>
    <span class="c1"># Create a &quot;SpaCr Applications&quot; menu</span>
    <span class="n">app_menu</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">menu_bar</span><span class="p">,</span> <span class="n">tearoff</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;#008080&quot;</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>
    <span class="n">menu_bar</span><span class="o">.</span><span class="n">add_cascade</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;SpaCr Applications&quot;</span><span class="p">,</span> <span class="n">menu</span><span class="o">=</span><span class="n">app_menu</span><span class="p">)</span>
    <span class="c1"># Add options to the &quot;SpaCr Applications&quot; menu</span>
    <span class="k">for</span> <span class="n">app_name</span><span class="p">,</span> <span class="n">app_func</span> <span class="ow">in</span> <span class="n">gui_apps</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">app_menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">app_name</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="k">lambda</span> <span class="n">app_name</span><span class="o">=</span><span class="n">app_name</span><span class="p">,</span> <span class="n">app_func</span><span class="o">=</span><span class="n">app_func</span><span class="p">:</span> <span class="n">load_app</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">app_name</span><span class="p">,</span> <span class="n">app_func</span><span class="p">))</span>
    <span class="c1"># Add a separator and an exit option</span>
    <span class="n">app_menu</span><span class="o">.</span><span class="n">add_separator</span><span class="p">()</span>
    <span class="n">app_menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Exit&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="n">root</span><span class="o">.</span><span class="n">quit</span><span class="p">)</span>
    <span class="c1"># Configure the menu for the root window</span>
    <span class="n">root</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="n">menu_bar</span><span class="p">)</span></div>


<div class="viewcode-block" id="CustomButton">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.CustomButton">[docs]</a>
<span class="k">class</span> <span class="nc">CustomButton</span><span class="p">(</span><span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">command</span> <span class="o">=</span> <span class="n">command</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Canvas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">highlightthickness</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">button_bg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_rounded_rectangle</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;#800080&quot;</span><span class="p">)</span>

        <span class="c1"># Create a Tkinter font object using OpenSans</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">font_style</span> <span class="o">=</span> <span class="n">tkFont</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">tkFont</span><span class="o">.</span><span class="n">NORMAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_text</span><span class="p">(</span><span class="mi">75</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font_style</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Enter&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_enter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Leave&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_leave</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Button-1&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_click</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Enter&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_enter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Leave&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_leave</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Button-1&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_click</span><span class="p">)</span>

<div class="viewcode-block" id="CustomButton.on_enter">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.CustomButton.on_enter">[docs]</a>
    <span class="k">def</span> <span class="nf">on_enter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">button_bg</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;#993399&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="CustomButton.on_leave">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.CustomButton.on_leave">[docs]</a>
    <span class="k">def</span> <span class="nf">on_leave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">button_bg</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;#800080&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="CustomButton.on_click">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.CustomButton.on_click">[docs]</a>
    <span class="k">def</span> <span class="nf">on_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">command</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">command</span><span class="p">()</span></div>


<div class="viewcode-block" id="CustomButton.create_rounded_rectangle">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.CustomButton.create_rounded_rectangle">[docs]</a>
    <span class="k">def</span> <span class="nf">create_rounded_rectangle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="n">x1</span> <span class="o">+</span> <span class="n">radius</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span>
                  <span class="n">x1</span> <span class="o">+</span> <span class="n">radius</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span>
                  <span class="n">x2</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span>
                  <span class="n">x2</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span>
                  <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span>
                  <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">radius</span><span class="p">,</span>
                  <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">radius</span><span class="p">,</span>
                  <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span>
                  <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span>
                  <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span>
                  <span class="n">x2</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span>
                  <span class="n">x2</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span>
                  <span class="n">x1</span> <span class="o">+</span> <span class="n">radius</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span>
                  <span class="n">x1</span> <span class="o">+</span> <span class="n">radius</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span>
                  <span class="n">x1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span>
                  <span class="n">x1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span>
                  <span class="n">x1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span>
                  <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">radius</span><span class="p">,</span>
                  <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">radius</span><span class="p">,</span>
                  <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_polygon</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">smooth</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>
</div>

    
<div class="viewcode-block" id="ToggleSwitch">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.ToggleSwitch">[docs]</a>
<span class="k">class</span> <span class="nc">ToggleSwitch</span><span class="p">(</span><span class="n">ttk</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">variable</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variable</span> <span class="o">=</span> <span class="n">variable</span> <span class="k">if</span> <span class="n">variable</span> <span class="k">else</span> <span class="n">tk</span><span class="o">.</span><span class="n">BooleanVar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">command</span> <span class="o">=</span> <span class="n">command</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Canvas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">highlightthickness</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bd</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        
        <span class="c1"># Background rounded rectangle with smaller dimensions and no outline</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">switch_bg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_rounded_rectangle</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">outline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;#fff&quot;</span><span class="p">)</span>

        <span class="c1"># Switch ball with no outline</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">switch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_oval</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">outline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;#800080&quot;</span><span class="p">)</span>  <span class="c1"># Purple initially</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">foreground</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Button-1&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">toggle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Button-1&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">toggle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Button-1&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">toggle</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">update_switch</span><span class="p">()</span>

<div class="viewcode-block" id="ToggleSwitch.toggle">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.ToggleSwitch.toggle">[docs]</a>
    <span class="k">def</span> <span class="nf">toggle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">animate_switch</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">command</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">command</span><span class="p">()</span></div>


<div class="viewcode-block" id="ToggleSwitch.update_switch">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.ToggleSwitch.update_switch">[docs]</a>
    <span class="k">def</span> <span class="nf">update_switch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">switch</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;#008080&quot;</span><span class="p">)</span>  <span class="c1"># Teal</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">switch</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>  <span class="c1"># Move switch to the right</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">switch</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;#800080&quot;</span><span class="p">)</span>  <span class="c1"># Purple</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">switch</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>  <span class="c1"># Move switch to the left</span></div>


<div class="viewcode-block" id="ToggleSwitch.animate_switch">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.ToggleSwitch.animate_switch">[docs]</a>
    <span class="k">def</span> <span class="nf">animate_switch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
            <span class="n">start_x</span><span class="p">,</span> <span class="n">end_x</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">24</span>
            <span class="n">final_color</span> <span class="o">=</span> <span class="s2">&quot;#008080&quot;</span>  <span class="c1"># Teal</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">start_x</span><span class="p">,</span> <span class="n">end_x</span> <span class="o">=</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">4</span>
            <span class="n">final_color</span> <span class="o">=</span> <span class="s2">&quot;#800080&quot;</span>  <span class="c1"># Purple</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">animate_movement</span><span class="p">(</span><span class="n">start_x</span><span class="p">,</span> <span class="n">end_x</span><span class="p">,</span> <span class="n">final_color</span><span class="p">)</span></div>


<div class="viewcode-block" id="ToggleSwitch.animate_movement">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.ToggleSwitch.animate_movement">[docs]</a>
    <span class="k">def</span> <span class="nf">animate_movement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_x</span><span class="p">,</span> <span class="n">end_x</span><span class="p">,</span> <span class="n">final_color</span><span class="p">):</span>
        <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">start_x</span> <span class="o">&lt;</span> <span class="n">end_x</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_x</span><span class="p">,</span> <span class="n">end_x</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">switch</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Small delay for smooth animation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">switch</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">final_color</span><span class="p">)</span></div>


<div class="viewcode-block" id="ToggleSwitch.get">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.ToggleSwitch.get">[docs]</a>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>


<div class="viewcode-block" id="ToggleSwitch.set">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.ToggleSwitch.set">[docs]</a>
    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_switch</span><span class="p">()</span></div>


<div class="viewcode-block" id="ToggleSwitch.create_rounded_rectangle">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.ToggleSwitch.create_rounded_rectangle">[docs]</a>
    <span class="k">def</span> <span class="nf">create_rounded_rectangle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># Smaller radius for smaller switch</span>
        <span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="n">x1</span> <span class="o">+</span> <span class="n">radius</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span>
                  <span class="n">x1</span> <span class="o">+</span> <span class="n">radius</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span>
                  <span class="n">x2</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span>
                  <span class="n">x2</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span>
                  <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span>
                  <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">radius</span><span class="p">,</span>
                  <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">radius</span><span class="p">,</span>
                  <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span>
                  <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span>
                  <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span>
                  <span class="n">x2</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span>
                  <span class="n">x2</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span>
                  <span class="n">x1</span> <span class="o">+</span> <span class="n">radius</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span>
                  <span class="n">x1</span> <span class="o">+</span> <span class="n">radius</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span>
                  <span class="n">x1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span>
                  <span class="n">x1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span>
                  <span class="n">x1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span>
                  <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">radius</span><span class="p">,</span>
                  <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">radius</span><span class="p">,</span>
                  <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_polygon</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">smooth</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>
</div>

    
<div class="viewcode-block" id="set_default_font">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.set_default_font">[docs]</a>
<span class="k">def</span> <span class="nf">set_default_font</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">font_name</span><span class="o">=</span><span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">):</span>
    <span class="n">default_font</span> <span class="o">=</span> <span class="p">(</span><span class="n">font_name</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
    <span class="n">root</span><span class="o">.</span><span class="n">option_add</span><span class="p">(</span><span class="s2">&quot;*Font&quot;</span><span class="p">,</span> <span class="n">default_font</span><span class="p">)</span>
    <span class="n">root</span><span class="o">.</span><span class="n">option_add</span><span class="p">(</span><span class="s2">&quot;*TButton.Font&quot;</span><span class="p">,</span> <span class="n">default_font</span><span class="p">)</span>
    <span class="n">root</span><span class="o">.</span><span class="n">option_add</span><span class="p">(</span><span class="s2">&quot;*TLabel.Font&quot;</span><span class="p">,</span> <span class="n">default_font</span><span class="p">)</span>
    <span class="n">root</span><span class="o">.</span><span class="n">option_add</span><span class="p">(</span><span class="s2">&quot;*TEntry.Font&quot;</span><span class="p">,</span> <span class="n">default_font</span><span class="p">)</span></div>


<div class="viewcode-block" id="check_and_download_font">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.check_and_download_font">[docs]</a>
<span class="k">def</span> <span class="nf">check_and_download_font</span><span class="p">():</span>
    <span class="n">font_name</span> <span class="o">=</span> <span class="s2">&quot;Arial&quot;</span>
    <span class="n">font_dir</span> <span class="o">=</span> <span class="s2">&quot;fonts&quot;</span>
    <span class="n">font_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">font_dir</span><span class="p">,</span> <span class="s2">&quot;OpenSans-Regular.ttf&quot;</span><span class="p">)</span>

    <span class="c1"># Check if the font is already available</span>
    <span class="n">available_fonts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tkFont</span><span class="o">.</span><span class="n">families</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">font_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">available_fonts</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Font &#39;</span><span class="si">{</span><span class="n">font_name</span><span class="si">}</span><span class="s2">&#39; not found. Downloading...&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">font_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">font_dir</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">font_path</span><span class="p">):</span>
            <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/google/fonts/blob/main/apache/opensans/OpenSans-Regular.ttf?raw=true&quot;</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">font_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

        <span class="c1"># Load the font</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tkFont</span><span class="o">.</span><span class="n">nametofont</span><span class="p">(</span><span class="s2">&quot;TkDefaultFont&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="n">font_name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">tkFont</span><span class="o">.</span><span class="n">nametofont</span><span class="p">(</span><span class="s2">&quot;TkTextFont&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="n">font_name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">tkFont</span><span class="o">.</span><span class="n">nametofont</span><span class="p">(</span><span class="s2">&quot;TkHeadingFont&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="n">font_name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">tk</span><span class="o">.</span><span class="n">TclError</span><span class="p">:</span>
            <span class="n">tkFont</span><span class="o">.</span><span class="n">nametofont</span><span class="p">(</span><span class="s2">&quot;TkDefaultFont&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">tkFont</span><span class="o">.</span><span class="n">nametofont</span><span class="p">(</span><span class="s2">&quot;TkTextFont&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">tkFont</span><span class="o">.</span><span class="n">nametofont</span><span class="p">(</span><span class="s2">&quot;TkHeadingFont&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tkFont</span><span class="o">.</span><span class="n">nametofont</span><span class="p">(</span><span class="s2">&quot;TkDefaultFont&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="n">font_name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">tkFont</span><span class="o">.</span><span class="n">nametofont</span><span class="p">(</span><span class="s2">&quot;TkTextFont&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="n">font_name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">tkFont</span><span class="o">.</span><span class="n">nametofont</span><span class="p">(</span><span class="s2">&quot;TkHeadingFont&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="n">font_name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span></div>


<div class="viewcode-block" id="style_text_boxes">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.style_text_boxes">[docs]</a>
<span class="k">def</span> <span class="nf">style_text_boxes</span><span class="p">(</span><span class="n">style</span><span class="p">):</span>
    <span class="n">check_and_download_font</span><span class="p">()</span>
    <span class="n">font_style</span> <span class="o">=</span> <span class="n">tkFont</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Define the Arial font</span>
    <span class="n">style</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s1">&#39;TEntry&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;5 5 5 5&#39;</span><span class="p">,</span> <span class="n">borderwidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">relief</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span> <span class="n">fieldbackground</span><span class="o">=</span><span class="s1">&#39;#000000&#39;</span><span class="p">,</span> <span class="n">foreground</span><span class="o">=</span><span class="s1">&#39;#ffffff&#39;</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">font_style</span><span class="p">)</span>
    <span class="n">style</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s1">&#39;TCombobox&#39;</span><span class="p">,</span> <span class="n">fieldbackground</span><span class="o">=</span><span class="s1">&#39;#000000&#39;</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="s1">&#39;#000000&#39;</span><span class="p">,</span> <span class="n">foreground</span><span class="o">=</span><span class="s1">&#39;#ffffff&#39;</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">font_style</span><span class="p">)</span>
    <span class="n">style</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s1">&#39;Custom.TButton&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;10 10 10 10&#39;</span><span class="p">,</span> <span class="n">borderwidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">relief</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="s1">&#39;#008080&#39;</span><span class="p">,</span> <span class="n">foreground</span><span class="o">=</span><span class="s1">&#39;#ffffff&#39;</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">font_style</span><span class="p">)</span>
    <span class="n">style</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="s1">&#39;Custom.TButton&#39;</span><span class="p">,</span>
              <span class="n">background</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="s1">&#39;#66b2b2&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;disabled&#39;</span><span class="p">,</span> <span class="s1">&#39;#004d4d&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;!disabled&#39;</span><span class="p">,</span> <span class="s1">&#39;#008080&#39;</span><span class="p">)],</span>
              <span class="n">foreground</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="s1">&#39;#ffffff&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;disabled&#39;</span><span class="p">,</span> <span class="s1">&#39;#888888&#39;</span><span class="p">)])</span>
    <span class="n">style</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s1">&#39;Custom.TLabel&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;5 5 5 5&#39;</span><span class="p">,</span> <span class="n">borderwidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">relief</span><span class="o">=</span><span class="s1">&#39;flat&#39;</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="s1">&#39;#000000&#39;</span><span class="p">,</span> <span class="n">foreground</span><span class="o">=</span><span class="s1">&#39;#ffffff&#39;</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">font_style</span><span class="p">)</span>
    <span class="n">style</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s1">&#39;TCheckbutton&#39;</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="s1">&#39;#333333&#39;</span><span class="p">,</span> <span class="n">foreground</span><span class="o">=</span><span class="s1">&#39;#ffffff&#39;</span><span class="p">,</span> <span class="n">indicatoron</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">relief</span><span class="o">=</span><span class="s1">&#39;flat&#39;</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">font_style</span><span class="p">)</span>
    <span class="n">style</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="s1">&#39;TCheckbutton&#39;</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;selected&#39;</span><span class="p">,</span> <span class="s1">&#39;#555555&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="s1">&#39;#555555&#39;</span><span class="p">)])</span></div>




<div class="viewcode-block" id="read_settings_from_csv">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.read_settings_from_csv">[docs]</a>
<span class="k">def</span> <span class="nf">read_settings_from_csv</span><span class="p">(</span><span class="n">csv_file_path</span><span class="p">):</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">csv_file_path</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">csvfile</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Key&#39;</span><span class="p">]</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span>
            <span class="n">settings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">settings</span></div>


<div class="viewcode-block" id="update_settings_from_csv">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.update_settings_from_csv">[docs]</a>
<span class="k">def</span> <span class="nf">update_settings_from_csv</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="n">csv_settings</span><span class="p">):</span>
    <span class="n">new_settings</span> <span class="o">=</span> <span class="n">variables</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># Start with a copy of the original settings</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">csv_settings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">new_settings</span><span class="p">:</span>
            <span class="c1"># Get the variable type and options from the original settings</span>
            <span class="n">var_type</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">new_settings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="c1"># Update the default value with the CSV value, keeping the type and options unchanged</span>
            <span class="n">new_settings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">var_type</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_settings</span></div>


<div class="viewcode-block" id="safe_literal_eval">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.safe_literal_eval">[docs]</a>
<span class="k">def</span> <span class="nf">safe_literal_eval</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># First, try to evaluate as a literal</span>
        <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">SyntaxError</span><span class="p">):</span>
        <span class="c1"># If it fails, return the value as it is (a string)</span>
        <span class="k">return</span> <span class="n">value</span></div>


<div class="viewcode-block" id="disable_interactivity">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.disable_interactivity">[docs]</a>
<span class="k">def</span> <span class="nf">disable_interactivity</span><span class="p">(</span><span class="n">fig</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span> <span class="s1">&#39;toolbar&#39;</span><span class="p">):</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">pack_forget</span><span class="p">()</span>

    <span class="n">event_handlers</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">callbacks</span>
    <span class="k">for</span> <span class="n">event</span><span class="p">,</span> <span class="n">handlers</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">event_handlers</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="k">for</span> <span class="n">handler_id</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">handlers</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_disconnect</span><span class="p">(</span><span class="n">handler_id</span><span class="p">)</span></div>


<div class="viewcode-block" id="ScrollableFrame">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.ScrollableFrame">[docs]</a>
<span class="k">class</span> <span class="nc">ScrollableFrame</span><span class="p">(</span><span class="n">ttk</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;TFrame&#39;</span><span class="p">)</span>  <span class="c1"># Ensure this uses the styled frame from dark mode</span>
        
        <span class="n">canvas</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Canvas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>  <span class="c1"># Set canvas background to match dark mode</span>
        <span class="n">scrollbar</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Scrollbar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="n">canvas</span><span class="o">.</span><span class="n">yview</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">scrollable_frame</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;TFrame&#39;</span><span class="p">)</span>  <span class="c1"># Ensure it uses the styled frame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scrollable_frame</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span>
            <span class="s2">&quot;&lt;Configure&gt;&quot;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">canvas</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">scrollregion</span><span class="o">=</span><span class="n">canvas</span><span class="o">.</span><span class="n">bbox</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">))</span>
        <span class="p">)</span>
        
        <span class="n">canvas</span><span class="o">.</span><span class="n">create_window</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">window</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scrollable_frame</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="s2">&quot;nw&quot;</span><span class="p">)</span>
        <span class="n">canvas</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">yscrollcommand</span><span class="o">=</span><span class="n">scrollbar</span><span class="o">.</span><span class="n">set</span><span class="p">)</span>
        
        <span class="n">canvas</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">scrollbar</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="StdoutRedirector">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.StdoutRedirector">[docs]</a>
<span class="k">class</span> <span class="nc">StdoutRedirector</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text_widget</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span> <span class="o">=</span> <span class="n">text_widget</span>

<div class="viewcode-block" id="StdoutRedirector.write">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.StdoutRedirector.write">[docs]</a>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">see</span><span class="p">(</span><span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">)</span></div>


<div class="viewcode-block" id="StdoutRedirector.flush">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.StdoutRedirector.flush">[docs]</a>
    <span class="k">def</span> <span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>
</div>


<div class="viewcode-block" id="check_mask_gui_settings">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.check_mask_gui_settings">[docs]</a>
<span class="k">def</span> <span class="nf">check_mask_gui_settings</span><span class="p">(</span><span class="n">vars_dict</span><span class="p">):</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">vars_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        
        <span class="c1"># Handle conversion for specific types if necessary</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;channels&#39;</span><span class="p">,</span> <span class="s1">&#39;timelapse_frame_limits&#39;</span><span class="p">]:</span>  <span class="c1"># Assuming these should be lists</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Convert string representation of a list into an actual list</span>
                <span class="n">settings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">messagebox</span><span class="o">.</span><span class="n">showerror</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Invalid format for </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">. Please enter a valid list.&quot;</span><span class="p">)</span>
                <span class="k">return</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;nucleus_channel&#39;</span><span class="p">,</span> <span class="s1">&#39;cell_channel&#39;</span><span class="p">,</span> <span class="s1">&#39;pathogen_channel&#39;</span><span class="p">,</span> <span class="s1">&#39;examples_to_plot&#39;</span><span class="p">,</span> <span class="s1">&#39;batch_size&#39;</span><span class="p">,</span> <span class="s1">&#39;timelapse_memory&#39;</span><span class="p">,</span> <span class="s1">&#39;workers&#39;</span><span class="p">,</span> <span class="s1">&#39;fps&#39;</span><span class="p">,</span> <span class="s1">&#39;magnification&#39;</span><span class="p">]:</span>  <span class="c1"># Assuming these should be integers</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">settings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="n">value</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">messagebox</span><span class="o">.</span><span class="n">showerror</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Invalid number for </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
                <span class="k">return</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;nucleus_background&#39;</span><span class="p">,</span> <span class="s1">&#39;cell_background&#39;</span><span class="p">,</span> <span class="s1">&#39;pathogen_background&#39;</span><span class="p">,</span> <span class="s1">&#39;nucleus_Signal_to_noise&#39;</span><span class="p">,</span> <span class="s1">&#39;cell_Signal_to_noise&#39;</span><span class="p">,</span> <span class="s1">&#39;pathogen_Signal_to_noise&#39;</span><span class="p">,</span> <span class="s1">&#39;nucleus_CP_prob&#39;</span><span class="p">,</span> <span class="s1">&#39;cell_CP_prob&#39;</span><span class="p">,</span> <span class="s1">&#39;pathogen_CP_prob&#39;</span><span class="p">,</span> <span class="s1">&#39;lower_quantile&#39;</span><span class="p">]:</span>  <span class="c1"># Assuming these should be floats</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">settings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="n">value</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">messagebox</span><span class="o">.</span><span class="n">showerror</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Invalid number for </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
                <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">settings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">settings</span></div>


<div class="viewcode-block" id="check_measure_gui_settings">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.check_measure_gui_settings">[docs]</a>
<span class="k">def</span> <span class="nf">check_measure_gui_settings</span><span class="p">(</span><span class="n">vars_dict</span><span class="p">):</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">vars_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>  <span class="c1"># Retrieves the string representation for entries or the actual value for checkboxes and combos.</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;channels&#39;</span><span class="p">,</span> <span class="s1">&#39;png_dims&#39;</span><span class="p">]:</span>
                <span class="n">settings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">chan</span><span class="p">)</span> <span class="k">for</span> <span class="n">chan</span> <span class="ow">in</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span> <span class="k">if</span> <span class="n">value</span> <span class="k">else</span> <span class="p">[]</span>
                
            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cell_loc&#39;</span><span class="p">,</span> <span class="s1">&#39;pathogen_loc&#39;</span><span class="p">,</span> <span class="s1">&#39;treatment_loc&#39;</span><span class="p">]:</span>
                <span class="c1"># Convert to a list of lists of strings, ensuring all structures are lists.</span>
                <span class="n">settings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">sublist</span><span class="p">))</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span> <span class="k">if</span> <span class="n">value</span> <span class="k">else</span> <span class="p">[]</span>

            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;dialate_png_ratios&#39;</span><span class="p">:</span>
                <span class="n">settings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span> <span class="k">if</span> <span class="n">value</span> <span class="k">else</span> <span class="p">[]</span>

            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;normalize&#39;</span><span class="p">:</span>
                <span class="n">settings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span> <span class="k">if</span> <span class="n">value</span> <span class="k">else</span> <span class="p">[]</span>

            <span class="c1"># Directly assign string values for these specific keys</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;normalize_by&#39;</span><span class="p">,</span> <span class="s1">&#39;experiment&#39;</span><span class="p">,</span> <span class="s1">&#39;measurement&#39;</span><span class="p">,</span> <span class="s1">&#39;input_folder&#39;</span><span class="p">]:</span>
                <span class="n">settings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;png_size&#39;</span><span class="p">:</span>
                <span class="n">settings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">dim</span><span class="p">))</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span> <span class="k">if</span> <span class="n">value</span> <span class="k">else</span> <span class="p">[]</span>
            
            <span class="c1"># Ensure these are lists of strings, converting from tuples if necessary</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;timelapse_objects&#39;</span><span class="p">,</span> <span class="s1">&#39;crop_mode&#39;</span><span class="p">,</span> <span class="s1">&#39;cells&#39;</span><span class="p">,</span> <span class="s1">&#39;pathogens&#39;</span><span class="p">,</span> <span class="s1">&#39;treatments&#39;</span><span class="p">]:</span>
                <span class="n">eval_value</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="n">value</span> <span class="k">else</span> <span class="p">[]</span>
                <span class="n">settings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">eval_value</span><span class="p">))</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">eval_value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="k">else</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">eval_value</span><span class="p">)]</span>

            <span class="c1"># Handling for single non-string values (int, float, bool)</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cell_mask_dim&#39;</span><span class="p">,</span> <span class="s1">&#39;cell_min_size&#39;</span><span class="p">,</span> <span class="s1">&#39;nucleus_mask_dim&#39;</span><span class="p">,</span> <span class="s1">&#39;nucleus_min_size&#39;</span><span class="p">,</span> <span class="s1">&#39;pathogen_mask_dim&#39;</span><span class="p">,</span> <span class="s1">&#39;pathogen_min_size&#39;</span><span class="p">,</span> <span class="s1">&#39;cytoplasm_min_size&#39;</span><span class="p">,</span> <span class="s1">&#39;max_workers&#39;</span><span class="p">,</span> <span class="s1">&#39;channel_of_interest&#39;</span><span class="p">,</span> <span class="s1">&#39;nr_imgs&#39;</span><span class="p">]:</span>
                <span class="n">settings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="n">value</span> <span class="k">else</span> <span class="kc">None</span>

            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;um_per_pixel&#39;</span><span class="p">:</span>
                <span class="n">settings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="n">value</span> <span class="k">else</span> <span class="kc">None</span>

            <span class="c1"># Handling boolean values based on checkboxes</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;save_png&#39;</span><span class="p">,</span> <span class="s1">&#39;use_bounding_box&#39;</span><span class="p">,</span> <span class="s1">&#39;save_measurements&#39;</span><span class="p">,</span> <span class="s1">&#39;plot&#39;</span><span class="p">,</span> <span class="s1">&#39;plot_filtration&#39;</span><span class="p">,</span> <span class="s1">&#39;include_uninfected&#39;</span><span class="p">,</span> <span class="s1">&#39;dialate_pngs&#39;</span><span class="p">,</span> <span class="s1">&#39;timelapse&#39;</span><span class="p">,</span> <span class="s1">&#39;representative_images&#39;</span><span class="p">]:</span>
                <span class="n">settings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">SyntaxError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Syntax error processing </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1">#messagebox.showerror(&quot;Error&quot;, f&quot;Syntax error processing {key}: {str(e)}&quot;)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1">#messagebox.showerror(&quot;Error&quot;, f&quot;Error processing {key}: {str(e)}&quot;)</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">settings</span></div>


<div class="viewcode-block" id="check_classify_gui_settings">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.check_classify_gui_settings">[docs]</a>
<span class="k">def</span> <span class="nf">check_classify_gui_settings</span><span class="p">(</span><span class="n">vars_dict</span><span class="p">):</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">vars_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>  <span class="c1"># This retrieves the string representation for entries or the actual value for checkboxes and combos</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">,</span> <span class="s1">&#39;measurement&#39;</span><span class="p">]:</span>
                <span class="c1"># Directly assign string values</span>
                <span class="n">settings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cell_mask_dim&#39;</span><span class="p">,</span> <span class="s1">&#39;image_size&#39;</span><span class="p">,</span> <span class="s1">&#39;batch_size&#39;</span><span class="p">,</span> <span class="s1">&#39;epochs&#39;</span><span class="p">,</span> <span class="s1">&#39;gradient_accumulation_steps&#39;</span><span class="p">,</span> <span class="s1">&#39;num_workers&#39;</span><span class="p">]:</span>
                <span class="c1"># Convert to integer</span>
                <span class="n">settings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;val_split&#39;</span><span class="p">,</span> <span class="s1">&#39;learning_rate&#39;</span><span class="p">,</span> <span class="s1">&#39;weight_decay&#39;</span><span class="p">,</span> <span class="s1">&#39;dropout_rate&#39;</span><span class="p">]:</span>
                <span class="c1"># Convert to float</span>
                <span class="n">settings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;classes&#39;</span><span class="p">:</span>
                <span class="c1"># Evaluate as list</span>
                <span class="n">settings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;model_type&#39;</span><span class="p">,</span><span class="s1">&#39;optimizer_type&#39;</span><span class="p">,</span><span class="s1">&#39;schedule&#39;</span><span class="p">,</span><span class="s1">&#39;loss_type&#39;</span><span class="p">,</span><span class="s1">&#39;train_mode&#39;</span><span class="p">]:</span>
                <span class="n">settings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;gradient_accumulation&#39;</span><span class="p">,</span><span class="s1">&#39;normalize&#39;</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="s1">&#39;plot&#39;</span><span class="p">,</span> <span class="s1">&#39;init_weights&#39;</span><span class="p">,</span><span class="s1">&#39;amsgrad&#39;</span><span class="p">,</span><span class="s1">&#39;use_checkpoint&#39;</span><span class="p">,</span><span class="s1">&#39;intermedeate_save&#39;</span><span class="p">,</span><span class="s1">&#39;pin_memory&#39;</span><span class="p">,</span> <span class="s1">&#39;num_workers&#39;</span><span class="p">,</span><span class="s1">&#39;verbose&#39;</span><span class="p">]:</span>
                <span class="n">settings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">SyntaxError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">messagebox</span><span class="o">.</span><span class="n">showerror</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Syntax error processing </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">messagebox</span><span class="o">.</span><span class="n">showerror</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Error processing </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">settings</span></div>


<div class="viewcode-block" id="check_sim_gui_settings">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.check_sim_gui_settings">[docs]</a>
<span class="k">def</span> <span class="nf">check_sim_gui_settings</span><span class="p">(</span><span class="n">vars_dict</span><span class="p">):</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">vars_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>  <span class="c1"># This retrieves the string representation for entries or the actual value for checkboxes and combos</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;variable&#39;</span><span class="p">]:</span>
                <span class="c1"># Directly assign string values</span>
                <span class="n">settings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            
            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;nr_plates&#39;</span><span class="p">,</span> <span class="s1">&#39;number_of_genes&#39;</span><span class="p">,</span><span class="s1">&#39;number_of_active_genes&#39;</span><span class="p">,</span><span class="s1">&#39;avg_genes_per_well&#39;</span><span class="p">,</span><span class="s1">&#39;avg_cells_per_well&#39;</span><span class="p">,</span><span class="s1">&#39;avg_reads_per_gene&#39;</span><span class="p">]:</span>
                <span class="c1">#generate list of integers from list</span>
                <span class="n">ls</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">ls</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">list_of_integers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ls</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ls</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                    <span class="n">list_of_integers</span> <span class="o">=</span> <span class="p">[</span><span class="n">num</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">num</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">list_of_integers</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">list_of_integers</span> <span class="o">=</span> <span class="p">[</span><span class="n">ls</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="n">settings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">list_of_integers</span>
                
            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;sequencing_error&#39;</span><span class="p">,</span><span class="s1">&#39;well_ineq_coeff&#39;</span><span class="p">,</span><span class="s1">&#39;gene_ineq_coeff&#39;</span><span class="p">,</span> <span class="s1">&#39;positive_mean&#39;</span><span class="p">]:</span>
                <span class="c1">#generate list of floats from list</span>
                <span class="n">ls</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">ls</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">list_of_floats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ls</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ls</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="n">list_of_floats</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                    <span class="n">list_of_floats</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="mf">0.0</span> <span class="k">else</span> <span class="n">x</span> <span class="o">+</span> <span class="mf">0.01</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_floats</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">list_of_floats</span> <span class="o">=</span> <span class="p">[</span><span class="n">ls</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="n">settings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">list_of_floats</span>

            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;plot&#39;</span><span class="p">,</span> <span class="s1">&#39;random_seed&#39;</span><span class="p">]:</span>
                <span class="c1"># Evaluate as bool</span>
                <span class="n">settings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                
            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;number_of_control_genes&#39;</span><span class="p">,</span> <span class="s1">&#39;replicates&#39;</span><span class="p">,</span> <span class="s1">&#39;max_workers&#39;</span><span class="p">]:</span>
                <span class="c1"># Convert to integer</span>
                <span class="n">settings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                
        <span class="k">except</span> <span class="ne">SyntaxError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">messagebox</span><span class="o">.</span><span class="n">showerror</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Syntax error processing </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">messagebox</span><span class="o">.</span><span class="n">showerror</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Error processing </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">settings</span></div>


<div class="viewcode-block" id="sim_variables">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.sim_variables">[docs]</a>
<span class="k">def</span> <span class="nf">sim_variables</span><span class="p">():</span>
    <span class="n">variables</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;plates_2_4_8&#39;</span><span class="p">),</span>
        <span class="s1">&#39;variable&#39;</span><span class="p">:(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">),</span>
        <span class="s1">&#39;src&#39;</span><span class="p">:(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;/home/olafsson/Desktop/simulations&#39;</span><span class="p">),</span>
        <span class="s1">&#39;number_of_control_genes&#39;</span><span class="p">:(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
        <span class="s1">&#39;replicates&#39;</span><span class="p">:(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
        <span class="s1">&#39;max_workers&#39;</span><span class="p">:(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;plot&#39;</span><span class="p">:(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;random_seed&#39;</span><span class="p">:(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;nr_plates&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;[8,8,0]&#39;</span><span class="p">),</span><span class="c1"># &#39;[2,2,8]&#39;</span>
        <span class="s1">&#39;number_of_genes&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;[100, 100, 0]&#39;</span><span class="p">),</span> <span class="c1">#[1384, 1384, 0]</span>
        <span class="s1">&#39;number_of_active_genes&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;[10,10,0]&#39;</span><span class="p">),</span>
        <span class="s1">&#39;avg_genes_per_well&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;[2, 10, 2]&#39;</span><span class="p">),</span>
        <span class="s1">&#39;avg_cells_per_well&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;[100, 100, 0]&#39;</span><span class="p">),</span>
        <span class="s1">&#39;positive_mean&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;[0.8, 0.8, 0]&#39;</span><span class="p">),</span>
        <span class="s1">&#39;avg_reads_per_gene&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;[1000,1000, 0]&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sequencing_error&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;[0.01, 0.01, 0]&#39;</span><span class="p">),</span>
        <span class="s1">&#39;well_ineq_coeff&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;[0.3,0.3,0]&#39;</span><span class="p">),</span>
        <span class="s1">&#39;gene_ineq_coeff&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;[0.8,0.8,0]&#39;</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">variables</span></div>


<div class="viewcode-block" id="add_measure_gui_defaults">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.add_measure_gui_defaults">[docs]</a>
<span class="k">def</span> <span class="nf">add_measure_gui_defaults</span><span class="p">(</span><span class="n">settings</span><span class="p">):</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;compartments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pathogen&#39;</span><span class="p">,</span> <span class="s1">&#39;cytoplasm&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">settings</span></div>


<div class="viewcode-block" id="measure_variables">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.measure_variables">[docs]</a>
<span class="k">def</span> <span class="nf">measure_variables</span><span class="p">():</span>
    <span class="n">variables</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;input_folder&#39;</span><span class="p">:(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;/mnt/data/CellVoyager/40x/einar/mitotrackerHeLaToxoDsRed_20240224_123156/test_gui/merged&#39;</span><span class="p">),</span>
        <span class="s1">&#39;channels&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;combo&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;[0,1,2,3]&#39;</span><span class="p">,</span><span class="s1">&#39;[0,1,2]&#39;</span><span class="p">,</span><span class="s1">&#39;[0,1]&#39;</span><span class="p">,</span><span class="s1">&#39;[0]&#39;</span><span class="p">],</span> <span class="s1">&#39;[0,1,2,3]&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cell_mask_dim&#39;</span><span class="p">:(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
        <span class="s1">&#39;cell_min_size&#39;</span><span class="p">:(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="s1">&#39;cytoplasm_min_size&#39;</span><span class="p">:(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="s1">&#39;nucleus_mask_dim&#39;</span><span class="p">:(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
        <span class="s1">&#39;nucleus_min_size&#39;</span><span class="p">:(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="s1">&#39;pathogen_mask_dim&#39;</span><span class="p">:(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
        <span class="s1">&#39;pathogen_min_size&#39;</span><span class="p">:(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="s1">&#39;save_png&#39;</span><span class="p">:(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;crop_mode&#39;</span><span class="p">:(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;[&quot;cell&quot;]&#39;</span><span class="p">),</span>
        <span class="s1">&#39;use_bounding_box&#39;</span><span class="p">:(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;png_size&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;[[224,224]]&#39;</span><span class="p">),</span> 
        <span class="s1">&#39;normalize&#39;</span><span class="p">:(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;[2,98]&#39;</span><span class="p">),</span>
        <span class="s1">&#39;png_dims&#39;</span><span class="p">:(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;[1,2,3]&#39;</span><span class="p">),</span>
        <span class="s1">&#39;normalize_by&#39;</span><span class="p">:(</span><span class="s1">&#39;combo&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;fov&#39;</span><span class="p">,</span> <span class="s1">&#39;png&#39;</span><span class="p">],</span> <span class="s1">&#39;png&#39;</span><span class="p">),</span>
        <span class="s1">&#39;save_measurements&#39;</span><span class="p">:(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;representative_images&#39;</span><span class="p">:(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;plot&#39;</span><span class="p">:(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;plot_filtration&#39;</span><span class="p">:(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;include_uninfected&#39;</span><span class="p">:(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;dialate_pngs&#39;</span><span class="p">:(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="s1">&#39;dialate_png_ratios&#39;</span><span class="p">:(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;[0.2]&#39;</span><span class="p">),</span>
        <span class="s1">&#39;timelapse&#39;</span><span class="p">:(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="s1">&#39;timelapse_objects&#39;</span><span class="p">:(</span><span class="s1">&#39;combo&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;[&quot;cell&quot;]&#39;</span><span class="p">,</span> <span class="s1">&#39;[&quot;nucleus&quot;]&#39;</span><span class="p">,</span> <span class="s1">&#39;[&quot;pathogen&quot;]&#39;</span><span class="p">,</span> <span class="s1">&#39;[&quot;cytoplasm&quot;]&#39;</span><span class="p">],</span> <span class="s1">&#39;[&quot;cell&quot;]&#39;</span><span class="p">),</span>
        <span class="s1">&#39;max_workers&#39;</span><span class="p">:(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
        <span class="s1">&#39;experiment&#39;</span><span class="p">:(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;experiment name&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cells&#39;</span><span class="p">:(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;HeLa&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;cell_loc&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;[[&quot;c1&quot;,&quot;c2&quot;], [&quot;c3&quot;,&quot;c4&quot;]]&#39;</span><span class="p">),</span>
        <span class="s1">&#39;pathogens&#39;</span><span class="p">:(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;[&quot;wt&quot;,&quot;mutant&quot;]&#39;</span><span class="p">),</span>
        <span class="s1">&#39;pathogen_loc&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;[[&quot;c1&quot;,&quot;c2&quot;], [&quot;c3&quot;,&quot;c4&quot;]]&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatments&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;[&quot;cm&quot;,&quot;lovastatin_20uM&quot;]&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_loc&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;[[&quot;c1&quot;,&quot;c2&quot;], [&quot;c3&quot;,&quot;c4&quot;]]&#39;</span><span class="p">),</span>
        <span class="s1">&#39;channel_of_interest&#39;</span><span class="p">:(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
        <span class="s1">&#39;compartments&#39;</span><span class="p">:(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;[&quot;pathogen&quot;,&quot;cytoplasm&quot;]&#39;</span><span class="p">),</span>
        <span class="s1">&#39;measurement&#39;</span><span class="p">:(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;mean_intensity&#39;</span><span class="p">),</span>
        <span class="s1">&#39;nr_imgs&#39;</span><span class="p">:(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
        <span class="s1">&#39;um_per_pixel&#39;</span><span class="p">:(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">variables</span></div>


<div class="viewcode-block" id="classify_variables">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.classify_variables">[docs]</a>
<span class="k">def</span> <span class="nf">classify_variables</span><span class="p">():</span>
    
    <span class="k">def</span> <span class="nf">get_torchvision_models</span><span class="p">():</span>
        <span class="c1"># Fetch all public callable attributes from torchvision.models that are functions</span>
        <span class="n">model_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="n">models</span><span class="p">)</span> 
                    <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isfunction</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">model_names</span>
    
    <span class="n">model_names</span> <span class="o">=</span> <span class="n">get_torchvision_models</span><span class="p">()</span>
    <span class="n">variables</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;src&#39;</span><span class="p">:(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;/mnt/data/CellVoyager/40x/einar/mitotrackerHeLaToxoDsRed_20240224_123156/test_gui/merged&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cell_mask_dim&#39;</span><span class="p">:(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
        <span class="s1">&#39;classes&#39;</span><span class="p">:(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;[&quot;nc&quot;,&quot;pc&quot;]&#39;</span><span class="p">),</span>
        <span class="s1">&#39;measurement&#39;</span><span class="p">:(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;mean_intensity&#39;</span><span class="p">),</span>
        <span class="s1">&#39;model_type&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;combo&#39;</span><span class="p">,</span> <span class="n">model_names</span><span class="p">,</span> <span class="s1">&#39;resnet50&#39;</span><span class="p">),</span>
        <span class="s1">&#39;optimizer_type&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;combo&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;adamw&#39;</span><span class="p">,</span><span class="s1">&#39;adam&#39;</span><span class="p">],</span> <span class="s1">&#39;adamw&#39;</span><span class="p">),</span>
        <span class="s1">&#39;schedule&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;combo&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;reduce_lr_on_plateau&#39;</span><span class="p">,</span><span class="s1">&#39;step_lr&#39;</span><span class="p">],</span> <span class="s1">&#39;reduce_lr_on_plateau&#39;</span><span class="p">),</span>
        <span class="s1">&#39;loss_type&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;combo&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;focal_loss&#39;</span><span class="p">,</span> <span class="s1">&#39;binary_cross_entropy_with_logits&#39;</span><span class="p">],</span> <span class="s1">&#39;focal_loss&#39;</span><span class="p">),</span>
        <span class="s1">&#39;image_size&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">224</span><span class="p">),</span>
        <span class="s1">&#39;batch_size&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
        <span class="s1">&#39;epochs&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
        <span class="s1">&#39;val_split&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
        <span class="s1">&#39;train_mode&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;combo&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;erm&#39;</span><span class="p">,</span> <span class="s1">&#39;irm&#39;</span><span class="p">],</span> <span class="s1">&#39;erm&#39;</span><span class="p">),</span>
        <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mf">0.0001</span><span class="p">),</span>
        <span class="s1">&#39;weight_decay&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mf">0.00001</span><span class="p">),</span>
        <span class="s1">&#39;dropout_rate&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
        <span class="s1">&#39;gradient_accumulation&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;gradient_accumulation_steps&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
        <span class="s1">&#39;normalize&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;save&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span> 
        <span class="s1">&#39;plot&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;init_weights&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;amsgrad&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;use_checkpoint&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;intermedeate_save&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;pin_memory&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;num_workers&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
        <span class="s1">&#39;verbose&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">variables</span></div>

    
<div class="viewcode-block" id="create_input_field">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.create_input_field">[docs]</a>
<span class="k">def</span> <span class="nf">create_input_field</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">label_text</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">var_type</span><span class="o">=</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">label_text</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;Custom.TLabel&#39;</span><span class="p">)</span>  <span class="c1"># Apply Custom.TLabel style for labels</span>
    <span class="n">label</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">var_type</span> <span class="o">==</span> <span class="s1">&#39;entry&#39;</span><span class="p">:</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">StringVar</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">default_value</span><span class="p">)</span>  <span class="c1"># Set default value</span>
        <span class="n">entry</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">textvariable</span><span class="o">=</span><span class="n">var</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;TEntry&#39;</span><span class="p">)</span>  <span class="c1"># Apply TEntry style for entries</span>
        <span class="n">entry</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">EW</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>  <span class="c1"># Return both the label and the entry, and the variable</span>
    <span class="k">elif</span> <span class="n">var_type</span> <span class="o">==</span> <span class="s1">&#39;check&#39;</span><span class="p">:</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">BooleanVar</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">default_value</span><span class="p">)</span>  <span class="c1"># Set default value (True/False)</span>
        <span class="n">check</span> <span class="o">=</span> <span class="n">ToggleSwitch</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">label_text</span><span class="p">,</span> <span class="n">variable</span><span class="o">=</span><span class="n">var</span><span class="p">)</span>  <span class="c1"># Use ToggleSwitch class</span>
        <span class="n">check</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">check</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>  <span class="c1"># Return both the label and the checkbutton, and the variable</span>
    <span class="k">elif</span> <span class="n">var_type</span> <span class="o">==</span> <span class="s1">&#39;combo&#39;</span><span class="p">:</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">StringVar</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">default_value</span><span class="p">)</span>  <span class="c1"># Set default value</span>
        <span class="n">combo</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Combobox</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">textvariable</span><span class="o">=</span><span class="n">var</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">options</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;TCombobox&#39;</span><span class="p">)</span>  <span class="c1"># Apply TCombobox style</span>
        <span class="n">combo</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">EW</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">default_value</span><span class="p">:</span>
            <span class="n">combo</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">default_value</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">combo</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>  <span class="c1"># Return both the label and the combobox, and the variable</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">var</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Placeholder in case of an undefined var_type</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span></div>


<div class="viewcode-block" id="mask_variables">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.mask_variables">[docs]</a>
<span class="k">def</span> <span class="nf">mask_variables</span><span class="p">():</span>
    <span class="n">variables</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;src&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;/mnt/data/CellVoyager/40x/einar/mitotrackerHeLaToxoDsRed_20240224_123156/test_gui&#39;</span><span class="p">),</span>
        <span class="s1">&#39;metadata_type&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;combo&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;cellvoyager&#39;</span><span class="p">,</span> <span class="s1">&#39;cq1&#39;</span><span class="p">,</span> <span class="s1">&#39;nikon&#39;</span><span class="p">,</span> <span class="s1">&#39;zeis&#39;</span><span class="p">,</span> <span class="s1">&#39;custom&#39;</span><span class="p">],</span> <span class="s1">&#39;cellvoyager&#39;</span><span class="p">),</span>
        <span class="s1">&#39;custom_regex&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="s1">&#39;experiment&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;exp&#39;</span><span class="p">),</span>
        <span class="s1">&#39;channels&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;combo&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;[0,1,2,3]&#39;</span><span class="p">,</span><span class="s1">&#39;[0,1,2]&#39;</span><span class="p">,</span><span class="s1">&#39;[0,1]&#39;</span><span class="p">,</span><span class="s1">&#39;[0]&#39;</span><span class="p">],</span> <span class="s1">&#39;[0,1,2,3]&#39;</span><span class="p">),</span>
        <span class="s1">&#39;magnification&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;combo&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">60</span><span class="p">,],</span> <span class="mi">40</span><span class="p">),</span>
        <span class="s1">&#39;nucleus_channel&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;combo&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span>
        <span class="s1">&#39;nucleus_background&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
        <span class="s1">&#39;nucleus_Signal_to_noise&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
        <span class="s1">&#39;nucleus_CP_prob&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="s1">&#39;cell_channel&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;combo&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="mi">3</span><span class="p">),</span>
        <span class="s1">&#39;cell_background&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
        <span class="s1">&#39;cell_Signal_to_noise&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
        <span class="s1">&#39;cell_CP_prob&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="s1">&#39;pathogen_channel&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;combo&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span>
        <span class="s1">&#39;pathogen_background&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
        <span class="s1">&#39;pathogen_Signal_to_noise&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
        <span class="s1">&#39;pathogen_CP_prob&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="s1">&#39;preprocess&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;masks&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;examples_to_plot&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;randomize&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;batch_size&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
        <span class="s1">&#39;timelapse&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="s1">&#39;timelapse_displacement&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="s1">&#39;timelapse_memory&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="s1">&#39;timelapse_frame_limits&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;[0,1000]&#39;</span><span class="p">),</span>
        <span class="s1">&#39;timelapse_remove_transient&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;timelapse_mode&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;combo&#39;</span><span class="p">,</span>  <span class="p">[</span><span class="s1">&#39;trackpy&#39;</span><span class="p">,</span> <span class="s1">&#39;btrack&#39;</span><span class="p">],</span> <span class="s1">&#39;trackpy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;timelapse_objects&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;combo&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;cell&#39;</span><span class="p">,</span><span class="s1">&#39;nucleus&#39;</span><span class="p">,</span><span class="s1">&#39;pathogen&#39;</span><span class="p">,</span><span class="s1">&#39;cytoplasm&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="kc">None</span><span class="p">),</span>
        <span class="s1">&#39;fps&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
        <span class="s1">&#39;remove_background&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;lower_quantile&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">),</span>
        <span class="s1">&#39;merge&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="s1">&#39;normalize_plots&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;all_to_mip&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="s1">&#39;pick_slice&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="s1">&#39;skip_mode&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="s1">&#39;save&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;plot&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;workers&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
        <span class="s1">&#39;verbose&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">variables</span></div>


<div class="viewcode-block" id="add_mask_gui_defaults">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.add_mask_gui_defaults">[docs]</a>
<span class="k">def</span> <span class="nf">add_mask_gui_defaults</span><span class="p">(</span><span class="n">settings</span><span class="p">):</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;remove_background&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;fps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;all_to_mip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pick_slice&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;merge&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;skip_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;verbose&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;normalize_plots&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;randomize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;preprocess&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;masks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;examples_to_plot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">settings</span></div>


<div class="viewcode-block" id="generate_fields">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.generate_fields">[docs]</a>
<span class="k">def</span> <span class="nf">generate_fields</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="n">scrollable_frame</span><span class="p">):</span>
    <span class="n">vars_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">row</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">tooltips</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;src&quot;</span><span class="p">:</span> <span class="s2">&quot;Path to the folder containing the images.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;metadata_type&quot;</span><span class="p">:</span> <span class="s2">&quot;Type of metadata to expect in the images. This will determine how the images are processed. If &#39;custom&#39; is selected, you can provide a custom regex pattern to extract metadata from the image names&quot;</span><span class="p">,</span>
        <span class="s2">&quot;custom_regex&quot;</span><span class="p">:</span> <span class="s2">&quot;Custom regex pattern to extract metadata from the image names. This will only be used if &#39;custom&#39; is selected for &#39;metadata_type&#39;.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;experiment&quot;</span><span class="p">:</span> <span class="s2">&quot;Name of the experiment. This will be used to name the output files.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;channels&quot;</span><span class="p">:</span> <span class="s2">&quot;List of channels to use for the analysis. The first channel is 0, the second is 1, and so on. For example, [0,1,2] will use channels 0, 1, and 2.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;magnification&quot;</span><span class="p">:</span> <span class="s2">&quot;At what magnification the images were taken. This will be used to determine the size of the objects in the images.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;nucleus_channel&quot;</span><span class="p">:</span> <span class="s2">&quot;The channel to use for the nucleus. If None, the nucleus will not be segmented.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;nucleus_background&quot;</span><span class="p">:</span> <span class="s2">&quot;The background intensity for the nucleus channel. This will be used to remove background noise.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;nucleus_Signal_to_noise&quot;</span><span class="p">:</span> <span class="s2">&quot;The signal-to-noise ratio for the nucleus channel. This will be used to determine the range of intensities to normalize images to for nucleus segmentation.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;nucleus_CP_prob&quot;</span><span class="p">:</span> <span class="s2">&quot;The cellpose probability threshold for the nucleus channel. This will be used to segment the nucleus.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cell_channel&quot;</span><span class="p">:</span> <span class="s2">&quot;The channel to use for the cell. If None, the cell will not be segmented.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cell_background&quot;</span><span class="p">:</span> <span class="s2">&quot;The background intensity for the cell channel. This will be used to remove background noise.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cell_Signal_to_noise&quot;</span><span class="p">:</span> <span class="s2">&quot;The signal-to-noise ratio for the cell channel. This will be used to determine the range of intensities to normalize images to for cell segmentation.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cell_CP_prob&quot;</span><span class="p">:</span> <span class="s2">&quot;The cellpose probability threshold for the cell channel. This will be used to segment the cell.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pathogen_channel&quot;</span><span class="p">:</span> <span class="s2">&quot;The channel to use for the pathogen. If None, the pathogen will not be segmented.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pathogen_background&quot;</span><span class="p">:</span> <span class="s2">&quot;The background intensity for the pathogen channel. This will be used to remove background noise.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pathogen_Signal_to_noise&quot;</span><span class="p">:</span> <span class="s2">&quot;The signal-to-noise ratio for the pathogen channel. This will be used to determine the range of intensities to normalize images to for pathogen segmentation.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pathogen_CP_prob&quot;</span><span class="p">:</span> <span class="s2">&quot;The cellpose probability threshold for the pathogen channel. This will be used to segment the pathogen.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;preprocess&quot;</span><span class="p">:</span> <span class="s2">&quot;Whether to preprocess the images before segmentation. This includes background removal and normalization. Set to False only if this step has already been done.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;masks&quot;</span><span class="p">:</span> <span class="s2">&quot;Whether to generate masks for the segmented objects. If True, masks will be generated for the nucleus, cell, and pathogen.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;examples_to_plot&quot;</span><span class="p">:</span> <span class="s2">&quot;The number of images to plot for each segmented object. This will be used to visually inspect the segmentation results and normalization .&quot;</span><span class="p">,</span>
        <span class="s2">&quot;randomize&quot;</span><span class="p">:</span> <span class="s2">&quot;Whether to randomize the order of the images before processing. Recommended to avoid bias in the segmentation.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="s2">&quot;The batch size to use for processing the images. This will determine how many images are processed at once. Images are normalized and segmented in batches. Lower if application runs out of RAM or VRAM.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;timelapse&quot;</span><span class="p">:</span> <span class="s2">&quot;Whether to process the images as a timelapse.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;timelapse_displacement&quot;</span><span class="p">:</span> <span class="s2">&quot;The displacement between frames in the timelapse. This will be used to align the frames before processing.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;timelapse_memory&quot;</span><span class="p">:</span> <span class="s2">&quot;The number of frames to in tandem objects must be present in to be considered the same object in the timelapse.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;timelapse_frame_limits&quot;</span><span class="p">:</span> <span class="s2">&quot;The frame limits to use for the timelapse. This will determine which frames are processed. For example, [5,20] will process frames 5 to 20.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;timelapse_remove_transient&quot;</span><span class="p">:</span> <span class="s2">&quot;Whether to remove transient objects in the timelapse. Transient objects are present in fewer than all frames.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;timelapse_mode&quot;</span><span class="p">:</span> <span class="s2">&quot;The mode to use for processing the timelapse. &#39;trackpy&#39; uses the trackpy library for tracking objects, while &#39;btrack&#39; uses the btrack library.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;timelapse_objects&quot;</span><span class="p">:</span> <span class="s2">&quot;The objects to track in the timelapse (cell, nucleus or pathogen). This will determine which objects are tracked over time. If None, all objects will be tracked.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fps&quot;</span><span class="p">:</span> <span class="s2">&quot;Frames per second of the automatically generated timelapse movies.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;remove_background&quot;</span><span class="p">:</span> <span class="s2">&quot;Whether to remove background noise from the images. This will help improve the quality of the segmentation.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;lower_quantile&quot;</span><span class="p">:</span> <span class="s2">&quot;The lower quantile to use for normalizing the images. This will be used to determine the range of intensities to normalize images to.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;merge_pathogens&quot;</span><span class="p">:</span> <span class="s2">&quot;Whether to merge pathogen objects that share more than 75</span><span class="si">% o</span><span class="s2">f their perimiter.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;normalize_plots&quot;</span><span class="p">:</span> <span class="s2">&quot;Whether to normalize the plots.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;all_to_mip&quot;</span><span class="p">:</span> <span class="s2">&quot;Whether to convert all images to maximum intensity projections before processing.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pick_slice&quot;</span><span class="p">:</span> <span class="s2">&quot;Whether to pick a single slice from the z-stack images. If False, the maximum intensity projection will be used.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;skip_mode&quot;</span><span class="p">:</span> <span class="s2">&quot;The mode to use for skipping images. This will determine how to handle images that cannot be processed.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;save&quot;</span><span class="p">:</span> <span class="s2">&quot;Whether to save the results to disk.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;plot&quot;</span><span class="p">:</span> <span class="s2">&quot;Whether to plot the results.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;workers&quot;</span><span class="p">:</span> <span class="s2">&quot;The number of workers to use for processing the images. This will determine how many images are processed in parallel. Increase to speed up processing.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;verbose&quot;</span><span class="p">:</span> <span class="s2">&quot;Whether to print verbose output during processing.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;input_folder&quot;</span><span class="p">:</span> <span class="s2">&quot;Path to the folder containing the images.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cell_mask_dim&quot;</span><span class="p">:</span> <span class="s2">&quot;The dimension of the array the cell mask is saved in.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cell_min_size&quot;</span><span class="p">:</span> <span class="s2">&quot;The minimum size of cell objects in pixels2.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cytoplasm_min_size&quot;</span><span class="p">:</span> <span class="s2">&quot;The minimum size of cytoplasm objects in pixels2.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;nucleus_mask_dim&quot;</span><span class="p">:</span> <span class="s2">&quot;The dimension of the array the nucleus mask is saved in.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;nucleus_min_size&quot;</span><span class="p">:</span> <span class="s2">&quot;The minimum size of nucleus objects in pixels2.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pathogen_mask_dim&quot;</span><span class="p">:</span> <span class="s2">&quot;The dimension of the array the pathogen mask is saved in.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pathogen_min_size&quot;</span><span class="p">:</span> <span class="s2">&quot;The minimum size of pathogen objects in pixels2.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;save_png&quot;</span><span class="p">:</span> <span class="s2">&quot;Whether to save the segmented objects as PNG images.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;crop_mode&quot;</span><span class="p">:</span> <span class="s2">&quot;The mode to use for cropping the images. This will determine which objects are cropped from the images (cell, nucleus, pathogen, cytoplasm).&quot;</span><span class="p">,</span>
        <span class="s2">&quot;use_bounding_box&quot;</span><span class="p">:</span> <span class="s2">&quot;Whether to use the bounding box of the objects for cropping. If False, only the object itself will be cropped.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;png_size&quot;</span><span class="p">:</span> <span class="s2">&quot;The size of the PNG images to save. This will determine the size of the saved images.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;normalize&quot;</span><span class="p">:</span> <span class="s2">&quot;The percentiles to use for normalizing the images. This will be used to determine the range of intensities to normalize images to., if None, no normalization is done.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;png_dims&quot;</span><span class="p">:</span> <span class="s2">&quot;The dimensions of the PNG images to save. This will determine the dimensions of the saved images. Maximum of 3 dimensions e.g. [1,2,3].&quot;</span><span class="p">,</span>
        <span class="s2">&quot;normalize_by&quot;</span><span class="p">:</span> <span class="s2">&quot;Whether to normalize the images by field of view (fov) or by PNG image (png).&quot;</span><span class="p">,</span>
        <span class="s2">&quot;save_measurements&quot;</span><span class="p">:</span> <span class="s2">&quot;Whether to save the measurements to disk.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;representative_images&quot;</span><span class="p">:</span> <span class="s2">&quot;Whether to save representative images of the segmented objects (Not working yet).&quot;</span><span class="p">,</span>
        <span class="s2">&quot;plot&quot;</span><span class="p">:</span> <span class="s2">&quot;Whether to plot results.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;plot_filtration&quot;</span><span class="p">:</span> <span class="s2">&quot;Whether to plot the filtration steps.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;include_uninfected&quot;</span><span class="p">:</span> <span class="s2">&quot;Whether to include uninfected cells in the analysis.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;dialate_pngs&quot;</span><span class="p">:</span> <span class="s2">&quot;Whether to dialate the PNG images before saving.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;dialate_png_ratios&quot;</span><span class="p">:</span> <span class="s2">&quot;The ratios to use for dialating the PNG images. This will determine the amount of dialation applied to the images before cropping.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;timelapse_objects&quot;</span><span class="p">:</span> <span class="s2">&quot;The objects to track in the timelapse (cell, nucleus or pathogen). This will determine which objects are tracked over time. If None, all objects will be tracked.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;max_workers&quot;</span><span class="p">:</span> <span class="s2">&quot;The number of workers to use for processing the images. This will determine how many images are processed in parallel. Increase to speed up processing.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cells: &quot;</span><span class="p">:</span> <span class="s2">&quot;The cell types to include in the analysis.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cell_loc&quot;</span><span class="p">:</span> <span class="s2">&quot;The locations of the cell types in the images.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pathogens&quot;</span><span class="p">:</span> <span class="s2">&quot;The pathogen types to include in the analysis.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pathogen_loc&quot;</span><span class="p">:</span> <span class="s2">&quot;The locations of the pathogen types in the images.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;treatments&quot;</span><span class="p">:</span> <span class="s2">&quot;The treatments to include in the analysis.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;treatment_loc&quot;</span><span class="p">:</span> <span class="s2">&quot;The locations of the treatments in the images.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;channel_of_interest&quot;</span><span class="p">:</span> <span class="s2">&quot;The channel of interest to use for the analysis.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;compartments&quot;</span><span class="p">:</span> <span class="s2">&quot;The compartments to measure in the images.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;measurement&quot;</span><span class="p">:</span> <span class="s2">&quot;The measurement to use for the analysis.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;nr_imgs&quot;</span><span class="p">:</span> <span class="s2">&quot;The number of images to plot.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;um_per_pixel&quot;</span><span class="p">:</span> <span class="s2">&quot;The micrometers per pixel for the images.&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="n">var_type</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">default_value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">label</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">create_input_field</span><span class="p">(</span><span class="n">scrollable_frame</span><span class="o">.</span><span class="n">scrollable_frame</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">var_type</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">default_value</span><span class="p">)</span>
        <span class="n">vars_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>  <span class="c1"># Store the label, widget, and variable</span>
        
        <span class="c1"># Add tooltip to the label if it exists in the tooltips dictionary</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">tooltips</span><span class="p">:</span>
            <span class="n">ToolTip</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">tooltips</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        
        <span class="n">row</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">vars_dict</span></div>



    
<div class="viewcode-block" id="TextRedirector">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.TextRedirector">[docs]</a>
<span class="k">class</span> <span class="nc">TextRedirector</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">queue</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span> <span class="o">=</span> <span class="n">queue</span>

<div class="viewcode-block" id="TextRedirector.write">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.TextRedirector.write">[docs]</a>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span></div>


<div class="viewcode-block" id="TextRedirector.flush">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.TextRedirector.flush">[docs]</a>
    <span class="k">def</span> <span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>
</div>


<div class="viewcode-block" id="create_dark_mode">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.create_dark_mode">[docs]</a>
<span class="k">def</span> <span class="nf">create_dark_mode</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">console_output</span><span class="p">):</span>
    <span class="n">dark_bg</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span>
    <span class="n">light_text</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span>
    <span class="n">dark_text</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span>
    <span class="n">input_bg</span> <span class="o">=</span> <span class="s1">&#39;#555555&#39;</span>  <span class="c1"># Slightly lighter background for input fields</span>
    
    <span class="c1"># Configure ttkcompartments(&#39;TFrame&#39;, background=dark_bg)</span>
    <span class="n">style</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s1">&#39;TLabel&#39;</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="n">dark_bg</span><span class="p">,</span> <span class="n">foreground</span><span class="o">=</span><span class="n">light_text</span><span class="p">)</span>
    <span class="n">style</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s1">&#39;TEntry&#39;</span><span class="p">,</span> <span class="n">fieldbackground</span><span class="o">=</span><span class="n">input_bg</span><span class="p">,</span> <span class="n">foreground</span><span class="o">=</span><span class="n">dark_text</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="n">dark_bg</span><span class="p">)</span>
    <span class="n">style</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s1">&#39;TButton&#39;</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="n">dark_bg</span><span class="p">,</span> <span class="n">foreground</span><span class="o">=</span><span class="n">dark_text</span><span class="p">)</span>
    <span class="n">style</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="s1">&#39;TButton&#39;</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="n">dark_bg</span><span class="p">)],</span> <span class="n">foreground</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="n">dark_text</span><span class="p">)])</span>
    <span class="n">style</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s1">&#39;Dark.TCheckbutton&#39;</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="n">dark_bg</span><span class="p">,</span> <span class="n">foreground</span><span class="o">=</span><span class="n">dark_text</span><span class="p">)</span>
    <span class="n">style</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="s1">&#39;Dark.TCheckbutton&#39;</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="n">dark_bg</span><span class="p">)],</span> <span class="n">foreground</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="n">dark_text</span><span class="p">)])</span>
    <span class="n">style</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s1">&#39;TCombobox&#39;</span><span class="p">,</span> <span class="n">fieldbackground</span><span class="o">=</span><span class="n">input_bg</span><span class="p">,</span> <span class="n">foreground</span><span class="o">=</span><span class="n">dark_text</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="n">dark_bg</span><span class="p">,</span> <span class="n">selectbackground</span><span class="o">=</span><span class="n">input_bg</span><span class="p">,</span> <span class="n">selectforeground</span><span class="o">=</span><span class="n">dark_text</span><span class="p">)</span>
    <span class="n">style</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="s1">&#39;TCombobox&#39;</span><span class="p">,</span> <span class="n">fieldbackground</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;readonly&#39;</span><span class="p">,</span> <span class="n">input_bg</span><span class="p">)],</span> <span class="n">selectbackground</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;readonly&#39;</span><span class="p">,</span> <span class="n">input_bg</span><span class="p">)],</span> <span class="n">foreground</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;readonly&#39;</span><span class="p">,</span> <span class="n">dark_text</span><span class="p">)])</span>
    
    <span class="k">if</span> <span class="n">console_output</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">console_output</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">bg</span><span class="o">=</span><span class="n">dark_bg</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="n">light_text</span><span class="p">,</span> <span class="n">insertbackground</span><span class="o">=</span><span class="n">light_text</span><span class="p">)</span> <span class="c1">#, font=(&quot;Arial&quot;, 12)</span>
    <span class="n">root</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">bg</span><span class="o">=</span><span class="n">dark_bg</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="set_dark_style">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.set_dark_style">[docs]</a>
<span class="k">def</span> <span class="nf">set_dark_style</span><span class="p">(</span><span class="n">style</span><span class="p">):</span>
    <span class="n">style</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s1">&#39;TFrame&#39;</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">style</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s1">&#39;TLabel&#39;</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">foreground</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
    <span class="n">style</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s1">&#39;TEntry&#39;</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">foreground</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
    <span class="n">style</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s1">&#39;TCheckbutton&#39;</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">foreground</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span></div>


<span class="c1">##@log_function_call   </span>
<div class="viewcode-block" id="main_thread_update_function">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.main_thread_update_function">[docs]</a>
<span class="k">def</span> <span class="nf">main_thread_update_function</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">fig_queue</span><span class="p">,</span> <span class="n">canvas_widget</span><span class="p">,</span> <span class="n">progress_label</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ansi_escape_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\x1B\[[0-?]*[ -/]*[@-~]&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">q</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">get_nowait</span><span class="p">()</span>
            <span class="n">clean_message</span> <span class="o">=</span> <span class="n">ansi_escape_pattern</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">clean_message</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Progress&quot;</span><span class="p">):</span>
                <span class="n">progress_label</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">clean_message</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">clean_message</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">Progress&quot;</span><span class="p">):</span>
                <span class="n">progress_label</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">clean_message</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">clean_message</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Successfully&quot;</span><span class="p">):</span>
                <span class="n">progress_label</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">clean_message</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">clean_message</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Processing&quot;</span><span class="p">):</span>
                <span class="n">progress_label</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">clean_message</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">clean_message</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;scale&quot;</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">clean_message</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;plot_cropped_arrays&quot;</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">clean_message</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">or</span> <span class="n">clean_message</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span> <span class="ow">or</span> <span class="n">clean_message</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">clean_message</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error updating GUI canvas: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">root</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">main_thread_update_function</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">fig_queue</span><span class="p">,</span> <span class="n">canvas_widget</span><span class="p">,</span> <span class="n">progress_label</span><span class="p">))</span></div>


<div class="viewcode-block" id="process_stdout_stderr">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.process_stdout_stderr">[docs]</a>
<span class="k">def</span> <span class="nf">process_stdout_stderr</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Redirect stdout and stderr to the queue q.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">WriteToQueue</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">WriteToQueue</span><span class="p">(</span><span class="n">q</span><span class="p">)</span></div>


<div class="viewcode-block" id="WriteToQueue">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.WriteToQueue">[docs]</a>
<span class="k">class</span> <span class="nc">WriteToQueue</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">TextIOBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A custom file-like class that writes any output to a given queue.</span>
<span class="sd">    This can be used to redirect stdout and stderr.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q</span> <span class="o">=</span> <span class="n">q</span>

<div class="viewcode-block" id="WriteToQueue.write">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.WriteToQueue.write">[docs]</a>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>


<div class="viewcode-block" id="WriteToQueue.flush">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.WriteToQueue.flush">[docs]</a>
    <span class="k">def</span> <span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>
</div>


<div class="viewcode-block" id="clear_canvas">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.clear_canvas">[docs]</a>
<span class="k">def</span> <span class="nf">clear_canvas</span><span class="p">(</span><span class="n">canvas</span><span class="p">):</span>
    <span class="c1"># Clear each plot (axes) in the figure</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">get_axes</span><span class="p">():</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="c1"># Redraw the now empty canvas without changing its size</span>
    <span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span></div>

    
<div class="viewcode-block" id="measure_crop_wrapper">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.measure_crop_wrapper">[docs]</a>
<span class="k">def</span> <span class="nf">measure_crop_wrapper</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">fig_queue</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wraps the measure_crop function to integrate with GUI processes.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    - settings: dict, The settings for the measure_crop function.</span>
<span class="sd">    - q: multiprocessing.Queue, Queue for logging messages to the GUI.</span>
<span class="sd">    - fig_queue: multiprocessing.Queue, Queue for sending figures to the GUI.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">my_show</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replacement for plt.show() that queues figures instead of displaying them.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
        <span class="n">fig_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>  <span class="c1"># Queue the figure for GUI display</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>  <span class="c1"># Prevent the figure from being shown by plt.show()</span>

    <span class="c1"># Temporarily override plt.show</span>
    <span class="n">original_show</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span> <span class="o">=</span> <span class="n">my_show</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;start&#39;</span><span class="p">)</span>
        <span class="n">spacr</span><span class="o">.</span><span class="n">measure</span><span class="o">.</span><span class="n">measure_crop</span><span class="p">(</span><span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">errorMessage</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Error during processing: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">errorMessage</span><span class="p">)</span>  <span class="c1"># Send the error message to the GUI via the queue</span>
        <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span> <span class="o">=</span> <span class="n">original_show</span>  <span class="c1"># Restore the original plt.show function</span></div>

        
<span class="c1">#@log_function_call</span>
<div class="viewcode-block" id="preprocess_generate_masks_wrapper">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.preprocess_generate_masks_wrapper">[docs]</a>
<span class="k">def</span> <span class="nf">preprocess_generate_masks_wrapper</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">fig_queue</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wraps the measure_crop function to integrate with GUI processes.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    - settings: dict, The settings for the measure_crop function.</span>
<span class="sd">    - q: multiprocessing.Queue, Queue for logging messages to the GUI.</span>
<span class="sd">    - fig_queue: multiprocessing.Queue, Queue for sending figures to the GUI.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">my_show</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replacement for plt.show() that queues figures instead of displaying them.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
        <span class="n">fig_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>  <span class="c1"># Queue the figure for GUI display</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>  <span class="c1"># Prevent the figure from being shown by plt.show()</span>

    <span class="c1"># Temporarily override plt.show</span>
    <span class="n">original_show</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span> <span class="o">=</span> <span class="n">my_show</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">spacr</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">preprocess_generate_masks</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">],</span> <span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">errorMessage</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Error during processing: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">errorMessage</span><span class="p">)</span>  <span class="c1"># Send the error message to the GUI via the queue</span>
        <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span> <span class="o">=</span> <span class="n">original_show</span>  <span class="c1"># Restore the original plt.show function</span></div>


<div class="viewcode-block" id="train_test_model_wrapper">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.train_test_model_wrapper">[docs]</a>
<span class="k">def</span> <span class="nf">train_test_model_wrapper</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">fig_queue</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wraps the measure_crop function to integrate with GUI processes.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    - settings: dict, The settings for the measure_crop function.</span>
<span class="sd">    - q: multiprocessing.Queue, Queue for logging messages to the GUI.</span>
<span class="sd">    - fig_queue: multiprocessing.Queue, Queue for sending figures to the GUI.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">my_show</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replacement for plt.show() that queues figures instead of displaying them.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
        <span class="n">fig_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>  <span class="c1"># Queue the figure for GUI display</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>  <span class="c1"># Prevent the figure from being shown by plt.show()</span>

    <span class="c1"># Temporarily override plt.show</span>
    <span class="n">original_show</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span> <span class="o">=</span> <span class="n">my_show</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">spacr</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">train_test_model</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">],</span> <span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">errorMessage</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Error during processing: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">errorMessage</span><span class="p">)</span>  <span class="c1"># Send the error message to the GUI via the queue</span>
        <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span> <span class="o">=</span> <span class="n">original_show</span>  <span class="c1"># Restore the original plt.show function</span></div>

        
        
<div class="viewcode-block" id="run_multiple_simulations_wrapper">
<a class="viewcode-back" href="../../spacr.html#spacr.gui_utils.run_multiple_simulations_wrapper">[docs]</a>
<span class="k">def</span> <span class="nf">run_multiple_simulations_wrapper</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">fig_queue</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wraps the run_multiple_simulations function to integrate with GUI processes.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    - settings: dict, The settings for the run_multiple_simulations function.</span>
<span class="sd">    - q: multiprocessing.Queue, Queue for logging messages to the GUI.</span>
<span class="sd">    - fig_queue: multiprocessing.Queue, Queue for sending figures to the GUI.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">my_show</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replacement for plt.show() that queues figures instead of displaying them.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
        <span class="n">fig_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>  <span class="c1"># Queue the figure for GUI display</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>  <span class="c1"># Prevent the figure from being shown by plt.show()</span>

    <span class="c1"># Temporarily override plt.show</span>
    <span class="n">original_show</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span> <span class="o">=</span> <span class="n">my_show</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">spacr</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">run_multiple_simulations</span><span class="p">(</span><span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">errorMessage</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Error during processing: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">errorMessage</span><span class="p">)</span>  <span class="c1"># Send the error message to the GUI via the queue</span>
        <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span> <span class="o">=</span> <span class="n">original_show</span>  <span class="c1"># Restore the original plt.show function   </span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>