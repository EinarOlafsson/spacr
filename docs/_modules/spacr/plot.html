

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>spacr.plot &mdash; spacr 1.0.8 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=fd3f3429" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=45a07ac9" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=aec50437"></script>
      <script src="../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #005f73" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/logo_spacr.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Core Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/spacr/core/index.html">Core Logic</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/spacr/core/index.html#module-contents">Module Contents</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/core/index.html#spacr.core.preprocess_generate_masks"><code class="docutils literal notranslate"><span class="pre">preprocess_generate_masks()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/core/index.html#spacr.core.generate_cellpose_masks"><code class="docutils literal notranslate"><span class="pre">generate_cellpose_masks()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/core/index.html#spacr.core.generate_screen_graphs"><code class="docutils literal notranslate"><span class="pre">generate_screen_graphs()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/spacr/io/index.html">IO Utilities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/spacr/io/index.html#module-contents">Module Contents</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.process_non_tif_non_2D_images"><code class="docutils literal notranslate"><span class="pre">process_non_tif_non_2D_images()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.CombineLoaders"><code class="docutils literal notranslate"><span class="pre">CombineLoaders</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.CombineLoaders.train_loaders"><code class="docutils literal notranslate"><span class="pre">CombineLoaders.train_loaders</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.CombineLoaders.loader_iters"><code class="docutils literal notranslate"><span class="pre">CombineLoaders.loader_iters</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.CombineLoaders.__iter__"><code class="docutils literal notranslate"><span class="pre">CombineLoaders.__iter__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.CombineLoaders.__next__"><code class="docutils literal notranslate"><span class="pre">CombineLoaders.__next__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.CombinedDataset"><code class="docutils literal notranslate"><span class="pre">CombinedDataset</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.CombinedDataset.datasets"><code class="docutils literal notranslate"><span class="pre">CombinedDataset.datasets</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.CombinedDataset.lengths"><code class="docutils literal notranslate"><span class="pre">CombinedDataset.lengths</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.CombinedDataset.total_length"><code class="docutils literal notranslate"><span class="pre">CombinedDataset.total_length</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.CombinedDataset.shuffle"><code class="docutils literal notranslate"><span class="pre">CombinedDataset.shuffle</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.CombinedDataset.__getitem__"><code class="docutils literal notranslate"><span class="pre">CombinedDataset.__getitem__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.CombinedDataset.__len__"><code class="docutils literal notranslate"><span class="pre">CombinedDataset.__len__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.NoClassDataset"><code class="docutils literal notranslate"><span class="pre">NoClassDataset</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.NoClassDataset.data_dir"><code class="docutils literal notranslate"><span class="pre">NoClassDataset.data_dir</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.NoClassDataset.transform"><code class="docutils literal notranslate"><span class="pre">NoClassDataset.transform</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.NoClassDataset.shuffle"><code class="docutils literal notranslate"><span class="pre">NoClassDataset.shuffle</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.NoClassDataset.load_to_memory"><code class="docutils literal notranslate"><span class="pre">NoClassDataset.load_to_memory</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.NoClassDataset.filenames"><code class="docutils literal notranslate"><span class="pre">NoClassDataset.filenames</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.NoClassDataset.load_image"><code class="docutils literal notranslate"><span class="pre">NoClassDataset.load_image()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.NoClassDataset.__len__"><code class="docutils literal notranslate"><span class="pre">NoClassDataset.__len__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.NoClassDataset.shuffle_dataset"><code class="docutils literal notranslate"><span class="pre">NoClassDataset.shuffle_dataset()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.NoClassDataset.__getitem__"><code class="docutils literal notranslate"><span class="pre">NoClassDataset.__getitem__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.spacrDataset"><code class="docutils literal notranslate"><span class="pre">spacrDataset</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.spacrDataset.data_dir"><code class="docutils literal notranslate"><span class="pre">spacrDataset.data_dir</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.spacrDataset.classes"><code class="docutils literal notranslate"><span class="pre">spacrDataset.classes</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.spacrDataset.transform"><code class="docutils literal notranslate"><span class="pre">spacrDataset.transform</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.spacrDataset.shuffle"><code class="docutils literal notranslate"><span class="pre">spacrDataset.shuffle</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.spacrDataset.pin_memory"><code class="docutils literal notranslate"><span class="pre">spacrDataset.pin_memory</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.spacrDataset.filenames"><code class="docutils literal notranslate"><span class="pre">spacrDataset.filenames</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.spacrDataset.labels"><code class="docutils literal notranslate"><span class="pre">spacrDataset.labels</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.spacrDataset.load_image"><code class="docutils literal notranslate"><span class="pre">spacrDataset.load_image()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.spacrDataset.__len__"><code class="docutils literal notranslate"><span class="pre">spacrDataset.__len__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.spacrDataset.shuffle_dataset"><code class="docutils literal notranslate"><span class="pre">spacrDataset.shuffle_dataset()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.spacrDataset.get_plate"><code class="docutils literal notranslate"><span class="pre">spacrDataset.get_plate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.spacrDataset.__getitem__"><code class="docutils literal notranslate"><span class="pre">spacrDataset.__getitem__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.spacrDataLoader"><code class="docutils literal notranslate"><span class="pre">spacrDataLoader</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.spacrDataLoader.preload_batches"><code class="docutils literal notranslate"><span class="pre">spacrDataLoader.preload_batches</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.spacrDataLoader.batch_queue"><code class="docutils literal notranslate"><span class="pre">spacrDataLoader.batch_queue</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.spacrDataLoader.process"><code class="docutils literal notranslate"><span class="pre">spacrDataLoader.process</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.spacrDataLoader.current_batch_index"><code class="docutils literal notranslate"><span class="pre">spacrDataLoader.current_batch_index</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.spacrDataLoader.pin_memory"><code class="docutils literal notranslate"><span class="pre">spacrDataLoader.pin_memory</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.spacrDataLoader.__iter__"><code class="docutils literal notranslate"><span class="pre">spacrDataLoader.__iter__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.spacrDataLoader.__next__"><code class="docutils literal notranslate"><span class="pre">spacrDataLoader.__next__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.spacrDataLoader.cleanup"><code class="docutils literal notranslate"><span class="pre">spacrDataLoader.cleanup()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.spacrDataLoader.__del__"><code class="docutils literal notranslate"><span class="pre">spacrDataLoader.__del__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.TarImageDataset"><code class="docutils literal notranslate"><span class="pre">TarImageDataset</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.TarImageDataset.members"><code class="docutils literal notranslate"><span class="pre">TarImageDataset.members</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.TarImageDataset.tar_path"><code class="docutils literal notranslate"><span class="pre">TarImageDataset.tar_path</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.TarImageDataset.transform"><code class="docutils literal notranslate"><span class="pre">TarImageDataset.transform</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.TarImageDataset.__len__"><code class="docutils literal notranslate"><span class="pre">TarImageDataset.__len__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.TarImageDataset.__getitem__"><code class="docutils literal notranslate"><span class="pre">TarImageDataset.__getitem__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.load_images_from_paths"><code class="docutils literal notranslate"><span class="pre">load_images_from_paths()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.concatenate_and_normalize"><code class="docutils literal notranslate"><span class="pre">concatenate_and_normalize()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.delete_empty_subdirectories"><code class="docutils literal notranslate"><span class="pre">delete_empty_subdirectories()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.preprocess_img_data"><code class="docutils literal notranslate"><span class="pre">preprocess_img_data()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.read_plot_model_stats"><code class="docutils literal notranslate"><span class="pre">read_plot_model_stats()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.convert_numpy_to_tiff"><code class="docutils literal notranslate"><span class="pre">convert_numpy_to_tiff()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.generate_cellpose_train_test"><code class="docutils literal notranslate"><span class="pre">generate_cellpose_train_test()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.parse_gz_files"><code class="docutils literal notranslate"><span class="pre">parse_gz_files()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.generate_dataset"><code class="docutils literal notranslate"><span class="pre">generate_dataset()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.generate_loaders"><code class="docutils literal notranslate"><span class="pre">generate_loaders()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.generate_training_dataset"><code class="docutils literal notranslate"><span class="pre">generate_training_dataset()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.training_dataset_from_annotation"><code class="docutils literal notranslate"><span class="pre">training_dataset_from_annotation()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.training_dataset_from_annotation_metadata"><code class="docutils literal notranslate"><span class="pre">training_dataset_from_annotation_metadata()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.generate_dataset_from_lists"><code class="docutils literal notranslate"><span class="pre">generate_dataset_from_lists()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.convert_separate_files_to_yokogawa"><code class="docutils literal notranslate"><span class="pre">convert_separate_files_to_yokogawa()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.convert_to_yokogawa"><code class="docutils literal notranslate"><span class="pre">convert_to_yokogawa()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.apply_augmentation"><code class="docutils literal notranslate"><span class="pre">apply_augmentation()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.process_instruction"><code class="docutils literal notranslate"><span class="pre">process_instruction()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/io/index.html#spacr.io.prepare_cellpose_dataset"><code class="docutils literal notranslate"><span class="pre">prepare_cellpose_dataset()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/spacr/utils/index.html">General Utilities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/spacr/utils/index.html#module-contents">Module Contents</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.spacr_path"><code class="docutils literal notranslate"><span class="pre">spacr_path</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.filepaths_to_database"><code class="docutils literal notranslate"><span class="pre">filepaths_to_database()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.activation_maps_to_database"><code class="docutils literal notranslate"><span class="pre">activation_maps_to_database()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.activation_correlations_to_database"><code class="docutils literal notranslate"><span class="pre">activation_correlations_to_database()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.calculate_activation_correlations"><code class="docutils literal notranslate"><span class="pre">calculate_activation_correlations()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.load_settings"><code class="docutils literal notranslate"><span class="pre">load_settings()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.save_settings"><code class="docutils literal notranslate"><span class="pre">save_settings()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.print_progress"><code class="docutils literal notranslate"><span class="pre">print_progress()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.reset_mp"><code class="docutils literal notranslate"><span class="pre">reset_mp()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.is_multiprocessing_process"><code class="docutils literal notranslate"><span class="pre">is_multiprocessing_process()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.close_file_descriptors"><code class="docutils literal notranslate"><span class="pre">close_file_descriptors()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.close_multiprocessing_processes"><code class="docutils literal notranslate"><span class="pre">close_multiprocessing_processes()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.check_mask_folder"><code class="docutils literal notranslate"><span class="pre">check_mask_folder()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.smooth_hull_lines"><code class="docutils literal notranslate"><span class="pre">smooth_hull_lines()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.mask_object_count"><code class="docutils literal notranslate"><span class="pre">mask_object_count()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.is_list_of_lists"><code class="docutils literal notranslate"><span class="pre">is_list_of_lists()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.normalize_to_dtype"><code class="docutils literal notranslate"><span class="pre">normalize_to_dtype()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.annotate_conditions"><code class="docutils literal notranslate"><span class="pre">annotate_conditions()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.Cache"><code class="docutils literal notranslate"><span class="pre">Cache</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.Cache.cache"><code class="docutils literal notranslate"><span class="pre">Cache.cache</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.Cache.max_size"><code class="docutils literal notranslate"><span class="pre">Cache.max_size</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.Cache.get"><code class="docutils literal notranslate"><span class="pre">Cache.get()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.Cache.put"><code class="docutils literal notranslate"><span class="pre">Cache.put()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.ScaledDotProductAttention_v1"><code class="docutils literal notranslate"><span class="pre">ScaledDotProductAttention_v1</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.ScaledDotProductAttention_v1.d_k"><code class="docutils literal notranslate"><span class="pre">ScaledDotProductAttention_v1.d_k</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.ScaledDotProductAttention_v1.forward"><code class="docutils literal notranslate"><span class="pre">ScaledDotProductAttention_v1.forward()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.SelfAttention_v1"><code class="docutils literal notranslate"><span class="pre">SelfAttention_v1</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.SelfAttention_v1.W_q"><code class="docutils literal notranslate"><span class="pre">SelfAttention_v1.W_q</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.SelfAttention_v1.W_k"><code class="docutils literal notranslate"><span class="pre">SelfAttention_v1.W_k</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.SelfAttention_v1.W_v"><code class="docutils literal notranslate"><span class="pre">SelfAttention_v1.W_v</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.SelfAttention_v1.attention"><code class="docutils literal notranslate"><span class="pre">SelfAttention_v1.attention</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.SelfAttention_v1.forward"><code class="docutils literal notranslate"><span class="pre">SelfAttention_v1.forward()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.ScaledDotProductAttention"><code class="docutils literal notranslate"><span class="pre">ScaledDotProductAttention</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.ScaledDotProductAttention.d_k"><code class="docutils literal notranslate"><span class="pre">ScaledDotProductAttention.d_k</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.ScaledDotProductAttention.forward"><code class="docutils literal notranslate"><span class="pre">ScaledDotProductAttention.forward()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.SelfAttention"><code class="docutils literal notranslate"><span class="pre">SelfAttention</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.SelfAttention.W_q"><code class="docutils literal notranslate"><span class="pre">SelfAttention.W_q</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.SelfAttention.W_k"><code class="docutils literal notranslate"><span class="pre">SelfAttention.W_k</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.SelfAttention.W_v"><code class="docutils literal notranslate"><span class="pre">SelfAttention.W_v</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.SelfAttention.attention"><code class="docutils literal notranslate"><span class="pre">SelfAttention.attention</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.SelfAttention.forward"><code class="docutils literal notranslate"><span class="pre">SelfAttention.forward()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.EarlyFusion"><code class="docutils literal notranslate"><span class="pre">EarlyFusion</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.EarlyFusion.conv1"><code class="docutils literal notranslate"><span class="pre">EarlyFusion.conv1</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.EarlyFusion.forward"><code class="docutils literal notranslate"><span class="pre">EarlyFusion.forward()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.SpatialAttention"><code class="docutils literal notranslate"><span class="pre">SpatialAttention</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.SpatialAttention.conv1"><code class="docutils literal notranslate"><span class="pre">SpatialAttention.conv1</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.SpatialAttention.sigmoid"><code class="docutils literal notranslate"><span class="pre">SpatialAttention.sigmoid</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.SpatialAttention.forward"><code class="docutils literal notranslate"><span class="pre">SpatialAttention.forward()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.MultiScaleBlockWithAttention"><code class="docutils literal notranslate"><span class="pre">MultiScaleBlockWithAttention</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.MultiScaleBlockWithAttention.spatial_attention"><code class="docutils literal notranslate"><span class="pre">MultiScaleBlockWithAttention.spatial_attention</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.MultiScaleBlockWithAttention.custom_forward"><code class="docutils literal notranslate"><span class="pre">MultiScaleBlockWithAttention.custom_forward()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.MultiScaleBlockWithAttention.forward"><code class="docutils literal notranslate"><span class="pre">MultiScaleBlockWithAttention.forward()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.MultiScaleBlockWithAttention.dilated_conv1"><code class="docutils literal notranslate"><span class="pre">MultiScaleBlockWithAttention.dilated_conv1</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id0"><code class="docutils literal notranslate"><span class="pre">MultiScaleBlockWithAttention.spatial_attention</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id1"><code class="docutils literal notranslate"><span class="pre">MultiScaleBlockWithAttention.custom_forward()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id2"><code class="docutils literal notranslate"><span class="pre">MultiScaleBlockWithAttention.forward()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.CustomCellClassifier"><code class="docutils literal notranslate"><span class="pre">CustomCellClassifier</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.CustomCellClassifier.early_fusion"><code class="docutils literal notranslate"><span class="pre">CustomCellClassifier.early_fusion</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.CustomCellClassifier.multi_scale_block_1"><code class="docutils literal notranslate"><span class="pre">CustomCellClassifier.multi_scale_block_1</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.CustomCellClassifier.fc1"><code class="docutils literal notranslate"><span class="pre">CustomCellClassifier.fc1</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.CustomCellClassifier.use_checkpoint"><code class="docutils literal notranslate"><span class="pre">CustomCellClassifier.use_checkpoint</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.CustomCellClassifier.custom_forward"><code class="docutils literal notranslate"><span class="pre">CustomCellClassifier.custom_forward()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.CustomCellClassifier.forward"><code class="docutils literal notranslate"><span class="pre">CustomCellClassifier.forward()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id3"><code class="docutils literal notranslate"><span class="pre">CustomCellClassifier.early_fusion</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id4"><code class="docutils literal notranslate"><span class="pre">CustomCellClassifier.multi_scale_block_1</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id5"><code class="docutils literal notranslate"><span class="pre">CustomCellClassifier.fc1</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id6"><code class="docutils literal notranslate"><span class="pre">CustomCellClassifier.use_checkpoint</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id7"><code class="docutils literal notranslate"><span class="pre">CustomCellClassifier.custom_forward()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id8"><code class="docutils literal notranslate"><span class="pre">CustomCellClassifier.forward()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.TorchModel"><code class="docutils literal notranslate"><span class="pre">TorchModel</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.TorchModel.use_checkpoint"><code class="docutils literal notranslate"><span class="pre">TorchModel.use_checkpoint</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.TorchModel.base_model"><code class="docutils literal notranslate"><span class="pre">TorchModel.base_model</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.TorchModel.num_ftrs"><code class="docutils literal notranslate"><span class="pre">TorchModel.num_ftrs</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.TorchModel.use_dropout"><code class="docutils literal notranslate"><span class="pre">TorchModel.use_dropout</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.TorchModel.dropout"><code class="docutils literal notranslate"><span class="pre">TorchModel.dropout</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.TorchModel.spacr_classifier"><code class="docutils literal notranslate"><span class="pre">TorchModel.spacr_classifier</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.TorchModel.apply_dropout_rate"><code class="docutils literal notranslate"><span class="pre">TorchModel.apply_dropout_rate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.TorchModel.init_base_model"><code class="docutils literal notranslate"><span class="pre">TorchModel.init_base_model()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.TorchModel.get_weight_choice"><code class="docutils literal notranslate"><span class="pre">TorchModel.get_weight_choice()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.TorchModel.get_num_ftrs"><code class="docutils literal notranslate"><span class="pre">TorchModel.get_num_ftrs()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.TorchModel.init_spacr_classifier"><code class="docutils literal notranslate"><span class="pre">TorchModel.init_spacr_classifier()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.TorchModel.forward"><code class="docutils literal notranslate"><span class="pre">TorchModel.forward()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.TorchModel.model_name"><code class="docutils literal notranslate"><span class="pre">TorchModel.model_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id9"><code class="docutils literal notranslate"><span class="pre">TorchModel.use_checkpoint</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id10"><code class="docutils literal notranslate"><span class="pre">TorchModel.base_model</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id11"><code class="docutils literal notranslate"><span class="pre">TorchModel.num_ftrs</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id12"><code class="docutils literal notranslate"><span class="pre">TorchModel.apply_dropout_rate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id13"><code class="docutils literal notranslate"><span class="pre">TorchModel.init_base_model()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id14"><code class="docutils literal notranslate"><span class="pre">TorchModel.get_weight_choice()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id15"><code class="docutils literal notranslate"><span class="pre">TorchModel.get_num_ftrs()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id16"><code class="docutils literal notranslate"><span class="pre">TorchModel.init_spacr_classifier()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id17"><code class="docutils literal notranslate"><span class="pre">TorchModel.forward()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.FocalLossWithLogits"><code class="docutils literal notranslate"><span class="pre">FocalLossWithLogits</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.FocalLossWithLogits.alpha"><code class="docutils literal notranslate"><span class="pre">FocalLossWithLogits.alpha</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.FocalLossWithLogits.gamma"><code class="docutils literal notranslate"><span class="pre">FocalLossWithLogits.gamma</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.FocalLossWithLogits.forward"><code class="docutils literal notranslate"><span class="pre">FocalLossWithLogits.forward()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id18"><code class="docutils literal notranslate"><span class="pre">FocalLossWithLogits.alpha</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id19"><code class="docutils literal notranslate"><span class="pre">FocalLossWithLogits.gamma</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id20"><code class="docutils literal notranslate"><span class="pre">FocalLossWithLogits.forward()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.ResNet"><code class="docutils literal notranslate"><span class="pre">ResNet</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.ResNet.forward"><code class="docutils literal notranslate"><span class="pre">ResNet.forward()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.ResNet.resnet"><code class="docutils literal notranslate"><span class="pre">ResNet.resnet</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.ResNet.fc1"><code class="docutils literal notranslate"><span class="pre">ResNet.fc1</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.ResNet.use_dropout"><code class="docutils literal notranslate"><span class="pre">ResNet.use_dropout</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.ResNet.use_checkpoint"><code class="docutils literal notranslate"><span class="pre">ResNet.use_checkpoint</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.ResNet.dropout"><code class="docutils literal notranslate"><span class="pre">ResNet.dropout</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.ResNet.fc2"><code class="docutils literal notranslate"><span class="pre">ResNet.fc2</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.ResNet.initialize_base"><code class="docutils literal notranslate"><span class="pre">ResNet.initialize_base()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id21"><code class="docutils literal notranslate"><span class="pre">ResNet.forward()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.split_my_dataset"><code class="docutils literal notranslate"><span class="pre">split_my_dataset()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.classification_metrics"><code class="docutils literal notranslate"><span class="pre">classification_metrics()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.compute_irm_penalty"><code class="docutils literal notranslate"><span class="pre">compute_irm_penalty()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.choose_model"><code class="docutils literal notranslate"><span class="pre">choose_model()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.calculate_loss"><code class="docutils literal notranslate"><span class="pre">calculate_loss()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.pick_best_model"><code class="docutils literal notranslate"><span class="pre">pick_best_model()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.get_paths_from_db"><code class="docutils literal notranslate"><span class="pre">get_paths_from_db()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.save_file_lists"><code class="docutils literal notranslate"><span class="pre">save_file_lists()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.augment_single_image"><code class="docutils literal notranslate"><span class="pre">augment_single_image()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.augment_images"><code class="docutils literal notranslate"><span class="pre">augment_images()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.augment_classes"><code class="docutils literal notranslate"><span class="pre">augment_classes()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.annotate_predictions"><code class="docutils literal notranslate"><span class="pre">annotate_predictions()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.initiate_counter"><code class="docutils literal notranslate"><span class="pre">initiate_counter()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.add_images_to_tar"><code class="docutils literal notranslate"><span class="pre">add_images_to_tar()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.generate_fraction_map"><code class="docutils literal notranslate"><span class="pre">generate_fraction_map()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.fishers_odds"><code class="docutils literal notranslate"><span class="pre">fishers_odds()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.model_metrics"><code class="docutils literal notranslate"><span class="pre">model_metrics()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.check_multicollinearity"><code class="docutils literal notranslate"><span class="pre">check_multicollinearity()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.lasso_reg"><code class="docutils literal notranslate"><span class="pre">lasso_reg()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.MLR"><code class="docutils literal notranslate"><span class="pre">MLR()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.get_files_from_dir"><code class="docutils literal notranslate"><span class="pre">get_files_from_dir()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.create_circular_mask"><code class="docutils literal notranslate"><span class="pre">create_circular_mask()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.apply_mask"><code class="docutils literal notranslate"><span class="pre">apply_mask()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.invert_image"><code class="docutils literal notranslate"><span class="pre">invert_image()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.resize_images_and_labels"><code class="docutils literal notranslate"><span class="pre">resize_images_and_labels()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.resize_labels_back"><code class="docutils literal notranslate"><span class="pre">resize_labels_back()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.calculate_iou"><code class="docutils literal notranslate"><span class="pre">calculate_iou()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.match_masks"><code class="docutils literal notranslate"><span class="pre">match_masks()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.compute_average_precision"><code class="docutils literal notranslate"><span class="pre">compute_average_precision()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.pad_to_same_shape"><code class="docutils literal notranslate"><span class="pre">pad_to_same_shape()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.compute_ap_over_iou_thresholds"><code class="docutils literal notranslate"><span class="pre">compute_ap_over_iou_thresholds()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.compute_segmentation_ap"><code class="docutils literal notranslate"><span class="pre">compute_segmentation_ap()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.jaccard_index"><code class="docutils literal notranslate"><span class="pre">jaccard_index()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.dice_coefficient"><code class="docutils literal notranslate"><span class="pre">dice_coefficient()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.extract_boundaries"><code class="docutils literal notranslate"><span class="pre">extract_boundaries()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.boundary_f1_score"><code class="docutils literal notranslate"><span class="pre">boundary_f1_score()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.merge_touching_objects"><code class="docutils literal notranslate"><span class="pre">merge_touching_objects()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.remove_intensity_objects"><code class="docutils literal notranslate"><span class="pre">remove_intensity_objects()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.SelectChannels"><code class="docutils literal notranslate"><span class="pre">SelectChannels</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.SelectChannels.__call__"><code class="docutils literal notranslate"><span class="pre">SelectChannels.__call__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.SelectChannels.channels"><code class="docutils literal notranslate"><span class="pre">SelectChannels.channels</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id26"><code class="docutils literal notranslate"><span class="pre">SelectChannels.__call__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.preprocess_image_v1"><code class="docutils literal notranslate"><span class="pre">preprocess_image_v1()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.SaliencyMapGenerator"><code class="docutils literal notranslate"><span class="pre">SaliencyMapGenerator</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.SaliencyMapGenerator.__init__"><code class="docutils literal notranslate"><span class="pre">SaliencyMapGenerator.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.SaliencyMapGenerator.compute_saliency_maps"><code class="docutils literal notranslate"><span class="pre">SaliencyMapGenerator.compute_saliency_maps()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.SaliencyMapGenerator.compute_saliency_and_predictions"><code class="docutils literal notranslate"><span class="pre">SaliencyMapGenerator.compute_saliency_and_predictions()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.SaliencyMapGenerator.plot_activation_grid"><code class="docutils literal notranslate"><span class="pre">SaliencyMapGenerator.plot_activation_grid()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.SaliencyMapGenerator.percentile_normalize"><code class="docutils literal notranslate"><span class="pre">SaliencyMapGenerator.percentile_normalize()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.SaliencyMapGenerator.model"><code class="docutils literal notranslate"><span class="pre">SaliencyMapGenerator.model</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id27"><code class="docutils literal notranslate"><span class="pre">SaliencyMapGenerator.compute_saliency_maps()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id28"><code class="docutils literal notranslate"><span class="pre">SaliencyMapGenerator.compute_saliency_and_predictions()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id29"><code class="docutils literal notranslate"><span class="pre">SaliencyMapGenerator.plot_activation_grid()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id30"><code class="docutils literal notranslate"><span class="pre">SaliencyMapGenerator.percentile_normalize()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.GradCAMGenerator"><code class="docutils literal notranslate"><span class="pre">GradCAMGenerator</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.GradCAMGenerator.target_layer"><code class="docutils literal notranslate"><span class="pre">GradCAMGenerator.target_layer</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.GradCAMGenerator.cam_type"><code class="docutils literal notranslate"><span class="pre">GradCAMGenerator.cam_type</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.GradCAMGenerator.gradients"><code class="docutils literal notranslate"><span class="pre">GradCAMGenerator.gradients</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.GradCAMGenerator.activations"><code class="docutils literal notranslate"><span class="pre">GradCAMGenerator.activations</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.GradCAMGenerator.__init__"><code class="docutils literal notranslate"><span class="pre">GradCAMGenerator.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.GradCAMGenerator.hook_layers"><code class="docutils literal notranslate"><span class="pre">GradCAMGenerator.hook_layers()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.GradCAMGenerator.get_layer"><code class="docutils literal notranslate"><span class="pre">GradCAMGenerator.get_layer()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.GradCAMGenerator.compute_gradcam_maps"><code class="docutils literal notranslate"><span class="pre">GradCAMGenerator.compute_gradcam_maps()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.GradCAMGenerator.compute_gradcam_and_predictions"><code class="docutils literal notranslate"><span class="pre">GradCAMGenerator.compute_gradcam_and_predictions()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.GradCAMGenerator.plot_activation_grid"><code class="docutils literal notranslate"><span class="pre">GradCAMGenerator.plot_activation_grid()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.GradCAMGenerator.percentile_normalize"><code class="docutils literal notranslate"><span class="pre">GradCAMGenerator.percentile_normalize()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.GradCAMGenerator.model"><code class="docutils literal notranslate"><span class="pre">GradCAMGenerator.model</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id31"><code class="docutils literal notranslate"><span class="pre">GradCAMGenerator.target_layer</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id32"><code class="docutils literal notranslate"><span class="pre">GradCAMGenerator.cam_type</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id33"><code class="docutils literal notranslate"><span class="pre">GradCAMGenerator.gradients</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id34"><code class="docutils literal notranslate"><span class="pre">GradCAMGenerator.activations</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.GradCAMGenerator.target_layer_module"><code class="docutils literal notranslate"><span class="pre">GradCAMGenerator.target_layer_module</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id35"><code class="docutils literal notranslate"><span class="pre">GradCAMGenerator.hook_layers()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id36"><code class="docutils literal notranslate"><span class="pre">GradCAMGenerator.get_layer()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id37"><code class="docutils literal notranslate"><span class="pre">GradCAMGenerator.compute_gradcam_maps()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id38"><code class="docutils literal notranslate"><span class="pre">GradCAMGenerator.compute_gradcam_and_predictions()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id39"><code class="docutils literal notranslate"><span class="pre">GradCAMGenerator.plot_activation_grid()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id40"><code class="docutils literal notranslate"><span class="pre">GradCAMGenerator.percentile_normalize()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.preprocess_image"><code class="docutils literal notranslate"><span class="pre">preprocess_image()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.class_visualization"><code class="docutils literal notranslate"><span class="pre">class_visualization()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.get_submodules"><code class="docutils literal notranslate"><span class="pre">get_submodules()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.GradCAM"><code class="docutils literal notranslate"><span class="pre">GradCAM</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.GradCAM.target_layers"><code class="docutils literal notranslate"><span class="pre">GradCAM.target_layers</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.GradCAM.use_cuda"><code class="docutils literal notranslate"><span class="pre">GradCAM.use_cuda</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.GradCAM.forward"><code class="docutils literal notranslate"><span class="pre">GradCAM.forward()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.GradCAM.__call__"><code class="docutils literal notranslate"><span class="pre">GradCAM.__call__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.GradCAM.model"><code class="docutils literal notranslate"><span class="pre">GradCAM.model</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id41"><code class="docutils literal notranslate"><span class="pre">GradCAM.target_layers</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.GradCAM.cuda"><code class="docutils literal notranslate"><span class="pre">GradCAM.cuda</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id42"><code class="docutils literal notranslate"><span class="pre">GradCAM.forward()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id43"><code class="docutils literal notranslate"><span class="pre">GradCAM.__call__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.show_cam_on_image"><code class="docutils literal notranslate"><span class="pre">show_cam_on_image()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.recommend_target_layers"><code class="docutils literal notranslate"><span class="pre">recommend_target_layers()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.IntegratedGradients"><code class="docutils literal notranslate"><span class="pre">IntegratedGradients</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.IntegratedGradients.model"><code class="docutils literal notranslate"><span class="pre">IntegratedGradients.model</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#id44"><code class="docutils literal notranslate"><span class="pre">IntegratedGradients.model</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.IntegratedGradients.generate_integrated_gradients"><code class="docutils literal notranslate"><span class="pre">IntegratedGradients.generate_integrated_gradients()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.get_db_paths"><code class="docutils literal notranslate"><span class="pre">get_db_paths()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.get_sequencing_paths"><code class="docutils literal notranslate"><span class="pre">get_sequencing_paths()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.load_image_paths"><code class="docutils literal notranslate"><span class="pre">load_image_paths()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.merge_dataframes"><code class="docutils literal notranslate"><span class="pre">merge_dataframes()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.remove_highly_correlated_columns_v1"><code class="docutils literal notranslate"><span class="pre">remove_highly_correlated_columns_v1()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.filter_columns"><code class="docutils literal notranslate"><span class="pre">filter_columns()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.reduction_and_clustering"><code class="docutils literal notranslate"><span class="pre">reduction_and_clustering()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.remove_noise"><code class="docutils literal notranslate"><span class="pre">remove_noise()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.plot_embedding"><code class="docutils literal notranslate"><span class="pre">plot_embedding()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.generate_colors"><code class="docutils literal notranslate"><span class="pre">generate_colors()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.assign_colors"><code class="docutils literal notranslate"><span class="pre">assign_colors()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.setup_plot"><code class="docutils literal notranslate"><span class="pre">setup_plot()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.plot_clusters"><code class="docutils literal notranslate"><span class="pre">plot_clusters()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.plot_umap_images"><code class="docutils literal notranslate"><span class="pre">plot_umap_images()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.plot_images_by_cluster"><code class="docutils literal notranslate"><span class="pre">plot_images_by_cluster()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.plot_image"><code class="docutils literal notranslate"><span class="pre">plot_image()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.remove_canvas"><code class="docutils literal notranslate"><span class="pre">remove_canvas()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.plot_clusters_grid"><code class="docutils literal notranslate"><span class="pre">plot_clusters_grid()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.plot_grid"><code class="docutils literal notranslate"><span class="pre">plot_grid()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.generate_path_list_from_db"><code class="docutils literal notranslate"><span class="pre">generate_path_list_from_db()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.correct_paths"><code class="docutils literal notranslate"><span class="pre">correct_paths()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.delete_folder"><code class="docutils literal notranslate"><span class="pre">delete_folder()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.measure_test_mode"><code class="docutils literal notranslate"><span class="pre">measure_test_mode()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.preprocess_data"><code class="docutils literal notranslate"><span class="pre">preprocess_data()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.remove_low_variance_columns"><code class="docutils literal notranslate"><span class="pre">remove_low_variance_columns()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.remove_highly_correlated_columns"><code class="docutils literal notranslate"><span class="pre">remove_highly_correlated_columns()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.filter_dataframe_features"><code class="docutils literal notranslate"><span class="pre">filter_dataframe_features()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.check_overlap"><code class="docutils literal notranslate"><span class="pre">check_overlap()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.find_non_overlapping_position"><code class="docutils literal notranslate"><span class="pre">find_non_overlapping_position()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.search_reduction_and_clustering"><code class="docutils literal notranslate"><span class="pre">search_reduction_and_clustering()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.load_image"><code class="docutils literal notranslate"><span class="pre">load_image()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.extract_features"><code class="docutils literal notranslate"><span class="pre">extract_features()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.check_normality"><code class="docutils literal notranslate"><span class="pre">check_normality()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.random_forest_feature_importance"><code class="docutils literal notranslate"><span class="pre">random_forest_feature_importance()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.perform_statistical_tests"><code class="docutils literal notranslate"><span class="pre">perform_statistical_tests()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.combine_results"><code class="docutils literal notranslate"><span class="pre">combine_results()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.cluster_feature_analysis"><code class="docutils literal notranslate"><span class="pre">cluster_feature_analysis()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.process_mask_file_adjust_cell"><code class="docutils literal notranslate"><span class="pre">process_mask_file_adjust_cell()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.adjust_cell_masks"><code class="docutils literal notranslate"><span class="pre">adjust_cell_masks()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.adjust_cell_masks_v1"><code class="docutils literal notranslate"><span class="pre">adjust_cell_masks_v1()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.process_masks"><code class="docutils literal notranslate"><span class="pre">process_masks()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.merge_regression_res_with_metadata"><code class="docutils literal notranslate"><span class="pre">merge_regression_res_with_metadata()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.process_vision_results"><code class="docutils literal notranslate"><span class="pre">process_vision_results()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.get_ml_results_paths"><code class="docutils literal notranslate"><span class="pre">get_ml_results_paths()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.augment_image"><code class="docutils literal notranslate"><span class="pre">augment_image()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.augment_dataset"><code class="docutils literal notranslate"><span class="pre">augment_dataset()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.convert_and_relabel_masks"><code class="docutils literal notranslate"><span class="pre">convert_and_relabel_masks()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.correct_masks"><code class="docutils literal notranslate"><span class="pre">correct_masks()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.count_reads_in_fastq"><code class="docutils literal notranslate"><span class="pre">count_reads_in_fastq()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.get_cuda_version"><code class="docutils literal notranslate"><span class="pre">get_cuda_version()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.all_elements_match"><code class="docutils literal notranslate"><span class="pre">all_elements_match()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.prepare_batch_for_segmentation"><code class="docutils literal notranslate"><span class="pre">prepare_batch_for_segmentation()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.check_index"><code class="docutils literal notranslate"><span class="pre">check_index()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.map_condition"><code class="docutils literal notranslate"><span class="pre">map_condition()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.download_models"><code class="docutils literal notranslate"><span class="pre">download_models()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.generate_cytoplasm_mask"><code class="docutils literal notranslate"><span class="pre">generate_cytoplasm_mask()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.add_column_to_database"><code class="docutils literal notranslate"><span class="pre">add_column_to_database()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.fill_holes_in_mask"><code class="docutils literal notranslate"><span class="pre">fill_holes_in_mask()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.correct_metadata_column_names"><code class="docutils literal notranslate"><span class="pre">correct_metadata_column_names()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.control_filelist"><code class="docutils literal notranslate"><span class="pre">control_filelist()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.rename_columns_in_db"><code class="docutils literal notranslate"><span class="pre">rename_columns_in_db()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.group_feature_class"><code class="docutils literal notranslate"><span class="pre">group_feature_class()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.delete_intermedeate_files"><code class="docutils literal notranslate"><span class="pre">delete_intermedeate_files()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.filter_and_save_csv"><code class="docutils literal notranslate"><span class="pre">filter_and_save_csv()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.extract_tar_bz2_files"><code class="docutils literal notranslate"><span class="pre">extract_tar_bz2_files()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.calculate_shortest_distance"><code class="docutils literal notranslate"><span class="pre">calculate_shortest_distance()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.format_path_for_system"><code class="docutils literal notranslate"><span class="pre">format_path_for_system()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.normalize_src_path"><code class="docutils literal notranslate"><span class="pre">normalize_src_path()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.generate_image_path_map"><code class="docutils literal notranslate"><span class="pre">generate_image_path_map()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.copy_images_to_consolidated"><code class="docutils literal notranslate"><span class="pre">copy_images_to_consolidated()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.correct_metadata"><code class="docutils literal notranslate"><span class="pre">correct_metadata()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/utils/index.html#spacr.utils.remove_outliers_by_group"><code class="docutils literal notranslate"><span class="pre">remove_outliers_by_group()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/spacr/settings/index.html">Settings</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/spacr/settings/index.html#module-contents">Module Contents</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.set_default_plot_merge_settings"><code class="docutils literal notranslate"><span class="pre">set_default_plot_merge_settings()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.set_default_settings_preprocess_generate_masks"><code class="docutils literal notranslate"><span class="pre">set_default_settings_preprocess_generate_masks()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.set_default_plot_data_from_db"><code class="docutils literal notranslate"><span class="pre">set_default_plot_data_from_db()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.set_default_settings_preprocess_img_data"><code class="docutils literal notranslate"><span class="pre">set_default_settings_preprocess_img_data()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.set_default_umap_image_settings"><code class="docutils literal notranslate"><span class="pre">set_default_umap_image_settings()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.get_measure_crop_settings"><code class="docutils literal notranslate"><span class="pre">get_measure_crop_settings()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.set_default_analyze_screen"><code class="docutils literal notranslate"><span class="pre">set_default_analyze_screen()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.set_default_train_test_model"><code class="docutils literal notranslate"><span class="pre">set_default_train_test_model()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.set_generate_training_dataset_defaults"><code class="docutils literal notranslate"><span class="pre">set_generate_training_dataset_defaults()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.deep_spacr_defaults"><code class="docutils literal notranslate"><span class="pre">deep_spacr_defaults()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.get_train_test_model_settings"><code class="docutils literal notranslate"><span class="pre">get_train_test_model_settings()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.get_analyze_recruitment_default_settings"><code class="docutils literal notranslate"><span class="pre">get_analyze_recruitment_default_settings()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.get_default_test_cellpose_model_settings"><code class="docutils literal notranslate"><span class="pre">get_default_test_cellpose_model_settings()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.get_default_apply_cellpose_model_settings"><code class="docutils literal notranslate"><span class="pre">get_default_apply_cellpose_model_settings()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.default_settings_analyze_percent_positive"><code class="docutils literal notranslate"><span class="pre">default_settings_analyze_percent_positive()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.get_analyze_reads_default_settings"><code class="docutils literal notranslate"><span class="pre">get_analyze_reads_default_settings()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.get_map_barcodes_default_settings"><code class="docutils literal notranslate"><span class="pre">get_map_barcodes_default_settings()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.get_train_cellpose_default_settings"><code class="docutils literal notranslate"><span class="pre">get_train_cellpose_default_settings()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.set_generate_dataset_defaults"><code class="docutils literal notranslate"><span class="pre">set_generate_dataset_defaults()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.get_perform_regression_default_settings"><code class="docutils literal notranslate"><span class="pre">get_perform_regression_default_settings()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.get_check_cellpose_models_default_settings"><code class="docutils literal notranslate"><span class="pre">get_check_cellpose_models_default_settings()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.get_identify_masks_finetune_default_settings"><code class="docutils literal notranslate"><span class="pre">get_identify_masks_finetune_default_settings()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.q"><code class="docutils literal notranslate"><span class="pre">q</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.expected_types"><code class="docutils literal notranslate"><span class="pre">expected_types</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.categories"><code class="docutils literal notranslate"><span class="pre">categories</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.category_keys"><code class="docutils literal notranslate"><span class="pre">category_keys</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.check_settings"><code class="docutils literal notranslate"><span class="pre">check_settings()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.generate_fields"><code class="docutils literal notranslate"><span class="pre">generate_fields()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.descriptions"><code class="docutils literal notranslate"><span class="pre">descriptions</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.set_annotate_default_settings"><code class="docutils literal notranslate"><span class="pre">set_annotate_default_settings()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.set_default_generate_barecode_mapping"><code class="docutils literal notranslate"><span class="pre">set_default_generate_barecode_mapping()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.get_default_generate_activation_map_settings"><code class="docutils literal notranslate"><span class="pre">get_default_generate_activation_map_settings()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.get_analyze_plaque_settings"><code class="docutils literal notranslate"><span class="pre">get_analyze_plaque_settings()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.set_graph_importance_defaults"><code class="docutils literal notranslate"><span class="pre">set_graph_importance_defaults()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.set_interperate_vision_model_defaults"><code class="docutils literal notranslate"><span class="pre">set_interperate_vision_model_defaults()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.set_analyze_endodyogeny_defaults"><code class="docutils literal notranslate"><span class="pre">set_analyze_endodyogeny_defaults()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.set_analyze_class_proportion_defaults"><code class="docutils literal notranslate"><span class="pre">set_analyze_class_proportion_defaults()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/settings/index.html#spacr.settings.get_plot_data_from_csv_default_settings"><code class="docutils literal notranslate"><span class="pre">get_plot_data_from_csv_default_settings()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/spacr/sp_stats/index.html">Statistics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/spacr/sp_stats/index.html#module-contents">Module Contents</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/sp_stats/index.html#spacr.sp_stats.choose_p_adjust_method"><code class="docutils literal notranslate"><span class="pre">choose_p_adjust_method()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/sp_stats/index.html#spacr.sp_stats.perform_normality_tests"><code class="docutils literal notranslate"><span class="pre">perform_normality_tests()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/sp_stats/index.html#spacr.sp_stats.perform_levene_test"><code class="docutils literal notranslate"><span class="pre">perform_levene_test()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/sp_stats/index.html#spacr.sp_stats.perform_statistical_tests"><code class="docutils literal notranslate"><span class="pre">perform_statistical_tests()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/sp_stats/index.html#spacr.sp_stats.perform_posthoc_tests"><code class="docutils literal notranslate"><span class="pre">perform_posthoc_tests()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/sp_stats/index.html#spacr.sp_stats.chi_pairwise"><code class="docutils literal notranslate"><span class="pre">chi_pairwise()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Image Analysis</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/spacr/measure/index.html">Measurement</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/spacr/measure/index.html#module-contents">Module Contents</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/measure/index.html#spacr.measure.get_components"><code class="docutils literal notranslate"><span class="pre">get_components()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/measure/index.html#spacr.measure.save_and_add_image_to_grid"><code class="docutils literal notranslate"><span class="pre">save_and_add_image_to_grid()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/measure/index.html#spacr.measure.img_list_to_grid"><code class="docutils literal notranslate"><span class="pre">img_list_to_grid()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/measure/index.html#spacr.measure.measure_crop"><code class="docutils literal notranslate"><span class="pre">measure_crop()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/measure/index.html#spacr.measure.process_meassure_crop_results"><code class="docutils literal notranslate"><span class="pre">process_meassure_crop_results()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/measure/index.html#spacr.measure.generate_cellpose_train_set"><code class="docutils literal notranslate"><span class="pre">generate_cellpose_train_set()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/measure/index.html#spacr.measure.get_object_counts"><code class="docutils literal notranslate"><span class="pre">get_object_counts()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/spacr/plot/index.html">Plotting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/spacr/plot/index.html#module-contents">Module Contents</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.plot_image_mask_overlay"><code class="docutils literal notranslate"><span class="pre">plot_image_mask_overlay()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.plot_cellpose4_output"><code class="docutils literal notranslate"><span class="pre">plot_cellpose4_output()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.plot_masks"><code class="docutils literal notranslate"><span class="pre">plot_masks()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.generate_mask_random_cmap"><code class="docutils literal notranslate"><span class="pre">generate_mask_random_cmap()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.random_cmap"><code class="docutils literal notranslate"><span class="pre">random_cmap()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.plot_images_and_arrays"><code class="docutils literal notranslate"><span class="pre">plot_images_and_arrays()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.plot_arrays"><code class="docutils literal notranslate"><span class="pre">plot_arrays()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.plot_arrays_v1"><code class="docutils literal notranslate"><span class="pre">plot_arrays_v1()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.plot_merged"><code class="docutils literal notranslate"><span class="pre">plot_merged()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.generate_plate_heatmap"><code class="docutils literal notranslate"><span class="pre">generate_plate_heatmap()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.plot_plates"><code class="docutils literal notranslate"><span class="pre">plot_plates()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.print_mask_and_flows"><code class="docutils literal notranslate"><span class="pre">print_mask_and_flows()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.plot_resize"><code class="docutils literal notranslate"><span class="pre">plot_resize()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.normalize_and_visualize"><code class="docutils literal notranslate"><span class="pre">normalize_and_visualize()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.visualize_masks"><code class="docutils literal notranslate"><span class="pre">visualize_masks()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.visualize_cellpose_masks"><code class="docutils literal notranslate"><span class="pre">visualize_cellpose_masks()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.plot_comparison_results"><code class="docutils literal notranslate"><span class="pre">plot_comparison_results()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.plot_object_outlines"><code class="docutils literal notranslate"><span class="pre">plot_object_outlines()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.volcano_plot"><code class="docutils literal notranslate"><span class="pre">volcano_plot()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.plot_histogram"><code class="docutils literal notranslate"><span class="pre">plot_histogram()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.plot_lorenz_curves"><code class="docutils literal notranslate"><span class="pre">plot_lorenz_curves()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.plot_permutation"><code class="docutils literal notranslate"><span class="pre">plot_permutation()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.plot_feature_importance"><code class="docutils literal notranslate"><span class="pre">plot_feature_importance()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.read_and_plot__vision_results"><code class="docutils literal notranslate"><span class="pre">read_and_plot__vision_results()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.jitterplot_by_annotation"><code class="docutils literal notranslate"><span class="pre">jitterplot_by_annotation()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.create_grouped_plot"><code class="docutils literal notranslate"><span class="pre">create_grouped_plot()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph"><code class="docutils literal notranslate"><span class="pre">spacrGraph</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.df"><code class="docutils literal notranslate"><span class="pre">spacrGraph.df</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.grouping_column"><code class="docutils literal notranslate"><span class="pre">spacrGraph.grouping_column</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.order"><code class="docutils literal notranslate"><span class="pre">spacrGraph.order</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.data_column"><code class="docutils literal notranslate"><span class="pre">spacrGraph.data_column</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.graph_type"><code class="docutils literal notranslate"><span class="pre">spacrGraph.graph_type</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.summary_func"><code class="docutils literal notranslate"><span class="pre">spacrGraph.summary_func</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.colors"><code class="docutils literal notranslate"><span class="pre">spacrGraph.colors</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.output_dir"><code class="docutils literal notranslate"><span class="pre">spacrGraph.output_dir</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.save"><code class="docutils literal notranslate"><span class="pre">spacrGraph.save</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.error_bar_type"><code class="docutils literal notranslate"><span class="pre">spacrGraph.error_bar_type</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.remove_outliers"><code class="docutils literal notranslate"><span class="pre">spacrGraph.remove_outliers</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.theme"><code class="docutils literal notranslate"><span class="pre">spacrGraph.theme</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.representation"><code class="docutils literal notranslate"><span class="pre">spacrGraph.representation</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.paired"><code class="docutils literal notranslate"><span class="pre">spacrGraph.paired</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.all_to_all"><code class="docutils literal notranslate"><span class="pre">spacrGraph.all_to_all</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.compare_group"><code class="docutils literal notranslate"><span class="pre">spacrGraph.compare_group</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.y_lim"><code class="docutils literal notranslate"><span class="pre">spacrGraph.y_lim</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.graph_name"><code class="docutils literal notranslate"><span class="pre">spacrGraph.graph_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.log_x"><code class="docutils literal notranslate"><span class="pre">spacrGraph.log_x</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.log_y"><code class="docutils literal notranslate"><span class="pre">spacrGraph.log_y</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.results_df"><code class="docutils literal notranslate"><span class="pre">spacrGraph.results_df</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.sns_palette"><code class="docutils literal notranslate"><span class="pre">spacrGraph.sns_palette</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.fig"><code class="docutils literal notranslate"><span class="pre">spacrGraph.fig</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.results_name"><code class="docutils literal notranslate"><span class="pre">spacrGraph.results_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.raw_df"><code class="docutils literal notranslate"><span class="pre">spacrGraph.raw_df</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.preprocess_data"><code class="docutils literal notranslate"><span class="pre">spacrGraph.preprocess_data()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.remove_outliers_from_plot"><code class="docutils literal notranslate"><span class="pre">spacrGraph.remove_outliers_from_plot()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.perform_normality_tests"><code class="docutils literal notranslate"><span class="pre">spacrGraph.perform_normality_tests()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.perform_levene_test"><code class="docutils literal notranslate"><span class="pre">spacrGraph.perform_levene_test()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.perform_statistical_tests"><code class="docutils literal notranslate"><span class="pre">spacrGraph.perform_statistical_tests()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.perform_posthoc_tests"><code class="docutils literal notranslate"><span class="pre">spacrGraph.perform_posthoc_tests()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.create_plot"><code class="docutils literal notranslate"><span class="pre">spacrGraph.create_plot()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.get_results"><code class="docutils literal notranslate"><span class="pre">spacrGraph.get_results()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.get_figure"><code class="docutils literal notranslate"><span class="pre">spacrGraph.get_figure()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.plot_data_from_db"><code class="docutils literal notranslate"><span class="pre">plot_data_from_db()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.plot_data_from_csv"><code class="docutils literal notranslate"><span class="pre">plot_data_from_csv()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.plot_region"><code class="docutils literal notranslate"><span class="pre">plot_region()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.plot_image_grid"><code class="docutils literal notranslate"><span class="pre">plot_image_grid()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.overlay_masks_on_images"><code class="docutils literal notranslate"><span class="pre">overlay_masks_on_images()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.graph_importance"><code class="docutils literal notranslate"><span class="pre">graph_importance()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.plot_proportion_stacked_bars"><code class="docutils literal notranslate"><span class="pre">plot_proportion_stacked_bars()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/plot/index.html#spacr.plot.create_venn_diagram"><code class="docutils literal notranslate"><span class="pre">create_venn_diagram()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/spacr/spacr_cellpose/index.html">Cellpose Integration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/spacr/spacr_cellpose/index.html#module-contents">Module Contents</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/spacr_cellpose/index.html#spacr.spacr_cellpose.parse_cellpose4_output"><code class="docutils literal notranslate"><span class="pre">parse_cellpose4_output()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/spacr_cellpose/index.html#spacr.spacr_cellpose.identify_masks_finetune"><code class="docutils literal notranslate"><span class="pre">identify_masks_finetune()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/spacr_cellpose/index.html#spacr.spacr_cellpose.generate_masks_from_imgs"><code class="docutils literal notranslate"><span class="pre">generate_masks_from_imgs()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/spacr_cellpose/index.html#spacr.spacr_cellpose.check_cellpose_models"><code class="docutils literal notranslate"><span class="pre">check_cellpose_models()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/spacr_cellpose/index.html#spacr.spacr_cellpose.save_results_and_figure"><code class="docutils literal notranslate"><span class="pre">save_results_and_figure()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/spacr_cellpose/index.html#spacr.spacr_cellpose.compare_mask"><code class="docutils literal notranslate"><span class="pre">compare_mask()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/spacr_cellpose/index.html#spacr.spacr_cellpose.compare_cellpose_masks"><code class="docutils literal notranslate"><span class="pre">compare_cellpose_masks()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Classification</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/spacr/ml/index.html">Classical ML</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/spacr/ml/index.html#module-contents">Module Contents</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/ml/index.html#spacr.ml.QuasiBinomial"><code class="docutils literal notranslate"><span class="pre">QuasiBinomial</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/ml/index.html#spacr.ml.QuasiBinomial.dispersion"><code class="docutils literal notranslate"><span class="pre">QuasiBinomial.dispersion</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/ml/index.html#spacr.ml.QuasiBinomial.variance"><code class="docutils literal notranslate"><span class="pre">QuasiBinomial.variance()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/ml/index.html#spacr.ml.calculate_p_values"><code class="docutils literal notranslate"><span class="pre">calculate_p_values()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/ml/index.html#spacr.ml.perform_mixed_model"><code class="docutils literal notranslate"><span class="pre">perform_mixed_model()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/ml/index.html#spacr.ml.create_volcano_filename"><code class="docutils literal notranslate"><span class="pre">create_volcano_filename()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/ml/index.html#spacr.ml.scale_variables"><code class="docutils literal notranslate"><span class="pre">scale_variables()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/ml/index.html#spacr.ml.select_glm_family"><code class="docutils literal notranslate"><span class="pre">select_glm_family()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/ml/index.html#spacr.ml.prepare_formula"><code class="docutils literal notranslate"><span class="pre">prepare_formula()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/ml/index.html#spacr.ml.fit_mixed_model"><code class="docutils literal notranslate"><span class="pre">fit_mixed_model()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/ml/index.html#spacr.ml.check_and_clean_data"><code class="docutils literal notranslate"><span class="pre">check_and_clean_data()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/ml/index.html#spacr.ml.minimum_cell_simulation"><code class="docutils literal notranslate"><span class="pre">minimum_cell_simulation()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/ml/index.html#spacr.ml.process_model_coefficients"><code class="docutils literal notranslate"><span class="pre">process_model_coefficients()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/ml/index.html#spacr.ml.check_distribution"><code class="docutils literal notranslate"><span class="pre">check_distribution()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/ml/index.html#spacr.ml.pick_glm_family_and_link"><code class="docutils literal notranslate"><span class="pre">pick_glm_family_and_link()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/ml/index.html#spacr.ml.regression_model"><code class="docutils literal notranslate"><span class="pre">regression_model()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/ml/index.html#spacr.ml.regression"><code class="docutils literal notranslate"><span class="pre">regression()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/ml/index.html#spacr.ml.save_summary_to_file"><code class="docutils literal notranslate"><span class="pre">save_summary_to_file()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/ml/index.html#spacr.ml.perform_regression"><code class="docutils literal notranslate"><span class="pre">perform_regression()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/ml/index.html#spacr.ml.process_reads"><code class="docutils literal notranslate"><span class="pre">process_reads()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/ml/index.html#spacr.ml.apply_transformation"><code class="docutils literal notranslate"><span class="pre">apply_transformation()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/ml/index.html#spacr.ml.check_normality"><code class="docutils literal notranslate"><span class="pre">check_normality()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/ml/index.html#spacr.ml.clean_controls"><code class="docutils literal notranslate"><span class="pre">clean_controls()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/ml/index.html#spacr.ml.process_scores"><code class="docutils literal notranslate"><span class="pre">process_scores()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/ml/index.html#spacr.ml.generate_ml_scores"><code class="docutils literal notranslate"><span class="pre">generate_ml_scores()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/ml/index.html#spacr.ml.ml_analysis"><code class="docutils literal notranslate"><span class="pre">ml_analysis()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/ml/index.html#spacr.ml.shap_analysis"><code class="docutils literal notranslate"><span class="pre">shap_analysis()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/ml/index.html#spacr.ml.find_optimal_threshold"><code class="docutils literal notranslate"><span class="pre">find_optimal_threshold()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/ml/index.html#spacr.ml.interperate_vision_model"><code class="docutils literal notranslate"><span class="pre">interperate_vision_model()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/spacr/deep_spacr/index.html">Deep Learning</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/spacr/deep_spacr/index.html#module-contents">Module Contents</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/deep_spacr/index.html#spacr.deep_spacr.apply_model"><code class="docutils literal notranslate"><span class="pre">apply_model()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/deep_spacr/index.html#spacr.deep_spacr.apply_model_to_tar"><code class="docutils literal notranslate"><span class="pre">apply_model_to_tar()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/deep_spacr/index.html#spacr.deep_spacr.evaluate_model_performance"><code class="docutils literal notranslate"><span class="pre">evaluate_model_performance()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/deep_spacr/index.html#spacr.deep_spacr.test_model_core"><code class="docutils literal notranslate"><span class="pre">test_model_core()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/deep_spacr/index.html#spacr.deep_spacr.test_model_performance"><code class="docutils literal notranslate"><span class="pre">test_model_performance()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/deep_spacr/index.html#spacr.deep_spacr.train_test_model"><code class="docutils literal notranslate"><span class="pre">train_test_model()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/deep_spacr/index.html#spacr.deep_spacr.train_model"><code class="docutils literal notranslate"><span class="pre">train_model()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/deep_spacr/index.html#spacr.deep_spacr.generate_activation_map"><code class="docutils literal notranslate"><span class="pre">generate_activation_map()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/deep_spacr/index.html#spacr.deep_spacr.visualize_classes"><code class="docutils literal notranslate"><span class="pre">visualize_classes()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/deep_spacr/index.html#spacr.deep_spacr.visualize_integrated_gradients"><code class="docutils literal notranslate"><span class="pre">visualize_integrated_gradients()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/deep_spacr/index.html#spacr.deep_spacr.SmoothGrad"><code class="docutils literal notranslate"><span class="pre">SmoothGrad</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/deep_spacr/index.html#spacr.deep_spacr.SmoothGrad.model"><code class="docutils literal notranslate"><span class="pre">SmoothGrad.model</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/deep_spacr/index.html#spacr.deep_spacr.SmoothGrad.n_samples"><code class="docutils literal notranslate"><span class="pre">SmoothGrad.n_samples</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/deep_spacr/index.html#spacr.deep_spacr.SmoothGrad.stdev_spread"><code class="docutils literal notranslate"><span class="pre">SmoothGrad.stdev_spread</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/deep_spacr/index.html#spacr.deep_spacr.SmoothGrad.compute_smooth_grad"><code class="docutils literal notranslate"><span class="pre">SmoothGrad.compute_smooth_grad()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/deep_spacr/index.html#spacr.deep_spacr.visualize_smooth_grad"><code class="docutils literal notranslate"><span class="pre">visualize_smooth_grad()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/deep_spacr/index.html#spacr.deep_spacr.deep_spacr"><code class="docutils literal notranslate"><span class="pre">deep_spacr()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/deep_spacr/index.html#spacr.deep_spacr.model_knowledge_transfer"><code class="docutils literal notranslate"><span class="pre">model_knowledge_transfer()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/deep_spacr/index.html#spacr.deep_spacr.model_fusion"><code class="docutils literal notranslate"><span class="pre">model_fusion()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/deep_spacr/index.html#spacr.deep_spacr.annotate_filter_vision"><code class="docutils literal notranslate"><span class="pre">annotate_filter_vision()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">GUI Components</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/spacr/gui/index.html">GUI Main App</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/spacr/gui/index.html#module-contents">Module Contents</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui/index.html#spacr.gui.MainApp"><code class="docutils literal notranslate"><span class="pre">MainApp</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui/index.html#spacr.gui.MainApp.color_settings"><code class="docutils literal notranslate"><span class="pre">MainApp.color_settings</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui/index.html#spacr.gui.MainApp.main_buttons"><code class="docutils literal notranslate"><span class="pre">MainApp.main_buttons</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui/index.html#spacr.gui.MainApp.additional_buttons"><code class="docutils literal notranslate"><span class="pre">MainApp.additional_buttons</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui/index.html#spacr.gui.MainApp.main_gui_apps"><code class="docutils literal notranslate"><span class="pre">MainApp.main_gui_apps</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui/index.html#spacr.gui.MainApp.additional_gui_apps"><code class="docutils literal notranslate"><span class="pre">MainApp.additional_gui_apps</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui/index.html#spacr.gui.MainApp.selected_app"><code class="docutils literal notranslate"><span class="pre">MainApp.selected_app</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui/index.html#spacr.gui.MainApp.create_widgets"><code class="docutils literal notranslate"><span class="pre">MainApp.create_widgets()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui/index.html#spacr.gui.MainApp.create_startup_screen"><code class="docutils literal notranslate"><span class="pre">MainApp.create_startup_screen()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui/index.html#spacr.gui.MainApp.update_description"><code class="docutils literal notranslate"><span class="pre">MainApp.update_description()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui/index.html#spacr.gui.MainApp.show_description"><code class="docutils literal notranslate"><span class="pre">MainApp.show_description()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui/index.html#spacr.gui.MainApp.clear_description"><code class="docutils literal notranslate"><span class="pre">MainApp.clear_description()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui/index.html#spacr.gui.MainApp.load_app"><code class="docutils literal notranslate"><span class="pre">MainApp.load_app()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui/index.html#spacr.gui.MainApp.clear_frame"><code class="docutils literal notranslate"><span class="pre">MainApp.clear_frame()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui/index.html#spacr.gui.gui_app"><code class="docutils literal notranslate"><span class="pre">gui_app()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/spacr/gui_core/index.html">GUI Core</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/spacr/gui_core/index.html#module-contents">Module Contents</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.q"><code class="docutils literal notranslate"><span class="pre">q</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.console_output"><code class="docutils literal notranslate"><span class="pre">console_output</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.parent_frame"><code class="docutils literal notranslate"><span class="pre">parent_frame</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.vars_dict"><code class="docutils literal notranslate"><span class="pre">vars_dict</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.canvas"><code class="docutils literal notranslate"><span class="pre">canvas</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.canvas_widget"><code class="docutils literal notranslate"><span class="pre">canvas_widget</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.scrollable_frame"><code class="docutils literal notranslate"><span class="pre">scrollable_frame</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.progress_label"><code class="docutils literal notranslate"><span class="pre">progress_label</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.fig_queue"><code class="docutils literal notranslate"><span class="pre">fig_queue</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.figures"><code class="docutils literal notranslate"><span class="pre">figures</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.figure_index"><code class="docutils literal notranslate"><span class="pre">figure_index</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.progress_bar"><code class="docutils literal notranslate"><span class="pre">progress_bar</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.usage_bars"><code class="docutils literal notranslate"><span class="pre">usage_bars</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.index_control"><code class="docutils literal notranslate"><span class="pre">index_control</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.thread_control"><code class="docutils literal notranslate"><span class="pre">thread_control</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.toggle_settings"><code class="docutils literal notranslate"><span class="pre">toggle_settings()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.display_figure"><code class="docutils literal notranslate"><span class="pre">display_figure()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.clear_unused_figures"><code class="docutils literal notranslate"><span class="pre">clear_unused_figures()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.show_previous_figure"><code class="docutils literal notranslate"><span class="pre">show_previous_figure()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.show_next_figure"><code class="docutils literal notranslate"><span class="pre">show_next_figure()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.process_fig_queue"><code class="docutils literal notranslate"><span class="pre">process_fig_queue()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.update_figure"><code class="docutils literal notranslate"><span class="pre">update_figure()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.setup_plot_section"><code class="docutils literal notranslate"><span class="pre">setup_plot_section()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.set_globals"><code class="docutils literal notranslate"><span class="pre">set_globals()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.import_settings"><code class="docutils literal notranslate"><span class="pre">import_settings()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.setup_settings_panel"><code class="docutils literal notranslate"><span class="pre">setup_settings_panel()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.setup_console"><code class="docutils literal notranslate"><span class="pre">setup_console()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.setup_button_section"><code class="docutils literal notranslate"><span class="pre">setup_button_section()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.setup_usage_panel"><code class="docutils literal notranslate"><span class="pre">setup_usage_panel()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.initiate_abort"><code class="docutils literal notranslate"><span class="pre">initiate_abort()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.check_src_folders_files"><code class="docutils literal notranslate"><span class="pre">check_src_folders_files()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.start_process"><code class="docutils literal notranslate"><span class="pre">start_process()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.process_console_queue"><code class="docutils literal notranslate"><span class="pre">process_console_queue()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.main_thread_update_function"><code class="docutils literal notranslate"><span class="pre">main_thread_update_function()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.cleanup_previous_instance"><code class="docutils literal notranslate"><span class="pre">cleanup_previous_instance()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_core/index.html#spacr.gui_core.initiate_root"><code class="docutils literal notranslate"><span class="pre">initiate_root()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/spacr/gui_elements/index.html">GUI Elements</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#module-contents">Module Contents</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.fig"><code class="docutils literal notranslate"><span class="pre">fig</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.restart_gui_app"><code class="docutils literal notranslate"><span class="pre">restart_gui_app()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.create_menu_bar"><code class="docutils literal notranslate"><span class="pre">create_menu_bar()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.set_element_size"><code class="docutils literal notranslate"><span class="pre">set_element_size()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.set_dark_style"><code class="docutils literal notranslate"><span class="pre">set_dark_style()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrFont"><code class="docutils literal notranslate"><span class="pre">spacrFont</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrFont.font_name"><code class="docutils literal notranslate"><span class="pre">spacrFont.font_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrFont.font_style"><code class="docutils literal notranslate"><span class="pre">spacrFont.font_style</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrFont.font_size"><code class="docutils literal notranslate"><span class="pre">spacrFont.font_size</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrFont.font_path"><code class="docutils literal notranslate"><span class="pre">spacrFont.font_path</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrFont.get_font_path"><code class="docutils literal notranslate"><span class="pre">spacrFont.get_font_path()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrFont.load_font"><code class="docutils literal notranslate"><span class="pre">spacrFont.load_font()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrFont.get_font"><code class="docutils literal notranslate"><span class="pre">spacrFont.get_font()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrContainer"><code class="docutils literal notranslate"><span class="pre">spacrContainer</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrContainer.orient"><code class="docutils literal notranslate"><span class="pre">spacrContainer.orient</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrContainer.bg"><code class="docutils literal notranslate"><span class="pre">spacrContainer.bg</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrContainer.sash_thickness"><code class="docutils literal notranslate"><span class="pre">spacrContainer.sash_thickness</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrContainer.panes"><code class="docutils literal notranslate"><span class="pre">spacrContainer.panes</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrContainer.sashes"><code class="docutils literal notranslate"><span class="pre">spacrContainer.sashes</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrContainer.add"><code class="docutils literal notranslate"><span class="pre">spacrContainer.add()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrContainer.create_sash"><code class="docutils literal notranslate"><span class="pre">spacrContainer.create_sash()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrContainer.reposition_panes"><code class="docutils literal notranslate"><span class="pre">spacrContainer.reposition_panes()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrContainer.on_configure"><code class="docutils literal notranslate"><span class="pre">spacrContainer.on_configure()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrContainer.on_enter_sash"><code class="docutils literal notranslate"><span class="pre">spacrContainer.on_enter_sash()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrContainer.on_leave_sash"><code class="docutils literal notranslate"><span class="pre">spacrContainer.on_leave_sash()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrContainer.start_resize"><code class="docutils literal notranslate"><span class="pre">spacrContainer.start_resize()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrContainer.perform_resize"><code class="docutils literal notranslate"><span class="pre">spacrContainer.perform_resize()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrEntry"><code class="docutils literal notranslate"><span class="pre">spacrEntry</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrEntry.bg_color"><code class="docutils literal notranslate"><span class="pre">spacrEntry.bg_color</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrEntry.active_color"><code class="docutils literal notranslate"><span class="pre">spacrEntry.active_color</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrEntry.fg_color"><code class="docutils literal notranslate"><span class="pre">spacrEntry.fg_color</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrEntry.outline"><code class="docutils literal notranslate"><span class="pre">spacrEntry.outline</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrEntry.font_family"><code class="docutils literal notranslate"><span class="pre">spacrEntry.font_family</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrEntry.font_size"><code class="docutils literal notranslate"><span class="pre">spacrEntry.font_size</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrEntry.font_loader"><code class="docutils literal notranslate"><span class="pre">spacrEntry.font_loader</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrEntry.canvas_height"><code class="docutils literal notranslate"><span class="pre">spacrEntry.canvas_height</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrEntry.canvas"><code class="docutils literal notranslate"><span class="pre">spacrEntry.canvas</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrEntry.draw_rounded_rectangle"><code class="docutils literal notranslate"><span class="pre">spacrEntry.draw_rounded_rectangle()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrEntry.on_focus_in"><code class="docutils literal notranslate"><span class="pre">spacrEntry.on_focus_in()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrEntry.on_focus_out"><code class="docutils literal notranslate"><span class="pre">spacrEntry.on_focus_out()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCheck"><code class="docutils literal notranslate"><span class="pre">spacrCheck</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCheck.bg_color"><code class="docutils literal notranslate"><span class="pre">spacrCheck.bg_color</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCheck.active_color"><code class="docutils literal notranslate"><span class="pre">spacrCheck.active_color</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCheck.fg_color"><code class="docutils literal notranslate"><span class="pre">spacrCheck.fg_color</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCheck.inactive_color"><code class="docutils literal notranslate"><span class="pre">spacrCheck.inactive_color</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCheck.variable"><code class="docutils literal notranslate"><span class="pre">spacrCheck.variable</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCheck.canvas_width"><code class="docutils literal notranslate"><span class="pre">spacrCheck.canvas_width</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCheck.canvas_height"><code class="docutils literal notranslate"><span class="pre">spacrCheck.canvas_height</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCheck.canvas"><code class="docutils literal notranslate"><span class="pre">spacrCheck.canvas</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCheck.draw_rounded_square"><code class="docutils literal notranslate"><span class="pre">spacrCheck.draw_rounded_square()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCheck.update_check"><code class="docutils literal notranslate"><span class="pre">spacrCheck.update_check()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCheck.toggle_variable"><code class="docutils literal notranslate"><span class="pre">spacrCheck.toggle_variable()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCombo"><code class="docutils literal notranslate"><span class="pre">spacrCombo</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCombo.bg_color"><code class="docutils literal notranslate"><span class="pre">spacrCombo.bg_color</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCombo.active_color"><code class="docutils literal notranslate"><span class="pre">spacrCombo.active_color</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCombo.fg_color"><code class="docutils literal notranslate"><span class="pre">spacrCombo.fg_color</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCombo.inactive_color"><code class="docutils literal notranslate"><span class="pre">spacrCombo.inactive_color</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCombo.font_family"><code class="docutils literal notranslate"><span class="pre">spacrCombo.font_family</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCombo.font_size"><code class="docutils literal notranslate"><span class="pre">spacrCombo.font_size</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCombo.font_loader"><code class="docutils literal notranslate"><span class="pre">spacrCombo.font_loader</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCombo.values"><code class="docutils literal notranslate"><span class="pre">spacrCombo.values</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCombo.canvas_width"><code class="docutils literal notranslate"><span class="pre">spacrCombo.canvas_width</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCombo.canvas_height"><code class="docutils literal notranslate"><span class="pre">spacrCombo.canvas_height</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCombo.canvas"><code class="docutils literal notranslate"><span class="pre">spacrCombo.canvas</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCombo.var"><code class="docutils literal notranslate"><span class="pre">spacrCombo.var</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCombo.selected_value"><code class="docutils literal notranslate"><span class="pre">spacrCombo.selected_value</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCombo.dropdown_menu"><code class="docutils literal notranslate"><span class="pre">spacrCombo.dropdown_menu</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCombo.draw_rounded_rectangle"><code class="docutils literal notranslate"><span class="pre">spacrCombo.draw_rounded_rectangle()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCombo.on_click"><code class="docutils literal notranslate"><span class="pre">spacrCombo.on_click()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCombo.open_dropdown"><code class="docutils literal notranslate"><span class="pre">spacrCombo.open_dropdown()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCombo.close_dropdown"><code class="docutils literal notranslate"><span class="pre">spacrCombo.close_dropdown()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCombo.on_select"><code class="docutils literal notranslate"><span class="pre">spacrCombo.on_select()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCombo.set"><code class="docutils literal notranslate"><span class="pre">spacrCombo.set()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrDropdownMenu"><code class="docutils literal notranslate"><span class="pre">spacrDropdownMenu</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrDropdownMenu.variable"><code class="docutils literal notranslate"><span class="pre">spacrDropdownMenu.variable</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrDropdownMenu.options"><code class="docutils literal notranslate"><span class="pre">spacrDropdownMenu.options</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrDropdownMenu.command"><code class="docutils literal notranslate"><span class="pre">spacrDropdownMenu.command</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrDropdownMenu.text"><code class="docutils literal notranslate"><span class="pre">spacrDropdownMenu.text</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrDropdownMenu.size"><code class="docutils literal notranslate"><span class="pre">spacrDropdownMenu.size</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrDropdownMenu.font_size"><code class="docutils literal notranslate"><span class="pre">spacrDropdownMenu.font_size</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrDropdownMenu.font_loader"><code class="docutils literal notranslate"><span class="pre">spacrDropdownMenu.font_loader</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrDropdownMenu.button_width"><code class="docutils literal notranslate"><span class="pre">spacrDropdownMenu.button_width</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrDropdownMenu.canvas_width"><code class="docutils literal notranslate"><span class="pre">spacrDropdownMenu.canvas_width</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrDropdownMenu.canvas_height"><code class="docutils literal notranslate"><span class="pre">spacrDropdownMenu.canvas_height</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrDropdownMenu.canvas"><code class="docutils literal notranslate"><span class="pre">spacrDropdownMenu.canvas</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrDropdownMenu.inactive_color"><code class="docutils literal notranslate"><span class="pre">spacrDropdownMenu.inactive_color</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrDropdownMenu.active_color"><code class="docutils literal notranslate"><span class="pre">spacrDropdownMenu.active_color</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrDropdownMenu.fg_color"><code class="docutils literal notranslate"><span class="pre">spacrDropdownMenu.fg_color</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrDropdownMenu.bg_color"><code class="docutils literal notranslate"><span class="pre">spacrDropdownMenu.bg_color</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrDropdownMenu.button_bg"><code class="docutils literal notranslate"><span class="pre">spacrDropdownMenu.button_bg</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrDropdownMenu.button_text"><code class="docutils literal notranslate"><span class="pre">spacrDropdownMenu.button_text</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrDropdownMenu.menu"><code class="docutils literal notranslate"><span class="pre">spacrDropdownMenu.menu</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrDropdownMenu.create_rounded_rectangle"><code class="docutils literal notranslate"><span class="pre">spacrDropdownMenu.create_rounded_rectangle()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrDropdownMenu.on_enter"><code class="docutils literal notranslate"><span class="pre">spacrDropdownMenu.on_enter()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrDropdownMenu.on_leave"><code class="docutils literal notranslate"><span class="pre">spacrDropdownMenu.on_leave()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrDropdownMenu.on_click"><code class="docutils literal notranslate"><span class="pre">spacrDropdownMenu.on_click()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrDropdownMenu.post_menu"><code class="docutils literal notranslate"><span class="pre">spacrDropdownMenu.post_menu()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrDropdownMenu.on_select"><code class="docutils literal notranslate"><span class="pre">spacrDropdownMenu.on_select()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrDropdownMenu.update_styles"><code class="docutils literal notranslate"><span class="pre">spacrDropdownMenu.update_styles()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCheckbutton"><code class="docutils literal notranslate"><span class="pre">spacrCheckbutton</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCheckbutton.text"><code class="docutils literal notranslate"><span class="pre">spacrCheckbutton.text</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCheckbutton.variable"><code class="docutils literal notranslate"><span class="pre">spacrCheckbutton.variable</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrCheckbutton.command"><code class="docutils literal notranslate"><span class="pre">spacrCheckbutton.command</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrProgressBar"><code class="docutils literal notranslate"><span class="pre">spacrProgressBar</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrProgressBar.fg_color"><code class="docutils literal notranslate"><span class="pre">spacrProgressBar.fg_color</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrProgressBar.bg_color"><code class="docutils literal notranslate"><span class="pre">spacrProgressBar.bg_color</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrProgressBar.active_color"><code class="docutils literal notranslate"><span class="pre">spacrProgressBar.active_color</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrProgressBar.inactive_color"><code class="docutils literal notranslate"><span class="pre">spacrProgressBar.inactive_color</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrProgressBar.font_size"><code class="docutils literal notranslate"><span class="pre">spacrProgressBar.font_size</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrProgressBar.font_loader"><code class="docutils literal notranslate"><span class="pre">spacrProgressBar.font_loader</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrProgressBar.style"><code class="docutils literal notranslate"><span class="pre">spacrProgressBar.style</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrProgressBar.label"><code class="docutils literal notranslate"><span class="pre">spacrProgressBar.label</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrProgressBar.operation_type"><code class="docutils literal notranslate"><span class="pre">spacrProgressBar.operation_type</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrProgressBar.additional_info"><code class="docutils literal notranslate"><span class="pre">spacrProgressBar.additional_info</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrProgressBar.set_label_position"><code class="docutils literal notranslate"><span class="pre">spacrProgressBar.set_label_position()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrProgressBar.update_label"><code class="docutils literal notranslate"><span class="pre">spacrProgressBar.update_label()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSlider"><code class="docutils literal notranslate"><span class="pre">spacrSlider</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSlider.specified_length"><code class="docutils literal notranslate"><span class="pre">spacrSlider.specified_length</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSlider.knob_radius"><code class="docutils literal notranslate"><span class="pre">spacrSlider.knob_radius</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSlider.thickness"><code class="docutils literal notranslate"><span class="pre">spacrSlider.thickness</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSlider.knob_position"><code class="docutils literal notranslate"><span class="pre">spacrSlider.knob_position</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSlider.slider_line"><code class="docutils literal notranslate"><span class="pre">spacrSlider.slider_line</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSlider.knob"><code class="docutils literal notranslate"><span class="pre">spacrSlider.knob</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSlider.position"><code class="docutils literal notranslate"><span class="pre">spacrSlider.position</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSlider.offset"><code class="docutils literal notranslate"><span class="pre">spacrSlider.offset</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSlider.from_"><code class="docutils literal notranslate"><span class="pre">spacrSlider.from_</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSlider.to"><code class="docutils literal notranslate"><span class="pre">spacrSlider.to</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSlider.value"><code class="docutils literal notranslate"><span class="pre">spacrSlider.value</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSlider.show_index"><code class="docutils literal notranslate"><span class="pre">spacrSlider.show_index</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSlider.command"><code class="docutils literal notranslate"><span class="pre">spacrSlider.command</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSlider.fg_color"><code class="docutils literal notranslate"><span class="pre">spacrSlider.fg_color</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSlider.bg_color"><code class="docutils literal notranslate"><span class="pre">spacrSlider.bg_color</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSlider.active_color"><code class="docutils literal notranslate"><span class="pre">spacrSlider.active_color</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSlider.inactive_color"><code class="docutils literal notranslate"><span class="pre">spacrSlider.inactive_color</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSlider.canvas"><code class="docutils literal notranslate"><span class="pre">spacrSlider.canvas</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSlider.length"><code class="docutils literal notranslate"><span class="pre">spacrSlider.length</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSlider.resize_slider"><code class="docutils literal notranslate"><span class="pre">spacrSlider.resize_slider()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSlider.value_to_position"><code class="docutils literal notranslate"><span class="pre">spacrSlider.value_to_position()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSlider.position_to_value"><code class="docutils literal notranslate"><span class="pre">spacrSlider.position_to_value()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSlider.draw_slider"><code class="docutils literal notranslate"><span class="pre">spacrSlider.draw_slider()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSlider.move_knob"><code class="docutils literal notranslate"><span class="pre">spacrSlider.move_knob()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSlider.activate_knob"><code class="docutils literal notranslate"><span class="pre">spacrSlider.activate_knob()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSlider.release_knob"><code class="docutils literal notranslate"><span class="pre">spacrSlider.release_knob()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSlider.set_to"><code class="docutils literal notranslate"><span class="pre">spacrSlider.set_to()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSlider.get"><code class="docutils literal notranslate"><span class="pre">spacrSlider.get()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSlider.set"><code class="docutils literal notranslate"><span class="pre">spacrSlider.set()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSlider.jump_to_click"><code class="docutils literal notranslate"><span class="pre">spacrSlider.jump_to_click()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSlider.update_slider_from_entry"><code class="docutils literal notranslate"><span class="pre">spacrSlider.update_slider_from_entry()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrScrollbarStyle"><code class="docutils literal notranslate"><span class="pre">spacrScrollbarStyle()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrFrame"><code class="docutils literal notranslate"><span class="pre">spacrFrame</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrFrame.inactive_color"><code class="docutils literal notranslate"><span class="pre">spacrFrame.inactive_color</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrFrame.active_color"><code class="docutils literal notranslate"><span class="pre">spacrFrame.active_color</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrFrame.fg_color"><code class="docutils literal notranslate"><span class="pre">spacrFrame.fg_color</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrFrame.rounded_rectangle"><code class="docutils literal notranslate"><span class="pre">spacrFrame.rounded_rectangle()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrLabel"><code class="docutils literal notranslate"><span class="pre">spacrLabel</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrLabel.text"><code class="docutils literal notranslate"><span class="pre">spacrLabel.text</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrLabel.align"><code class="docutils literal notranslate"><span class="pre">spacrLabel.align</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrLabel.style_out"><code class="docutils literal notranslate"><span class="pre">spacrLabel.style_out</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrLabel.font_style"><code class="docutils literal notranslate"><span class="pre">spacrLabel.font_style</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrLabel.font_size"><code class="docutils literal notranslate"><span class="pre">spacrLabel.font_size</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrLabel.font_family"><code class="docutils literal notranslate"><span class="pre">spacrLabel.font_family</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrLabel.font_loader"><code class="docutils literal notranslate"><span class="pre">spacrLabel.font_loader</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrLabel.canvas"><code class="docutils literal notranslate"><span class="pre">spacrLabel.canvas</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrLabel.style"><code class="docutils literal notranslate"><span class="pre">spacrLabel.style</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrLabel.set_text"><code class="docutils literal notranslate"><span class="pre">spacrLabel.set_text()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrButton"><code class="docutils literal notranslate"><span class="pre">spacrButton</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrButton.text"><code class="docutils literal notranslate"><span class="pre">spacrButton.text</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrButton.command"><code class="docutils literal notranslate"><span class="pre">spacrButton.command</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrButton.icon_name"><code class="docutils literal notranslate"><span class="pre">spacrButton.icon_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrButton.size"><code class="docutils literal notranslate"><span class="pre">spacrButton.size</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrButton.show_text"><code class="docutils literal notranslate"><span class="pre">spacrButton.show_text</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrButton.outline"><code class="docutils literal notranslate"><span class="pre">spacrButton.outline</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrButton.animation"><code class="docutils literal notranslate"><span class="pre">spacrButton.animation</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrButton.font_size"><code class="docutils literal notranslate"><span class="pre">spacrButton.font_size</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrButton.font_loader"><code class="docutils literal notranslate"><span class="pre">spacrButton.font_loader</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrButton.canvas"><code class="docutils literal notranslate"><span class="pre">spacrButton.canvas</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrButton.inactive_color"><code class="docutils literal notranslate"><span class="pre">spacrButton.inactive_color</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrButton.bg_color"><code class="docutils literal notranslate"><span class="pre">spacrButton.bg_color</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrButton.active_color"><code class="docutils literal notranslate"><span class="pre">spacrButton.active_color</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrButton.fg_color"><code class="docutils literal notranslate"><span class="pre">spacrButton.fg_color</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrButton.is_zoomed_in"><code class="docutils literal notranslate"><span class="pre">spacrButton.is_zoomed_in</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrButton.load_icon"><code class="docutils literal notranslate"><span class="pre">spacrButton.load_icon()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrButton.get_icon_path"><code class="docutils literal notranslate"><span class="pre">spacrButton.get_icon_path()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrButton.on_enter"><code class="docutils literal notranslate"><span class="pre">spacrButton.on_enter()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrButton.on_leave"><code class="docutils literal notranslate"><span class="pre">spacrButton.on_leave()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrButton.on_click"><code class="docutils literal notranslate"><span class="pre">spacrButton.on_click()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrButton.create_rounded_rectangle"><code class="docutils literal notranslate"><span class="pre">spacrButton.create_rounded_rectangle()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrButton.update_description"><code class="docutils literal notranslate"><span class="pre">spacrButton.update_description()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrButton.clear_description"><code class="docutils literal notranslate"><span class="pre">spacrButton.clear_description()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrButton.animate_zoom"><code class="docutils literal notranslate"><span class="pre">spacrButton.animate_zoom()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrButton.zoom_icon"><code class="docutils literal notranslate"><span class="pre">spacrButton.zoom_icon()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSwitch"><code class="docutils literal notranslate"><span class="pre">spacrSwitch</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSwitch.text"><code class="docutils literal notranslate"><span class="pre">spacrSwitch.text</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSwitch.variable"><code class="docutils literal notranslate"><span class="pre">spacrSwitch.variable</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSwitch.command"><code class="docutils literal notranslate"><span class="pre">spacrSwitch.command</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSwitch.canvas"><code class="docutils literal notranslate"><span class="pre">spacrSwitch.canvas</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSwitch.switch_bg"><code class="docutils literal notranslate"><span class="pre">spacrSwitch.switch_bg</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSwitch.switch"><code class="docutils literal notranslate"><span class="pre">spacrSwitch.switch</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSwitch.label"><code class="docutils literal notranslate"><span class="pre">spacrSwitch.label</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSwitch.toggle"><code class="docutils literal notranslate"><span class="pre">spacrSwitch.toggle()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSwitch.update_switch"><code class="docutils literal notranslate"><span class="pre">spacrSwitch.update_switch()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSwitch.animate_switch"><code class="docutils literal notranslate"><span class="pre">spacrSwitch.animate_switch()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSwitch.animate_movement"><code class="docutils literal notranslate"><span class="pre">spacrSwitch.animate_movement()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSwitch.get"><code class="docutils literal notranslate"><span class="pre">spacrSwitch.get()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSwitch.set"><code class="docutils literal notranslate"><span class="pre">spacrSwitch.set()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrSwitch.create_rounded_rectangle"><code class="docutils literal notranslate"><span class="pre">spacrSwitch.create_rounded_rectangle()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrToolTip"><code class="docutils literal notranslate"><span class="pre">spacrToolTip</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrToolTip.widget"><code class="docutils literal notranslate"><span class="pre">spacrToolTip.widget</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrToolTip.text"><code class="docutils literal notranslate"><span class="pre">spacrToolTip.text</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrToolTip.tooltip_window"><code class="docutils literal notranslate"><span class="pre">spacrToolTip.tooltip_window</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrToolTip.show_tooltip"><code class="docutils literal notranslate"><span class="pre">spacrToolTip.show_tooltip()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.spacrToolTip.hide_tooltip"><code class="docutils literal notranslate"><span class="pre">spacrToolTip.hide_tooltip()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.standardize_figure"><code class="docutils literal notranslate"><span class="pre">standardize_figure()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.modify_figure_properties"><code class="docutils literal notranslate"><span class="pre">modify_figure_properties()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.save_figure_as_format"><code class="docutils literal notranslate"><span class="pre">save_figure_as_format()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.modify_figure"><code class="docutils literal notranslate"><span class="pre">modify_figure()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_elements/index.html#spacr.gui_elements.generate_dna_matrix"><code class="docutils literal notranslate"><span class="pre">generate_dna_matrix()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/spacr/gui_utils/index.html">GUI Utilities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/spacr/gui_utils/index.html#module-contents">Module Contents</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_utils/index.html#spacr.gui_utils.initialize_cuda"><code class="docutils literal notranslate"><span class="pre">initialize_cuda()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_utils/index.html#spacr.gui_utils.set_high_priority"><code class="docutils literal notranslate"><span class="pre">set_high_priority()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_utils/index.html#spacr.gui_utils.set_cpu_affinity"><code class="docutils literal notranslate"><span class="pre">set_cpu_affinity()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_utils/index.html#spacr.gui_utils.proceed_with_app"><code class="docutils literal notranslate"><span class="pre">proceed_with_app()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_utils/index.html#spacr.gui_utils.load_app"><code class="docutils literal notranslate"><span class="pre">load_app()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_utils/index.html#spacr.gui_utils.parse_list"><code class="docutils literal notranslate"><span class="pre">parse_list()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_utils/index.html#spacr.gui_utils.create_input_field"><code class="docutils literal notranslate"><span class="pre">create_input_field()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_utils/index.html#spacr.gui_utils.process_stdout_stderr"><code class="docutils literal notranslate"><span class="pre">process_stdout_stderr()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_utils/index.html#spacr.gui_utils.WriteToQueue"><code class="docutils literal notranslate"><span class="pre">WriteToQueue</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_utils/index.html#spacr.gui_utils.WriteToQueue.q"><code class="docutils literal notranslate"><span class="pre">WriteToQueue.q</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_utils/index.html#spacr.gui_utils.WriteToQueue.write"><code class="docutils literal notranslate"><span class="pre">WriteToQueue.write()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/gui_utils/index.html#spacr.gui_utils.WriteToQueue.flush"><code class="docutils literal notranslate"><span class="pre">WriteToQueue.flush()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_utils/index.html#spacr.gui_utils.cancel_after_tasks"><code class="docutils literal notranslate"><span class="pre">cancel_after_tasks()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_utils/index.html#spacr.gui_utils.load_next_app"><code class="docutils literal notranslate"><span class="pre">load_next_app()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_utils/index.html#spacr.gui_utils.convert_settings_dict_for_gui"><code class="docutils literal notranslate"><span class="pre">convert_settings_dict_for_gui()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_utils/index.html#spacr.gui_utils.spacrFigShow"><code class="docutils literal notranslate"><span class="pre">spacrFigShow()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_utils/index.html#spacr.gui_utils.function_gui_wrapper"><code class="docutils literal notranslate"><span class="pre">function_gui_wrapper()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_utils/index.html#spacr.gui_utils.run_function_gui"><code class="docutils literal notranslate"><span class="pre">run_function_gui()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_utils/index.html#spacr.gui_utils.hide_all_settings"><code class="docutils literal notranslate"><span class="pre">hide_all_settings()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_utils/index.html#spacr.gui_utils.setup_frame"><code class="docutils literal notranslate"><span class="pre">setup_frame()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_utils/index.html#spacr.gui_utils.download_hug_dataset"><code class="docutils literal notranslate"><span class="pre">download_hug_dataset()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_utils/index.html#spacr.gui_utils.download_dataset"><code class="docutils literal notranslate"><span class="pre">download_dataset()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_utils/index.html#spacr.gui_utils.ensure_after_tasks"><code class="docutils literal notranslate"><span class="pre">ensure_after_tasks()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_utils/index.html#spacr.gui_utils.display_gif_in_plot_frame"><code class="docutils literal notranslate"><span class="pre">display_gif_in_plot_frame()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_utils/index.html#spacr.gui_utils.display_media_in_plot_frame"><code class="docutils literal notranslate"><span class="pre">display_media_in_plot_frame()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_utils/index.html#spacr.gui_utils.print_widget_structure"><code class="docutils literal notranslate"><span class="pre">print_widget_structure()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_utils/index.html#spacr.gui_utils.get_screen_dimensions"><code class="docutils literal notranslate"><span class="pre">get_screen_dimensions()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/gui_utils/index.html#spacr.gui_utils.convert_to_number"><code class="docutils literal notranslate"><span class="pre">convert_to_number()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Sequencing &amp; Submodules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/spacr/sequencing/index.html">Sequencing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/spacr/sequencing/index.html#module-contents">Module Contents</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/sequencing/index.html#spacr.sequencing.map_sequences_to_names"><code class="docutils literal notranslate"><span class="pre">map_sequences_to_names()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/sequencing/index.html#spacr.sequencing.save_df_to_hdf5"><code class="docutils literal notranslate"><span class="pre">save_df_to_hdf5()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/sequencing/index.html#spacr.sequencing.save_unique_combinations_to_csv"><code class="docutils literal notranslate"><span class="pre">save_unique_combinations_to_csv()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/sequencing/index.html#spacr.sequencing.save_qc_df_to_csv"><code class="docutils literal notranslate"><span class="pre">save_qc_df_to_csv()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/sequencing/index.html#spacr.sequencing.extract_sequence_and_quality"><code class="docutils literal notranslate"><span class="pre">extract_sequence_and_quality()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/sequencing/index.html#spacr.sequencing.create_consensus"><code class="docutils literal notranslate"><span class="pre">create_consensus()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/sequencing/index.html#spacr.sequencing.get_consensus_base"><code class="docutils literal notranslate"><span class="pre">get_consensus_base()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/sequencing/index.html#spacr.sequencing.reverse_complement"><code class="docutils literal notranslate"><span class="pre">reverse_complement()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/sequencing/index.html#spacr.sequencing.process_chunk"><code class="docutils literal notranslate"><span class="pre">process_chunk()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/sequencing/index.html#spacr.sequencing.saver_process"><code class="docutils literal notranslate"><span class="pre">saver_process()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/sequencing/index.html#spacr.sequencing.paired_read_chunked_processing"><code class="docutils literal notranslate"><span class="pre">paired_read_chunked_processing()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/sequencing/index.html#spacr.sequencing.single_read_chunked_processing"><code class="docutils literal notranslate"><span class="pre">single_read_chunked_processing()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/sequencing/index.html#spacr.sequencing.generate_barecode_mapping"><code class="docutils literal notranslate"><span class="pre">generate_barecode_mapping()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/sequencing/index.html#spacr.sequencing.barecodes_reverse_complement"><code class="docutils literal notranslate"><span class="pre">barecodes_reverse_complement()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/sequencing/index.html#spacr.sequencing.graph_sequencing_stats"><code class="docutils literal notranslate"><span class="pre">graph_sequencing_stats()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/spacr/toxo/index.html">Toxoplasma Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/spacr/toxo/index.html#module-contents">Module Contents</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/toxo/index.html#spacr.toxo.custom_volcano_plot"><code class="docutils literal notranslate"><span class="pre">custom_volcano_plot()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/toxo/index.html#spacr.toxo.go_term_enrichment_by_column"><code class="docutils literal notranslate"><span class="pre">go_term_enrichment_by_column()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/toxo/index.html#spacr.toxo.plot_gene_phenotypes"><code class="docutils literal notranslate"><span class="pre">plot_gene_phenotypes()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/toxo/index.html#spacr.toxo.plot_gene_heatmaps"><code class="docutils literal notranslate"><span class="pre">plot_gene_heatmaps()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/toxo/index.html#spacr.toxo.generate_score_heatmap"><code class="docutils literal notranslate"><span class="pre">generate_score_heatmap()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/spacr/submodules/index.html">Submodules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/spacr/submodules/index.html#module-contents">Module Contents</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/submodules/index.html#spacr.submodules.CellposeLazyDataset"><code class="docutils literal notranslate"><span class="pre">CellposeLazyDataset</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/submodules/index.html#spacr.submodules.CellposeLazyDataset.normalize"><code class="docutils literal notranslate"><span class="pre">CellposeLazyDataset.normalize</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/submodules/index.html#spacr.submodules.CellposeLazyDataset.percentiles"><code class="docutils literal notranslate"><span class="pre">CellposeLazyDataset.percentiles</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/submodules/index.html#spacr.submodules.CellposeLazyDataset.target_size"><code class="docutils literal notranslate"><span class="pre">CellposeLazyDataset.target_size</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/submodules/index.html#spacr.submodules.CellposeLazyDataset.augment"><code class="docutils literal notranslate"><span class="pre">CellposeLazyDataset.augment</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/submodules/index.html#spacr.submodules.CellposeLazyDataset.__len__"><code class="docutils literal notranslate"><span class="pre">CellposeLazyDataset.__len__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/submodules/index.html#spacr.submodules.CellposeLazyDataset.apply_augmentation"><code class="docutils literal notranslate"><span class="pre">CellposeLazyDataset.apply_augmentation()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/spacr/submodules/index.html#spacr.submodules.CellposeLazyDataset.__getitem__"><code class="docutils literal notranslate"><span class="pre">CellposeLazyDataset.__getitem__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/submodules/index.html#spacr.submodules.train_cellpose"><code class="docutils literal notranslate"><span class="pre">train_cellpose()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/submodules/index.html#spacr.submodules.test_cellpose_model"><code class="docutils literal notranslate"><span class="pre">test_cellpose_model()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/submodules/index.html#spacr.submodules.apply_cellpose_model"><code class="docutils literal notranslate"><span class="pre">apply_cellpose_model()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/submodules/index.html#spacr.submodules.plot_cellpose_batch"><code class="docutils literal notranslate"><span class="pre">plot_cellpose_batch()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/submodules/index.html#spacr.submodules.analyze_percent_positive"><code class="docutils literal notranslate"><span class="pre">analyze_percent_positive()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/submodules/index.html#spacr.submodules.analyze_recruitment"><code class="docutils literal notranslate"><span class="pre">analyze_recruitment()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/submodules/index.html#spacr.submodules.analyze_plaques"><code class="docutils literal notranslate"><span class="pre">analyze_plaques()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/submodules/index.html#spacr.submodules.count_phenotypes"><code class="docutils literal notranslate"><span class="pre">count_phenotypes()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/submodules/index.html#spacr.submodules.compare_reads_to_scores"><code class="docutils literal notranslate"><span class="pre">compare_reads_to_scores()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/submodules/index.html#spacr.submodules.interperate_vision_model"><code class="docutils literal notranslate"><span class="pre">interperate_vision_model()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/submodules/index.html#spacr.submodules.analyze_endodyogeny"><code class="docutils literal notranslate"><span class="pre">analyze_endodyogeny()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/submodules/index.html#spacr.submodules.analyze_class_proportion"><code class="docutils literal notranslate"><span class="pre">analyze_class_proportion()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/submodules/index.html#spacr.submodules.generate_score_heatmap"><code class="docutils literal notranslate"><span class="pre">generate_score_heatmap()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/spacr/submodules/index.html#spacr.submodules.post_regression_analysis"><code class="docutils literal notranslate"><span class="pre">post_regression_analysis()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API Reference</a><ul class="simple">
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #005f73" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">spacr</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">spacr.plot</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for spacr.plot</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">random</span><span class="o">,</span> <span class="nn">cv2</span><span class="o">,</span> <span class="nn">glob</span><span class="o">,</span> <span class="nn">math</span><span class="o">,</span> <span class="nn">torch</span><span class="o">,</span> <span class="nn">itertools</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">ListedColormap</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">scipy.ndimage</span> <span class="k">as</span> <span class="nn">ndi</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">imageio.v2</span> <span class="k">as</span> <span class="nn">imageio</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
<span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">measure</span>
<span class="kn">from</span> <span class="nn">skimage.measure</span> <span class="kn">import</span> <span class="n">find_contours</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">regionprops</span>
<span class="kn">from</span> <span class="nn">skimage.transform</span> <span class="kn">import</span> <span class="n">resize</span> <span class="k">as</span> <span class="n">sk_resize</span>
<span class="kn">import</span> <span class="nn">scikit_posthocs</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">chi2_contingency</span>
<span class="kn">import</span> <span class="nn">tifffile</span> <span class="k">as</span> <span class="nn">tiff</span>

<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">normaltest</span><span class="p">,</span> <span class="n">ttest_ind</span><span class="p">,</span> <span class="n">mannwhitneyu</span><span class="p">,</span> <span class="n">f_oneway</span><span class="p">,</span> <span class="n">kruskal</span><span class="p">,</span> <span class="n">levene</span><span class="p">,</span> <span class="n">shapiro</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.multicomp</span> <span class="kn">import</span> <span class="n">pairwise_tukeyhsd</span>
<span class="kn">import</span> <span class="nn">pingouin</span> <span class="k">as</span> <span class="nn">pg</span>

<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">IntSlider</span><span class="p">,</span> <span class="n">interact</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span> <span class="k">as</span> <span class="n">ipyimage</span>
<span class="kn">from</span> <span class="nn">matplotlib_venn</span> <span class="kn">import</span> <span class="n">venn2</span>

<div class="viewcode-block" id="plot_image_mask_overlay">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.plot_image_mask_overlay">[docs]</a>
<span class="k">def</span> <span class="nf">plot_image_mask_overlay</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="n">channels</span><span class="p">,</span><span class="n">cell_channel</span><span class="p">,</span><span class="n">nucleus_channel</span><span class="p">,</span><span class="n">pathogen_channel</span><span class="p">,</span><span class="n">figuresize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">percentiles</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">98</span><span class="p">),</span><span class="n">thickness</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">save_pdf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;outlines&#39;</span><span class="p">,</span><span class="n">export_tiffs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">all_on_all</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">all_outlines</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">filter_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot multi-channel microscopy image overlays with cell, nucleus, and pathogen masks.</span>

<span class="sd">    This function visualizes microscopy images with optional mask overlays for different object types.</span>
<span class="sd">    It supports contour and filled mask modes, object filtering based on size and intensity, and saving output.</span>

<span class="sd">    Args:</span>
<span class="sd">        file (str): Path to the `.npy` image stack (H x W x C).</span>
<span class="sd">        channels (list): Indices of the image channels to display.</span>
<span class="sd">        cell_channel (int or None): Channel index for the cell mask intensity.</span>
<span class="sd">        nucleus_channel (int or None): Channel index for the nucleus mask intensity.</span>
<span class="sd">        pathogen_channel (int or None): Channel index for the pathogen mask intensity.</span>
<span class="sd">        figuresize (int): Base figure size for each subplot. Default is 10.</span>
<span class="sd">        percentiles (tuple): Percentile range for image normalization. Default is (2, 98).</span>
<span class="sd">        thickness (int): Thickness of mask contour outlines. Default is 3.</span>
<span class="sd">        save_pdf (bool): If True, saves a PDF of the overlaid image. Default is True.</span>
<span class="sd">        mode (str): &#39;outlines&#39; or &#39;filled&#39;. Determines how masks are rendered. Default is &#39;outlines&#39;.</span>
<span class="sd">        export_tiffs (bool): If True, exports grayscale TIFFs for each image channel. Default is False.</span>
<span class="sd">        all_on_all (bool): If True, overlays all outlines on all channels. Default is False.</span>
<span class="sd">        all_outlines (bool): If True, overlays all outlines on non-matching channels. Default is False.</span>
<span class="sd">        filter_dict (dict or None): Dictionary of filtering thresholds for each object type. </span>
<span class="sd">            For example: {&quot;cell&quot;: [(min_area, max_area), (min_intensity, max_intensity)]}</span>

<span class="sd">    Returns:</span>
<span class="sd">        matplotlib.figure.Figure: The generated overlay figure.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">random_color_cmap</span><span class="p">(</span><span class="n">n_labels</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates a random color map for a given number of labels.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">rand_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n_labels</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">rand_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">rand_colors</span><span class="p">])</span>  <span class="c1"># Ensure background is black</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">ListedColormap</span><span class="p">(</span><span class="n">rand_colors</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cmap</span>

    <span class="k">def</span> <span class="nf">_plot_merged_plot</span><span class="p">(</span>
        <span class="n">image</span><span class="p">,</span>
        <span class="n">outlines</span><span class="p">,</span>
        <span class="n">outline_colors</span><span class="p">,</span>
        <span class="n">figuresize</span><span class="p">,</span>
        <span class="n">thickness</span><span class="p">,</span>
        <span class="n">percentiles</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;outlines&#39;</span><span class="p">,</span>
        <span class="n">all_on_all</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">all_outlines</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">channels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">cell_channel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">nucleus_channel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">pathogen_channel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">cell_outlines</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">nucleus_outlines</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">pathogen_outlines</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">save_pdf</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot the merged plot with overlay, image channels, and masks.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">_generate_colored_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">cmap</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Generate a colored mask using the given colormap.&quot;&quot;&quot;</span>
            <span class="n">mask_norm</span> <span class="o">=</span> <span class="n">mask</span> <span class="o">/</span> <span class="p">(</span><span class="n">mask</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mf">1e-5</span><span class="p">)</span>  <span class="c1"># Normalize mask</span>
            <span class="n">colored_mask</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">mask_norm</span><span class="p">)</span>
            <span class="n">colored_mask</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># Alpha channel</span>
            <span class="k">return</span> <span class="n">colored_mask</span>

        <span class="k">def</span> <span class="nf">_overlay_mask</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Overlay the colored mask onto the original image.&quot;&quot;&quot;</span>
            <span class="n">combined</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">image</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">mask</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">:])</span> <span class="o">+</span> <span class="n">mask</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">mask</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">:],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">combined</span>

        <span class="k">def</span> <span class="nf">_normalize_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">percentiles</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Normalize the image based on given percentiles.&quot;&quot;&quot;</span>
            <span class="n">v_min</span><span class="p">,</span> <span class="n">v_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">percentiles</span><span class="p">)</span>
            <span class="n">image_normalized</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">((</span><span class="n">image</span> <span class="o">-</span> <span class="n">v_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">v_max</span> <span class="o">-</span> <span class="n">v_min</span> <span class="o">+</span> <span class="mf">1e-5</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">image_normalized</span>

        <span class="k">def</span> <span class="nf">_generate_contours</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Generate contours from the mask using OpenCV.&quot;&quot;&quot;</span>
            <span class="n">contours</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findContours</span><span class="p">(</span>
                <span class="n">mask</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span> <span class="n">cv2</span><span class="o">.</span><span class="n">RETR_EXTERNAL</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CHAIN_APPROX_SIMPLE</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">contours</span>

        <span class="k">def</span> <span class="nf">_apply_contours</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">thickness</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Apply contours to the image.&quot;&quot;&quot;</span>
            <span class="n">unique_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">unique_labels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>  <span class="c1"># Skip background</span>
                <span class="n">label_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="n">label</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
                <span class="n">contours</span> <span class="o">=</span> <span class="n">_generate_contours</span><span class="p">(</span><span class="n">label_mask</span><span class="p">)</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">drawContours</span><span class="p">(</span>
                    <span class="n">image</span><span class="p">,</span> <span class="n">contours</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">to_rgb</span><span class="p">(</span><span class="n">color</span><span class="p">),</span> <span class="n">thickness</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="n">image</span>

        <span class="n">num_channels</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_channels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">figuresize</span><span class="p">,</span> <span class="n">figuresize</span><span class="p">))</span>

        <span class="c1"># Identify channels without associated outlines</span>
        <span class="n">channels_with_outlines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">cell_channel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">channels_with_outlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell_channel</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nucleus_channel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">channels_with_outlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nucleus_channel</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pathogen_channel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">channels_with_outlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pathogen_channel</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_channels</span><span class="p">):</span>
            <span class="n">channel_image</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">v</span><span class="p">]</span>
            <span class="n">channel_image_normalized</span> <span class="o">=</span> <span class="n">_normalize_image</span><span class="p">(</span><span class="n">channel_image</span><span class="p">,</span> <span class="n">percentiles</span><span class="p">)</span>
            <span class="n">channel_image_rgb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">([</span><span class="n">channel_image_normalized</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>

            <span class="n">current_channel</span> <span class="o">=</span> <span class="n">channels</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">all_on_all</span><span class="p">:</span>
                <span class="c1"># Apply all outlines to all channels</span>
                <span class="k">for</span> <span class="n">outline</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">outlines</span><span class="p">,</span> <span class="n">outline_colors</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;outlines&#39;</span><span class="p">:</span>
                        <span class="n">channel_image_rgb</span> <span class="o">=</span> <span class="n">_apply_contours</span><span class="p">(</span>
                            <span class="n">channel_image_rgb</span><span class="p">,</span> <span class="n">outline</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">thickness</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cmap</span> <span class="o">=</span> <span class="n">random_color_cmap</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">outline</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
                        <span class="n">mask</span> <span class="o">=</span> <span class="n">_generate_colored_mask</span><span class="p">(</span><span class="n">outline</span><span class="p">,</span> <span class="n">cmap</span><span class="p">)</span>
                        <span class="n">channel_image_rgb</span> <span class="o">=</span> <span class="n">_overlay_mask</span><span class="p">(</span><span class="n">channel_image_rgb</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">current_channel</span> <span class="ow">in</span> <span class="n">channels_with_outlines</span><span class="p">:</span>
                <span class="c1"># Apply only the relevant outline to each channel</span>
                <span class="n">outline</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">color</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="n">current_channel</span> <span class="o">==</span> <span class="n">cell_channel</span> <span class="ow">and</span> <span class="n">cell_outlines</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">outline</span> <span class="o">=</span> <span class="n">cell_outlines</span>
                <span class="k">elif</span> <span class="n">current_channel</span> <span class="o">==</span> <span class="n">nucleus_channel</span> <span class="ow">and</span> <span class="n">nucleus_outlines</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">outline</span> <span class="o">=</span> <span class="n">nucleus_outlines</span>
                <span class="k">elif</span> <span class="n">current_channel</span> <span class="o">==</span> <span class="n">pathogen_channel</span> <span class="ow">and</span> <span class="n">pathogen_outlines</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">outline</span> <span class="o">=</span> <span class="n">pathogen_outlines</span>

                <span class="k">if</span> <span class="n">outline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;outlines&#39;</span><span class="p">:</span>
                        <span class="c1"># Use magenta color when all_on_all=False</span>
                        <span class="n">channel_image_rgb</span> <span class="o">=</span> <span class="n">_apply_contours</span><span class="p">(</span>
                            <span class="n">channel_image_rgb</span><span class="p">,</span> <span class="n">outline</span><span class="p">,</span> <span class="s1">&#39;#FF00FF&#39;</span><span class="p">,</span> <span class="n">thickness</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cmap</span> <span class="o">=</span> <span class="n">random_color_cmap</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">outline</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
                        <span class="n">mask</span> <span class="o">=</span> <span class="n">_generate_colored_mask</span><span class="p">(</span><span class="n">outline</span><span class="p">,</span> <span class="n">cmap</span><span class="p">)</span>
                        <span class="n">channel_image_rgb</span> <span class="o">=</span> <span class="n">_overlay_mask</span><span class="p">(</span><span class="n">channel_image_rgb</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Channel without associated outlines</span>
                <span class="k">if</span> <span class="n">all_outlines</span><span class="p">:</span>
                    <span class="c1"># Apply all outlines with specified colors</span>
                    <span class="k">for</span> <span class="n">outline</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">outlines</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">]):</span>
                        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;outlines&#39;</span><span class="p">:</span>
                            <span class="n">channel_image_rgb</span> <span class="o">=</span> <span class="n">_apply_contours</span><span class="p">(</span>
                                <span class="n">channel_image_rgb</span><span class="p">,</span> <span class="n">outline</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">thickness</span>
                            <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">cmap</span> <span class="o">=</span> <span class="n">random_color_cmap</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">outline</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
                            <span class="n">mask</span> <span class="o">=</span> <span class="n">_generate_colored_mask</span><span class="p">(</span><span class="n">outline</span><span class="p">,</span> <span class="n">cmap</span><span class="p">)</span>
                            <span class="n">channel_image_rgb</span> <span class="o">=</span> <span class="n">_overlay_mask</span><span class="p">(</span><span class="n">channel_image_rgb</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>

            <span class="n">ax</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">channel_image_rgb</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Image - Channel </span><span class="si">{</span><span class="n">current_channel</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Create an image combining all objects filled with colors</span>
        <span class="n">combined_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">outlines</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">outline</span> <span class="ow">in</span> <span class="n">outlines</span><span class="p">:</span>
            <span class="n">combined_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">combined_mask</span><span class="p">,</span> <span class="n">outline</span><span class="p">)</span>

        <span class="n">cmap</span> <span class="o">=</span> <span class="n">random_color_cmap</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">combined_mask</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">_generate_colored_mask</span><span class="p">(</span><span class="n">combined_mask</span><span class="p">,</span> <span class="n">cmap</span><span class="p">)</span>
        <span class="n">blank_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="o">*</span><span class="n">combined_mask</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">filled_image</span> <span class="o">=</span> <span class="n">_overlay_mask</span><span class="p">(</span><span class="n">blank_image</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">filled_image</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Combined Objects Image&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="c1"># Save the figure as a PDF</span>
        <span class="k">if</span> <span class="n">save_pdf</span><span class="p">:</span>
            <span class="n">pdf_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">file</span><span class="p">)),</span> <span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="s1">&#39;overlay&#39;</span>
            <span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">pdf_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">pdf_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">pdf_dir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.npy&#39;</span><span class="p">,</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">fig</span>

    <span class="k">def</span> <span class="nf">_save_channels_as_tiff</span><span class="p">(</span><span class="n">stack</span><span class="p">,</span> <span class="n">save_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save each channel in the stack as a grayscale TIFF.&quot;&quot;&quot;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">stack</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">channel</span> <span class="o">=</span> <span class="n">stack</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
            <span class="n">tiff_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">_channel_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.tiff&quot;</span><span class="p">)</span>
            <span class="n">tiff</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">tiff_path</span><span class="p">,</span> <span class="n">channel</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">),</span> <span class="n">photometric</span><span class="o">=</span><span class="s1">&#39;minisblack&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved </span><span class="si">{</span><span class="n">tiff_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_filter_object</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">intensity_image</span><span class="p">,</span> <span class="n">min_max_area</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10000000</span><span class="p">),</span> <span class="n">min_max_intensity</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">65000</span><span class="p">),</span> <span class="n">type_</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Filter objects in a mask based on their area (size) and mean intensity.</span>

<span class="sd">        Args:</span>
<span class="sd">            mask (ndarray): The input mask.</span>
<span class="sd">            intensity_image (ndarray): The corresponding intensity image.</span>
<span class="sd">            min_max_area (tuple): A tuple (min_area, max_area) specifying the minimum and maximum area thresholds.</span>
<span class="sd">            min_max_intensity (tuple): A tuple (min_intensity, max_intensity) specifying the minimum and maximum intensity thresholds.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ndarray: The filtered mask.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">original_dtype</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">dtype</span>
        <span class="n">mask_int</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
        <span class="n">intensity_image</span> <span class="o">=</span> <span class="n">intensity_image</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="c1"># Compute properties for each labeled object</span>
        <span class="n">unique_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">mask_int</span><span class="p">)</span>
        <span class="n">unique_labels</span> <span class="o">=</span> <span class="n">unique_labels</span><span class="p">[</span><span class="n">unique_labels</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># Exclude background</span>
        <span class="n">num_objects_before</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_labels</span><span class="p">)</span>

        <span class="c1"># Initialize lists to store area and intensity for each object</span>
        <span class="n">areas</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">mean_intensities</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">labels_to_keep</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">unique_labels</span><span class="p">:</span>
            <span class="n">label_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">mask_int</span> <span class="o">==</span> <span class="n">label</span><span class="p">)</span>
            <span class="n">area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">label_mask</span><span class="p">)</span>
            <span class="n">mean_intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">intensity_image</span><span class="p">[</span><span class="n">label_mask</span><span class="p">])</span>

            <span class="n">areas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">area</span><span class="p">)</span>
            <span class="n">mean_intensities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean_intensity</span><span class="p">)</span>

            <span class="c1"># Check if the object meets both area and intensity criteria</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">min_max_area</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">area</span> <span class="o">&lt;=</span> <span class="n">min_max_area</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">min_max_intensity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">mean_intensity</span> <span class="o">&lt;=</span> <span class="n">min_max_intensity</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">labels_to_keep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

        <span class="c1"># Convert lists to numpy arrays for easier computation</span>
        <span class="n">areas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">areas</span><span class="p">)</span>
        <span class="n">mean_intensities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mean_intensities</span><span class="p">)</span>
        <span class="n">num_objects_after</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels_to_keep</span><span class="p">)</span>
        <span class="c1"># Compute average area and intensity before and after filtering</span>
        <span class="n">avg_area_before</span> <span class="o">=</span> <span class="n">areas</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">if</span> <span class="n">num_objects_before</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">avg_intensity_before</span> <span class="o">=</span> <span class="n">mean_intensities</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">if</span> <span class="n">num_objects_before</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">areas_after</span> <span class="o">=</span> <span class="n">areas</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">unique_labels</span><span class="p">,</span> <span class="n">labels_to_keep</span><span class="p">)]</span>
        <span class="n">mean_intensities_after</span> <span class="o">=</span> <span class="n">mean_intensities</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">unique_labels</span><span class="p">,</span> <span class="n">labels_to_keep</span><span class="p">)]</span>
        <span class="n">avg_area_after</span> <span class="o">=</span> <span class="n">areas_after</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">if</span> <span class="n">num_objects_after</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">avg_intensity_after</span> <span class="o">=</span> <span class="n">mean_intensities_after</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">if</span> <span class="n">num_objects_after</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Before filtering </span><span class="si">{</span><span class="n">type_</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">num_objects_before</span><span class="si">}</span><span class="s2"> objects&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Average area </span><span class="si">{</span><span class="n">type_</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">avg_area_before</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> pixels, Average intensity: </span><span class="si">{</span><span class="n">avg_intensity_before</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;After filtering </span><span class="si">{</span><span class="n">type_</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">num_objects_after</span><span class="si">}</span><span class="s2"> objects&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Average area </span><span class="si">{</span><span class="n">type_</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">avg_area_after</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> pixels, Average intensity: </span><span class="si">{</span><span class="n">avg_intensity_after</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">mask_filtered</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">mask_int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels_to_keep</span><span class="p">:</span>
            <span class="n">mask_filtered</span><span class="p">[</span><span class="n">mask_int</span> <span class="o">==</span> <span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span>
        <span class="n">mask_filtered</span> <span class="o">=</span> <span class="n">mask_filtered</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">original_dtype</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mask_filtered</span>

    <span class="n">stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">export_tiffs</span><span class="p">:</span>
        <span class="n">save_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">file</span><span class="p">)),</span>
            <span class="s1">&#39;results&#39;</span><span class="p">,</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))[</span><span class="mi">0</span><span class="p">],</span>
            <span class="s1">&#39;tiff&#39;</span>
        <span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">_save_channels_as_tiff</span><span class="p">(</span><span class="n">stack</span><span class="p">,</span> <span class="n">save_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

    <span class="c1"># Convert to float for normalization and ensure correct handling of arrays</span>
    <span class="k">if</span> <span class="n">stack</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">in</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">):</span>
        <span class="n">stack</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="n">image</span> <span class="o">=</span> <span class="n">stack</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">channels</span><span class="p">]</span>
    <span class="n">outlines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">outline_colors</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Define variables to hold individual outlines</span>
    <span class="n">cell_outlines</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">nucleus_outlines</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">pathogen_outlines</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">pathogen_channel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pathogen_mask_dim</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> 
        <span class="n">pathogen_outlines</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">stack</span><span class="p">,</span> <span class="n">pathogen_mask_dim</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filter_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pathogen_intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">stack</span><span class="p">,</span> <span class="n">pathogen_channel</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">pathogen_outlines</span> <span class="o">=</span> <span class="n">_filter_object</span><span class="p">(</span><span class="n">pathogen_outlines</span><span class="p">,</span> <span class="n">pathogen_intensity</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">[</span><span class="s1">&#39;pathogen&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">filter_dict</span><span class="p">[</span><span class="s1">&#39;pathogen&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">type_</span><span class="o">=</span><span class="s1">&#39;pathogen&#39;</span><span class="p">)</span>
        
        <span class="n">outlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pathogen_outlines</span><span class="p">)</span>
        <span class="n">outline_colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>  

    <span class="k">if</span> <span class="n">nucleus_channel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">nucleus_mask_dim</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="k">if</span> <span class="n">pathogen_channel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">nucleus_outlines</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">stack</span><span class="p">,</span> <span class="n">nucleus_mask_dim</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filter_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nucleus_intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">stack</span><span class="p">,</span> <span class="n">nucleus_channel</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">nucleus_outlines</span> <span class="o">=</span> <span class="n">_filter_object</span><span class="p">(</span><span class="n">nucleus_outlines</span><span class="p">,</span> <span class="n">nucleus_intensity</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">[</span><span class="s1">&#39;nucleus&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">filter_dict</span><span class="p">[</span><span class="s1">&#39;nucleus&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">type_</span><span class="o">=</span><span class="s1">&#39;nucleus&#39;</span><span class="p">)</span>
        <span class="n">outlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nucleus_outlines</span><span class="p">)</span>
        <span class="n">outline_colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>  

    <span class="k">if</span> <span class="n">cell_channel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">nucleus_channel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">pathogen_channel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cell_mask_dim</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span>
        <span class="k">elif</span> <span class="n">nucleus_channel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">pathogen_channel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cell_mask_dim</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cell_mask_dim</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">cell_outlines</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">stack</span><span class="p">,</span> <span class="n">cell_mask_dim</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filter_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cell_intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">stack</span><span class="p">,</span> <span class="n">cell_channel</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">cell_outlines</span> <span class="o">=</span> <span class="n">_filter_object</span><span class="p">(</span><span class="n">cell_outlines</span><span class="p">,</span> <span class="n">cell_intensity</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">[</span><span class="s1">&#39;cell&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">filter_dict</span><span class="p">[</span><span class="s1">&#39;cell&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">type_</span><span class="o">=</span><span class="s1">&#39;cell&#39;</span><span class="p">)</span>
        <span class="n">outlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell_outlines</span><span class="p">)</span>
        <span class="n">outline_colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">_plot_merged_plot</span><span class="p">(</span>
        <span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>
        <span class="n">outlines</span><span class="o">=</span><span class="n">outlines</span><span class="p">,</span>
        <span class="n">outline_colors</span><span class="o">=</span><span class="n">outline_colors</span><span class="p">,</span>
        <span class="n">figuresize</span><span class="o">=</span><span class="n">figuresize</span><span class="p">,</span>
        <span class="n">thickness</span><span class="o">=</span><span class="n">thickness</span><span class="p">,</span>
        <span class="n">percentiles</span><span class="o">=</span><span class="n">percentiles</span><span class="p">,</span>  <span class="c1"># Pass percentiles to the plotting function</span>
        <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
        <span class="n">all_on_all</span><span class="o">=</span><span class="n">all_on_all</span><span class="p">,</span>
        <span class="n">all_outlines</span><span class="o">=</span><span class="n">all_outlines</span><span class="p">,</span>
        <span class="n">channels</span><span class="o">=</span><span class="n">channels</span><span class="p">,</span>
        <span class="n">cell_channel</span><span class="o">=</span><span class="n">cell_channel</span><span class="p">,</span>
        <span class="n">nucleus_channel</span><span class="o">=</span><span class="n">nucleus_channel</span><span class="p">,</span>
        <span class="n">pathogen_channel</span><span class="o">=</span><span class="n">pathogen_channel</span><span class="p">,</span>
        <span class="n">cell_outlines</span><span class="o">=</span><span class="n">cell_outlines</span><span class="p">,</span>
        <span class="n">nucleus_outlines</span><span class="o">=</span><span class="n">nucleus_outlines</span><span class="p">,</span>
        <span class="n">pathogen_outlines</span><span class="o">=</span><span class="n">pathogen_outlines</span><span class="p">,</span>
        <span class="n">save_pdf</span><span class="o">=</span><span class="n">save_pdf</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="plot_cellpose4_output">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.plot_cellpose4_output">[docs]</a>
<span class="k">def</span> <span class="nf">plot_cellpose4_output</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">masks</span><span class="p">,</span> <span class="n">flows</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;inferno&#39;</span><span class="p">,</span> <span class="n">figuresize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">nr</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">print_object_number</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the masks and flows for a given batch of images.</span>

<span class="sd">    Args:</span>
<span class="sd">        batch (numpy.ndarray): The batch of images.</span>
<span class="sd">        masks (list or numpy.ndarray): The masks corresponding to the images.</span>
<span class="sd">        flows (list or numpy.ndarray): The flows corresponding to the images.</span>
<span class="sd">        cmap (str, optional): The colormap to use for displaying the images. Defaults to &#39;inferno&#39;.</span>
<span class="sd">        figuresize (int, optional): The size of the figure. Defaults to 20.</span>
<span class="sd">        nr (int, optional): The maximum number of images to plot. Defaults to 1.</span>
<span class="sd">        file_type (str, optional): The file type of the flows. Defaults to &#39;.npz&#39;.</span>
<span class="sd">        print_object_number (bool, optional): Whether to print the object number on the mask. Defaults to True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">_generate_mask_random_cmap</span><span class="p">,</span> <span class="n">mask_object_count</span>
    
    <span class="n">font</span> <span class="o">=</span> <span class="n">figuresize</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">for</span> <span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">flow</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">masks</span><span class="p">,</span> <span class="n">flows</span><span class="p">):</span>
        <span class="c1">#if print_object_number:</span>
        <span class="c1">#    num_objects = mask_object_count(mask)</span>
        <span class="c1">#    print(f&#39;Number of objects: {num_objects}&#39;)</span>
        <span class="n">random_cmap</span> <span class="o">=</span> <span class="n">_generate_mask_random_cmap</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">nr</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">chans</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">figuresize</span><span class="p">,</span> <span class="n">figuresize</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">v</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Image - Channel&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">chans</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">random_cmap</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">chans</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Mask&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">print_object_number</span><span class="p">:</span>
                <span class="n">unique_objects</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">mask</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">unique_objects</span><span class="p">:</span>
                    <span class="n">cy</span><span class="p">,</span> <span class="n">cx</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">center_of_mass</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="n">obj</span><span class="p">)</span>
                    <span class="n">ax</span><span class="p">[</span><span class="n">chans</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">font</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">chans</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">chans</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Flow&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span></div>


<div class="viewcode-block" id="plot_masks">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.plot_masks">[docs]</a>
<span class="k">def</span> <span class="nf">plot_masks</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">masks</span><span class="p">,</span> <span class="n">flows</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;inferno&#39;</span><span class="p">,</span> <span class="n">figuresize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">nr</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="s1">&#39;.npz&#39;</span><span class="p">,</span> <span class="n">print_object_number</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the masks and flows for a given batch of images.</span>

<span class="sd">    Args:</span>
<span class="sd">        batch (numpy.ndarray): The batch of images.</span>
<span class="sd">        masks (list or numpy.ndarray): The masks corresponding to the images.</span>
<span class="sd">        flows (list or numpy.ndarray): The flows corresponding to the images.</span>
<span class="sd">        cmap (str, optional): The colormap to use for displaying the images. Defaults to &#39;inferno&#39;.</span>
<span class="sd">        figuresize (int, optional): The size of the figure. Defaults to 20.</span>
<span class="sd">        nr (int, optional): The maximum number of images to plot. Defaults to 1.</span>
<span class="sd">        file_type (str, optional): The file type of the flows. Defaults to &#39;.npz&#39;.</span>
<span class="sd">        print_object_number (bool, optional): Whether to print the object number on the mask. Defaults to True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">batch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">masks</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">masks</span> <span class="o">=</span> <span class="p">[</span><span class="n">masks</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">flows</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">flows</span> <span class="o">=</span> <span class="p">[</span><span class="n">flows</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">flows</span> <span class="o">=</span> <span class="n">flows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;png&#39;</span><span class="p">:</span>
        <span class="n">flows</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">flows</span><span class="p">]</span>  <span class="c1"># assuming this is what you want to do when file_type is &#39;png&#39;</span>
    <span class="n">font</span> <span class="o">=</span> <span class="n">figuresize</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">flow</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">masks</span><span class="p">,</span> <span class="n">flows</span><span class="p">):</span>
        <span class="n">unique_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
        
        <span class="n">num_objects</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_labels</span><span class="p">[</span><span class="n">unique_labels</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">random_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">num_objects</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">random_colors</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">random_colors</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">random_cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">random_colors</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">nr</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">chans</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">figuresize</span><span class="p">,</span> <span class="n">figuresize</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">v</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span> <span class="c1">#_imshow</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Image - Channel&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">chans</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">random_cmap</span><span class="p">)</span> <span class="c1">#_imshow</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">chans</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Mask&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">print_object_number</span><span class="p">:</span>
                <span class="n">unique_objects</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">mask</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">unique_objects</span><span class="p">:</span>
                    <span class="n">cy</span><span class="p">,</span> <span class="n">cx</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">center_of_mass</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="n">obj</span><span class="p">)</span>
                    <span class="n">ax</span><span class="p">[</span><span class="n">chans</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">font</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">chans</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span> <span class="c1">#_imshow</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">chans</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Flow&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span></div>


<span class="k">def</span> <span class="nf">_plot_4D_arrays</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">figuresize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;inferno&#39;</span><span class="p">,</span> <span class="n">nr_npz</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nr</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot 4D arrays from .npz files.</span>

<span class="sd">    Args:</span>
<span class="sd">        src (str): The directory path where the .npz files are located.</span>
<span class="sd">        figuresize (int, optional): The size of the figure. Defaults to 10.</span>
<span class="sd">        cmap (str, optional): The colormap to use for image visualization. Defaults to &#39;inferno&#39;.</span>
<span class="sd">        nr_npz (int, optional): The number of .npz files to plot. Defaults to 1.</span>
<span class="sd">        nr (int, optional): The number of images to plot from each .npz file. Defaults to 1.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">src</span><span class="p">)</span> <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.npz&#39;</span><span class="p">)]</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">nr_npz</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)))</span>

    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">stack</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
        <span class="n">num_images</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">num_channels</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span> <span class="n">num_images</span><span class="p">)):</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">stack</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="c1"># Create subplots</span>
            <span class="k">if</span> <span class="n">num_channels</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">figuresize</span><span class="p">,</span> <span class="n">figuresize</span><span class="p">))</span>
                <span class="n">axs</span> <span class="o">=</span> <span class="p">[</span><span class="n">axs</span><span class="p">]</span>  <span class="c1"># Make axs a list to use axs[c] later</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_channels</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">num_channels</span> <span class="o">*</span> <span class="n">figuresize</span><span class="p">,</span> <span class="n">figuresize</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_channels</span><span class="p">):</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">c</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span> <span class="c1">#_imshow</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Channel </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

            <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span>

<div class="viewcode-block" id="generate_mask_random_cmap">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.generate_mask_random_cmap">[docs]</a>
<span class="k">def</span> <span class="nf">generate_mask_random_cmap</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a random colormap based on the unique labels in the given mask.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    mask (numpy.ndarray): The input mask array.</span>

<span class="sd">    Returns:</span>
<span class="sd">    matplotlib.colors.ListedColormap: The random colormap.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unique_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
    <span class="n">num_objects</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_labels</span><span class="p">[</span><span class="n">unique_labels</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">random_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">num_objects</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">random_colors</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">random_colors</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">random_cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">random_colors</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">random_cmap</span></div>

    
<div class="viewcode-block" id="random_cmap">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.random_cmap">[docs]</a>
<span class="k">def</span> <span class="nf">random_cmap</span><span class="p">(</span><span class="n">num_objects</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a random colormap.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    num_objects (int): The number of objects to generate colors for. Default is 100.</span>

<span class="sd">    Returns:</span>
<span class="sd">    random_cmap (matplotlib.colors.ListedColormap): A random colormap.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">random_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">num_objects</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">random_colors</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">random_colors</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">random_cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">random_colors</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">random_cmap</span></div>


<span class="k">def</span> <span class="nf">_generate_mask_random_cmap</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a random colormap based on the unique labels in the given mask.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    mask (ndarray): The mask array containing unique labels.</span>

<span class="sd">    Returns:</span>
<span class="sd">    ListedColormap: A random colormap generated based on the unique labels in the mask.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unique_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
    <span class="n">num_objects</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_labels</span><span class="p">[</span><span class="n">unique_labels</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">random_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">num_objects</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">random_colors</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">random_colors</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">random_cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">random_colors</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">random_cmap</span>

<span class="k">def</span> <span class="nf">_get_colours_merged</span><span class="p">(</span><span class="n">outline_color</span><span class="p">):</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the merged outline colors based on the specified outline color format.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    outline_color (str): The outline color format. Can be one of &#39;rgb&#39;, &#39;bgr&#39;, &#39;gbr&#39;, or &#39;rbg&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">    list: A list of merged outline colors based on the specified format.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">outline_color</span> <span class="o">==</span> <span class="s1">&#39;rgb&#39;</span><span class="p">:</span>
        <span class="n">outline_colors</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>  <span class="c1"># rgb</span>
    <span class="k">elif</span> <span class="n">outline_color</span> <span class="o">==</span> <span class="s1">&#39;bgr&#39;</span><span class="p">:</span>
        <span class="n">outline_colors</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>  <span class="c1"># bgr</span>
    <span class="k">elif</span> <span class="n">outline_color</span> <span class="o">==</span> <span class="s1">&#39;gbr&#39;</span><span class="p">:</span>
        <span class="n">outline_colors</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>  <span class="c1"># gbr</span>
    <span class="k">elif</span> <span class="n">outline_color</span> <span class="o">==</span> <span class="s1">&#39;rbg&#39;</span><span class="p">:</span>
        <span class="n">outline_colors</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>  <span class="c1"># rbg</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">outline_colors</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>  <span class="c1"># rbg</span>
    <span class="k">return</span> <span class="n">outline_colors</span>

<div class="viewcode-block" id="plot_images_and_arrays">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.plot_images_and_arrays">[docs]</a>
<span class="k">def</span> <span class="nf">plot_images_and_arrays</span><span class="p">(</span><span class="n">folders</span><span class="p">,</span> <span class="n">lower_percentile</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">upper_percentile</span><span class="o">=</span><span class="mi">99</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">extensions</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;.npy&#39;</span><span class="p">,</span> <span class="s1">&#39;.tif&#39;</span><span class="p">,</span> <span class="s1">&#39;.tiff&#39;</span><span class="p">,</span> <span class="s1">&#39;.png&#39;</span><span class="p">],</span> <span class="n">overlay</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_nr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">randomize</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot images and arrays from the given folders.</span>

<span class="sd">    Args:</span>
<span class="sd">        folders (list): A list of folder paths containing the images and arrays.</span>
<span class="sd">        lower_percentile (int, optional): The lower percentile for image normalization. Defaults to 1.</span>
<span class="sd">        upper_percentile (int, optional): The upper percentile for image normalization. Defaults to 99.</span>
<span class="sd">        threshold (int, optional): The threshold for determining whether to display an image as a mask or normalize it. Defaults to 1000.</span>
<span class="sd">        extensions (list, optional): A list of file extensions to consider. Defaults to [&#39;.npy&#39;, &#39;.tif&#39;, &#39;.tiff&#39;, &#39;.png&#39;].</span>
<span class="sd">        overlay (bool, optional): If True, overlay the outlines of the objects on the image. Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">normalize_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">99</span><span class="p">):</span>
        <span class="n">p2</span><span class="p">,</span> <span class="n">p98</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">((</span><span class="n">image</span> <span class="o">-</span> <span class="n">p2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">p98</span> <span class="o">-</span> <span class="n">p2</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">find_files</span><span class="p">(</span><span class="n">folders</span><span class="p">,</span> <span class="n">extensions</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;.npy&#39;</span><span class="p">,</span> <span class="s1">&#39;.tif&#39;</span><span class="p">,</span> <span class="s1">&#39;.tiff&#39;</span><span class="p">,</span> <span class="s1">&#39;.png&#39;</span><span class="p">]):</span>
        <span class="n">file_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folders</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">extensions</span><span class="p">):</span>
                        <span class="n">file_name_wo_ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">file_name_wo_ext</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">file_dict</span><span class="p">:</span>
                            <span class="n">file_dict</span><span class="p">[</span><span class="n">file_name_wo_ext</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="n">file_dict</span><span class="p">[</span><span class="n">file_name_wo_ext</span><span class="p">][</span><span class="n">folder</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_path</span>

        <span class="c1"># Filter out files that don&#39;t have paths in all folders</span>
        <span class="n">filtered_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">file_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">folders</span><span class="p">)}</span>
        <span class="k">return</span> <span class="n">filtered_dict</span>

    <span class="k">def</span> <span class="nf">plot_from_file_dict</span><span class="p">(</span><span class="n">file_dict</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">lower_percentile</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">upper_percentile</span><span class="o">=</span><span class="mi">99</span><span class="p">,</span> <span class="n">overlay</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot images and arrays from the given file dictionary.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_dict (dict): A dictionary containing the file paths for each image or array.</span>
<span class="sd">            threshold (int, optional): The threshold for determining whether to display an image as a mask or normalize it. Defaults to 1000.</span>
<span class="sd">            lower_percentile (int, optional): The lower percentile for image normalization. Defaults to 1.</span>
<span class="sd">            upper_percentile (int, optional): The upper percentile for image normalization. Defaults to 99.</span>
<span class="sd">            overlay (bool, optional): If True, overlay the outlines of the objects on the image. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">filename</span><span class="p">,</span> <span class="n">folder_paths</span> <span class="ow">in</span> <span class="n">file_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">image_data</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">mask_data</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">for</span> <span class="n">folder</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">folder_paths</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.npy&#39;</span><span class="p">):</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.tif&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.tiff&#39;</span><span class="p">):</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">imageio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="n">unique_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
                    <span class="n">image_data</span> <span class="o">=</span> <span class="n">normalize_image</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">lower_percentile</span><span class="p">,</span> <span class="n">upper_percentile</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mask_data</span> <span class="o">=</span> <span class="n">data</span>

            <span class="k">if</span> <span class="n">image_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mask_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
                
                <span class="c1"># Display the mask with random colormap</span>
                <span class="n">cmap</span> <span class="o">=</span> <span class="n">random_cmap</span><span class="p">(</span><span class="n">num_objects</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">mask_data</span><span class="p">)))</span>
                <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mask_data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
                <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> - Mask&quot;</span><span class="p">)</span>
                <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

                <span class="c1"># Display the normalized image</span>
                <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image_data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">overlay</span><span class="p">:</span>
                    <span class="n">labeled_mask</span> <span class="o">=</span> <span class="n">label</span><span class="p">(</span><span class="n">mask_data</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">regionprops</span><span class="p">(</span><span class="n">labeled_mask</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">region</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">region</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">contours</span> <span class="o">=</span> <span class="n">find_contours</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">contour</span> <span class="ow">in</span> <span class="n">contours</span><span class="p">:</span>
                                <span class="c1"># Adjust contour coordinates relative to the full image</span>
                                <span class="n">contour</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">region</span><span class="o">.</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                <span class="n">contour</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">region</span><span class="o">.</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                                <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">contour</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">contour</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;magenta&#39;</span><span class="p">)</span>

                <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> - Normalized Image&quot;</span><span class="p">)</span>
                <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
                    <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">overlay</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Overlay will only work on the first two folders in the list&#39;</span><span class="p">)</span>

    <span class="n">file_dict</span> <span class="o">=</span> <span class="n">find_files</span><span class="p">(</span><span class="n">folders</span><span class="p">,</span> <span class="n">extensions</span><span class="p">)</span>
    <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">file_dict</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">randomize</span><span class="p">:</span>
        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_nr</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">items</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="n">max_nr</span><span class="p">)]</span>
    <span class="n">file_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>

    <span class="n">plot_from_file_dict</span><span class="p">(</span><span class="n">file_dict</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">lower_percentile</span><span class="p">,</span> <span class="n">upper_percentile</span><span class="p">,</span> <span class="n">overlay</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span></div>


<span class="k">def</span> <span class="nf">_filter_objects_in_plot</span><span class="p">(</span><span class="n">stack</span><span class="p">,</span> <span class="n">cell_mask_dim</span><span class="p">,</span> <span class="n">nucleus_mask_dim</span><span class="p">,</span> <span class="n">pathogen_mask_dim</span><span class="p">,</span> <span class="n">mask_dims</span><span class="p">,</span> <span class="n">filter_min_max</span><span class="p">,</span> <span class="n">nuclei_limit</span><span class="p">,</span> <span class="n">pathogen_limit</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Filters objects in a plot based on various criteria.</span>

<span class="sd">    Args:</span>
<span class="sd">        stack (numpy.ndarray): The input stack of masks.</span>
<span class="sd">        cell_mask_dim (int): The dimension index of the cell mask.</span>
<span class="sd">        nucleus_mask_dim (int): The dimension index of the nucleus mask.</span>
<span class="sd">        pathogen_mask_dim (int): The dimension index of the pathogen mask.</span>
<span class="sd">        mask_dims (list): A list of dimension indices for additional masks.</span>
<span class="sd">        filter_min_max (list): A list of minimum and maximum area values for each mask.</span>
<span class="sd">        nuclei_limit (bool): Whether to include multinucleated cells.</span>
<span class="sd">        pathogen_limit (bool): Whether to include multiinfected cells.</span>

<span class="sd">    Returns:</span>
<span class="sd">        numpy.ndarray: The filtered stack of masks.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">_remove_outside_objects</span><span class="p">,</span> <span class="n">_remove_multiobject_cells</span>
    
    <span class="n">stack</span> <span class="o">=</span> <span class="n">_remove_outside_objects</span><span class="p">(</span><span class="n">stack</span><span class="p">,</span> <span class="n">cell_mask_dim</span><span class="p">,</span> <span class="n">nucleus_mask_dim</span><span class="p">,</span> <span class="n">pathogen_mask_dim</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mask_dim</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mask_dims</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filter_min_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">min_max</span> <span class="o">=</span> <span class="n">filter_min_max</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">min_max</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100000000</span><span class="p">]</span>

        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">stack</span><span class="p">,</span> <span class="n">mask_dim</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">props</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">regionprops_table</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s1">&#39;area&#39;</span><span class="p">])</span>
        <span class="c1">#props = measure.regionprops_table(mask, intensity_image=intensity_image, properties=[&#39;label&#39;, &#39;area&#39;, &#39;mean_intensity&#39;])</span>
        <span class="n">avg_size_before</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">])</span>
        <span class="n">total_count_before</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">filter_min_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">valid_labels</span> <span class="o">=</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">min_max</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">min_max</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>  
            <span class="n">stack</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">mask_dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">valid_labels</span><span class="p">)</span> <span class="o">*</span> <span class="n">mask</span>  

        <span class="n">props_after</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">regionprops_table</span><span class="p">(</span><span class="n">stack</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">mask_dim</span><span class="p">],</span> <span class="n">properties</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s1">&#39;area&#39;</span><span class="p">])</span> 
        <span class="n">avg_size_after</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">props_after</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">])</span>
        <span class="n">total_count_after</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">props_after</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">mask_dim</span> <span class="o">==</span> <span class="n">cell_mask_dim</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nuclei_limit</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">nucleus_mask_dim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">stack</span> <span class="o">=</span> <span class="n">_remove_multiobject_cells</span><span class="p">(</span><span class="n">stack</span><span class="p">,</span> <span class="n">mask_dim</span><span class="p">,</span> <span class="n">cell_mask_dim</span><span class="p">,</span> <span class="n">nucleus_mask_dim</span><span class="p">,</span> <span class="n">pathogen_mask_dim</span><span class="p">,</span> <span class="n">object_dim</span><span class="o">=</span><span class="n">pathogen_mask_dim</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pathogen_limit</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">cell_mask_dim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">pathogen_mask_dim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">stack</span> <span class="o">=</span> <span class="n">_remove_multiobject_cells</span><span class="p">(</span><span class="n">stack</span><span class="p">,</span> <span class="n">mask_dim</span><span class="p">,</span> <span class="n">cell_mask_dim</span><span class="p">,</span> <span class="n">nucleus_mask_dim</span><span class="p">,</span> <span class="n">pathogen_mask_dim</span><span class="p">,</span> <span class="n">object_dim</span><span class="o">=</span><span class="n">nucleus_mask_dim</span><span class="p">)</span>
            <span class="n">cell_area_before</span> <span class="o">=</span> <span class="n">avg_size_before</span>
            <span class="n">cell_count_before</span> <span class="o">=</span> <span class="n">total_count_before</span>
            <span class="n">cell_area_after</span> <span class="o">=</span> <span class="n">avg_size_after</span>
            <span class="n">cell_count_after</span> <span class="o">=</span> <span class="n">total_count_after</span>
        <span class="k">if</span> <span class="n">mask_dim</span> <span class="o">==</span> <span class="n">nucleus_mask_dim</span><span class="p">:</span>
            <span class="n">nucleus_area_before</span> <span class="o">=</span> <span class="n">avg_size_before</span>
            <span class="n">nucleus_count_before</span> <span class="o">=</span> <span class="n">total_count_before</span>
            <span class="n">nucleus_area_after</span> <span class="o">=</span> <span class="n">avg_size_after</span>
            <span class="n">nucleus_count_after</span> <span class="o">=</span> <span class="n">total_count_after</span>
        <span class="k">if</span> <span class="n">mask_dim</span> <span class="o">==</span> <span class="n">pathogen_mask_dim</span><span class="p">:</span>
            <span class="n">pathogen_area_before</span> <span class="o">=</span> <span class="n">avg_size_before</span>
            <span class="n">pathogen_count_before</span> <span class="o">=</span> <span class="n">total_count_before</span>
            <span class="n">pathogen_area_after</span> <span class="o">=</span> <span class="n">avg_size_after</span>
            <span class="n">pathogen_count_after</span> <span class="o">=</span> <span class="n">total_count_after</span>

    <span class="k">if</span> <span class="n">cell_mask_dim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;removed </span><span class="si">{</span><span class="n">cell_count_before</span><span class="o">-</span><span class="n">cell_count_after</span><span class="si">}</span><span class="s1"> cells, cell size from </span><span class="si">{</span><span class="n">cell_area_before</span><span class="si">}</span><span class="s1"> to </span><span class="si">{</span><span class="n">cell_area_after</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nucleus_mask_dim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;removed </span><span class="si">{</span><span class="n">nucleus_count_before</span><span class="o">-</span><span class="n">nucleus_count_after</span><span class="si">}</span><span class="s1"> nucleus, nucleus size from </span><span class="si">{</span><span class="n">nucleus_area_before</span><span class="si">}</span><span class="s1"> to </span><span class="si">{</span><span class="n">nucleus_area_after</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pathogen_mask_dim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;removed </span><span class="si">{</span><span class="n">pathogen_count_before</span><span class="o">-</span><span class="n">pathogen_count_after</span><span class="si">}</span><span class="s1"> pathogens, pathogen size from </span><span class="si">{</span><span class="n">pathogen_area_before</span><span class="si">}</span><span class="s1"> to </span><span class="si">{</span><span class="n">pathogen_area_after</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">stack</span>


<div class="viewcode-block" id="plot_arrays">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.plot_arrays">[docs]</a>
<span class="k">def</span> <span class="nf">plot_arrays</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">figuresize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;inferno&#39;</span><span class="p">,</span> <span class="n">nr</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">q1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">q2</span><span class="o">=</span><span class="mi">99</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot randomly selected arrays from a given directory or a single .npz/.npy file.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - src (str): The directory path or file path containing the arrays.</span>
<span class="sd">    - figuresize (int): The size of the figure (default: 10).</span>
<span class="sd">    - cmap (str): The colormap to use for displaying the arrays (default: &#39;inferno&#39;).</span>
<span class="sd">    - nr (int): The number of arrays to plot (default: 1).</span>
<span class="sd">    - normalize (bool): Whether to normalize the arrays (default: True).</span>
<span class="sd">    - q1 (int): The lower percentile for normalization (default: 1).</span>
<span class="sd">    - q2 (int): The upper percentile for normalization (default: 99).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">normalize_to_dtype</span>

    <span class="n">mask_cmap</span> <span class="o">=</span> <span class="n">random_cmap</span><span class="p">()</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">src</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.npz&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">src</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.npy&#39;</span><span class="p">):</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">src</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">src</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s1">&#39;.npy&#39;</span><span class="p">,</span> <span class="s1">&#39;.npz&#39;</span><span class="p">))]</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)))</span>

    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Image path: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.npz&#39;</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># assume first key</span>
                <span class="n">img</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>          <span class="c1"># get first image in batch</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">normalize_to_dtype</span><span class="p">(</span><span class="n">array</span><span class="o">=</span><span class="n">img</span><span class="p">,</span> <span class="n">p1</span><span class="o">=</span><span class="n">q1</span><span class="p">,</span> <span class="n">p2</span><span class="o">=</span><span class="n">q2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">array_nr</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">array_nr</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">figuresize</span><span class="p">,</span> <span class="n">figuresize</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">array_nr</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">axs</span> <span class="o">=</span> <span class="p">[</span><span class="n">axs</span><span class="p">]</span>  <span class="c1"># ensure iterable</span>
            <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">array_nr</span><span class="p">):</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">img</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">channel</span><span class="p">]</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">))</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Channel </span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">figuresize</span><span class="p">,</span> <span class="n">figuresize</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Channel 0&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="plot_arrays_v1">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.plot_arrays_v1">[docs]</a>
<span class="k">def</span> <span class="nf">plot_arrays_v1</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">figuresize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;inferno&#39;</span><span class="p">,</span> <span class="n">nr</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">q1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">q2</span><span class="o">=</span><span class="mi">99</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot randomly selected arrays from a given directory.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - src (str): The directory path containing the arrays.</span>
<span class="sd">    - figuresize (int): The size of the figure (default: 50).</span>
<span class="sd">    - cmap (str): The colormap to use for displaying the arrays (default: &#39;inferno&#39;).</span>
<span class="sd">    - nr (int): The number of arrays to plot (default: 1).</span>
<span class="sd">    - normalize (bool): Whether to normalize the arrays (default: True).</span>
<span class="sd">    - q1 (int): The lower percentile for normalization (default: 1).</span>
<span class="sd">    - q2 (int): The upper percentile for normalization (default: 99).</span>

<span class="sd">    Returns:</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">normalize_to_dtype</span>
    
    <span class="n">mask_cmap</span> <span class="o">=</span> <span class="n">random_cmap</span><span class="p">()</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.npy&#39;</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
            <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">nr</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Image path:</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">normalize_to_dtype</span><span class="p">(</span><span class="n">array</span><span class="o">=</span><span class="n">img</span><span class="p">,</span> <span class="n">p1</span><span class="o">=</span><span class="n">q1</span><span class="p">,</span> <span class="n">p2</span><span class="o">=</span><span class="n">q2</span><span class="p">)</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">array_nr</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">array_nr</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">figuresize</span><span class="p">,</span><span class="n">figuresize</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">array_nr</span><span class="p">):</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">[</span><span class="n">channel</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">))</span> <span class="c1">#_imshow</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Channel &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">channel</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">figuresize</span><span class="p">,</span><span class="n">figuresize</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">))</span> <span class="c1">#_imshow</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Channel 0&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span></div>


<span class="k">def</span> <span class="nf">_normalize_and_outline</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">remove_background</span><span class="p">,</span> <span class="n">normalize</span><span class="p">,</span> <span class="n">normalization_percentiles</span><span class="p">,</span> <span class="n">overlay</span><span class="p">,</span> <span class="n">overlay_chans</span><span class="p">,</span> <span class="n">mask_dims</span><span class="p">,</span> <span class="n">outline_colors</span><span class="p">,</span> <span class="n">outline_thickness</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalize and outline an image.</span>

<span class="sd">    Args:</span>
<span class="sd">        image (ndarray): The input image.</span>
<span class="sd">        remove_background (bool): Flag indicating whether to remove the background.</span>
<span class="sd">        backgrounds (list): List of background values for each channel.</span>
<span class="sd">        normalize (bool): Flag indicating whether to normalize the image.</span>
<span class="sd">        normalization_percentiles (list): List of percentiles for normalization.</span>
<span class="sd">        overlay (bool): Flag indicating whether to overlay outlines onto the image.</span>
<span class="sd">        overlay_chans (list): List of channel indices to overlay.</span>
<span class="sd">        mask_dims (list): List of dimensions to use for masking.</span>
<span class="sd">        outline_colors (list): List of colors for the outlines.</span>
<span class="sd">        outline_thickness (int): Thickness of the outlines.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing the overlayed image, the original image, and a list of outlines.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">normalize_to_dtype</span><span class="p">,</span> <span class="n">_outline_and_overlay</span><span class="p">,</span> <span class="n">_gen_rgb_image</span>

    <span class="k">if</span> <span class="n">remove_background</span><span class="p">:</span>
        <span class="n">backgrounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">backgrounds</span> <span class="o">=</span> <span class="n">backgrounds</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">chan_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">chan_index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mask_dims</span><span class="p">:</span>
                <span class="n">mask</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">chan_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">chan_index</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">backgrounds</span><span class="p">[</span><span class="n">chan_index</span><span class="p">]</span>
        <span class="n">image</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">normalize_to_dtype</span><span class="p">(</span><span class="n">array</span><span class="o">=</span><span class="n">image</span><span class="p">,</span> <span class="n">p1</span><span class="o">=</span><span class="n">normalization_percentiles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p2</span><span class="o">=</span><span class="n">normalization_percentiles</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">normalize_to_dtype</span><span class="p">(</span><span class="n">array</span><span class="o">=</span><span class="n">image</span><span class="p">,</span> <span class="n">p1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">p2</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="n">rgb_image</span> <span class="o">=</span> <span class="n">_gen_rgb_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="n">overlay_chans</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">overlay</span><span class="p">:</span>
        <span class="n">overlayed_image</span><span class="p">,</span> <span class="n">outlines</span><span class="p">,</span> <span class="n">image</span> <span class="o">=</span> <span class="n">_outline_and_overlay</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">rgb_image</span><span class="p">,</span> <span class="n">mask_dims</span><span class="p">,</span> <span class="n">outline_colors</span><span class="p">,</span> <span class="n">outline_thickness</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">overlayed_image</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">outlines</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Remove mask_dims from image</span>
        <span class="n">channels_to_keep</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mask_dims</span><span class="p">]</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">channels_to_keep</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[],</span> <span class="n">image</span><span class="p">,</span> <span class="p">[]</span>


<span class="k">def</span> <span class="nf">_plot_merged_plot</span><span class="p">(</span><span class="n">overlay</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="n">mask_dims</span><span class="p">,</span> <span class="n">figuresize</span><span class="p">,</span> <span class="n">overlayed_image</span><span class="p">,</span> <span class="n">outlines</span><span class="p">,</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">outline_colors</span><span class="p">,</span> <span class="n">print_object_number</span><span class="p">):</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the merged plot with overlay, image channels, and masks.</span>

<span class="sd">    Args:</span>
<span class="sd">        overlay (bool): Flag indicating whether to overlay the image with outlines.</span>
<span class="sd">        image (ndarray): Input image array.</span>
<span class="sd">        stack (ndarray): Stack of masks.</span>
<span class="sd">        mask_dims (list): List of mask dimensions.</span>
<span class="sd">        figuresize (float): Size of the figure.</span>
<span class="sd">        overlayed_image (ndarray): Overlayed image array.</span>
<span class="sd">        outlines (list): List of outlines.</span>
<span class="sd">        cmap (str): Colormap for the masks.</span>
<span class="sd">        outline_colors (list): List of outline colors.</span>
<span class="sd">        print_object_number (bool): Flag indicating whether to print object numbers on the masks.</span>

<span class="sd">    Returns:</span>
<span class="sd">        fig (Figure): The generated matplotlib figure.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">overlay</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">mask_dims</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">figuresize</span><span class="p">,</span> <span class="n">figuresize</span><span class="p">))</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">overlayed_image</span><span class="p">)</span> <span class="c1">#_imshow</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Overlayed Image&#39;</span><span class="p">)</span>
        <span class="n">ax_index</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">mask_dims</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">figuresize</span><span class="p">,</span> <span class="n">figuresize</span><span class="p">))</span>
        <span class="n">ax_index</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Normalize and plot each channel with outlines</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">channel_image</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">v</span><span class="p">]</span>
        <span class="n">channel_image_normalized</span> <span class="o">=</span> <span class="n">channel_image</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">channel_image_normalized</span> <span class="o">-=</span> <span class="n">channel_image_normalized</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">channel_image_normalized</span> <span class="o">/=</span> <span class="n">channel_image_normalized</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">channel_image_rgb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">channel_image_normalized</span><span class="p">,</span> <span class="n">channel_image_normalized</span><span class="p">,</span> <span class="n">channel_image_normalized</span><span class="p">))</span>

        <span class="c1"># Apply the outlines onto the RGB image</span>
        <span class="k">for</span> <span class="n">outline</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">outlines</span><span class="p">,</span> <span class="n">outline_colors</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">outline</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">channel_image_rgb</span><span class="p">[</span><span class="n">outline</span> <span class="o">==</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">to_rgb</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="n">v</span> <span class="o">+</span> <span class="n">ax_index</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">channel_image_rgb</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">v</span> <span class="o">+</span> <span class="n">ax_index</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Image - Channel&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mask_dim</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mask_dims</span><span class="p">):</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">stack</span><span class="p">,</span> <span class="n">mask_dim</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">random_cmap</span> <span class="o">=</span> <span class="n">_generate_mask_random_cmap</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ax_index</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">random_cmap</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ax_index</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Mask &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">print_object_number</span><span class="p">:</span>
            <span class="n">unique_objects</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">mask</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">unique_objects</span><span class="p">:</span>
                <span class="n">cy</span><span class="p">,</span> <span class="n">cx</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">center_of_mass</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="n">obj</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ax_index</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>

<div class="viewcode-block" id="plot_merged">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.plot_merged">[docs]</a>
<span class="k">def</span> <span class="nf">plot_merged</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">settings</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the merged images after applying various filters and modifications.</span>

<span class="sd">    Args:</span>
<span class="sd">        src (path): Path to folder with images.</span>
<span class="sd">        settings (dict): The settings for the plot.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">_remove_noninfected</span>

    
    
    <span class="n">font</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;figuresize&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">outline_colors</span> <span class="o">=</span> <span class="n">_get_colours_merged</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;outline_color&#39;</span><span class="p">])</span>
    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        
    <span class="n">mask_dims</span> <span class="o">=</span> <span class="p">[</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;cell_mask_dim&#39;</span><span class="p">],</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;nucleus_mask_dim&#39;</span><span class="p">],</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pathogen_mask_dim&#39;</span><span class="p">]]</span>
    <span class="n">mask_dims</span> <span class="o">=</span> <span class="p">[</span><span class="n">element</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">mask_dims</span> <span class="k">if</span> <span class="n">element</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;verbose&#39;</span><span class="p">]:</span>
        <span class="n">display</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pathogen_mask_dim&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pathogen_limit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
        <span class="n">stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Loaded: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pathogen_limit&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pathogen_mask_dim&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;cell_mask_dim&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">stack</span> <span class="o">=</span> <span class="n">_remove_noninfected</span><span class="p">(</span><span class="n">stack</span><span class="p">,</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;cell_mask_dim&#39;</span><span class="p">],</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;nucleus_mask_dim&#39;</span><span class="p">],</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pathogen_mask_dim&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pathogen_limit&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;nuclei_limit&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;filter_min_max&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">stack</span> <span class="o">=</span> <span class="n">_filter_objects_in_plot</span><span class="p">(</span><span class="n">stack</span><span class="p">,</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;cell_mask_dim&#39;</span><span class="p">],</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;nucleus_mask_dim&#39;</span><span class="p">],</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pathogen_mask_dim&#39;</span><span class="p">],</span> <span class="n">mask_dims</span><span class="p">,</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;filter_min_max&#39;</span><span class="p">],</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;nuclei_limit&#39;</span><span class="p">],</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pathogen_limit&#39;</span><span class="p">])</span>

        <span class="n">overlayed_image</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">outlines</span> <span class="o">=</span> <span class="n">_normalize_and_outline</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">stack</span><span class="p">,</span> 
                                                                  <span class="n">remove_background</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;remove_background&#39;</span><span class="p">],</span>
                                                                  <span class="n">normalize</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;normalize&#39;</span><span class="p">],</span>
                                                                  <span class="n">normalization_percentiles</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;normalization_percentiles&#39;</span><span class="p">],</span>
                                                                  <span class="n">overlay</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;overlay&#39;</span><span class="p">],</span>
                                                                  <span class="n">overlay_chans</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;overlay_chans&#39;</span><span class="p">],</span>
                                                                  <span class="n">mask_dims</span><span class="o">=</span><span class="n">mask_dims</span><span class="p">,</span>
                                                                  <span class="n">outline_colors</span><span class="o">=</span><span class="n">outline_colors</span><span class="p">,</span>
                                                                  <span class="n">outline_thickness</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;outline_thickness&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;nr&#39;</span><span class="p">]:</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">_plot_merged_plot</span><span class="p">(</span><span class="n">overlay</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;overlay&#39;</span><span class="p">],</span>
                                    <span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>
                                    <span class="n">stack</span><span class="o">=</span><span class="n">stack</span><span class="p">,</span>
                                    <span class="n">mask_dims</span><span class="o">=</span><span class="n">mask_dims</span><span class="p">,</span>
                                    <span class="n">figuresize</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;figuresize&#39;</span><span class="p">],</span>
                                    <span class="n">overlayed_image</span><span class="o">=</span><span class="n">overlayed_image</span><span class="p">,</span>
                                    <span class="n">outlines</span><span class="o">=</span><span class="n">outlines</span><span class="p">,</span>
                                    <span class="n">cmap</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">],</span>
                                    <span class="n">outline_colors</span><span class="o">=</span><span class="n">outline_colors</span><span class="p">,</span>
                                    <span class="n">print_object_number</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;print_object_number&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fig</span></div>


<span class="k">def</span> <span class="nf">_plot_images_on_grid</span><span class="p">(</span><span class="n">image_files</span><span class="p">,</span> <span class="n">channel_indices</span><span class="p">,</span> <span class="n">um_per_pixel</span><span class="p">,</span> <span class="n">scale_bar_length_um</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">show_filename</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">channel_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots a grid of images with optional scale bar and channel names.</span>

<span class="sd">    Args:</span>
<span class="sd">        image_files (list): List of image file paths.</span>
<span class="sd">        channel_indices (list): List of channel indices to select from the images.</span>
<span class="sd">        um_per_pixel (float): Micrometers per pixel.</span>
<span class="sd">        scale_bar_length_um (float, optional): Length of the scale bar in micrometers. Defaults to 5.</span>
<span class="sd">        fontsize (int, optional): Font size for the image titles. Defaults to 8.</span>
<span class="sd">        show_filename (bool, optional): Whether to show the image file names as titles. Defaults to True.</span>
<span class="sd">        channel_names (list, optional): List of channel names. Defaults to None.</span>
<span class="sd">        plot (bool, optional): Whether to display the plot. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        matplotlib.figure.Figure: The generated figure object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;scale bar represents </span><span class="si">{</span><span class="n">scale_bar_length_um</span><span class="si">}</span><span class="s1"> um&#39;</span><span class="p">)</span>
    <span class="n">nr_of_images</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">image_files</span><span class="p">)</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nr_of_images</span><span class="p">)))</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">nr_of_images</span> <span class="o">/</span> <span class="n">cols</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">rows</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">cols</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="c1"># Calculate the scale bar length in pixels</span>
    <span class="n">scale_bar_length_px</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">scale_bar_length_um</span> <span class="o">/</span> <span class="n">um_per_pixel</span><span class="p">)</span>  <span class="c1"># Convert to pixels</span>

    <span class="n">channel_colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="s1">&#39;green&#39;</span><span class="p">,</span><span class="s1">&#39;blue&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">image_file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">image_files</span><span class="p">):</span>
        <span class="n">img_array</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">image_file</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_UNCHANGED</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">img_array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">img_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">img_array</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img_array</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2RGB</span><span class="p">)</span>
        <span class="c1"># Handle different channel selections</span>
        <span class="k">if</span> <span class="n">channel_indices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">channel_indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Single channel (grayscale)</span>
                <span class="n">img_array</span> <span class="o">=</span> <span class="n">img_array</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">channel_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">channel_indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># Dual channels</span>
                <span class="n">img_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img_array</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">channel_indices</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># RGB or more channels</span>
                <span class="n">img_array</span> <span class="o">=</span> <span class="n">img_array</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">channel_indices</span><span class="p">]</span>
                <span class="n">cmap</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">img_array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="s1">&#39;gray&#39;</span>
        <span class="c1"># Normalize based on dtype</span>
        <span class="k">if</span> <span class="n">img_array</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">:</span>
            <span class="n">img_array</span> <span class="o">=</span> <span class="n">img_array</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">/</span> <span class="mf">65535.0</span>
        <span class="k">elif</span> <span class="n">img_array</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
            <span class="n">img_array</span> <span class="o">=</span> <span class="n">img_array</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.0</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img_array</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show_filename</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">image_file</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="c1"># Add scale bar</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">scale_bar_length_px</span><span class="p">],</span> <span class="p">[</span><span class="n">img_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
    <span class="c1"># Add channel names at the top if specified</span>
    <span class="n">initial_offset</span> <span class="o">=</span> <span class="mf">0.02</span>  <span class="c1"># Starting offset from the left side of the figure</span>
    <span class="n">increment</span> <span class="o">=</span> <span class="mf">0.05</span>  <span class="c1"># Fixed increment for each subsequent channel name, adjust based on figure width</span>
    <span class="k">if</span> <span class="n">channel_names</span><span class="p">:</span>
        <span class="n">current_offset</span> <span class="o">=</span> <span class="n">initial_offset</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">channel_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">channel_names</span><span class="p">):</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">channel_colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">channel_colors</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;white&#39;</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">current_offset</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                        <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
            <span class="n">current_offset</span> <span class="o">+=</span> <span class="n">increment</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)):</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>

<span class="k">def</span> <span class="nf">_save_scimg_plot</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">nr_imgs</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">channel_indices</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">um_per_pixel</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">scale_bar_length_um</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">standardize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">show_filename</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">channel_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">all_folders</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save and visualize single-cell images.</span>

<span class="sd">    Args:</span>
<span class="sd">        src (str): The source directory path.</span>
<span class="sd">        nr_imgs (int, optional): The number of images to visualize. Defaults to 16.</span>
<span class="sd">        channel_indices (list, optional): List of channel indices to visualize. Defaults to [0,1,2].</span>
<span class="sd">        um_per_pixel (float, optional): Micrometers per pixel. Defaults to 0.1.</span>
<span class="sd">        scale_bar_length_um (float, optional): Length of the scale bar in micrometers. Defaults to 10.</span>
<span class="sd">        standardize (bool, optional): Whether to standardize the image sizes. Defaults to True.</span>
<span class="sd">        fontsize (int, optional): Font size for the filename. Defaults to 8.</span>
<span class="sd">        show_filename (bool, optional): Whether to show the filename on the image. Defaults to True.</span>
<span class="sd">        channel_names (list, optional): List of channel names. Defaults to None.</span>
<span class="sd">        dpi (int, optional): Dots per inch for the saved image. Defaults to 300.</span>
<span class="sd">        plot (bool, optional): Whether to plot the images. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">.io</span> <span class="kn">import</span> <span class="n">_save_figure</span>
    
    <span class="k">def</span> <span class="nf">_visualize_scimgs</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">channel_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">um_per_pixel</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">scale_bar_length_um</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">show_filename</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">standardize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nr_imgs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">channel_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Visualize single-cell images.</span>

<span class="sd">        Args:</span>
<span class="sd">            src (str): The source directory path.</span>
<span class="sd">            channel_indices (list, optional): List of channel indices to visualize. Defaults to None.</span>
<span class="sd">            um_per_pixel (float, optional): Micrometers per pixel. Defaults to 0.1.</span>
<span class="sd">            scale_bar_length_um (float, optional): Length of the scale bar in micrometers. Defaults to 10.</span>
<span class="sd">            show_filename (bool, optional): Whether to show the filename on the image. Defaults to True.</span>
<span class="sd">            standardize (bool, optional): Whether to standardize the image sizes. Defaults to True.</span>
<span class="sd">            nr_imgs (int, optional): The number of images to visualize. Defaults to None.</span>
<span class="sd">            fontsize (int, optional): Font size for the filename. Defaults to 8.</span>
<span class="sd">            channel_names (list, optional): List of channel names. Defaults to None.</span>
<span class="sd">            plot (bool, optional): Whether to plot the images. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            matplotlib.figure.Figure: The figure object containing the plotted images.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">_find_similar_sized_images</span>
        <span class="k">def</span> <span class="nf">_generate_filelist</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Generate a list of image files in the specified directory.</span>

<span class="sd">            Args:</span>
<span class="sd">                src (str): The source directory path.</span>

<span class="sd">            Returns:</span>
<span class="sd">                list: A list of image file paths.</span>

<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">))</span>
            <span class="n">image_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="s1">&#39;.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;.jpeg&#39;</span><span class="p">,</span> <span class="s1">&#39;.bmp&#39;</span><span class="p">,</span> <span class="s1">&#39;.tif&#39;</span><span class="p">,</span> <span class="s1">&#39;.tiff&#39;</span><span class="p">,</span> <span class="s1">&#39;.gif&#39;</span><span class="p">))]</span>
            <span class="k">return</span> <span class="n">image_files</span>

        <span class="k">def</span> <span class="nf">_random_sample</span><span class="p">(</span><span class="n">file_list</span><span class="p">,</span> <span class="n">nr_imgs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Randomly selects a subset of files from the given file list.</span>

<span class="sd">            Args:</span>
<span class="sd">                file_list (list): A list of file names.</span>
<span class="sd">                nr_imgs (int, optional): The number of files to select. If None, all files are selected. Defaults to None.</span>

<span class="sd">            Returns:</span>
<span class="sd">                list: A list of randomly selected file names.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">nr_imgs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">nr_imgs</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_list</span><span class="p">):</span>
                <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
                <span class="n">file_list</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">file_list</span><span class="p">,</span> <span class="n">nr_imgs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">file_list</span>

        <span class="n">image_files</span> <span class="o">=</span> <span class="n">_generate_filelist</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">standardize</span><span class="p">:</span>
            <span class="n">image_files</span> <span class="o">=</span> <span class="n">_find_similar_sized_images</span><span class="p">(</span><span class="n">image_files</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">nr_imgs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">image_files</span> <span class="o">=</span> <span class="n">_random_sample</span><span class="p">(</span><span class="n">image_files</span><span class="p">,</span> <span class="n">nr_imgs</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">_plot_images_on_grid</span><span class="p">(</span><span class="n">image_files</span><span class="p">,</span> <span class="n">channel_indices</span><span class="p">,</span> <span class="n">um_per_pixel</span><span class="p">,</span> <span class="n">scale_bar_length_um</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">show_filename</span><span class="p">,</span> <span class="n">channel_names</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">_visualize_scimgs</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">channel_indices</span><span class="p">,</span> <span class="n">um_per_pixel</span><span class="p">,</span> <span class="n">scale_bar_length_um</span><span class="p">,</span> <span class="n">show_filename</span><span class="p">,</span> <span class="n">standardize</span><span class="p">,</span> <span class="n">nr_imgs</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">channel_names</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>
    <span class="n">_save_figure</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;all_channels&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">channel_indices</span><span class="p">:</span>
        <span class="n">channel_indices</span><span class="o">=</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">_visualize_scimgs</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">channel_indices</span><span class="p">,</span> <span class="n">um_per_pixel</span><span class="p">,</span> <span class="n">scale_bar_length_um</span><span class="p">,</span> <span class="n">show_filename</span><span class="p">,</span> <span class="n">standardize</span><span class="p">,</span> <span class="n">nr_imgs</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">channel_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">)</span>
        <span class="n">_save_figure</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;channel_</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">return</span>

<span class="k">def</span> <span class="nf">_plot_cropped_arrays</span><span class="p">(</span><span class="n">stack</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">figuresize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;inferno&#39;</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">500</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot cropped arrays.</span>

<span class="sd">    Args:</span>
<span class="sd">        stack (ndarray): The array to be plotted.</span>
<span class="sd">        figuresize (int, optional): The size of the figure. Defaults to 20.</span>
<span class="sd">        cmap (str, optional): The colormap to be used. Defaults to &#39;inferno&#39;.</span>
<span class="sd">        threshold (int, optional): The threshold for the number of unique intensity values. Defaults to 1000.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#start = time.time()</span>
    <span class="n">dim</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">shape</span>
    
    <span class="k">def</span> <span class="nf">plot_single_array</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">chosen_cmap</span><span class="p">):</span>
        <span class="n">unique_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
        <span class="n">num_unique_values</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_values</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">num_unique_values</span> <span class="o">&lt;=</span> <span class="n">threshold</span><span class="p">:</span>
            <span class="n">chosen_cmap</span> <span class="o">=</span> <span class="n">_generate_mask_random_cmap</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
            <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">num_unique_values</span><span class="si">}</span><span class="s1"> (obj.)&#39;</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">chosen_cmap</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">figuresize</span><span class="p">,</span> <span class="n">figuresize</span><span class="p">))</span>
        <span class="n">plot_single_array</span><span class="p">(</span><span class="n">stack</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="s1">&#39;Channel one&#39;</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">))</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">num_channels</span> <span class="o">=</span> <span class="n">dim</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_channels</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">figuresize</span><span class="p">,</span> <span class="n">figuresize</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_channels</span><span class="p">):</span>
            <span class="n">plot_single_array</span><span class="p">(</span><span class="n">stack</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">channel</span><span class="p">],</span> <span class="n">axs</span><span class="p">[</span><span class="n">channel</span><span class="p">],</span> <span class="sa">f</span><span class="s1">&#39;C. </span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">))</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>    
    <span class="c1">#print(f&#39;{filename}&#39;)</span>
    <span class="k">return</span> <span class="n">fig</span>
    
<span class="k">def</span> <span class="nf">_visualize_and_save_timelapse_stack_with_tracks</span><span class="p">(</span><span class="n">masks</span><span class="p">,</span> <span class="n">tracks_df</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">plot</span><span class="p">,</span> <span class="n">filenames</span><span class="p">,</span> <span class="n">object_type</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;btrack&#39;</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Visualizes and saves a timelapse stack with tracks.</span>

<span class="sd">    Args:</span>
<span class="sd">        masks (list): List of binary masks representing each frame of the timelapse stack.</span>
<span class="sd">        tracks_df (pandas.DataFrame): DataFrame containing track information.</span>
<span class="sd">        save (bool): Flag indicating whether to save the timelapse stack.</span>
<span class="sd">        src (str): Source file path.</span>
<span class="sd">        name (str): Name of the timelapse stack.</span>
<span class="sd">        plot (bool): Flag indicating whether to plot the timelapse stack.</span>
<span class="sd">        filenames (list): List of filenames corresponding to each frame of the timelapse stack.</span>
<span class="sd">        object_type (str): Type of object being tracked.</span>
<span class="sd">        mode (str, optional): Tracking mode. Defaults to &#39;btrack&#39;.</span>
<span class="sd">        interactive (bool, optional): Flag indicating whether to display the timelapse stack interactively. Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="kn">from</span> <span class="nn">.io</span> <span class="kn">import</span> <span class="n">_save_mask_timelapse_as_gif</span>
    
    <span class="n">highest_label</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span> <span class="k">for</span> <span class="n">mask</span> <span class="ow">in</span> <span class="n">masks</span><span class="p">)</span>
    <span class="c1"># Generate random colors for each label, including the background</span>
    <span class="n">random_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">highest_label</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">random_colors</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Full opacity</span>
    <span class="n">random_colors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># Background color</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">random_colors</span><span class="p">)</span>
    <span class="c1"># Ensure the normalization range covers all labels</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">highest_label</span><span class="p">)</span>

    <span class="c1"># Function to plot a frame and overlay tracks</span>
    <span class="k">def</span> <span class="nf">_view_frame_with_tracks</span><span class="p">(</span><span class="n">frame</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display the frame with tracks overlaid.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        frame (int): The frame number to display.</span>

<span class="sd">        Returns:</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
        <span class="n">current_mask</span> <span class="o">=</span> <span class="n">masks</span><span class="p">[</span><span class="n">frame</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">current_mask</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>  <span class="c1"># Apply both colormap and normalization</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Frame: </span><span class="si">{</span><span class="n">frame</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Directly annotate each object with its label number from the mask</span>
        <span class="k">for</span> <span class="n">label_value</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">current_mask</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">label_value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">continue</span>  <span class="c1"># Skip background</span>
            <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">current_mask</span> <span class="o">==</span> <span class="n">label_value</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">label_value</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

        <span class="c1"># Overlay tracks</span>
        <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="n">tracks_df</span><span class="p">[</span><span class="s1">&#39;track_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
            <span class="n">_track</span> <span class="o">=</span> <span class="n">tracks_df</span><span class="p">[</span><span class="n">tracks_df</span><span class="p">[</span><span class="s1">&#39;track_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">track</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">_track</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">_track</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
            <span class="n">interact</span><span class="p">(</span><span class="n">_view_frame_with_tracks</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">masks</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="c1"># Save as gif</span>
        <span class="n">gif_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">src</span><span class="p">),</span> <span class="s1">&#39;movies&#39;</span><span class="p">,</span> <span class="s1">&#39;gif&#39;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">gif_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">save_path_gif</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">gif_path</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;timelapse_masks_</span><span class="si">{</span><span class="n">object_type</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">.gif&#39;</span><span class="p">)</span>
        <span class="n">_save_mask_timelapse_as_gif</span><span class="p">(</span><span class="n">masks</span><span class="p">,</span> <span class="n">tracks_df</span><span class="p">,</span> <span class="n">save_path_gif</span><span class="p">,</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="p">,</span> <span class="n">filenames</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">interactive</span><span class="p">:</span>
                <span class="n">_display_gif</span><span class="p">(</span><span class="n">save_path_gif</span><span class="p">)</span>
                
<span class="k">def</span> <span class="nf">_display_gif</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Display a GIF image from the given path.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    path (str): The path to the GIF image file.</span>

<span class="sd">    Returns:</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">display</span><span class="p">(</span><span class="n">ipyimage</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span>
        
<span class="k">def</span> <span class="nf">_plot_recruitment</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">df_type</span><span class="p">,</span> <span class="n">channel_of_interest</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[],</span> <span class="n">figuresize</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot recruitment data for different conditions and pathogens.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (DataFrame): The input DataFrame containing the recruitment data.</span>
<span class="sd">        df_type (str): The type of DataFrame (e.g., &#39;train&#39;, &#39;test&#39;).</span>
<span class="sd">        channel_of_interest (str): The channel of interest for plotting.</span>
<span class="sd">        target (str): The target variable for plotting.</span>
<span class="sd">        columns (list, optional): Additional columns to plot. Defaults to an empty list.</span>
<span class="sd">        figuresize (int, optional): The size of the figure. Defaults to 50.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">color_list</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">55</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">155</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">155</span><span class="o">/</span><span class="mi">255</span><span class="p">),</span> 
                  <span class="p">(</span><span class="mi">155</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">55</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">155</span><span class="o">/</span><span class="mi">255</span><span class="p">),</span> 
                  <span class="p">(</span><span class="mi">55</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">155</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="o">/</span><span class="mi">255</span><span class="p">),</span> 
                  <span class="p">(</span><span class="mi">255</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">55</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">155</span><span class="o">/</span><span class="mi">255</span><span class="p">)]</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">set_palette</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="n">color_list</span><span class="p">))</span>
    <span class="n">font</span> <span class="o">=</span> <span class="n">figuresize</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">width</span><span class="o">=</span><span class="n">figuresize</span>
    <span class="n">height</span><span class="o">=</span><span class="n">figuresize</span><span class="o">/</span><span class="mi">4</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;condition&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;cell_channel_</span><span class="si">{</span><span class="n">channel_of_interest</span><span class="si">}</span><span class="s1">_mean_intensity&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;pathogen&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="s1">&#39;sd&#39;</span><span class="p">,</span> <span class="n">dodge</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;pathogen </span><span class="si">{</span><span class="n">df_type</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;cell_channel_</span><span class="si">{</span><span class="n">channel_of_interest</span><span class="si">}</span><span class="s1">_mean_intensity&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;condition&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;nucleus_channel_</span><span class="si">{</span><span class="n">channel_of_interest</span><span class="si">}</span><span class="s1">_mean_intensity&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;pathogen&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="s1">&#39;sd&#39;</span><span class="p">,</span> <span class="n">dodge</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;pathogen </span><span class="si">{</span><span class="n">df_type</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;nucleus_channel_</span><span class="si">{</span><span class="n">channel_of_interest</span><span class="si">}</span><span class="s1">_mean_intensity&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;condition&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;cytoplasm_channel_</span><span class="si">{</span><span class="n">channel_of_interest</span><span class="si">}</span><span class="s1">_mean_intensity&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;pathogen&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="s1">&#39;sd&#39;</span><span class="p">,</span> <span class="n">dodge</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;pathogen </span><span class="si">{</span><span class="n">df_type</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;cytoplasm_channel_</span><span class="si">{</span><span class="n">channel_of_interest</span><span class="si">}</span><span class="s1">_mean_intensity&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;condition&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;pathogen_channel_</span><span class="si">{</span><span class="n">channel_of_interest</span><span class="si">}</span><span class="s1">_mean_intensity&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;pathogen&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="s1">&#39;sd&#39;</span><span class="p">,</span> <span class="n">dodge</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;pathogen </span><span class="si">{</span><span class="n">df_type</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;pathogen_channel_</span><span class="si">{</span><span class="n">channel_of_interest</span><span class="si">}</span><span class="s1">_mean_intensity&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>

    <span class="c1">#axes[0].legend_.remove()</span>
    <span class="c1">#axes[1].legend_.remove()</span>
    <span class="c1">#axes[2].legend_.remove()</span>
    <span class="c1">#axes[3].legend_.remove()</span>
        
    <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]:</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;pathogen_cytoplasm_mean_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;pathogen_cytoplasm_q75_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;pathogen_periphery_cytoplasm_mean_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;pathogen_outside_cytoplasm_mean_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;pathogen_outside_cytoplasm_q75_mean&#39;</span><span class="p">]</span>
    <span class="c1">#columns = columns + [f&#39;pathogen_slope_channel_{channel_of_interest}&#39;, f&#39;pathogen_cell_distance_channel_{channel_of_interest}&#39;, f&#39;nucleus_cell_distance_channel_{channel_of_interest}&#39;]</span>

    <span class="n">width</span> <span class="o">=</span> <span class="n">figuresize</span><span class="o">*</span><span class="mi">2</span>
    <span class="n">columns_per_row</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">height</span> <span class="o">=</span> <span class="p">(</span><span class="n">figuresize</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">columns_per_row</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">columns_per_row</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">columns</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">columns</span><span class="p">):</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;condition&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;pathogen&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="s1">&#39;sd&#39;</span><span class="p">,</span> <span class="n">dodge</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;pathogen </span><span class="si">{</span><span class="n">df_type</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">font</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend_</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)):</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
<span class="k">def</span> <span class="nf">_plot_controls</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">mask_chans</span><span class="p">,</span> <span class="n">channel_of_interest</span><span class="p">,</span> <span class="n">figuresize</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot controls for different channels and conditions.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pandas.DataFrame): The DataFrame containing the data.</span>
<span class="sd">        mask_chans (list): The list of channels to include in the plot.</span>
<span class="sd">        channel_of_interest (int): The channel of interest.</span>
<span class="sd">        figuresize (int, optional): The size of the figure. Defaults to 5.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mask_chans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">channel_of_interest</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mask_chans</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">mask_chans</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mask_chans</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">mask_chans</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mask_chans</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">mask_chans</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mask_chans</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">mask_chans</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">controls_cols</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">chan</span> <span class="ow">in</span> <span class="n">mask_chans</span><span class="p">:</span>

        <span class="n">controls_cols_c</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">controls_cols_c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;cell_channel_</span><span class="si">{</span><span class="n">chan</span><span class="si">}</span><span class="s1">_mean_intensity&#39;</span><span class="p">)</span>
        <span class="n">controls_cols_c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;nucleus_channel_</span><span class="si">{</span><span class="n">chan</span><span class="si">}</span><span class="s1">_mean_intensity&#39;</span><span class="p">)</span>
        <span class="n">controls_cols_c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;pathogen_channel_</span><span class="si">{</span><span class="n">chan</span><span class="si">}</span><span class="s1">_mean_intensity&#39;</span><span class="p">)</span>
        <span class="n">controls_cols_c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;cytoplasm_channel_</span><span class="si">{</span><span class="n">chan</span><span class="si">}</span><span class="s1">_mean_intensity&#39;</span><span class="p">)</span>
        <span class="n">controls_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">controls_cols_c</span><span class="p">)</span>

    <span class="n">unique_conditions</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;condition&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_conditions</span><span class="p">)</span> <span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">unique_conditions</span><span class="o">=</span><span class="n">unique_conditions</span><span class="o">+</span><span class="n">unique_conditions</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_conditions</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">mask_chans</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">figuresize</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">mask_chans</span><span class="p">),</span> <span class="n">figuresize</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_conditions</span><span class="p">)))</span>

    <span class="c1"># Define RGB color tuples (scaled to 0-1 range)</span>
    <span class="n">color_list</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">55</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">155</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">155</span><span class="o">/</span><span class="mi">255</span><span class="p">),</span> 
                  <span class="p">(</span><span class="mi">155</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">55</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">155</span><span class="o">/</span><span class="mi">255</span><span class="p">),</span> 
                  <span class="p">(</span><span class="mi">55</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">155</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="o">/</span><span class="mi">255</span><span class="p">),</span> 
                  <span class="p">(</span><span class="mi">255</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">55</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">155</span><span class="o">/</span><span class="mi">255</span><span class="p">)]</span>

    <span class="k">for</span> <span class="n">idx_condition</span><span class="p">,</span> <span class="n">condition</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_conditions</span><span class="p">):</span>
        <span class="n">df_temp</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;condition&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">condition</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">idx_channel</span><span class="p">,</span> <span class="n">control_cols_c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">controls_cols</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">std_dev</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">control_col</span> <span class="ow">in</span> <span class="n">control_cols_c</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">control_col</span> <span class="ow">in</span> <span class="n">df_temp</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="n">mean_intensity</span> <span class="o">=</span> <span class="n">df_temp</span><span class="p">[</span><span class="n">control_col</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                    <span class="n">mean_intensity</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">mean_intensity</span><span class="p">)</span> <span class="k">else</span> <span class="n">mean_intensity</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean_intensity</span><span class="p">)</span>
                    <span class="n">std_dev</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_temp</span><span class="p">[</span><span class="n">control_col</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>

            <span class="n">current_axis</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">idx_condition</span><span class="p">][</span><span class="n">idx_channel</span><span class="p">]</span>
            <span class="n">current_axis</span><span class="o">.</span><span class="n">bar</span><span class="p">([</span><span class="s2">&quot;cell&quot;</span><span class="p">,</span> <span class="s2">&quot;nucleus&quot;</span><span class="p">,</span> <span class="s2">&quot;pathogen&quot;</span><span class="p">,</span> <span class="s2">&quot;cytoplasm&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">std_dev</span><span class="p">,</span> 
                             <span class="n">capsize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_list</span><span class="p">)</span>
            <span class="n">current_axis</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Component&#39;</span><span class="p">)</span>
            <span class="n">current_axis</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Mean Intensity&#39;</span><span class="p">)</span>
            <span class="n">current_axis</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Condition: </span><span class="si">{</span><span class="n">condition</span><span class="si">}</span><span class="s1"> - Channel </span><span class="si">{</span><span class="n">idx_channel</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">_imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">nrow</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Display multiple images in a grid with corresponding labels.</span>

<span class="sd">    Args:</span>
<span class="sd">        img (list): List of images to display.</span>
<span class="sd">        labels (list): List of labels corresponding to each image.</span>
<span class="sd">        nrow (int, optional): Number of images per row in the grid. Defaults to 20.</span>
<span class="sd">        color (str, optional): Color of the label text. Defaults to &#39;white&#39;.</span>
<span class="sd">        fontsize (int, optional): Font size of the label text. Defaults to 12.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_images</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">n_col</span> <span class="o">=</span> <span class="n">nrow</span>
    <span class="n">n_row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">n_images</span> <span class="o">/</span> <span class="n">n_col</span><span class="p">))</span>
    <span class="n">img_height</span> <span class="o">=</span> <span class="n">img</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">img_width</span> <span class="o">=</span> <span class="n">img</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">canvas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">img_height</span> <span class="o">*</span> <span class="n">n_row</span><span class="p">,</span> <span class="n">img_width</span> <span class="o">*</span> <span class="n">n_col</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_row</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_col</span><span class="p">):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">n_col</span> <span class="o">+</span> <span class="n">j</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">n_images</span><span class="p">:</span>
                <span class="n">canvas</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">img_height</span><span class="p">:(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">img_height</span><span class="p">,</span> <span class="n">j</span> <span class="o">*</span> <span class="n">img_width</span><span class="p">:(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">img_width</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>        
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">canvas</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">i</span> <span class="o">//</span> <span class="n">n_col</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="n">n_col</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">col</span> <span class="o">*</span> <span class="n">img_width</span> <span class="o">+</span> <span class="mi">2</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">row</span> <span class="o">*</span> <span class="n">img_height</span> <span class="o">+</span> <span class="mi">15</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span>

<span class="k">def</span> <span class="nf">_imshow_gpu</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">nrow</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Display multiple images in a grid with corresponding labels.</span>

<span class="sd">    Args:</span>
<span class="sd">        img (torch.Tensor): A batch of images as a tensor.</span>
<span class="sd">        labels (list): List of labels corresponding to each image.</span>
<span class="sd">        nrow (int, optional): Number of images per row in the grid. Defaults to 20.</span>
<span class="sd">        color (str, optional): Color of the label text. Defaults to &#39;white&#39;.</span>
<span class="sd">        fontsize (int, optional): Font size of the label text. Defaults to 12.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">is_cuda</span><span class="p">:</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>  <span class="c1"># Move to CPU if the tensor is on GPU</span>

    <span class="n">n_images</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">n_col</span> <span class="o">=</span> <span class="n">nrow</span>
    <span class="n">n_row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">n_images</span> <span class="o">/</span> <span class="n">n_col</span><span class="p">))</span>

    <span class="n">img_height</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># Height of the image</span>
    <span class="n">img_width</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>   <span class="c1"># Width of the image</span>

    <span class="c1"># Prepare the canvas on CPU</span>
    <span class="n">canvas</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">img_height</span> <span class="o">*</span> <span class="n">n_row</span><span class="p">,</span> <span class="n">img_width</span> <span class="o">*</span> <span class="n">n_col</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_row</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_col</span><span class="p">):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">n_col</span> <span class="o">+</span> <span class="n">j</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">n_images</span><span class="p">:</span>
                <span class="c1"># Place the image on the canvas</span>
                <span class="n">canvas</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">img_height</span><span class="p">:(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">img_height</span><span class="p">,</span> <span class="n">j</span> <span class="o">*</span> <span class="n">img_width</span><span class="p">:(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">img_width</span><span class="p">]</span> <span class="o">=</span> <span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">canvas</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>  <span class="c1"># Convert to NumPy for plotting</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">canvas</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">i</span> <span class="o">//</span> <span class="n">n_col</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="n">n_col</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">col</span> <span class="o">*</span> <span class="n">img_width</span> <span class="o">+</span> <span class="mi">2</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">row</span> <span class="o">*</span> <span class="n">img_height</span> <span class="o">+</span> <span class="mi">15</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span>
    
<span class="k">def</span> <span class="nf">_plot_histograms_and_stats</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">conditions</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;condition&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">condition</span> <span class="ow">in</span> <span class="n">conditions</span><span class="p">:</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;condition&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">condition</span><span class="p">]</span>
        
        <span class="c1"># Calculate the statistics</span>
        <span class="n">mean_pred</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[</span><span class="s1">&#39;pred&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">over_0_5</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">subset</span><span class="p">[</span><span class="s1">&#39;pred&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">under_0_5</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">subset</span><span class="p">[</span><span class="s1">&#39;pred&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">)</span>

        <span class="c1"># Print the statistics</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Condition: </span><span class="si">{</span><span class="n">condition</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of rows: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean of pred: </span><span class="si">{</span><span class="n">mean_pred</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Count of pred values over 0.5: </span><span class="si">{</span><span class="n">over_0_5</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Count of pred values under 0.5: </span><span class="si">{</span><span class="n">under_0_5</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Percent positive: </span><span class="si">{</span><span class="p">(</span><span class="n">over_0_5</span><span class="o">/</span><span class="p">(</span><span class="n">over_0_5</span><span class="o">+</span><span class="n">under_0_5</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Percent negative: </span><span class="si">{</span><span class="p">(</span><span class="n">under_0_5</span><span class="o">/</span><span class="p">(</span><span class="n">over_0_5</span><span class="o">+</span><span class="n">under_0_5</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">40</span><span class="p">)</span>
        
        <span class="c1"># Plot the histogram</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">subset</span><span class="p">[</span><span class="s1">&#39;pred&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">mean_pred</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Mean = </span><span class="si">{</span><span class="n">mean_pred</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Histogram for pred - Condition: </span><span class="si">{</span><span class="n">condition</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pred Value&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">_show_residules</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>

    <span class="c1"># Get the residuals</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">resid</span>

    <span class="c1"># Histogram of residuals</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Histogram of Residuals&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Residual Value&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># QQ plot</span>
    <span class="n">sm</span><span class="o">.</span><span class="n">qqplot</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="s1">&#39;45&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;QQ Plot&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Residuals vs. Fitted values</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">,</span> <span class="n">residuals</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Fitted values&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residuals&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Residuals vs. Fitted Values&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Shapiro-Wilk test for normality</span>
    <span class="n">W</span><span class="p">,</span> <span class="n">p_value</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">shapiro</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Shapiro-Wilk Test W-statistic: </span><span class="si">{</span><span class="n">W</span><span class="si">}</span><span class="s1">, p-value: </span><span class="si">{</span><span class="n">p_value</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">_reg_v_plot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">grouping</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">plate_number</span><span class="p">):</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;-log10(p)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">])</span>

    <span class="c1"># Create the volcano plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
    <span class="n">sc</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;effect&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;-log10(p)&#39;</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;effect&#39;</span><span class="p">]),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Volcano Plot&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Coefficient&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;-log10(P-value)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

    <span class="c1"># Add text for specified points</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span><span class="c1"># and abs(row[&#39;effect&#39;]) &gt; 0.1:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;effect&#39;</span><span class="p">],</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">]),</span> <span class="n">idx</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">0.05</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>  <span class="c1"># line for p=0.05</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
<div class="viewcode-block" id="generate_plate_heatmap">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.generate_plate_heatmap">[docs]</a>
<span class="k">def</span> <span class="nf">generate_plate_heatmap</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">plate_number</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">grouping</span><span class="p">,</span> <span class="n">min_max</span><span class="p">,</span> <span class="n">min_count</span><span class="p">):</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">min_count</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
        <span class="n">min_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Check the number of parts in &#39;prc&#39;</span>
    <span class="n">num_parts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;prc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">num_parts</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">split</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;prc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rowID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">split</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;prc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">plate_number</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">split</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">split</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        
    <span class="c1"># Construct &#39;prc&#39; based on &#39;plateID&#39;, &#39;rowID&#39;, and &#39;columnID&#39; columns</span>
    <span class="c1">#df[&#39;prc&#39;] = df[&#39;plateID&#39;].astype(str) + &#39;_&#39; + df[&#39;rowID&#39;].astype(str) + &#39;_&#39; + df[&#39;columnID&#39;].astype(str)</span>

    <span class="k">if</span> <span class="s1">&#39;column_name&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;column&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;columnID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;column&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;column_name&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;columnID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;column_name&#39;</span><span class="p">]</span>
                
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;plateID&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rowID&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;columnID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;prc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span>
    
    <span class="c1"># Filtering the dataframe based on the plate_number</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;plateID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">plate_number</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># Create another copy after filtering</span>
    
    <span class="c1"># Ensure proper ordering</span>
    <span class="n">row_order</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;r</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">17</span><span class="p">)]</span>
    <span class="n">col_order</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;c</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="p">)]</span>  <span class="c1"># Exclude c15 as per your earlier code</span>
    
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rowID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rowID&#39;</span><span class="p">],</span> <span class="n">categories</span><span class="o">=</span><span class="n">row_order</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;columnID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;columnID&#39;</span><span class="p">],</span> <span class="n">categories</span><span class="o">=</span><span class="n">col_order</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;rowID&#39;</span><span class="p">,</span> <span class="s1">&#39;columnID&#39;</span><span class="p">])[</span><span class="s1">&#39;rowID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">min_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">min_count</span><span class="p">]</span>

    <span class="c1"># Explicitly set observed=True to avoid FutureWarning</span>
    <span class="n">grouped</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;rowID&#39;</span><span class="p">,</span> <span class="s1">&#39;columnID&#39;</span><span class="p">],</span> <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Group by row and column</span>
    
    <span class="k">if</span> <span class="n">grouping</span> <span class="o">==</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span>
        <span class="n">plate</span> <span class="o">=</span> <span class="n">grouped</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">grouping</span> <span class="o">==</span> <span class="s1">&#39;sum&#39;</span><span class="p">:</span>
        <span class="n">plate</span> <span class="o">=</span> <span class="n">grouped</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">grouping</span> <span class="o">==</span> <span class="s1">&#39;count&#39;</span><span class="p">:</span>
        <span class="n">variable</span> <span class="o">=</span> <span class="s1">&#39;count&#39;</span>
        <span class="n">plate</span> <span class="o">=</span> <span class="n">grouped</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported grouping: </span><span class="si">{</span><span class="n">grouping</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
    <span class="n">plate_map</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">plate</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">variable</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;rowID&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;columnID&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">min_max</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
        <span class="n">min_max</span> <span class="o">=</span> <span class="p">[</span><span class="n">plate_map</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">plate_map</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>
    <span class="k">elif</span> <span class="n">min_max</span> <span class="o">==</span> <span class="s1">&#39;allq&#39;</span><span class="p">:</span>
        <span class="n">min_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">plate_map</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">])</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">min_max</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">min_max</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">min_max</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">float</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">min_max</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="nb">float</span><span class="p">)):</span>
            <span class="n">min_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">plate_map</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="p">[</span><span class="n">min_max</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">min_max</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">min_max</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">int</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">min_max</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="nb">int</span><span class="p">)):</span> 
            <span class="n">min_max</span> <span class="o">=</span> <span class="p">[</span><span class="n">min_max</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">min_max</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="k">return</span> <span class="n">plate_map</span><span class="p">,</span> <span class="n">min_max</span></div>


<div class="viewcode-block" id="plot_plates">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.plot_plates">[docs]</a>
<span class="k">def</span> <span class="nf">plot_plates</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">grouping</span><span class="p">,</span> <span class="n">min_max</span><span class="p">,</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">min_count</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dst</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">plates</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;prc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">plates</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">n_rows</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">plate</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">plates</span><span class="p">):</span>
        <span class="n">plate_map</span><span class="p">,</span> <span class="n">min_max_values</span> <span class="o">=</span> <span class="n">generate_plate_heatmap</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">plate</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">grouping</span><span class="p">,</span> <span class="n">min_max</span><span class="p">,</span> <span class="n">min_count</span><span class="p">)</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">plate_map</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">min_max_values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmax</span><span class="o">=</span><span class="n">min_max_values</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">plate</span><span class="p">)</span>
        
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">plates</span><span class="p">),</span> <span class="n">n_rows</span> <span class="o">*</span> <span class="n">n_cols</span><span class="p">):</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">delaxes</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">dst</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1000</span><span class="p">):</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;plate_heatmap_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.pdf&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Saved heatmap to </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">break</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="print_mask_and_flows">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.print_mask_and_flows">[docs]</a>
<span class="k">def</span> <span class="nf">print_mask_and_flows</span><span class="p">(</span><span class="n">stack</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">flows</span><span class="p">,</span> <span class="n">overlay</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Display the original image, mask with outlines, and flow images.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        stack (np.array): Original image or stack.</span>
<span class="sd">        mask (np.array): Mask image.</span>
<span class="sd">        flows (list): List of flow images.</span>
<span class="sd">        overlay (bool): Whether to overlay the mask outlines on the original image.</span>
<span class="sd">        max_size (int): Maximum allowed size for any dimension of the images.</span>
<span class="sd">        thickness (int): Thickness of the contour outlines.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">resize_if_needed</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">max_size</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Resize image if any dimension exceeds max_size while maintaining aspect ratio.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">max_size</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">max_size</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">new_shape</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">new_shape</span> <span class="o">+=</span> <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],)</span>
            <span class="k">return</span> <span class="n">sk_resize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">new_shape</span><span class="p">,</span> <span class="n">preserve_range</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">anti_aliasing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">image</span>

    <span class="k">def</span> <span class="nf">generate_contours</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate contours for each object in the mask using OpenCV.&quot;&quot;&quot;</span>
        <span class="n">contours</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findContours</span><span class="p">(</span><span class="n">mask</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span> <span class="n">cv2</span><span class="o">.</span><span class="n">RETR_EXTERNAL</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CHAIN_APPROX_SIMPLE</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">contours</span>

    <span class="k">def</span> <span class="nf">apply_contours_on_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Draw the contours on the original image.&quot;&quot;&quot;</span>
        <span class="c1"># Ensure the image is in RGB format</span>
        <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># Grayscale to RGB</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">normalize_to_uint8</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>  <span class="c1"># Convert to uint8 if needed</span>
            <span class="n">image_rgb</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_GRAY2RGB</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">image_rgb</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Generate and draw contours</span>
        <span class="n">contours</span> <span class="o">=</span> <span class="n">generate_contours</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">drawContours</span><span class="p">(</span><span class="n">image_rgb</span><span class="p">,</span> <span class="n">contours</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">thickness</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">image_rgb</span>

    <span class="k">def</span> <span class="nf">normalize_to_uint8</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Normalize and convert image to uint8.&quot;&quot;&quot;</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Ensure values are between 0 and 1</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">image</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>  <span class="c1"># Convert to uint8</span>
    
    
    <span class="c1"># Resize if necessary</span>
    <span class="n">stack</span> <span class="o">=</span> <span class="n">resize_if_needed</span><span class="p">(</span><span class="n">stack</span><span class="p">,</span> <span class="n">max_size</span><span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">resize_if_needed</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">max_size</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">flows</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flows</span> <span class="o">=</span> <span class="p">[</span><span class="n">resize_if_needed</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">max_size</span><span class="p">)</span> <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">flows</span><span class="p">]</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">stack</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span>

    <span class="c1"># Display original image</span>
    <span class="k">if</span> <span class="n">stack</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">original_image</span> <span class="o">=</span> <span class="n">stack</span>
    <span class="k">elif</span> <span class="n">stack</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">original_image</span> <span class="o">=</span> <span class="n">stack</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># Use the first channel as the base</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unexpected stack dimensionality.&quot;</span><span class="p">)</span>

    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">original_image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original Image&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

    <span class="c1"># Overlay mask outlines on original image if overlay is True</span>
    <span class="k">if</span> <span class="n">overlay</span><span class="p">:</span>
        <span class="n">outlined_image</span> <span class="o">=</span> <span class="n">apply_contours_on_image</span><span class="p">(</span><span class="n">original_image</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">thickness</span><span class="o">=</span><span class="n">thickness</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">outlined_image</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>

    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Mask with Overlay&#39;</span> <span class="k">if</span> <span class="n">overlay</span> <span class="k">else</span> <span class="s1">&#39;Mask&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">flows</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>

        <span class="c1"># Display flow image or its first channel</span>
        <span class="k">if</span> <span class="n">flows</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">flows</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">flows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ndim</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
            <span class="n">flow_image</span> <span class="o">=</span> <span class="n">flows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">flow_image</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">flow_image</span> <span class="o">=</span> <span class="n">flow_image</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># Use first channel for 3D</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">flow_image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unexpected flow dimensionality or structure.&quot;</span><span class="p">)</span>

        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Flows&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

    
<div class="viewcode-block" id="plot_resize">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.plot_resize">[docs]</a>
<span class="k">def</span> <span class="nf">plot_resize</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">resized_images</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">resized_labels</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">prepare_image</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">img</span><span class="p">,</span> <span class="s1">&#39;gray&#39;</span>
        <span class="k">elif</span> <span class="n">img</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;gray&#39;</span>
            <span class="k">elif</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">img</span><span class="p">,</span> <span class="kc">None</span>  <span class="c1"># RGB</span>
            <span class="k">elif</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">img</span><span class="p">,</span> <span class="kc">None</span>  <span class="c1"># RGBA</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># fallback: average across channels to show as grayscale</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;gray&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported image shape: </span><span class="si">{</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>

    <span class="c1"># Original Image</span>
    <span class="n">img</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">prepare_image</span><span class="p">(</span><span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original Image&#39;</span><span class="p">)</span>

    <span class="c1"># Resized Image</span>
    <span class="n">img</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">prepare_image</span><span class="p">(</span><span class="n">resized_images</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Resized Image&#39;</span><span class="p">)</span>

    <span class="c1"># Labels (assumed grayscale or single-channel)</span>
    <span class="n">lbl</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">prepare_image</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">lbl</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original Label&#39;</span><span class="p">)</span>

    <span class="n">lbl</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">prepare_image</span><span class="p">(</span><span class="n">resized_labels</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">lbl</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Resized Label&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

    
<div class="viewcode-block" id="normalize_and_visualize">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.normalize_and_visualize">[docs]</a>
<span class="k">def</span> <span class="nf">normalize_and_visualize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">normalized_image</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Utility function for visualization&quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># Multi-channel image</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>  <span class="c1"># Display the average over channels for visualization</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Grayscale image</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Original &quot;</span> <span class="o">+</span> <span class="n">title</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">normalized_image</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">normalized_image</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>  <span class="c1"># Similarly, display the average over channels</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">normalized_image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Normalized &quot;</span> <span class="o">+</span> <span class="n">title</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

    
<div class="viewcode-block" id="visualize_masks">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.visualize_masks">[docs]</a>
<span class="k">def</span> <span class="nf">visualize_masks</span><span class="p">(</span><span class="n">mask1</span><span class="p">,</span> <span class="n">mask2</span><span class="p">,</span> <span class="n">mask3</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Masks Comparison&quot;</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">title</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="p">[</span><span class="n">mask1</span><span class="p">,</span> <span class="n">mask2</span><span class="p">,</span> <span class="n">mask3</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Mask 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Mask 2&#39;</span><span class="p">,</span> <span class="s1">&#39;Mask 3&#39;</span><span class="p">]):</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">generate_mask_random_cmap</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
        <span class="c1"># If the mask is binary, we can skip normalization</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Normalize the image for displaying purposes</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">mask</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="visualize_cellpose_masks">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.visualize_cellpose_masks">[docs]</a>
<span class="k">def</span> <span class="nf">visualize_cellpose_masks</span><span class="p">(</span><span class="n">masks</span><span class="p">,</span> <span class="n">titles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">src</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Visualize multiple masks with optional titles.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        masks (list of np.ndarray): A list of masks to visualize.</span>
<span class="sd">        titles (list of str, optional): A list of titles for the masks. If None, default titles will be used.</span>
<span class="sd">        comparison_title (str): Title for the entire figure.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">comparison_title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Masks Comparison for </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span>
    
    <span class="k">if</span> <span class="n">titles</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Mask </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">masks</span><span class="p">))]</span>
    
    <span class="c1"># Ensure the length of titles matches the number of masks</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">titles</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">masks</span><span class="p">),</span> <span class="s2">&quot;Number of titles and masks must match&quot;</span>
    
    <span class="n">num_masks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">masks</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_masks</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="n">num_masks</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>  <span class="c1"># Adjusting figure size dynamically</span>
    
    <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">title</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">masks</span><span class="p">,</span> <span class="n">titles</span><span class="p">):</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">generate_mask_random_cmap</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
        <span class="c1"># Normalize and display the mask</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">mask</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">comparison_title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">src</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">src</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="n">results_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="s1">&#39;results&#39;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">results_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">fig_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.pdf&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig_path</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Saved figure to </span><span class="si">{</span><span class="n">fig_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span></div>


    
<div class="viewcode-block" id="plot_comparison_results">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.plot_comparison_results">[docs]</a>
<span class="k">def</span> <span class="nf">plot_comparison_results</span><span class="p">(</span><span class="n">comparison_results</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">comparison_results</span><span class="p">)</span>
    <span class="n">df_melted</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">],</span> <span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;metric&#39;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
    <span class="n">df_jaccard</span> <span class="o">=</span> <span class="n">df_melted</span><span class="p">[</span><span class="n">df_melted</span><span class="p">[</span><span class="s1">&#39;metric&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;jaccard&#39;</span><span class="p">)]</span>
    <span class="n">df_dice</span> <span class="o">=</span> <span class="n">df_melted</span><span class="p">[</span><span class="n">df_melted</span><span class="p">[</span><span class="s1">&#39;metric&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;dice&#39;</span><span class="p">)]</span>
    <span class="n">df_boundary_f1</span> <span class="o">=</span> <span class="n">df_melted</span><span class="p">[</span><span class="n">df_melted</span><span class="p">[</span><span class="s1">&#39;metric&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;boundary_f1&#39;</span><span class="p">)]</span>
    <span class="n">df_ap</span> <span class="o">=</span> <span class="n">df_melted</span><span class="p">[</span><span class="n">df_melted</span><span class="p">[</span><span class="s1">&#39;metric&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;average_precision&#39;</span><span class="p">)]</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    
    <span class="c1"># Jaccard Index Plot</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df_jaccard</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;metric&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df_jaccard</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;metric&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">jitter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Jaccard Index by Comparison&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Comparison&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Jaccard Index&#39;</span><span class="p">)</span>
    <span class="c1"># Dice Coefficient Plot</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df_dice</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;metric&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df_dice</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;metric&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">jitter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Dice Coefficient by Comparison&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Comparison&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Dice Coefficient&#39;</span><span class="p">)</span>
    <span class="c1"># Border F1 scores</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df_boundary_f1</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;metric&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df_boundary_f1</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;metric&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">jitter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Boundary F1 Score by Comparison&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Comparison&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Boundary F1 Score&#39;</span><span class="p">)</span>
    <span class="c1"># AP scores plot</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df_ap</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;metric&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df_ap</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;metric&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">jitter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Average Precision by Comparison&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Comparison&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Average Precision&#39;</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="plot_object_outlines">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.plot_object_outlines">[docs]</a>
<span class="k">def</span> <span class="nf">plot_object_outlines</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">objects</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;nucleus&#39;</span><span class="p">,</span><span class="s1">&#39;cell&#39;</span><span class="p">,</span><span class="s1">&#39;pathogen&#39;</span><span class="p">],</span> <span class="n">channels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">max_nr</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    
    <span class="k">for</span> <span class="n">object_</span><span class="p">,</span> <span class="n">channel</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">objects</span><span class="p">,</span> <span class="n">channels</span><span class="p">):</span>
        <span class="n">folders</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="s1">&#39;masks&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">object_</span><span class="si">}</span><span class="s1">_mask_stack&#39;</span><span class="p">),</span>
                   <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">channel</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">folders</span><span class="p">)</span>
        <span class="n">plot_images_and_arrays</span><span class="p">(</span><span class="n">folders</span><span class="p">,</span>
                               <span class="n">lower_percentile</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                               <span class="n">upper_percentile</span><span class="o">=</span><span class="mf">99.5</span><span class="p">,</span>
                               <span class="n">threshold</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                               <span class="n">extensions</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;.npy&#39;</span><span class="p">,</span> <span class="s1">&#39;.tif&#39;</span><span class="p">,</span> <span class="s1">&#39;.tiff&#39;</span><span class="p">,</span> <span class="s1">&#39;.png&#39;</span><span class="p">],</span>
                               <span class="n">overlay</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">max_nr</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                               <span class="n">randomize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

                
<div class="viewcode-block" id="volcano_plot">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.volcano_plot">[docs]</a>
<span class="k">def</span> <span class="nf">volcano_plot</span><span class="p">(</span><span class="n">coef_df</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;volcano_plot.pdf&#39;</span><span class="p">):</span>
    <span class="n">palette</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;pc&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span>
        <span class="s1">&#39;nc&#39;</span><span class="p">:</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span>
        <span class="s1">&#39;control&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span>
        <span class="s1">&#39;other&#39;</span><span class="p">:</span> <span class="s1">&#39;gray&#39;</span>
    <span class="p">}</span>

    <span class="c1"># Create the volcano plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">coef_df</span><span class="p">,</span> 
        <span class="n">x</span><span class="o">=</span><span class="s1">&#39;coefficient&#39;</span><span class="p">,</span> 
        <span class="n">y</span><span class="o">=</span><span class="s1">&#39;-log10(p_value)&#39;</span><span class="p">,</span> 
        <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;condition&#39;</span><span class="p">,</span> 
        <span class="n">palette</span><span class="o">=</span><span class="n">palette</span>
    <span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Volcano Plot of Coefficients&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Coefficient&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;-log10(p-value)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">0.05</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Saved Volcano plot: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="plot_histogram">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.plot_histogram">[docs]</a>
<span class="k">def</span> <span class="nf">plot_histogram</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">dst</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># Plot histogram of the dependent variable</span>
    <span class="n">bar_color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">155</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">155</span><span class="o">/</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">bar_color</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Histogram of </span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">dst</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s1">_histogram.pdf&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Saved histogram to </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="plot_lorenz_curves">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.plot_lorenz_curves">[docs]</a>
<span class="k">def</span> <span class="nf">plot_lorenz_curves</span><span class="p">(</span><span class="n">csv_files</span><span class="p">,</span> <span class="n">name_column</span><span class="o">=</span><span class="s1">&#39;grna_name&#39;</span><span class="p">,</span> <span class="n">value_column</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> 
                       <span class="n">remove_keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                       <span class="n">x_lim</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">y_lim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">remove_outliers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="nf">lorenz_curve</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate Lorenz curve.&quot;&quot;&quot;</span>
        <span class="n">sorted_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">cumulative_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">sorted_data</span><span class="p">)</span>
        <span class="n">lorenz_curve</span> <span class="o">=</span> <span class="n">cumulative_data</span> <span class="o">/</span> <span class="n">cumulative_data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">lorenz_curve</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">lorenz_curve</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lorenz_curve</span>
    
    <span class="k">def</span> <span class="nf">gini_coefficient</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate Gini coefficient from data.&quot;&quot;&quot;</span>
        <span class="n">sorted_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">cumulative_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">sorted_data</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sorted_data</span><span class="p">)</span>
        <span class="n">cumulative_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">cumulative_data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">gini</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cumulative_data</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">gini</span>

    <span class="k">def</span> <span class="nf">remove_outliers_by_wells</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">name_col</span><span class="p">,</span> <span class="n">wells_col</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove outliers based on 95% confidence interval for well counts.&quot;&quot;&quot;</span>
        <span class="n">well_counts</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">name_col</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
        <span class="n">q1</span> <span class="o">=</span> <span class="n">well_counts</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="n">q3</span> <span class="o">=</span> <span class="n">well_counts</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.95</span><span class="p">)</span>
        <span class="n">iqr_range</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">-</span> <span class="n">q1</span>
        <span class="n">lower_bound</span> <span class="o">=</span> <span class="n">q1</span> <span class="o">-</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">iqr_range</span>
        <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">iqr_range</span>
        <span class="n">valid_names</span> <span class="o">=</span> <span class="n">well_counts</span><span class="p">[(</span><span class="n">well_counts</span> <span class="o">&gt;=</span> <span class="n">lower_bound</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">well_counts</span> <span class="o">&lt;=</span> <span class="n">upper_bound</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">name_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">valid_names</span><span class="p">)]</span>
    
    <span class="n">combined_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">gini_values</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">csv_file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">csv_files</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_file</span><span class="p">)</span>
        
        <span class="c1"># Remove specified keys</span>
        <span class="k">for</span> <span class="n">remove</span> <span class="ow">in</span> <span class="n">remove_keys</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">name_column</span><span class="p">]</span> <span class="o">!=</span> <span class="n">remove</span><span class="p">]</span>
        
        <span class="c1"># Remove outliers</span>
        <span class="k">if</span> <span class="n">remove_outliers</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">remove_outliers_by_wells</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">name_column</span><span class="p">,</span> <span class="n">value_column</span><span class="p">)</span>
        
        <span class="n">values</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">value_column</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">combined_data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        
        <span class="c1"># Calculate Lorenz curve and Gini coefficient</span>
        <span class="n">lorenz</span> <span class="o">=</span> <span class="n">lorenz_curve</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="n">gini</span> <span class="o">=</span> <span class="n">gini_coefficient</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="n">gini_values</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;plate </span><span class="si">{</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gini</span>
        
        <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;plate </span><span class="si">{</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> (Gini: </span><span class="si">{</span><span class="n">gini</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">lorenz</span><span class="p">)),</span> <span class="n">lorenz</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="c1"># Plot combined Lorenz curve</span>
    <span class="n">combined_lorenz</span> <span class="o">=</span> <span class="n">lorenz_curve</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">combined_data</span><span class="p">))</span>
    <span class="n">combined_gini</span> <span class="o">=</span> <span class="n">gini_coefficient</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">combined_data</span><span class="p">))</span>
    <span class="n">gini_values</span><span class="p">[</span><span class="s2">&quot;Combined&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">combined_gini</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">combined_lorenz</span><span class="p">)),</span> <span class="n">combined_lorenz</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Combined (Gini: </span><span class="si">{</span><span class="n">combined_gini</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">x_lim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">x_lim</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">y_lim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">y_lim</span><span class="p">)</span>
        
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Lorenz Curves&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Cumulative Share of Individuals&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Cumulative Share of Value&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">csv_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39;results&#39;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">save_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="s1">&#39;lorenz_curve_with_gini.pdf&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_file_path</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved Lorenz Curve: </span><span class="si">{</span><span class="n">save_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Print Gini coefficients</span>
    <span class="k">for</span> <span class="n">plate</span><span class="p">,</span> <span class="n">gini</span> <span class="ow">in</span> <span class="n">gini_values</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">plate</span><span class="si">}</span><span class="s2">: Gini Coefficient = </span><span class="si">{</span><span class="n">gini</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="plot_permutation">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.plot_permutation">[docs]</a>
<span class="k">def</span> <span class="nf">plot_permutation</span><span class="p">(</span><span class="n">permutation_df</span><span class="p">):</span>
    <span class="n">num_features</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">permutation_df</span><span class="p">)</span>
    <span class="n">fig_height</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">num_features</span> <span class="o">*</span> <span class="mf">0.3</span><span class="p">)</span>  <span class="c1"># Set a minimum height of 8 and adjust height based on number of features</span>
    <span class="n">fig_width</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># Width can be fixed or adjusted similarly</span>
    <span class="n">font_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span> <span class="o">-</span> <span class="n">num_features</span> <span class="o">*</span> <span class="mf">0.2</span><span class="p">)</span>  <span class="c1"># Adjust font size dynamically</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fig_width</span><span class="p">,</span> <span class="n">fig_height</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">permutation_df</span><span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">],</span> <span class="n">permutation_df</span><span class="p">[</span><span class="s1">&#39;importance_mean&#39;</span><span class="p">],</span> <span class="n">xerr</span><span class="o">=</span><span class="n">permutation_df</span><span class="p">[</span><span class="s1">&#39;importance_std&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;teal&quot;</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Permutation Importance&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">font_size</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">font_size</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="plot_feature_importance">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.plot_feature_importance">[docs]</a>
<span class="k">def</span> <span class="nf">plot_feature_importance</span><span class="p">(</span><span class="n">feature_importance_df</span><span class="p">):</span>
    <span class="n">num_features</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">feature_importance_df</span><span class="p">)</span>
    <span class="n">fig_height</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">num_features</span> <span class="o">*</span> <span class="mf">0.3</span><span class="p">)</span>  <span class="c1"># Set a minimum height of 8 and adjust height based on number of features</span>
    <span class="n">fig_width</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># Width can be fixed or adjusted similarly</span>
    <span class="n">font_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span> <span class="o">-</span> <span class="n">num_features</span> <span class="o">*</span> <span class="mf">0.2</span><span class="p">)</span>  <span class="c1"># Adjust font size dynamically</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fig_width</span><span class="p">,</span> <span class="n">fig_height</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">feature_importance_df</span><span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">],</span> <span class="n">feature_importance_df</span><span class="p">[</span><span class="s1">&#39;importance&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Feature Importance&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">font_size</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">font_size</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="read_and_plot__vision_results">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.read_and_plot__vision_results">[docs]</a>
<span class="k">def</span> <span class="nf">read_and_plot__vision_results</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">y_axis</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="n">name_split</span><span class="o">=</span><span class="s1">&#39;_time&#39;</span><span class="p">,</span> <span class="n">y_lim</span><span class="o">=</span><span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">]):</span>
    <span class="c1"># List to store data from all CSV files</span>
    <span class="n">data_frames</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">dst</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;result&#39;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span><span class="n">exists</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Walk through the directory</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">base_dir</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_test_result.csv&quot;</span><span class="p">):</span>
                <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
                <span class="c1"># Extract model information from the file name</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                <span class="n">model</span> <span class="o">=</span> <span class="n">file_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name_split</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                
                <span class="c1"># Extract epoch information from the file name</span>
                <span class="n">epoch_info</span> <span class="o">=</span> <span class="n">file_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_time&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">base_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                <span class="n">epoch</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">base_folder</span><span class="p">)</span>
                
                <span class="c1"># Read the CSV file</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                <span class="n">df</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span>
                <span class="n">df</span><span class="p">[</span><span class="s1">&#39;epoch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">epoch</span>
                
                <span class="c1"># Append the data frame to the list</span>
                <span class="n">data_frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    
    <span class="c1"># Concatenate all data frames</span>
    <span class="k">if</span> <span class="n">data_frames</span><span class="p">:</span>
        <span class="n">result_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">data_frames</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="c1"># Calculate average y_axis per model</span>
        <span class="n">avg_metric</span> <span class="o">=</span> <span class="n">result_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">)[</span><span class="n">y_axis</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">avg_metric</span> <span class="o">=</span> <span class="n">avg_metric</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">y_axis</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">avg_metric</span><span class="p">)</span>
        
        <span class="c1"># Plotting the results</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">avg_metric</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">],</span> <span class="n">avg_metric</span><span class="p">[</span><span class="n">y_axis</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Model&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">y_axis</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Average </span><span class="si">{</span><span class="n">y_axis</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s1"> per Model&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">y_lim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">y_lim</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No CSV files found in the specified directory.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="jitterplot_by_annotation">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.jitterplot_by_annotation">[docs]</a>
<span class="k">def</span> <span class="nf">jitterplot_by_annotation</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">x_column</span><span class="p">,</span> <span class="n">y_column</span><span class="p">,</span> <span class="n">plot_title</span><span class="o">=</span><span class="s1">&#39;Jitter Plot&#39;</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filter_column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filter_values</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads a CSV file and creates a jitter plot of one column grouped by another column.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">    src (str): Path to the source data.</span>
<span class="sd">    x_column (str): Name of the column to be used for the x-axis.</span>
<span class="sd">    y_column (str): Name of the column to be used for the y-axis.</span>
<span class="sd">    plot_title (str): Title of the plot. Default is &#39;Jitter Plot&#39;.</span>
<span class="sd">    output_path (str): Path to save the plot image. If None, the plot will be displayed. Default is None.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    pd.DataFrame: The filtered and balanced DataFrame.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">join_measurments_and_annotation</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">tables</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cell&#39;</span><span class="p">,</span> <span class="s1">&#39;nucleus&#39;</span><span class="p">,</span> <span class="s1">&#39;pathogen&#39;</span><span class="p">,</span><span class="s1">&#39;cytoplasm&#39;</span><span class="p">]):</span>
        <span class="kn">from</span> <span class="nn">.io</span> <span class="kn">import</span> <span class="n">_read_and_merge_data</span><span class="p">,</span> <span class="n">_read_db</span>
        <span class="n">db_loc</span> <span class="o">=</span> <span class="p">[</span><span class="n">src</span><span class="o">+</span><span class="s1">&#39;/measurements/measurements.db&#39;</span><span class="p">]</span>
        <span class="n">loc</span> <span class="o">=</span> <span class="n">src</span><span class="o">+</span><span class="s1">&#39;/measurements/measurements.db&#39;</span>
        <span class="n">df</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_read_and_merge_data</span><span class="p">(</span><span class="n">db_loc</span><span class="p">,</span> 
                                    <span class="n">tables</span><span class="p">,</span> 
                                    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                                    <span class="n">nuclei_limit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                                    <span class="n">pathogen_limit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="n">paths_df</span> <span class="o">=</span> <span class="n">_read_db</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">tables</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;png_list&#39;</span><span class="p">])</span>
        <span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">paths_df</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;prcfo&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">merged_df</span>

    <span class="c1"># Read the CSV file into a DataFrame</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">join_measurments_and_annotation</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">tables</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cell&#39;</span><span class="p">,</span> <span class="s1">&#39;nucleus&#39;</span><span class="p">,</span> <span class="s1">&#39;pathogen&#39;</span><span class="p">,</span> <span class="s1">&#39;cytoplasm&#39;</span><span class="p">])</span>

    <span class="c1"># Print column names for debugging</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated dataframe with: </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> columns and </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> rows&quot;</span><span class="p">)</span>
    <span class="c1">#print(&quot;Columns in DataFrame:&quot;, df.columns.tolist())</span>

    <span class="c1"># Replace NaN values with a specific label in x_column</span>
    <span class="n">df</span><span class="p">[</span><span class="n">x_column</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">x_column</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;NaN&#39;</span><span class="p">)</span>

    <span class="c1"># Filter the DataFrame if filter_column and filter_values are provided</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">filter_column</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filter_column</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">filter_column</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">filter_values</span><span class="p">)]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filter_column</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">filter_column</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;hello </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">val</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">filter_values</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span>

    <span class="c1"># Use the correct column names based on your DataFrame</span>
    <span class="n">required_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;plate_x&#39;</span><span class="p">,</span> <span class="s1">&#39;row_x&#39;</span><span class="p">,</span> <span class="s1">&#39;col_x&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">column</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">required_columns</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DataFrame does not contain the necessary columns: </span><span class="si">{</span><span class="n">required_columns</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Filter to retain rows with non-NaN values in x_column and with matching plate, row, col values</span>
    <span class="n">non_nan_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">x_column</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;NaN&#39;</span><span class="p">]</span>
    <span class="n">retained_rows</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;plate_x&#39;</span><span class="p">,</span> <span class="s1">&#39;row_x&#39;</span><span class="p">,</span> <span class="s1">&#39;col_x&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">non_nan_df</span><span class="p">[[</span><span class="s1">&#39;plate_x&#39;</span><span class="p">,</span> <span class="s1">&#39;row_x&#39;</span><span class="p">,</span> <span class="s1">&#39;col_x&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))]</span>

    <span class="c1"># Determine the minimum count of examples across all groups in x_column</span>
    <span class="n">min_count</span> <span class="o">=</span> <span class="n">retained_rows</span><span class="p">[</span><span class="n">x_column</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Found </span><span class="si">{</span><span class="n">min_count</span><span class="si">}</span><span class="s1"> annotated images&#39;</span><span class="p">)</span>

    <span class="c1"># Randomly sample min_count examples from each group in x_column</span>
    <span class="n">balanced_df</span> <span class="o">=</span> <span class="n">retained_rows</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">x_column</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">min_count</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Create the jitter plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">jitter_plot</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">balanced_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x_column</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_column</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="n">x_column</span><span class="p">,</span> <span class="n">jitter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">dodge</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">plot_title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">x_column</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">y_column</span><span class="p">)</span>
    
    <span class="c1"># Customize the x-axis labels</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
    
    <span class="c1"># Adjust the position of the x-axis labels to be centered below the data</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
    
    <span class="c1"># Save the plot to a file or display it</span>
    <span class="k">if</span> <span class="n">output_path</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Jitter plot saved to </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">balanced_df</span></div>


<div class="viewcode-block" id="create_grouped_plot">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.create_grouped_plot">[docs]</a>
<span class="k">def</span> <span class="nf">create_grouped_plot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">grouping_column</span><span class="p">,</span> <span class="n">data_column</span><span class="p">,</span> <span class="n">graph_type</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">summary_func</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="s1">&#39;./output&#39;</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">y_lim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">error_bar_type</span><span class="o">=</span><span class="s1">&#39;std&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a grouped plot, perform statistical tests, and optionally export the results along with the plot.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - df: DataFrame containing the data.</span>
<span class="sd">    - grouping_column: Column name for the categorical grouping.</span>
<span class="sd">    - data_column: Column name for the data to be grouped and plotted.</span>
<span class="sd">    - graph_type: Type of plot (&#39;bar&#39;, &#39;violin&#39;, &#39;jitter&#39;, &#39;box&#39;, &#39;jitter_box&#39;).</span>
<span class="sd">    - summary_func: Summary function to apply to each group (&#39;mean&#39;, &#39;median&#39;, etc.).</span>
<span class="sd">    - order: List specifying the order of the groups. If None, groups will be ordered alphabetically.</span>
<span class="sd">    - colors: List of colors for each group.</span>
<span class="sd">    - output_dir: Directory where the figure and test results will be saved if `save=True`.</span>
<span class="sd">    - save: Boolean flag indicating whether to save the plot and results to files.</span>
<span class="sd">    - y_lim: Optional y-axis min and max.</span>
<span class="sd">    - error_bar_type: Type of error bars to plot, either &#39;std&#39; for standard deviation or &#39;sem&#39; for standard error of the mean.</span>

<span class="sd">    Outputs:</span>
<span class="sd">    - Figure of the plot.</span>
<span class="sd">    - DataFrame with full statistical test results, including normality tests.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Remove NaN rows in grouping_column</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="n">grouping_column</span><span class="p">])</span>
    
    <span class="c1"># Ensure the output directory exists if save is True</span>
    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1"># Sorting and ordering</span>
    <span class="k">if</span> <span class="n">order</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="n">grouping_column</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">grouping_column</span><span class="p">],</span> <span class="n">categories</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="n">grouping_column</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">grouping_column</span><span class="p">],</span> <span class="n">categories</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">grouping_column</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()),</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1"># Get unique groups</span>
    <span class="n">unique_groups</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">grouping_column</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    
    <span class="c1"># Initialize test results</span>
    <span class="n">test_results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Test normality for each group</span>
    <span class="n">grouped_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">grouping_column</span><span class="p">]</span> <span class="o">==</span> <span class="n">group</span><span class="p">,</span> <span class="n">data_column</span><span class="p">]</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">unique_groups</span><span class="p">]</span>
    <span class="n">normal_p_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">normaltest</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">pvalue</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">grouped_data</span><span class="p">]</span>
    <span class="n">normal_stats</span> <span class="o">=</span> <span class="p">[</span><span class="n">normaltest</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">statistic</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">grouped_data</span><span class="p">]</span>
    <span class="n">is_normal</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">p</span> <span class="o">&gt;</span> <span class="mf">0.05</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">normal_p_values</span><span class="p">)</span>

    <span class="c1"># Add normality test results to the results_df</span>
    <span class="k">for</span> <span class="n">group</span><span class="p">,</span> <span class="n">stat</span><span class="p">,</span> <span class="n">p_value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">unique_groups</span><span class="p">,</span> <span class="n">normal_stats</span><span class="p">,</span> <span class="n">normal_p_values</span><span class="p">):</span>
        <span class="n">test_results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;Comparison&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Normality test for </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Test Statistic&#39;</span><span class="p">:</span> <span class="n">stat</span><span class="p">,</span>
            <span class="s1">&#39;p-value&#39;</span><span class="p">:</span> <span class="n">p_value</span><span class="p">,</span>
            <span class="s1">&#39;Test Name&#39;</span><span class="p">:</span> <span class="s1">&#39;Normality test&#39;</span>
        <span class="p">})</span>

    <span class="c1"># Determine statistical test</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_groups</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">is_normal</span><span class="p">:</span>
            <span class="n">stat_test</span> <span class="o">=</span> <span class="n">ttest_ind</span>
            <span class="n">test_name</span> <span class="o">=</span> <span class="s1">&#39;T-test&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stat_test</span> <span class="o">=</span> <span class="n">mannwhitneyu</span>
            <span class="n">test_name</span> <span class="o">=</span> <span class="s1">&#39;Mann-Whitney U test&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">is_normal</span><span class="p">:</span>
            <span class="n">stat_test</span> <span class="o">=</span> <span class="n">f_oneway</span>
            <span class="n">test_name</span> <span class="o">=</span> <span class="s1">&#39;One-way ANOVA&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stat_test</span> <span class="o">=</span> <span class="n">kruskal</span>
            <span class="n">test_name</span> <span class="o">=</span> <span class="s1">&#39;Kruskal-Wallis test&#39;</span>

    <span class="c1"># Perform pairwise statistical tests</span>
    <span class="n">comparisons</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">unique_groups</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">p_values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">test_statistics</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">group1</span><span class="p">,</span> <span class="n">group2</span><span class="p">)</span> <span class="ow">in</span> <span class="n">comparisons</span><span class="p">:</span>
        <span class="n">data1</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">grouping_column</span><span class="p">]</span> <span class="o">==</span> <span class="n">group1</span><span class="p">][</span><span class="n">data_column</span><span class="p">]</span>
        <span class="n">data2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">grouping_column</span><span class="p">]</span> <span class="o">==</span> <span class="n">group2</span><span class="p">][</span><span class="n">data_column</span><span class="p">]</span>
        <span class="n">stat</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">stat_test</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">)</span>
        <span class="n">p_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">test_statistics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stat</span><span class="p">)</span>
        <span class="n">test_results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Comparison&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">group1</span><span class="si">}</span><span class="s1"> vs </span><span class="si">{</span><span class="n">group2</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;Test Statistic&#39;</span><span class="p">:</span> <span class="n">stat</span><span class="p">,</span> <span class="s1">&#39;p-value&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">,</span> <span class="s1">&#39;Test Name&#39;</span><span class="p">:</span> <span class="n">test_name</span><span class="p">})</span>
    
    <span class="c1"># Post-hoc test (Tukey HSD for ANOVA)</span>
    <span class="n">posthoc_p_values</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">is_normal</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_groups</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">tukey_result</span> <span class="o">=</span> <span class="n">pairwise_tukeyhsd</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">data_column</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">grouping_column</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="n">posthoc_p_values</span> <span class="o">=</span> <span class="n">tukey_result</span><span class="o">.</span><span class="n">pvalues</span>
        <span class="k">for</span> <span class="n">comparison</span><span class="p">,</span> <span class="n">p_value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tukey_result</span><span class="o">.</span><span class="n">_results_table</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">tukey_result</span><span class="o">.</span><span class="n">pvalues</span><span class="p">):</span>
            <span class="n">test_results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;Comparison&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">comparison</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> vs </span><span class="si">{</span><span class="n">comparison</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Test Statistic&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Tukey does not provide a test statistic in the same way</span>
                <span class="s1">&#39;p-value&#39;</span><span class="p">:</span> <span class="n">p_value</span><span class="p">,</span>
                <span class="s1">&#39;Test Name&#39;</span><span class="p">:</span> <span class="s1">&#39;Tukey HSD Post-hoc&#39;</span>
            <span class="p">})</span>

    <span class="c1"># Create plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;whitegrid&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">colors</span><span class="p">:</span>
        <span class="n">color_palette</span> <span class="o">=</span> <span class="n">colors</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">color_palette</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;husl&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_groups</span><span class="p">))</span>
    
    <span class="c1"># Choose graph type</span>
    <span class="k">if</span> <span class="n">graph_type</span> <span class="o">==</span> <span class="s1">&#39;bar&#39;</span><span class="p">:</span>
        <span class="n">summary_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">grouping_column</span><span class="p">)[</span><span class="n">data_column</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="n">summary_func</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="s1">&#39;sem&#39;</span><span class="p">])</span>
        
        <span class="c1"># Set error bars based on error_bar_type</span>
        <span class="k">if</span> <span class="n">error_bar_type</span> <span class="o">==</span> <span class="s1">&#39;std&#39;</span><span class="p">:</span>
            <span class="n">error_bars</span> <span class="o">=</span> <span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">error_bar_type</span> <span class="o">==</span> <span class="s1">&#39;sem&#39;</span><span class="p">:</span>
            <span class="n">error_bars</span> <span class="o">=</span> <span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;sem&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid error_bar_type: </span><span class="si">{</span><span class="n">error_bar_type</span><span class="si">}</span><span class="s2">. Choose either &#39;std&#39; or &#39;sem&#39;.&quot;</span><span class="p">)</span>

        <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">grouping_column</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">summary_func</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">summary_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span> <span class="n">ci</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">color_palette</span><span class="p">)</span>

        <span class="c1"># Add error bars (standard deviation or standard error of the mean)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">summary_df</span><span class="p">)),</span> <span class="n">y</span><span class="o">=</span><span class="n">summary_df</span><span class="p">[</span><span class="n">summary_func</span><span class="p">],</span> <span class="n">yerr</span><span class="o">=</span><span class="n">error_bars</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    
    <span class="k">elif</span> <span class="n">graph_type</span> <span class="o">==</span> <span class="s1">&#39;violin&#39;</span><span class="p">:</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">grouping_column</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">data_column</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">color_palette</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">graph_type</span> <span class="o">==</span> <span class="s1">&#39;jitter&#39;</span><span class="p">:</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">grouping_column</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">data_column</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">jitter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">color_palette</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">graph_type</span> <span class="o">==</span> <span class="s1">&#39;box&#39;</span><span class="p">:</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">grouping_column</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">data_column</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">color_palette</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">graph_type</span> <span class="o">==</span> <span class="s1">&#39;jitter_box&#39;</span><span class="p">:</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">grouping_column</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">data_column</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">color_palette</span><span class="p">)</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">grouping_column</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">data_column</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">jitter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>

    <span class="c1"># Create a DataFrame to summarize the test results</span>
    <span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">test_results</span><span class="p">)</span>

    <span class="c1"># Set y-axis start if provided</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y_lim</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_lim</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">y_lim</span><span class="p">)</span>

    <span class="c1"># If save is True, save the plot and results as PNG and CSV</span>
    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="c1"># Save the plot as PNG</span>
        <span class="n">plot_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;grouped_plot.png&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">test_name</span><span class="si">}</span><span class="s1"> results for </span><span class="si">{</span><span class="n">graph_type</span><span class="si">}</span><span class="s1"> plot&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plot_path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plot saved to </span><span class="si">{</span><span class="n">plot_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Save the test results as a CSV file</span>
        <span class="n">results_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;test_results.csv&#39;</span><span class="p">)</span>
        <span class="n">results_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">results_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test results saved to </span><span class="si">{</span><span class="n">results_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Show the plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">(),</span> <span class="n">results_df</span></div>

    
<div class="viewcode-block" id="spacrGraph">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph">[docs]</a>
<span class="k">class</span> <span class="nc">spacrGraph</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">grouping_column</span><span class="p">,</span> <span class="n">data_column</span><span class="p">,</span> <span class="n">graph_type</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">summary_func</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> 
                 <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="s1">&#39;./output&#39;</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">y_lim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">log_y</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">log_x</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">error_bar_type</span><span class="o">=</span><span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="n">remove_outliers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">theme</span><span class="o">=</span><span class="s1">&#39;pastel&#39;</span><span class="p">,</span> <span class="n">representation</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">,</span>
                 <span class="n">paired</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">all_to_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">compare_group</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">graph_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Class for creating grouped plots with optional statistical tests and data preprocessing.</span>
<span class="sd">        &quot;&quot;&quot;</span>

<div class="viewcode-block" id="spacrGraph.df">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.df">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span></div>

<div class="viewcode-block" id="spacrGraph.grouping_column">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.grouping_column">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span> <span class="o">=</span> <span class="n">grouping_column</span></div>

<div class="viewcode-block" id="spacrGraph.order">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.order">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span></div>

<div class="viewcode-block" id="spacrGraph.data_column">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.data_column">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_column</span> <span class="o">=</span> <span class="n">data_column</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_column</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">data_column</span><span class="p">]</span></div>

        
<div class="viewcode-block" id="spacrGraph.graph_type">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.graph_type">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph_type</span> <span class="o">=</span> <span class="n">graph_type</span></div>

<div class="viewcode-block" id="spacrGraph.summary_func">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.summary_func">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">summary_func</span> <span class="o">=</span> <span class="n">summary_func</span></div>

        <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="n">order</span>
<div class="viewcode-block" id="spacrGraph.colors">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.colors">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="n">colors</span></div>

<div class="viewcode-block" id="spacrGraph.output_dir">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.output_dir">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">=</span> <span class="n">output_dir</span></div>

<div class="viewcode-block" id="spacrGraph.save">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.save">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span> <span class="o">=</span> <span class="n">save</span></div>

<div class="viewcode-block" id="spacrGraph.error_bar_type">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.error_bar_type">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_bar_type</span> <span class="o">=</span> <span class="n">error_bar_type</span></div>

<div class="viewcode-block" id="spacrGraph.remove_outliers">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.remove_outliers">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_outliers</span> <span class="o">=</span> <span class="n">remove_outliers</span></div>

<div class="viewcode-block" id="spacrGraph.theme">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.theme">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">theme</span> <span class="o">=</span> <span class="n">theme</span></div>

<div class="viewcode-block" id="spacrGraph.representation">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.representation">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">representation</span> <span class="o">=</span> <span class="n">representation</span></div>

<div class="viewcode-block" id="spacrGraph.paired">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.paired">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">paired</span> <span class="o">=</span> <span class="n">paired</span></div>

<div class="viewcode-block" id="spacrGraph.all_to_all">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.all_to_all">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_to_all</span> <span class="o">=</span> <span class="n">all_to_all</span></div>

<div class="viewcode-block" id="spacrGraph.compare_group">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.compare_group">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">compare_group</span> <span class="o">=</span> <span class="n">compare_group</span></div>

<div class="viewcode-block" id="spacrGraph.y_lim">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.y_lim">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_lim</span> <span class="o">=</span> <span class="n">y_lim</span></div>

<div class="viewcode-block" id="spacrGraph.graph_name">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.graph_name">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph_name</span> <span class="o">=</span> <span class="n">graph_name</span></div>

<div class="viewcode-block" id="spacrGraph.log_x">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.log_x">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_x</span> <span class="o">=</span> <span class="n">log_x</span></div>

<div class="viewcode-block" id="spacrGraph.log_y">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.log_y">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_y</span> <span class="o">=</span> <span class="n">log_y</span></div>


<div class="viewcode-block" id="spacrGraph.results_df">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.results_df">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span></div>

<div class="viewcode-block" id="spacrGraph.sns_palette">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.sns_palette">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">sns_palette</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="spacrGraph.fig">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.fig">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="spacrGraph.results_name">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.results_name">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph_name</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph_type</span><span class="p">)</span></div>

        
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_theme</span><span class="p">()</span>
<div class="viewcode-block" id="spacrGraph.raw_df">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.raw_df">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>

        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocess_data</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">_set_theme</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the Seaborn theme and reorder colors if necessary.&quot;&quot;&quot;</span>
        <span class="n">integer_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">81</span><span class="p">))</span>
        <span class="n">color_order</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">integer_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sns_palette</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_reordered_theme</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theme</span><span class="p">,</span> <span class="n">color_order</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_reordered_theme</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theme</span><span class="o">=</span><span class="s1">&#39;deep&#39;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_colors</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">show_theme</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set and reorder the Seaborn color palette.&quot;&quot;&quot;</span>
        <span class="n">palette</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="n">theme</span><span class="p">,</span> <span class="n">n_colors</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">order</span><span class="p">:</span>
            <span class="n">reordered_palette</span> <span class="o">=</span> <span class="p">[</span><span class="n">palette</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">order</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reordered_palette</span> <span class="o">=</span> <span class="n">palette</span>
        <span class="k">if</span> <span class="n">show_theme</span><span class="p">:</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">palplot</span><span class="p">(</span><span class="n">reordered_palette</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">reordered_palette</span>

    <span class="c1">#def preprocess_data(self):</span>
    <span class="c1">#    &quot;&quot;&quot;Preprocess the data: remove NaNs, sort/order the grouping column, and optionally group by &#39;prc&#39;.&quot;&quot;&quot;</span>
    <span class="c1">#    # Remove NaNs in both the grouping column and each data column</span>
    <span class="c1">#    df = self.df.dropna(subset=[self.grouping_column] + self.data_column)</span>
    <span class="c1">#    # Group by &#39;prc&#39; column if representation is &#39;well&#39;</span>
    <span class="c1">#    if self.representation == &#39;well&#39;:</span>
    <span class="c1">#        df = df.groupby([&#39;prc&#39;, self.grouping_column])[self.data_column].agg(self.summary_func).reset_index()</span>
    <span class="c1">#    if self.representation == &#39;plateID&#39;:</span>
    <span class="c1">#        df = df.groupby([&#39;plateID&#39;, self.grouping_column])[self.data_column].agg(self.summary_func).reset_index()</span>
    <span class="c1">#    if self.order:</span>
    <span class="c1">#        df[self.grouping_column] = pd.Categorical(df[self.grouping_column], categories=self.order, ordered=True)</span>
    <span class="c1">#    else:</span>
    <span class="c1">#        df[self.grouping_column] = pd.Categorical(df[self.grouping_column], categories=sorted(df[self.grouping_column].unique()), ordered=True)</span>
    <span class="c1">#    return df</span>
  
<div class="viewcode-block" id="spacrGraph.preprocess_data">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.preprocess_data">[docs]</a>
    <span class="k">def</span> <span class="nf">preprocess_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Preprocess the data: remove NaNs, optionally ensure &#39;plateID&#39; column is created,</span>
<span class="sd">        then group by either &#39;prc&#39;, &#39;plateID&#39;, or do no grouping at all if representation == &#39;object&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># 1) Remove NaNs in both the grouping column and each data column</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">)</span>

        <span class="c1"># 2) Decide how to handle grouping based on &#39;representation&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">representation</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="p">:</span>
            <span class="c1"># -- No grouping at all --</span>
            <span class="c1"># We do nothing except keep df as-is after removing NaNs</span>
            <span class="n">group_cols</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">representation</span> <span class="o">==</span> <span class="s1">&#39;well&#39;</span><span class="p">:</span>
            <span class="c1"># Group by [&#39;prc&#39;, grouping_column]</span>
            <span class="n">group_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;prc&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">representation</span> <span class="o">==</span> <span class="s1">&#39;plate&#39;</span><span class="p">:</span>
            <span class="c1"># Make sure &#39;plateID&#39; exists (split from &#39;prc&#39; if needed)</span>
            <span class="k">if</span> <span class="s1">&#39;plateID&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;prc&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;plateID&#39;</span><span class="p">,</span> <span class="s1">&#39;rowID&#39;</span><span class="p">,</span> <span class="s1">&#39;columnID&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;prc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                        <span class="s2">&quot;Representation is &#39;plateID&#39;, but no &#39;plateID&#39; column found. &quot;</span>
                        <span class="s2">&quot;Also cannot split from &#39;prc&#39; because &#39;prc&#39; column is missing.&quot;</span>
                    <span class="p">)</span>
            <span class="c1"># If the grouping column IS &#39;plateID&#39;, only group by [&#39;plateID&#39;] once</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span> <span class="o">==</span> <span class="s1">&#39;plateID&#39;</span><span class="p">:</span>
                <span class="n">group_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;plateID&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">group_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;plateID&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown representation: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">representation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># 3) Perform grouping only if group_cols is set</span>
        <span class="k">if</span> <span class="n">group_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">group_cols</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">summary_func</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="c1"># 4) Handle ordering if specified (and if the grouping_column still exists)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
            <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span>
                <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">],</span>
                <span class="n">categories</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">,</span>
                <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
            <span class="c1"># Default to sorting unique values</span>
            <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span>
                <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">],</span>
                <span class="n">categories</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()),</span>
                <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span></div>

   
<div class="viewcode-block" id="spacrGraph.remove_outliers_from_plot">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.remove_outliers_from_plot">[docs]</a>
    <span class="k">def</span> <span class="nf">remove_outliers_from_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove outliers from the plot but keep them in the data.&quot;&quot;&quot;</span>
        <span class="n">filtered_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">unique_groups</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">unique_groups</span><span class="p">:</span>
            <span class="n">group_data</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="p">[</span><span class="n">filtered_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span> <span class="o">==</span> <span class="n">group</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">]</span>
            <span class="n">q1</span> <span class="o">=</span> <span class="n">group_data</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
            <span class="n">q3</span> <span class="o">=</span> <span class="n">group_data</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span>
            <span class="n">iqr</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">-</span> <span class="n">q1</span>
            <span class="n">lower_bound</span> <span class="o">=</span> <span class="n">q1</span> <span class="o">-</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">iqr</span>
            <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">iqr</span>
            <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">filtered_df</span><span class="p">[(</span><span class="n">filtered_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span> <span class="o">==</span> <span class="n">group</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">((</span><span class="n">filtered_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">lower_bound</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">filtered_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">upper_bound</span><span class="p">))]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">filtered_df</span></div>


<div class="viewcode-block" id="spacrGraph.perform_normality_tests">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.perform_normality_tests">[docs]</a>
    <span class="k">def</span> <span class="nf">perform_normality_tests</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform normality tests for each group and data column.&quot;&quot;&quot;</span>
        <span class="n">unique_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="n">normality_results</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">unique_groups</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span> <span class="o">==</span> <span class="n">group</span><span class="p">,</span> <span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
                <span class="n">n_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">n_samples</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="c1"># Skip test if there aren&#39;t enough data points</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping normality test for group &#39;</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&#39; on column &#39;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">&#39; - Not enough data.&quot;</span><span class="p">)</span>
                    <span class="n">normality_results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s1">&#39;Comparison&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Normality test for </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s1"> on </span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;Test Statistic&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s1">&#39;p-value&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s1">&#39;Test Name&#39;</span><span class="p">:</span> <span class="s1">&#39;Skipped&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;Column&#39;</span><span class="p">:</span> <span class="n">column</span><span class="p">,</span>
                        <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="n">n_samples</span>
                    <span class="p">})</span>
                    <span class="k">continue</span>

                <span class="c1"># Choose the appropriate normality test based on the sample size</span>
                <span class="k">if</span> <span class="n">n_samples</span> <span class="o">&gt;=</span> <span class="mi">8</span><span class="p">:</span>
                    <span class="n">stat</span><span class="p">,</span> <span class="n">p_value</span> <span class="o">=</span> <span class="n">normaltest</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                    <span class="n">test_name</span> <span class="o">=</span> <span class="s2">&quot;D&#39;Agostino-Pearson test&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">stat</span><span class="p">,</span> <span class="n">p_value</span> <span class="o">=</span> <span class="n">shapiro</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                    <span class="n">test_name</span> <span class="o">=</span> <span class="s2">&quot;Shapiro-Wilk test&quot;</span>

                <span class="c1"># Store the result for this group and column</span>
                <span class="n">normality_results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;Comparison&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Normality test for </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s1"> on </span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;Test Statistic&#39;</span><span class="p">:</span> <span class="n">stat</span><span class="p">,</span>
                    <span class="s1">&#39;p-value&#39;</span><span class="p">:</span> <span class="n">p_value</span><span class="p">,</span>
                    <span class="s1">&#39;Test Name&#39;</span><span class="p">:</span> <span class="n">test_name</span><span class="p">,</span>
                    <span class="s1">&#39;Column&#39;</span><span class="p">:</span> <span class="n">column</span><span class="p">,</span>
                    <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="n">n_samples</span>
                <span class="p">})</span>

            <span class="c1"># Check if all groups are normally distributed (p &gt; 0.05)</span>
            <span class="n">normal_p_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;p-value&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">normality_results</span> <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;Column&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">column</span> <span class="ow">and</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;p-value&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
            <span class="n">is_normal</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">p</span> <span class="o">&gt;</span> <span class="mf">0.05</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">normal_p_values</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">is_normal</span><span class="p">,</span> <span class="n">normality_results</span></div>


<div class="viewcode-block" id="spacrGraph.perform_levene_test">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.perform_levene_test">[docs]</a>
    <span class="k">def</span> <span class="nf">perform_levene_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unique_groups</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform Levene&#39;s test for equal variance.&quot;&quot;&quot;</span>
        <span class="n">grouped_data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span> <span class="o">==</span> <span class="n">group</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">]</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">unique_groups</span><span class="p">]</span>
        <span class="n">stat</span><span class="p">,</span> <span class="n">p_value</span> <span class="o">=</span> <span class="n">levene</span><span class="p">(</span><span class="o">*</span><span class="n">grouped_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">stat</span><span class="p">,</span> <span class="n">p_value</span></div>


<div class="viewcode-block" id="spacrGraph.perform_statistical_tests">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.perform_statistical_tests">[docs]</a>
    <span class="k">def</span> <span class="nf">perform_statistical_tests</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unique_groups</span><span class="p">,</span> <span class="n">is_normal</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform statistical tests separately for each data column.&quot;&quot;&quot;</span>
        <span class="n">test_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">:</span>  <span class="c1"># Iterate over each data column</span>
            <span class="n">grouped_data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span> <span class="o">==</span> <span class="n">group</span><span class="p">,</span> <span class="n">column</span><span class="p">]</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">unique_groups</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_groups</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># For two groups: class_0 vs class_1</span>
                <span class="k">if</span> <span class="n">is_normal</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">paired</span><span class="p">:</span>
                        <span class="n">stat</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">ttest</span><span class="p">(</span><span class="n">grouped_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">grouped_data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">paired</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][[</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;p-val&#39;</span><span class="p">]]</span>
                        <span class="n">test_name</span> <span class="o">=</span> <span class="s1">&#39;Paired T-test&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">stat</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ttest_ind</span><span class="p">(</span><span class="n">grouped_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">grouped_data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">test_name</span> <span class="o">=</span> <span class="s1">&#39;T-test&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">paired</span><span class="p">:</span>
                        <span class="n">stat</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">wilcoxon</span><span class="p">(</span><span class="n">grouped_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">grouped_data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][[</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;p-val&#39;</span><span class="p">]]</span>
                        <span class="n">test_name</span> <span class="o">=</span> <span class="s1">&#39;Paired Wilcoxon test&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">stat</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">grouped_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">grouped_data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">test_name</span> <span class="o">=</span> <span class="s1">&#39;Mann-Whitney U test&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">is_normal</span><span class="p">:</span>
                    <span class="n">stat</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">f_oneway</span><span class="p">(</span><span class="o">*</span><span class="n">grouped_data</span><span class="p">)</span>
                    <span class="n">test_name</span> <span class="o">=</span> <span class="s1">&#39;One-way ANOVA&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">stat</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">kruskal</span><span class="p">(</span><span class="o">*</span><span class="n">grouped_data</span><span class="p">)</span>
                    <span class="n">test_name</span> <span class="o">=</span> <span class="s1">&#39;Kruskal-Wallis test&#39;</span>

            <span class="n">test_results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;Comparison&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">unique_groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> vs </span><span class="si">{</span><span class="n">unique_groups</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Test Statistic&#39;</span><span class="p">:</span> <span class="n">stat</span><span class="p">,</span>
                <span class="s1">&#39;p-value&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">,</span>
                <span class="s1">&#39;Test Name&#39;</span><span class="p">:</span> <span class="n">test_name</span><span class="p">,</span>
                <span class="s1">&#39;Column&#39;</span><span class="p">:</span> <span class="n">column</span><span class="p">,</span>
                <span class="s1">&#39;n_object&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">grouped_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">grouped_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                <span class="s1">&#39;n_well&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span> <span class="o">==</span> <span class="n">unique_groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="o">+</span> 
                          <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span> <span class="o">==</span> <span class="n">unique_groups</span><span class="p">[</span><span class="mi">1</span><span class="p">]])})</span>

        <span class="k">return</span> <span class="n">test_results</span></div>

    
<div class="viewcode-block" id="spacrGraph.perform_posthoc_tests">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.perform_posthoc_tests">[docs]</a>
    <span class="k">def</span> <span class="nf">perform_posthoc_tests</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_normal</span><span class="p">,</span> <span class="n">unique_groups</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform post-hoc tests for multiple groups based on all_to_all flag.&quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">.sp_stats</span> <span class="kn">import</span> <span class="n">choose_p_adjust_method</span>

        <span class="n">posthoc_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">is_normal</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_groups</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_to_all</span><span class="p">:</span>
            <span class="n">tukey_result</span> <span class="o">=</span> <span class="n">pairwise_tukeyhsd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
            <span class="n">posthoc_results</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">comparison</span><span class="p">,</span> <span class="n">p_value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tukey_result</span><span class="o">.</span><span class="n">_results_table</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">tukey_result</span><span class="o">.</span><span class="n">pvalues</span><span class="p">):</span>
                <span class="n">raw_data1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span> <span class="o">==</span> <span class="n">comparison</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">]</span>
                <span class="n">raw_data2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span> <span class="o">==</span> <span class="n">comparison</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">]</span>

                <span class="n">posthoc_results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;Comparison&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">comparison</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> vs </span><span class="si">{</span><span class="n">comparison</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;Test Statistic&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Tukey does not provide a test statistic</span>
                    <span class="s1">&#39;p-value&#39;</span><span class="p">:</span> <span class="n">p_value</span><span class="p">,</span>
                    <span class="s1">&#39;Test Name&#39;</span><span class="p">:</span> <span class="s1">&#39;Tukey HSD Post-hoc&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;n_object&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw_data1</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw_data2</span><span class="p">),</span>
                    <span class="s1">&#39;n_well&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span> <span class="o">==</span> <span class="n">comparison</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span> <span class="o">==</span> <span class="n">comparison</span><span class="p">[</span><span class="mi">1</span><span class="p">]])})</span>
            <span class="k">return</span> <span class="n">posthoc_results</span>
        
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_groups</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_to_all</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;performing_dunns&#39;</span><span class="p">)</span>

            <span class="c1"># Prepare data for Dunn&#39;s test in long format</span>
            <span class="n">long_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

            <span class="n">p_adjust_method</span> <span class="o">=</span> <span class="n">choose_p_adjust_method</span><span class="p">(</span><span class="n">num_groups</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">long_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()),</span><span class="n">num_data_points</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">long_data</span><span class="p">)</span> <span class="o">//</span> <span class="nb">len</span><span class="p">(</span><span class="n">long_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>

            <span class="c1"># Perform Dunn&#39;s test with Bonferroni correction</span>
            <span class="n">dunn_result</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">posthoc_dunn</span><span class="p">(</span>
                <span class="n">long_data</span><span class="p">,</span> 
                <span class="n">val_col</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                <span class="n">group_col</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">,</span> 
                <span class="n">p_adjust</span><span class="o">=</span><span class="n">p_adjust_method</span>
            <span class="p">)</span>

            <span class="k">for</span> <span class="n">group_a</span><span class="p">,</span> <span class="n">group_b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">triu_indices_from</span><span class="p">(</span><span class="n">dunn_result</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)):</span>
                <span class="n">raw_data1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span> <span class="o">==</span> <span class="n">dunn_result</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">group_a</span><span class="p">]][</span><span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">]</span>
                <span class="n">raw_data2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span> <span class="o">==</span> <span class="n">dunn_result</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">group_b</span><span class="p">]][</span><span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">]</span>

                <span class="n">posthoc_results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;Comparison&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dunn_result</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">group_a</span><span class="p">]</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">dunn_result</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">group_b</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="s1">&#39;Test Statistic&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Dunn&#39;s test does not return a specific test statistic</span>
                    <span class="s1">&#39;p-value&#39;</span><span class="p">:</span> <span class="n">dunn_result</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">group_a</span><span class="p">,</span> <span class="n">group_b</span><span class="p">],</span>  <span class="c1"># Extract the p-value from the matrix</span>
                    <span class="s1">&#39;Test Name&#39;</span><span class="p">:</span> <span class="s2">&quot;Dunn&#39;s Post-hoc&quot;</span><span class="p">,</span>
                    <span class="s1">&#39;p_adjust_method&#39;</span><span class="p">:</span> <span class="n">p_adjust_method</span><span class="p">,</span>
                    <span class="s1">&#39;n_object&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw_data1</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw_data2</span><span class="p">),</span>  <span class="c1"># Total objects</span>
                    <span class="s1">&#39;n_well&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span> <span class="o">==</span> <span class="n">dunn_result</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">group_a</span><span class="p">]])</span> <span class="o">+</span>
                            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span> <span class="o">==</span> <span class="n">dunn_result</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">group_b</span><span class="p">])})</span>

            <span class="k">return</span> <span class="n">posthoc_results</span>

        <span class="k">return</span> <span class="n">posthoc_results</span></div>

    
<div class="viewcode-block" id="spacrGraph.create_plot">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.create_plot">[docs]</a>
    <span class="k">def</span> <span class="nf">create_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create and display the plot based on the chosen graph type.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">_generate_tabels</span><span class="p">(</span><span class="n">unique_groups</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Generate row labels and a symbol table for multi-level grouping.&quot;&quot;&quot;</span>
            <span class="c1"># Create row labels: Include the grouping column and data columns</span>
            <span class="n">row_labels</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_column</span>

            <span class="c1"># Initialize table data</span>
            <span class="n">table_data</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># Create the grouping row: Alternate each group for every data column</span>
            <span class="n">grouping_row</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">unique_groups</span><span class="p">:</span>
                    <span class="n">grouping_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
            <span class="n">table_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grouping_row</span><span class="p">)</span>  <span class="c1"># Add the grouping row to the table</span>

            <span class="c1"># Create symbol rows for each data column</span>
            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">:</span>
                <span class="n">column_row</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Initialize a row for this column</span>
                <span class="k">for</span> <span class="n">data_col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">:</span>  <span class="c1"># Iterate over data columns to align with the structure</span>
                    <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">unique_groups</span><span class="p">:</span>
                        <span class="c1"># Assign &#39;+&#39; if the column matches, otherwise assign &#39;-&#39;</span>
                        <span class="k">if</span> <span class="n">column</span> <span class="o">==</span> <span class="n">data_col</span><span class="p">:</span>
                            <span class="n">column_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">column_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
                <span class="n">table_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">column_row</span><span class="p">)</span>  <span class="c1"># Add this row to the table</span>

            <span class="c1"># Transpose the table to align with the plot layout</span>
            <span class="n">transposed_table</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">table_data</span><span class="p">)))</span>
            <span class="k">return</span> <span class="n">row_labels</span><span class="p">,</span> <span class="n">transposed_table</span>


        <span class="k">def</span> <span class="nf">_place_symbols</span><span class="p">(</span><span class="n">row_labels</span><span class="p">,</span> <span class="n">transposed_table</span><span class="p">,</span> <span class="n">x_positions</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Places symbols and row labels aligned under the bars or jitter points on the graph.</span>
<span class="sd">            </span>
<span class="sd">            Parameters:</span>
<span class="sd">            - row_labels: List of row titles to be displayed along the y-axis.</span>
<span class="sd">            - transposed_table: Data to be placed under each bar/jitter as symbols.</span>
<span class="sd">            - x_positions: X-axis positions for each group to align the symbols.</span>
<span class="sd">            - ax: The matplotlib Axes object where the plot is drawn.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># Get plot dimensions and adjust for different plot sizes</span>
            <span class="n">y_axis_min</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Minimum y-axis value (usually 0)</span>
            <span class="n">symbol_start_y</span> <span class="o">=</span> <span class="n">y_axis_min</span> <span class="o">-</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_axis_min</span><span class="p">)</span>  <span class="c1"># Adjust a bit below the x-axis</span>

            <span class="c1"># Calculate spacing for the table rows (adjust as needed)</span>
            <span class="n">y_spacing</span> <span class="o">=</span> <span class="mf">0.04</span>  <span class="c1"># Adjust this for better spacing between rows</span>

            <span class="c1"># Determine the leftmost x-position for row labels (align with the y-axis)</span>
            <span class="n">label_x_pos</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.3</span>  <span class="c1"># Adjust offset from the y-axis</span>

            <span class="c1"># Place row labels vertically aligned with symbols</span>
            <span class="k">for</span> <span class="n">row_idx</span><span class="p">,</span> <span class="n">title</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row_labels</span><span class="p">):</span>
                <span class="n">y_pos</span> <span class="o">=</span> <span class="n">symbol_start_y</span> <span class="o">-</span> <span class="p">(</span><span class="n">row_idx</span> <span class="o">*</span> <span class="n">y_spacing</span><span class="p">)</span>  <span class="c1"># Calculate vertical position for each label</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">label_x_pos</span><span class="p">,</span> <span class="n">y_pos</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;regular&#39;</span><span class="p">)</span>

            <span class="c1"># Place symbols under each bar or jitter point based on x-positions</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">x_pos</span><span class="p">,</span> <span class="n">column_data</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x_positions</span><span class="p">,</span> <span class="n">transposed_table</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">row_idx</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">column_data</span><span class="p">):</span>
                    <span class="n">y_pos</span> <span class="o">=</span> <span class="n">symbol_start_y</span> <span class="o">-</span> <span class="p">(</span><span class="n">row_idx</span> <span class="o">*</span> <span class="n">y_spacing</span><span class="p">)</span>  <span class="c1"># Adjust vertical spacing for symbols</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_pos</span><span class="p">,</span> <span class="n">y_pos</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;regular&#39;</span><span class="p">)</span>

            <span class="c1"># Redraw to apply changes</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
                    
        <span class="k">def</span> <span class="nf">_get_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span><span class="s1">&#39;jitter_bar&#39;</span><span class="p">]:</span> 
                <span class="n">x_positions</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bar</span><span class="o">.</span><span class="n">get_paths</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">vertices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">collections</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">bar</span><span class="p">,</span> <span class="s1">&#39;get_paths&#39;</span><span class="p">)]</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_type</span> <span class="o">==</span> <span class="s1">&#39;violin&#39;</span><span class="p">:</span>
                <span class="n">x_positions</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">violin</span><span class="o">.</span><span class="n">get_paths</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">vertices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">violin</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">collections</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">violin</span><span class="p">,</span> <span class="s1">&#39;get_paths&#39;</span><span class="p">)]</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">,</span> <span class="s1">&#39;jitter_box&#39;</span><span class="p">]:</span>
                <span class="n">x_positions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">get_xdata</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">lines</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">get_linestyle</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">))</span>                

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_type</span> <span class="o">==</span> <span class="s1">&#39;jitter&#39;</span><span class="p">:</span> 
                <span class="n">x_positions</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">collection</span><span class="o">.</span><span class="n">get_offsets</span><span class="p">()[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">collections</span> <span class="k">if</span> <span class="n">collection</span><span class="o">.</span><span class="n">get_offsets</span><span class="p">()</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
            
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="s1">&#39;line_std&#39;</span><span class="p">]:</span>
                <span class="n">x_positions</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="k">return</span> <span class="n">x_positions</span>
        
        <span class="k">def</span> <span class="nf">_draw_comparison_lines</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">x_positions</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Draw comparison lines and annotate significance based on results_df.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">results_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No comparisons available to annotate.&quot;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="n">y_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">bar</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span> <span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">patches</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">*</span> <span class="mf">1.3</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">group1</span><span class="p">,</span> <span class="n">group2</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Comparison&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; vs &#39;</span><span class="p">)</span>
                <span class="n">p_value</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;p-value&#39;</span><span class="p">]</span>

                <span class="c1"># Determine significance marker</span>
                <span class="k">if</span> <span class="n">p_value</span> <span class="o">&lt;=</span> <span class="mf">0.001</span><span class="p">:</span>
                    <span class="n">signiresults_namecance</span> <span class="o">=</span> <span class="s1">&#39;***&#39;</span>
                <span class="k">elif</span> <span class="n">p_value</span> <span class="o">&lt;=</span> <span class="mf">0.01</span><span class="p">:</span>
                    <span class="n">significance</span> <span class="o">=</span> <span class="s1">&#39;**&#39;</span>
                <span class="k">elif</span> <span class="n">p_value</span> <span class="o">&lt;=</span> <span class="mf">0.05</span><span class="p">:</span>
                    <span class="n">significance</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">significance</span> <span class="o">=</span> <span class="s1">&#39;ns&#39;</span>

                <span class="c1"># Find the x positions of the compared groups</span>
                <span class="n">x1</span> <span class="o">=</span> <span class="n">x_positions</span><span class="p">[</span><span class="n">unique_groups</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">group1</span><span class="p">)]</span>
                <span class="n">x2</span> <span class="o">=</span> <span class="n">x_positions</span><span class="p">[</span><span class="n">unique_groups</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">group2</span><span class="p">)]</span>

                <span class="c1"># Stagger lines to avoid overlap</span>
                <span class="n">line_y</span> <span class="o">=</span> <span class="n">y_max</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">y_max</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

                <span class="c1"># Draw the comparison line</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x2</span><span class="p">],</span> <span class="p">[</span><span class="n">line_y</span> <span class="o">-</span> <span class="mf">0.02</span><span class="p">,</span> <span class="n">line_y</span><span class="p">,</span> <span class="n">line_y</span><span class="p">,</span> <span class="n">line_y</span> <span class="o">-</span> <span class="mf">0.02</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

                <span class="c1"># Add the significance marker</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="n">x1</span> <span class="o">+</span> <span class="n">x2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">line_y</span><span class="p">,</span> <span class="n">significance</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

        <span class="c1"># Optional: Remove outliers for plotting</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_outliers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_outliers_from_plot</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df_melted</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">],</span> <span class="n">value_vars</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">,</span><span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;Data Column&#39;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
        <span class="n">unique_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="n">is_normal</span><span class="p">,</span> <span class="n">normality_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">perform_normality_tests</span><span class="p">()</span>
        <span class="n">is_normal</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">levene_stat</span><span class="p">,</span> <span class="n">levene_p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">perform_levene_test</span><span class="p">(</span><span class="n">unique_groups</span><span class="p">)</span>
        <span class="n">test_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">perform_statistical_tests</span><span class="p">(</span><span class="n">unique_groups</span><span class="p">,</span> <span class="n">is_normal</span><span class="p">)</span>
        <span class="n">posthoc_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">perform_posthoc_tests</span><span class="p">(</span><span class="n">is_normal</span><span class="p">,</span> <span class="n">unique_groups</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">normality_results</span> <span class="o">+</span> <span class="n">test_results</span> <span class="o">+</span> <span class="n">posthoc_results</span><span class="p">)</span>

        <span class="n">num_groups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">)</span>
        <span class="n">num_data_columns</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bar_width</span> <span class="o">=</span> <span class="mf">0.4</span>
        <span class="n">spacing_between_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bar_width</span><span class="o">/</span><span class="mf">0.5</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig_width</span> <span class="o">=</span> <span class="p">(</span><span class="n">num_groups</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">bar_width</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">spacing_between_groups</span> <span class="o">*</span> <span class="n">num_groups</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_width</span><span class="o">/</span><span class="mi">2</span>
        
        <span class="k">if</span>  <span class="bp">self</span><span class="o">.</span><span class="n">graph_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">,</span><span class="s1">&#39;line_std&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig_height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_width</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span> 

        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_width</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hue</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">jitter_bar_dodge</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hue</span><span class="o">=</span><span class="s1">&#39;Data Column&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">jitter_bar_dodge</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="c1"># Handle the different plot types based on `graph_type`</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_type</span> <span class="o">==</span> <span class="s1">&#39;bar&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_bar_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_type</span> <span class="o">==</span> <span class="s1">&#39;jitter&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_jitter_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_type</span> <span class="o">==</span> <span class="s1">&#39;box&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_box_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_type</span> <span class="o">==</span> <span class="s1">&#39;violin&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_violin_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_type</span> <span class="o">==</span> <span class="s1">&#39;jitter_box&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_jitter_box_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_type</span> <span class="o">==</span> <span class="s1">&#39;jitter_bar&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_jitter_bar_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_type</span> <span class="o">==</span> <span class="s1">&#39;line&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_line_graph</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_type</span> <span class="o">==</span> <span class="s1">&#39;line_std&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_line_with_std_area</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown graph type: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">graph_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> 
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">num_groups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_standerdize_figure_format</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">num_groups</span><span class="o">=</span><span class="n">num_groups</span><span class="p">,</span> <span class="n">graph_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">graph_type</span><span class="p">)</span>

        <span class="c1"># Set y-axis start</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_lim</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_lim</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_lim</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Data Column&#39;</span><span class="p">)</span> <span class="c1"># Move the legend outside the plot</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">,</span><span class="s1">&#39;line_std&#39;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="n">x_positions</span> <span class="o">=</span> <span class="n">_get_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">,</span><span class="s1">&#39;line_std&#39;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">,</span><span class="s1">&#39;line_std&#39;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
            <span class="n">legend_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.62</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>  <span class="c1"># Position the table closer to the graph</span>
            <span class="n">legend_ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>

            <span class="n">row_labels</span><span class="p">,</span> <span class="n">table_data</span> <span class="o">=</span> <span class="n">_generate_tabels</span><span class="p">(</span><span class="n">unique_groups</span><span class="p">)</span>
            <span class="n">_place_symbols</span><span class="p">(</span><span class="n">row_labels</span><span class="p">,</span> <span class="n">table_data</span><span class="p">,</span> <span class="n">x_positions</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>
            
        <span class="c1">#_draw_comparison_lines(ax, x_positions)    </span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_results</span><span class="p">()</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.12</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_standerdize_figure_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">num_groups</span><span class="p">,</span> <span class="n">graph_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adjusts the figure layout (size, bar width, jitter, and spacing) based on the number of groups.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        - ax: The matplotlib Axes object.</span>
<span class="sd">        - num_groups: Number of unique groups.</span>
<span class="sd">        - graph_type: The type of graph (e.g., &#39;bar&#39;, &#39;jitter&#39;, &#39;box&#39;, etc.).</span>

<span class="sd">        Returns:</span>
<span class="sd">        - None. Modifies the figure and Axes in place.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">graph_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="s1">&#39;line_std&#39;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Skipping layout adjustment for line graphs.&quot;</span><span class="p">)</span>
            <span class="k">return</span>  <span class="c1"># Skip layout adjustment for line graphs</span>
        
        <span class="n">correction_factor</span> <span class="o">=</span> <span class="mi">4</span>

        <span class="c1"># Set figure size to ensure it remains square with a minimum size</span>
        <span class="n">fig_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">num_groups</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>  <span class="o">/</span> <span class="n">correction_factor</span>
        
        <span class="k">if</span> <span class="n">fig_size</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">fig_size</span> <span class="o">=</span> <span class="mi">10</span>
        
        
        <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">fig_size</span><span class="p">,</span> <span class="n">fig_size</span><span class="p">)</span>

        <span class="c1"># Configure layout based on the number of groups</span>
        <span class="n">bar_width</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.5</span> <span class="o">/</span> <span class="n">num_groups</span><span class="p">)</span> <span class="o">/</span> <span class="n">correction_factor</span>
        <span class="n">jitter_amount</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span> <span class="o">/</span> <span class="n">num_groups</span><span class="p">)</span> <span class="o">/</span> <span class="n">correction_factor</span>
        <span class="n">jitter_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">50</span> <span class="o">/</span> <span class="n">num_groups</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

        <span class="c1"># Adjust axis limits to ensure bars are centered with respect to group labels</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">num_groups</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>

        <span class="c1"># Set ticks to match the group labels in your DataFrame</span>
        <span class="c1">#group_labels = self.df[self.grouping_column].unique()</span>
        <span class="c1">#group_labels = self.order</span>
        <span class="c1">#ax.set_xticks(range(len(group_labels)))</span>
        <span class="c1">#ax.set_xticklabels(group_labels, rotation=45, ha=&#39;right&#39;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>

        <span class="c1"># Customize elements based on the graph type</span>
        <span class="k">if</span> <span class="n">graph_type</span> <span class="o">==</span> <span class="s1">&#39;bar&#39;</span><span class="p">:</span>
            <span class="c1"># Adjust bars&#39; width and position</span>
            <span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">patches</span><span class="p">:</span>
                <span class="n">bar</span><span class="o">.</span><span class="n">set_width</span><span class="p">(</span><span class="n">bar_width</span><span class="p">)</span>
                <span class="n">bar</span><span class="o">.</span><span class="n">set_x</span><span class="p">(</span><span class="n">bar</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span> <span class="o">-</span> <span class="n">bar_width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">graph_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;jitter&#39;</span><span class="p">,</span> <span class="s1">&#39;jitter_bar&#39;</span><span class="p">,</span> <span class="s1">&#39;jitter_box&#39;</span><span class="p">]:</span>
            <span class="c1"># Adjust jitter points&#39; position and size</span>
            <span class="k">for</span> <span class="n">coll</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">collections</span><span class="p">:</span>
                <span class="n">offsets</span> <span class="o">=</span> <span class="n">coll</span><span class="o">.</span><span class="n">get_offsets</span><span class="p">()</span>
                <span class="n">offsets</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">jitter_amount</span>  <span class="c1"># Shift jitter points slightly</span>
                <span class="n">coll</span><span class="o">.</span><span class="n">set_offsets</span><span class="p">(</span><span class="n">offsets</span><span class="p">)</span>
                <span class="n">coll</span><span class="o">.</span><span class="n">set_sizes</span><span class="p">([</span><span class="n">jitter_size</span><span class="p">]</span>  <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">offsets</span><span class="p">))</span>  <span class="c1"># Adjust point size dynamically</span>

        <span class="k">elif</span> <span class="n">graph_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">,</span> <span class="s1">&#39;violin&#39;</span><span class="p">]:</span>
            <span class="c1"># Adjust box width for consistent spacing</span>
            <span class="k">for</span> <span class="n">artist</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">artists</span><span class="p">:</span>
                <span class="n">artist</span><span class="o">.</span><span class="n">set_width</span><span class="p">(</span><span class="n">bar_width</span><span class="p">)</span>

        <span class="c1"># Adjust legend and axis labels</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span> <span class="o">-</span> <span class="n">num_groups</span> <span class="o">//</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span> <span class="o">-</span> <span class="n">num_groups</span> <span class="o">//</span> <span class="mi">2</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">():</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">set_bbox_to_anchor</span><span class="p">((</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="c1">#loc=&#39;upper left&#39;,borderaxespad=0.</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">prop</span><span class="o">.</span><span class="n">set_size</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">12</span> <span class="o">-</span> <span class="n">num_groups</span> <span class="o">//</span> <span class="mi">3</span><span class="p">))</span>

        <span class="c1"># Redraw the figure to apply changes</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">_create_bar_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper method to create a bar plot with consistent bar thickness and centered error bars.&quot;&quot;&quot;</span>
        <span class="c1"># Flatten DataFrame: Combine grouping column and data column into one group if needed</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df_melted</span><span class="p">[</span><span class="s1">&#39;Combined Group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_melted</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; - &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_melted</span><span class="p">[</span><span class="s1">&#39;Data Column&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span>
            <span class="n">x_axis_column</span> <span class="o">=</span> <span class="s1">&#39;Combined Group&#39;</span>
            <span class="n">hue</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_axis_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">hue</span> <span class="o">=</span> <span class="kc">None</span>
    
        <span class="n">summary_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_melted</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">x_axis_column</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">),</span><span class="n">std</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">),</span><span class="n">sem</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="s1">&#39;sem&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">error_bars</span> <span class="o">=</span> <span class="n">summary_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">error_bar_type</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_bar_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="s1">&#39;sem&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">df_melted</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x_axis_column</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hue</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sns_palette</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">dodge</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">jitter_bar_dodge</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>
        
        <span class="c1"># Adjust the bar width manually</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">bars</span> <span class="o">=</span> <span class="p">[</span><span class="n">bar</span> <span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">patches</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bar</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">)]</span>
            <span class="n">target_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bar_width</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">bars</span><span class="p">:</span>
                <span class="n">bar</span><span class="o">.</span><span class="n">set_width</span><span class="p">(</span><span class="n">target_width</span><span class="p">)</span>  <span class="c1"># Set new width</span>
                <span class="c1"># Center the bar on its x-coordinate</span>
                <span class="n">bar</span><span class="o">.</span><span class="n">set_x</span><span class="p">(</span><span class="n">bar</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span> <span class="o">-</span> <span class="n">target_width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            
        <span class="c1"># Adjust error bars alignment with bars</span>
        <span class="n">bars</span> <span class="o">=</span> <span class="p">[</span><span class="n">bar</span> <span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">patches</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bar</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">bar</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bars</span><span class="p">,</span> <span class="n">summary_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()):</span>
            <span class="n">x_bar</span> <span class="o">=</span> <span class="n">bar</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span> <span class="o">+</span> <span class="n">bar</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">err</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">error_bar_type</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_bar</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">bar</span><span class="o">.</span><span class="n">get_height</span><span class="p">(),</span> <span class="n">yerr</span><span class="o">=</span><span class="n">err</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    
        <span class="c1"># Set legend and labels</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_y</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_x</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_jitter_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper method to create a jitter plot (strip plot) with consistent spacing.&quot;&quot;&quot;</span>
        <span class="c1"># Combine grouping column and data column if needed</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df_melted</span><span class="p">[</span><span class="s1">&#39;Combined Group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_melted</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>  <span class="o">+</span> <span class="s2">&quot; - &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_melted</span><span class="p">[</span><span class="s1">&#39;Data Column&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span>
            <span class="n">x_axis_column</span> <span class="o">=</span> <span class="s1">&#39;Combined Group&#39;</span>
            <span class="n">hue</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Disable hue to avoid two-level grouping</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_axis_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">hue</span> <span class="o">=</span> <span class="kc">None</span>
    
        <span class="c1"># Create the jitter plot</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">df_melted</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">x_axis_column</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span><span class="n">hue</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hue</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sns_palette</span><span class="p">,</span> <span class="n">dodge</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">jitter_bar_dodge</span><span class="p">,</span> <span class="n">jitter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bar_width</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>
    
        <span class="c1"># Adjust legend and labels</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">)</span>
       
        <span class="c1"># Manage the legend</span>
        <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
        <span class="n">unique_labels</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">handles</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">unique_labels</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">unique_labels</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_y</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_x</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_line_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper method to create a line graph with one line per group based on epochs and accuracy.&quot;&quot;&quot;</span>
        <span class="c1">#display(self.df)</span>
        <span class="c1"># Ensure epoch is used on the x-axis and accuracy on the y-axis</span>
        <span class="n">x_axis_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y_axis_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_y</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">y_axis_column</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">y_axis_column</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_x</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">x_axis_column</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">x_axis_column</span><span class="p">])</span>
        
        <span class="c1"># Set hue to the grouping column to get one line per group</span>
        <span class="n">hue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span>

        <span class="c1"># Check if the required columns exist in the DataFrame</span>
        <span class="n">required_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">x_axis_column</span><span class="p">,</span> <span class="n">y_axis_column</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">required_columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column &#39;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&#39; not found in DataFrame.&quot;</span><span class="p">)</span>

        <span class="c1"># Create the line graph with one line per group</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">x_axis_column</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y_axis_column</span><span class="p">,</span><span class="n">hue</span><span class="o">=</span><span class="n">hue</span><span class="p">,</span><span class="n">palette</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sns_palette</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

        <span class="c1"># Adjust axis labels</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x_axis_column</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">y_axis_column</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_line_with_std_area</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper method to create a line graph with shaded area representing standard deviation.&quot;&quot;&quot;</span>

        <span class="n">x_axis_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y_axis_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">y_axis_column_mean</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;mean_</span><span class="si">{</span><span class="n">y_axis_column</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">y_axis_column_std</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;std_</span><span class="si">{</span><span class="n">y_axis_column_mean</span><span class="si">}</span><span class="s2">&quot;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_y</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">y_axis_column</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">y_axis_column</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_x</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">x_axis_column</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">x_axis_column</span><span class="p">])</span>

        <span class="c1"># Pivot the DataFrame to get mean and std for each epoch across plates</span>
        <span class="n">summary_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">x_axis_column</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="n">y_axis_column</span><span class="p">,</span><span class="n">aggfunc</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        
        <span class="c1"># Flatten MultiIndex columns (result of pivoting)</span>
        <span class="n">summary_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">x_axis_column</span><span class="p">,</span> <span class="n">y_axis_column_mean</span><span class="p">,</span> <span class="n">y_axis_column_std</span><span class="p">]</span>
            
        <span class="c1"># Plot the mean accuracy as a line</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">summary_df</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">x_axis_column</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y_axis_column_mean</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">y_axis_column_mean</span><span class="p">)</span>


        <span class="c1"># Fill the area representing the standard deviation</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">summary_df</span><span class="p">[</span><span class="n">x_axis_column</span><span class="p">],</span><span class="n">summary_df</span><span class="p">[</span><span class="n">y_axis_column_mean</span><span class="p">]</span> <span class="o">-</span> <span class="n">summary_df</span><span class="p">[</span><span class="n">y_axis_column_std</span><span class="p">],</span><span class="n">summary_df</span><span class="p">[</span><span class="n">y_axis_column_mean</span><span class="p">]</span> <span class="o">+</span> <span class="n">summary_df</span><span class="p">[</span><span class="n">y_axis_column_std</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>  <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span> <span class="p">)</span>

        <span class="c1"># Adjust axis labels</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x_axis_column</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">y_axis_column</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">_create_box_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper method to create a box plot with consistent spacing.&quot;&quot;&quot;</span>
        <span class="c1"># Combine grouping column and data column if needed</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df_melted</span><span class="p">[</span><span class="s1">&#39;Combined Group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_melted</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; - &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_melted</span><span class="p">[</span><span class="s1">&#39;Data Column&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span>
            <span class="n">x_axis_column</span> <span class="o">=</span> <span class="s1">&#39;Combined Group&#39;</span>
            <span class="n">hue</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_axis_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">hue</span> <span class="o">=</span> <span class="kc">None</span>
    
        <span class="c1"># Create the box plot</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">df_melted</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">x_axis_column</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span><span class="n">hue</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hue</span><span class="p">,</span><span class="n">palette</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sns_palette</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>
    
        <span class="c1"># Adjust legend and labels</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">)</span>

        <span class="c1"># Manage the legend</span>
        <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
        <span class="n">unique_labels</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">handles</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">unique_labels</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">unique_labels</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_y</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_x</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_create_violin_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper method to create a violin plot with consistent spacing.&quot;&quot;&quot;</span>
        <span class="c1"># Combine grouping column and data column if needed</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df_melted</span><span class="p">[</span><span class="s1">&#39;Combined Group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_melted</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; - &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_melted</span><span class="p">[</span><span class="s1">&#39;Data Column&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span>
            <span class="n">x_axis_column</span> <span class="o">=</span> <span class="s1">&#39;Combined Group&#39;</span>
            <span class="n">hue</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_axis_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">hue</span> <span class="o">=</span> <span class="kc">None</span>
    
        <span class="c1"># Create the violin plot</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">df_melted</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">x_axis_column</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hue</span><span class="p">,</span><span class="n">palette</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sns_palette</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>
    
        <span class="c1"># Adjust legend and labels</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
    
        <span class="c1"># Manage the legend</span>
        <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
        <span class="n">unique_labels</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">handles</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">unique_labels</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">unique_labels</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_y</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_x</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_jitter_bar_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper method to create a bar plot with consistent bar thickness and centered error bars.&quot;&quot;&quot;</span>
        <span class="c1"># Flatten DataFrame: Combine grouping column and data column into one group if needed</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df_melted</span><span class="p">[</span><span class="s1">&#39;Combined Group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_melted</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; - &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_melted</span><span class="p">[</span><span class="s1">&#39;Data Column&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span>
            <span class="n">x_axis_column</span> <span class="o">=</span> <span class="s1">&#39;Combined Group&#39;</span>
            <span class="n">hue</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_axis_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">hue</span> <span class="o">=</span> <span class="kc">None</span>
    
        <span class="n">summary_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_melted</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">x_axis_column</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">),</span><span class="n">std</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">),</span><span class="n">sem</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="s1">&#39;sem&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">error_bars</span> <span class="o">=</span> <span class="n">summary_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">error_bar_type</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_bar_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="s1">&#39;sem&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">df_melted</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x_axis_column</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hue</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sns_palette</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">dodge</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">jitter_bar_dodge</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">df_melted</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">x_axis_column</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span><span class="n">hue</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hue</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sns_palette</span><span class="p">,</span> <span class="n">dodge</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">jitter_bar_dodge</span><span class="p">,</span> <span class="n">jitter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bar_width</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>
        
        <span class="c1"># Adjust the bar width manually</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">bars</span> <span class="o">=</span> <span class="p">[</span><span class="n">bar</span> <span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">patches</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bar</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">)]</span>
            <span class="n">target_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bar_width</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">bars</span><span class="p">:</span>
                <span class="n">bar</span><span class="o">.</span><span class="n">set_width</span><span class="p">(</span><span class="n">target_width</span><span class="p">)</span>  <span class="c1"># Set new width</span>
                <span class="c1"># Center the bar on its x-coordinate</span>
                <span class="n">bar</span><span class="o">.</span><span class="n">set_x</span><span class="p">(</span><span class="n">bar</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span> <span class="o">-</span> <span class="n">target_width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            
        <span class="c1"># Adjust error bars alignment with bars</span>
        <span class="c1">#bars = [bar for bar in ax.patches if isinstance(bar, plt.Rectangle)]</span>
        <span class="c1">#for bar, (_, row) in zip(bars, summary_df.iterrows()):</span>
        <span class="c1">#    x_bar = bar.get_x() + bar.get_width() / 2</span>
        <span class="c1">#    err = row[self.error_bar_type]</span>
        <span class="c1">#    ax.errorbar(x=x_bar, y=bar.get_height(), yerr=err, fmt=&#39;none&#39;, c=&#39;black&#39;, capsize=5, lw=2)</span>
    
        <span class="c1"># Set legend and labels</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_y</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_x</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_jitter_box_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper method to create a box plot with consistent spacing.&quot;&quot;&quot;</span>
        <span class="c1"># Combine grouping column and data column if needed</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df_melted</span><span class="p">[</span><span class="s1">&#39;Combined Group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_melted</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; - &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_melted</span><span class="p">[</span><span class="s1">&#39;Data Column&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span>
            <span class="n">x_axis_column</span> <span class="o">=</span> <span class="s1">&#39;Combined Group&#39;</span>
            <span class="n">hue</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_axis_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_column</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">hue</span> <span class="o">=</span> <span class="kc">None</span>
    
        <span class="c1"># Create the box plot</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">df_melted</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">x_axis_column</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span><span class="n">hue</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hue</span><span class="p">,</span><span class="n">palette</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sns_palette</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">df_melted</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">x_axis_column</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span><span class="n">hue</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hue</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sns_palette</span><span class="p">,</span> <span class="n">dodge</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">jitter_bar_dodge</span><span class="p">,</span> <span class="n">jitter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bar_width</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>
    
        <span class="c1"># Adjust legend and labels</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_column</span><span class="p">)</span>

        <span class="c1"># Manage the legend</span>
        <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
        <span class="n">unique_labels</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">handles</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">unique_labels</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">unique_labels</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_y</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_x</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_save_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper method to save the plot and results.&quot;&quot;&quot;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plot_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">results_name</span><span class="si">}</span><span class="s2">.pdf&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plot_path</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">)</span>
        <span class="n">results_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">results_name</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">results_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plot saved to </span><span class="si">{</span><span class="n">plot_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test results saved to </span><span class="si">{</span><span class="n">results_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="spacrGraph.get_results">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.get_results">[docs]</a>
    <span class="k">def</span> <span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the results dataframe.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">results_df</span></div>

    
<div class="viewcode-block" id="spacrGraph.get_figure">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.spacrGraph.get_figure">[docs]</a>
    <span class="k">def</span> <span class="nf">get_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the generated figure.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span></div>
</div>


<div class="viewcode-block" id="plot_data_from_db">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.plot_data_from_db">[docs]</a>
<span class="k">def</span> <span class="nf">plot_data_from_db</span><span class="p">(</span><span class="n">settings</span><span class="p">):</span>
    
    <span class="kn">from</span> <span class="nn">.io</span> <span class="kn">import</span> <span class="n">_read_db</span><span class="p">,</span> <span class="n">_read_and_merge_data</span>
    <span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">annotate_conditions</span><span class="p">,</span> <span class="n">save_settings</span>
    <span class="kn">from</span> <span class="nn">.settings</span> <span class="kn">import</span> <span class="n">set_default_plot_data_from_db</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts the specified table from the SQLite database and plots a specified column.</span>

<span class="sd">    Args:</span>
<span class="sd">        db_path (str): The path to the SQLite database.</span>
<span class="sd">        table_names (str): The name of the table to extract.</span>
<span class="sd">        data_column (str): The column to plot from the table.</span>

<span class="sd">    Returns:</span>
<span class="sd">        df (pd.DataFrame): The extracted table as a DataFrame.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">settings</span> <span class="o">=</span> <span class="n">set_default_plot_data_from_db</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">srcs</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;src must be a string or a list of strings.&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;database&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;database&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;database&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">srcs</span><span class="p">))]</span>
    
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;dst&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">srcs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;results&#39;</span><span class="p">)</span>
    
    <span class="n">save_settings</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;graph_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">_plot_settings_db&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">src</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">srcs</span><span class="p">):</span>
        <span class="n">db_loc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="s1">&#39;measurements&#39;</span><span class="p">,</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;database&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database: </span><span class="si">{</span><span class="n">db_loc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;table_names&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;saliency_image_correlations&#39;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database table: </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;table_names&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="p">[</span><span class="n">df1</span><span class="p">]</span> <span class="o">=</span> <span class="n">_read_db</span><span class="p">(</span><span class="n">db_loc</span><span class="p">,</span> <span class="n">tables</span><span class="o">=</span><span class="p">[</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;table_names&#39;</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df1</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_read_and_merge_data</span><span class="p">(</span><span class="n">locs</span><span class="o">=</span><span class="p">[</span><span class="n">db_loc</span><span class="p">],</span>
                                    <span class="n">tables</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;table_names&#39;</span><span class="p">],</span>
                                    <span class="n">verbose</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;verbose&#39;</span><span class="p">],</span>
                                    <span class="n">nuclei_limit</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;nuclei_limit&#39;</span><span class="p">],</span>
                                    <span class="n">pathogen_limit</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pathogen_limit&#39;</span><span class="p">])</span>
            
        <span class="n">dft</span> <span class="o">=</span> <span class="n">annotate_conditions</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> 
                                <span class="n">cells</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;cell_types&#39;</span><span class="p">],</span> 
                                <span class="n">cell_loc</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;cell_plate_metadata&#39;</span><span class="p">],</span> 
                                <span class="n">pathogens</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pathogen_types&#39;</span><span class="p">],</span>
                                <span class="n">pathogen_loc</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pathogen_plate_metadata&#39;</span><span class="p">],</span>
                                <span class="n">treatments</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;treatments&#39;</span><span class="p">],</span> 
                                <span class="n">treatment_loc</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;treatment_plate_metadata&#39;</span><span class="p">])</span>
        <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dft</span><span class="p">)</span>
        
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;prc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;plateID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rowID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;columnID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;cell_plate_metadata&#39;</span><span class="p">]</span> <span class="o">!=</span>  <span class="kc">None</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;host_cell&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pathogen_plate_metadata&#39;</span><span class="p">]</span> <span class="o">!=</span>  <span class="kc">None</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;pathogen&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;treatment_plate_metadata&#39;</span><span class="p">]</span> <span class="o">!=</span>  <span class="kc">None</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;treatment&#39;</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;data_column&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;recruitment&#39;</span><span class="p">:</span>
        <span class="n">pahtogen_measurement</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;pathogen_channel_</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;channel_of_interest&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">_mean_intensity&quot;</span><span class="p">]</span>
        <span class="n">cytoplasm_measurement</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;cytoplasm_channel_</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;channel_of_interest&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">_mean_intensity&quot;</span><span class="p">]</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;recruitment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pahtogen_measurement</span> <span class="o">/</span> <span class="n">cytoplasm_measurement</span>
        
    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;data_column&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data column </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;data_column&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> not found in DataFrame.&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Please use one of the following columns:&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
        <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;data_column&#39;</span><span class="p">])</span>
        
    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;grouping_column&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Grouping column </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;grouping_column&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> not found in DataFrame.&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Please use one of the following columns:&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
        <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;grouping_column&#39;</span><span class="p">])</span>

    <span class="n">src</span> <span class="o">=</span> <span class="n">srcs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> 
    <span class="n">dst</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;graph_name&#39;</span><span class="p">])</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="n">spacr_graph</span> <span class="o">=</span> <span class="n">spacrGraph</span><span class="p">(</span>
        <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>                                       <span class="c1"># Your DataFrame</span>
        <span class="n">grouping_column</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;grouping_column&#39;</span><span class="p">],</span> <span class="c1"># Column for grouping the data (x-axis)</span>
        <span class="n">data_column</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;data_column&#39;</span><span class="p">],</span>         <span class="c1"># Column for the data (y-axis)</span>
        <span class="n">graph_type</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;graph_type&#39;</span><span class="p">],</span>           <span class="c1"># Type of plot (&#39;bar&#39;, &#39;box&#39;, &#39;violin&#39;, &#39;jitter&#39;)</span>
        <span class="n">graph_name</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;graph_name&#39;</span><span class="p">],</span>           <span class="c1"># Name of the plot</span>
        <span class="n">summary_func</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span>                         <span class="c1"># Function to summarize data (e.g., &#39;mean&#39;, &#39;median&#39;)</span>
        <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>                                 <span class="c1"># Custom colors for the plot (optional)</span>
        <span class="n">output_dir</span><span class="o">=</span><span class="n">dst</span><span class="p">,</span>                              <span class="c1"># Directory to save the plot and results</span>
        <span class="n">save</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;save&#39;</span><span class="p">],</span>                       <span class="c1"># Whether to save the plot and results</span>
        <span class="n">y_lim</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;y_lim&#39;</span><span class="p">],</span>                     <span class="c1"># Starting point for y-axis (optional)</span>
        <span class="n">error_bar_type</span><span class="o">=</span><span class="s1">&#39;std&#39;</span><span class="p">,</span>                        <span class="c1"># Type of error bar (&#39;std&#39; or &#39;sem&#39;)</span>
        <span class="n">representation</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;representation&#39;</span><span class="p">],</span>
        <span class="n">theme</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;theme&#39;</span><span class="p">],</span>                     <span class="c1"># Seaborn color palette theme (e.g., &#39;pastel&#39;, &#39;muted&#39;)</span>
    <span class="p">)</span>

    <span class="c1"># Create the plot</span>
    <span class="n">spacr_graph</span><span class="o">.</span><span class="n">create_plot</span><span class="p">()</span>

    <span class="c1"># Get the figure object if needed</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">spacr_graph</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Optional: Get the results DataFrame containing statistical test results</span>
    <span class="n">results_df</span> <span class="o">=</span> <span class="n">spacr_graph</span><span class="o">.</span><span class="n">get_results</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">results_df</span></div>


<div class="viewcode-block" id="plot_data_from_csv">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.plot_data_from_csv">[docs]</a>
<span class="k">def</span> <span class="nf">plot_data_from_csv</span><span class="p">(</span><span class="n">settings</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">.io</span> <span class="kn">import</span> <span class="n">_read_db</span><span class="p">,</span> <span class="n">_read_and_merge_data</span>
    <span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">annotate_conditions</span><span class="p">,</span> <span class="n">save_settings</span><span class="p">,</span> <span class="n">remove_outliers_by_group</span>
    <span class="kn">from</span> <span class="nn">.settings</span> <span class="kn">import</span> <span class="n">get_plot_data_from_csv_default_settings</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts the specified table from the SQLite database and plots a specified column.</span>

<span class="sd">    Args:</span>
<span class="sd">        db_path (str): The path to the SQLite database.</span>
<span class="sd">        table_names (str): The name of the table to extract.</span>
<span class="sd">        data_column (str): The column to plot from the table.</span>

<span class="sd">    Returns:</span>
<span class="sd">        df (pd.DataFrame): The extracted table as a DataFrame.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    

    <span class="k">def</span> <span class="nf">filter_rows_by_column_values</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">column</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a filtered DataFrame where only rows with the column value in the list are kept.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">values</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">srcs</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;src must be a string or a list of strings.&quot;</span><span class="p">)</span>
    
    <span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">src</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">srcs</span><span class="p">):</span>
        <span class="n">dft</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;plateID&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dft</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">dft</span><span class="p">[</span><span class="s1">&#39;plateID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;plate</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">dft</span><span class="p">[</span><span class="s1">&#39;common&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;spacr&#39;</span>
        <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dft</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="s1">&#39;prc&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="c1"># Check if &#39;plateID&#39;, &#39;rowID&#39;, and &#39;columnID&#39; are all missing from df.columns</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;plate&#39;</span><span class="p">,</span> <span class="s1">&#39;rowID&#39;</span><span class="p">,</span> <span class="s1">&#39;columnID&#39;</span><span class="p">]):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Split &#39;prc&#39; into &#39;plateID&#39;, &#39;rowID&#39;, and &#39;columnID&#39;</span>
                <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;plateID&#39;</span><span class="p">,</span> <span class="s1">&#39;rowID&#39;</span><span class="p">,</span> <span class="s1">&#39;columnID&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;prc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not split the prc column: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;keep_groups&#39;</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;keep_groups&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;keep_groups&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;keep_groups&#39;</span><span class="p">]]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;keep_groups&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">filter_rows_by_column_values</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;grouping_column&#39;</span><span class="p">],</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;keep_groups&#39;</span><span class="p">])</span>
            
    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;remove_outliers&#39;</span><span class="p">]:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">remove_outliers_by_group</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;grouping_column&#39;</span><span class="p">],</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;data_column&#39;</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;iqr&#39;</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;verbose&#39;</span><span class="p">]:</span>       
        <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;data_column&#39;</span><span class="p">])</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;grouping_column&#39;</span><span class="p">])</span>
    <span class="n">src</span> <span class="o">=</span> <span class="n">srcs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> 
    <span class="n">dst</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">src</span><span class="p">),</span> <span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;graph_name&#39;</span><span class="p">])</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1">#data_csv = os.path.join(dst, f&quot;{settings[&#39;graph_name&#39;]}_data.csv&quot;)</span>
    <span class="c1">#df.to_csv(data_csv, index=False)</span>
    
    <span class="n">spacr_graph</span> <span class="o">=</span> <span class="n">spacrGraph</span><span class="p">(</span>
        <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>                                       <span class="c1"># Your DataFrame</span>
        <span class="n">grouping_column</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;grouping_column&#39;</span><span class="p">],</span> <span class="c1"># Column for grouping the data (x-axis)</span>
        <span class="n">data_column</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;data_column&#39;</span><span class="p">],</span>         <span class="c1"># Column for the data (y-axis)</span>
        <span class="n">graph_type</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;graph_type&#39;</span><span class="p">],</span>           <span class="c1"># Type of plot (&#39;bar&#39;, &#39;box&#39;, &#39;violin&#39;, &#39;jitter&#39;)</span>
        <span class="n">graph_name</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;graph_name&#39;</span><span class="p">],</span>           <span class="c1"># Name of the plot</span>
        <span class="n">summary_func</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span>                         <span class="c1"># Function to summarize data (e.g., &#39;mean&#39;, &#39;median&#39;)</span>
        <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>                                 <span class="c1"># Custom colors for the plot (optional)</span>
        <span class="n">output_dir</span><span class="o">=</span><span class="n">dst</span><span class="p">,</span>                              <span class="c1"># Directory to save the plot and results</span>
        <span class="n">save</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;save&#39;</span><span class="p">],</span>                       <span class="c1"># Whether to save the plot and results</span>
        <span class="n">y_lim</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;y_lim&#39;</span><span class="p">],</span>                     <span class="c1"># Starting point for y-axis (optional)</span>
        <span class="n">log_y</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;log_y&#39;</span><span class="p">],</span>                     <span class="c1"># Log-transform the y-axis</span>
        <span class="n">log_x</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;log_x&#39;</span><span class="p">],</span>                     <span class="c1"># Log-transform the x-axis</span>
        <span class="n">error_bar_type</span><span class="o">=</span><span class="s1">&#39;std&#39;</span><span class="p">,</span>                        <span class="c1"># Type of error bar (&#39;std&#39; or &#39;sem&#39;)</span>
        <span class="n">representation</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;representation&#39;</span><span class="p">],</span>
        <span class="n">theme</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;theme&#39;</span><span class="p">],</span>                     <span class="c1"># Seaborn color palette theme (e.g., &#39;pastel&#39;, &#39;muted&#39;)</span>
    <span class="p">)</span>

    <span class="c1"># Create the plot</span>
    <span class="n">spacr_graph</span><span class="o">.</span><span class="n">create_plot</span><span class="p">()</span>

    <span class="c1"># Get the figure object if needed</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">spacr_graph</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Optional: Get the results DataFrame containing statistical test results</span>
    <span class="n">results_df</span> <span class="o">=</span> <span class="n">spacr_graph</span><span class="o">.</span><span class="n">get_results</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">results_df</span></div>


<div class="viewcode-block" id="plot_region">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.plot_region">[docs]</a>
<span class="k">def</span> <span class="nf">plot_region</span><span class="p">(</span><span class="n">settings</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">_sort_paths_by_basename</span><span class="p">(</span><span class="n">paths</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">path</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="nf">save_figure_as_pdf</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Create directory if it doesn&#39;t exist</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="kn">from</span> <span class="nn">.io</span> <span class="kn">import</span> <span class="n">_read_db</span>
    <span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">correct_paths</span>
    <span class="n">fov_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">],</span> <span class="s1">&#39;merged&#39;</span><span class="p">,</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="n">db_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">],</span> <span class="s1">&#39;measurements&#39;</span><span class="p">,</span> <span class="s1">&#39;measurements.db&#39;</span><span class="p">)</span>
    <span class="n">paths_df</span> <span class="o">=</span> <span class="n">_read_db</span><span class="p">(</span><span class="n">db_path</span><span class="p">,</span> <span class="n">tables</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;png_list&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">paths_df</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">correct_paths</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">paths_df</span><span class="p">,</span> <span class="n">base_path</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">],</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
    <span class="n">paths_df</span> <span class="o">=</span> <span class="n">paths_df</span><span class="p">[</span><span class="n">paths_df</span><span class="p">[</span><span class="s1">&#39;png_path&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>

    <span class="n">activation_mode</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;activation_mode&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">_list&quot;</span>
    <span class="n">activation_db_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">],</span> <span class="s1">&#39;measurements&#39;</span><span class="p">,</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;activation_db&#39;</span><span class="p">])</span>
    <span class="n">activation_paths_df</span> <span class="o">=</span> <span class="n">_read_db</span><span class="p">(</span><span class="n">activation_db_path</span><span class="p">,</span> <span class="n">tables</span><span class="o">=</span><span class="p">[</span><span class="n">activation_mode</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">activation_db</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;activation_db&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">base_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">],</span> <span class="s1">&#39;datasets&#39;</span><span class="p">,</span><span class="n">activation_db</span><span class="p">)</span> 
    <span class="n">activation_paths_df</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">correct_paths</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">activation_paths_df</span><span class="p">,</span> <span class="n">base_path</span><span class="o">=</span><span class="n">base_path</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;activation_mode&#39;</span><span class="p">])</span>
    <span class="n">activation_paths_df</span> <span class="o">=</span> <span class="n">activation_paths_df</span><span class="p">[</span><span class="n">activation_paths_df</span><span class="p">[</span><span class="s1">&#39;png_path&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>

    <span class="n">png_paths</span> <span class="o">=</span> <span class="n">_sort_paths_by_basename</span><span class="p">(</span><span class="n">paths_df</span><span class="p">[</span><span class="s1">&#39;png_path&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="n">activation_paths</span> <span class="o">=</span> <span class="n">_sort_paths_by_basename</span><span class="p">(</span><span class="n">activation_paths_df</span><span class="p">[</span><span class="s1">&#39;png_path&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

    
    <span class="k">if</span> <span class="n">activation_paths</span><span class="p">:</span>
        <span class="n">fig_3</span> <span class="o">=</span> <span class="n">plot_image_grid</span><span class="p">(</span><span class="n">image_paths</span><span class="o">=</span><span class="n">activation_paths</span><span class="p">,</span> <span class="n">percentiles</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;percentiles&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig_3</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find any cropped PNGs&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">png_paths</span><span class="p">:</span>
        <span class="n">fig_2</span> <span class="o">=</span> <span class="n">plot_image_grid</span><span class="p">(</span><span class="n">image_paths</span><span class="o">=</span><span class="n">png_paths</span><span class="p">,</span> <span class="n">percentiles</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;percentiles&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig_2</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find any activation maps&quot;</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;fov_path&#39;</span><span class="p">,</span> <span class="n">fov_path</span><span class="p">)</span>
    <span class="n">fig_1</span> <span class="o">=</span> <span class="n">plot_image_mask_overlay</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">fov_path</span><span class="p">,</span>
                                    <span class="n">channels</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;channels&#39;</span><span class="p">],</span>
                                    <span class="n">cell_channel</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;cell_channel&#39;</span><span class="p">],</span>
                                    <span class="n">nucleus_channel</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;nucleus_channel&#39;</span><span class="p">],</span>
                                    <span class="n">pathogen_channel</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pathogen_channel&#39;</span><span class="p">],</span>
                                    <span class="n">figuresize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                    <span class="n">percentiles</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;percentiles&#39;</span><span class="p">],</span>
                                    <span class="n">thickness</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> 
                                    <span class="n">save_pdf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                                    <span class="n">mode</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">],</span>
                                    <span class="n">export_tiffs</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;export_tiffs&#39;</span><span class="p">])</span>
    
    <span class="n">dst</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">],</span> <span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">fig_1</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">save_figure_as_pdf</span><span class="p">(</span><span class="n">fig_1</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_mask_overlay.pdf&quot;</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">fig_2</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">save_figure_as_pdf</span><span class="p">(</span><span class="n">fig_2</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_png_grid.pdf&quot;</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">fig_3</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">save_figure_as_pdf</span><span class="p">(</span><span class="n">fig_3</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_activation_grid.pdf&quot;</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">fig_1</span><span class="p">,</span> <span class="n">fig_2</span><span class="p">,</span> <span class="n">fig_3</span></div>


<div class="viewcode-block" id="plot_image_grid">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.plot_image_grid">[docs]</a>
<span class="k">def</span> <span class="nf">plot_image_grid</span><span class="p">(</span><span class="n">image_paths</span><span class="p">,</span> <span class="n">percentiles</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots a square grid of images from a list of image paths. </span>
<span class="sd">    Unused subplots are filled with black, and padding is minimized.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - image_paths: List of paths to images to be displayed.</span>

<span class="sd">    Returns:</span>
<span class="sd">    - fig: The generated matplotlib figure.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="kn">import</span> <span class="nn">math</span>

    <span class="k">def</span> <span class="nf">_normalize_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">percentiles</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">98</span><span class="p">)):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Normalize the image to the given percentiles for each channel independently, preserving the input type (either PIL.Image or numpy.ndarray).&quot;&quot;&quot;</span>
        
        <span class="c1"># Check if the input is a PIL image and convert it to a NumPy array</span>
        <span class="n">is_pil_image</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_pil_image</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="c1"># If the image is single-channel, normalize directly</span>
        <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">v_min</span><span class="p">,</span> <span class="n">v_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">percentiles</span><span class="p">)</span>
            <span class="n">normalized_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">((</span><span class="n">image</span> <span class="o">-</span> <span class="n">v_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">v_max</span> <span class="o">-</span> <span class="n">v_min</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If multi-channel, normalize each channel independently</span>
            <span class="n">normalized_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">v_min</span><span class="p">,</span> <span class="n">v_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">c</span><span class="p">],</span> <span class="n">percentiles</span><span class="p">)</span>
                <span class="n">normalized_image</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">((</span><span class="n">image</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span> <span class="o">-</span> <span class="n">v_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">v_max</span> <span class="o">-</span> <span class="n">v_min</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># If the input was a PIL image, convert the result back to PIL format</span>
        <span class="k">if</span> <span class="n">is_pil_image</span><span class="p">:</span>
            <span class="c1"># Ensure the image is converted back to 8-bit range (0-255) for PIL</span>
            <span class="n">normalized_image</span> <span class="o">=</span> <span class="p">(</span><span class="n">normalized_image</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">normalized_image</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">normalized_image</span>

    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">image_paths</span><span class="p">)</span>
    <span class="c1"># Calculate the smallest square grid size to fit all images</span>
    <span class="n">grid_size</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>  

    <span class="c1"># Create the square grid of subplots with a black background</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
        <span class="n">grid_size</span><span class="p">,</span> <span class="n">grid_size</span><span class="p">,</span> 
        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">grid_size</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">grid_size</span> <span class="o">*</span> <span class="mi">2</span><span class="p">),</span>
        <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span>  <span class="c1"># Set figure background to black</span>
    <span class="p">)</span>

    <span class="c1"># Flatten axs in case of a 2D array</span>
    <span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">img_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">image_paths</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="c1"># Load the image</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">_normalize_image</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">percentiles</span><span class="p">)</span>

        <span class="c1"># Display the image</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>  <span class="c1"># Hide axes</span>

    <span class="c1"># Fill any unused subplots with black</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">axs</span><span class="p">)):</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>  <span class="c1"># Black square</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>  <span class="c1"># Hide axes</span>

    <span class="c1"># Adjust layout to minimize white space</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="overlay_masks_on_images">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.overlay_masks_on_images">[docs]</a>
<span class="k">def</span> <span class="nf">overlay_masks_on_images</span><span class="p">(</span><span class="n">img_folder</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">resize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load images and masks from folders, overlay mask contours on images, and optionally normalize, resize, and save.</span>

<span class="sd">    Args:</span>
<span class="sd">        img_folder (str): Path to the folder containing images.</span>
<span class="sd">        mask_folder (str): Path to the folder containing masks.</span>
<span class="sd">        normalize (bool): If True, normalize images to the 1st and 99th percentiles.</span>
<span class="sd">        resize (bool): If True, resize the final overlay to 500x500.</span>
<span class="sd">        save (bool): If True, save the final overlay in an &#39;overlay&#39; folder within the image folder.</span>
<span class="sd">        thickness (int): Thickness of the contour lines.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">normalize_image</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Normalize the image to the 1st and 99th percentiles.&quot;&quot;&quot;</span>
        <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">99</span><span class="p">])</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">((</span><span class="n">image</span> <span class="o">-</span> <span class="n">lower</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">image</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

    
    <span class="n">mask_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">img_folder</span><span class="p">,</span><span class="s1">&#39;masks&#39;</span><span class="p">)</span>    
    <span class="n">overlay_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">img_folder</span><span class="p">,</span> <span class="s2">&quot;overlay&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">overlay_folder</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">overlay_folder</span><span class="p">)</span>

    <span class="c1"># Get common filenames in both image and mask folders</span>
    <span class="n">image_filenames</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">img_folder</span><span class="p">))</span>
    <span class="n">mask_filenames</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">mask_folder</span><span class="p">))</span>
    <span class="n">common_filenames</span> <span class="o">=</span> <span class="n">image_filenames</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">mask_filenames</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">common_filenames</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No matching filenames found in both folders.&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">common_filenames</span><span class="p">:</span>
        <span class="c1"># Load image and mask</span>
        <span class="n">img_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">img_folder</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="n">mask_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mask_folder</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

        <span class="n">image</span> <span class="o">=</span> <span class="n">tiff</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">tiff</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">mask_path</span><span class="p">)</span>

        <span class="c1"># Normalize the image if requested</span>
        <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">normalize_image</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="c1"># Ensure the mask is binary</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">mask</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

        <span class="c1"># Resize the mask if it doesn&#39;t match the image size</span>
        <span class="k">if</span> <span class="n">mask</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">INTER_NEAREST</span><span class="p">)</span>

        <span class="c1"># Generate contours from the mask</span>
        <span class="n">contours</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findContours</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">RETR_EXTERNAL</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CHAIN_APPROX_SIMPLE</span><span class="p">)</span>

        <span class="c1"># Convert to RGB if grayscale</span>
        <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">image_rgb</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_GRAY2RGB</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">image_rgb</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            
        <span class="c1"># Draw contours with alpha blending</span>
        <span class="n">overlay</span> <span class="o">=</span> <span class="n">image_rgb</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">drawContours</span><span class="p">(</span><span class="n">overlay</span><span class="p">,</span> <span class="n">contours</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">thickness</span><span class="p">)</span>
        <span class="n">blended</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">addWeighted</span><span class="p">(</span><span class="n">overlay</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="n">image_rgb</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        
        <span class="c1"># Resize the final overlay if requested</span>
        <span class="k">if</span> <span class="n">resize</span><span class="p">:</span>
            <span class="n">blended</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">blended</span><span class="p">,</span> <span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">INTER_AREA</span><span class="p">)</span>

        <span class="c1"># Save the overlay if requested</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">overlay_folder</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">blended</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_RGB2BGR</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="c1"># Display the result</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">blended</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Overlay: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="graph_importance">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.graph_importance">[docs]</a>
<span class="k">def</span> <span class="nf">graph_importance</span><span class="p">(</span><span class="n">settings</span><span class="p">):</span>
    
    <span class="kn">from</span> <span class="nn">.settings</span> <span class="kn">import</span> <span class="n">set_graph_importance_defaults</span>
    <span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">save_settings</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;csvs&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;csvs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;csvs&#39;</span><span class="p">]</span>
    
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;csvs&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="n">settings</span> <span class="o">=</span> <span class="n">set_graph_importance_defaults</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
    <span class="n">save_settings</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;graph_importance&#39;</span><span class="p">)</span>
    
    <span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;csvs&#39;</span><span class="p">]:</span>
        <span class="n">dft</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dft</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;grouping_column&#39;</span><span class="p">],</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;data_column&#39;</span><span class="p">])):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;grouping </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;grouping_column&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> and data </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;data_column&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> columns must be in </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    
    <span class="n">output_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;csvs&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="n">spacr_graph</span> <span class="o">=</span> <span class="n">spacrGraph</span><span class="p">(</span>
        <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>                                     
        <span class="n">grouping_column</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;grouping_column&#39;</span><span class="p">],</span>
        <span class="n">data_column</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;data_column&#39;</span><span class="p">],</span>   
        <span class="n">graph_type</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;graph_type&#39;</span><span class="p">],</span>   
        <span class="n">graph_name</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;grouping_column&#39;</span><span class="p">],</span>
        <span class="n">summary_func</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span>                         
        <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>                                
        <span class="n">output_dir</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span>                              
        <span class="n">save</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;save&#39;</span><span class="p">],</span>                       
        <span class="n">y_lim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>                     
        <span class="n">error_bar_type</span><span class="o">=</span><span class="s1">&#39;std&#39;</span><span class="p">,</span>                       
        <span class="n">representation</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">,</span>
        <span class="n">theme</span><span class="o">=</span><span class="s1">&#39;muted&#39;</span><span class="p">,</span>                    
    <span class="p">)</span>

    <span class="c1"># Create the plot</span>
    <span class="n">spacr_graph</span><span class="o">.</span><span class="n">create_plot</span><span class="p">()</span>

    <span class="c1"># Get the figure object if needed</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">spacr_graph</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

    
<div class="viewcode-block" id="plot_proportion_stacked_bars">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.plot_proportion_stacked_bars">[docs]</a>
<span class="k">def</span> <span class="nf">plot_proportion_stacked_bars</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">group_column</span><span class="p">,</span> <span class="n">bin_column</span><span class="p">,</span> <span class="n">prc_column</span><span class="o">=</span><span class="s1">&#39;prc&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a stacked bar plot for proportions and perform chi-squared and pairwise tests.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    - settings (dict): Analysis settings.</span>
<span class="sd">    - df (DataFrame): Input data.</span>
<span class="sd">    - group_column (str): Column indicating the groups.</span>
<span class="sd">    - bin_column (str): Column indicating the categories.</span>
<span class="sd">    - prc_column (str): Optional; column for additional stratification.</span>
<span class="sd">    - level (str): Level of aggregation (&#39;well&#39; or &#39;object&#39;).</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    - chi2 (float): Chi-squared statistic for the overall test.</span>
<span class="sd">    - p (float): p-value for the overall chi-squared test.</span>
<span class="sd">    - dof (int): Degrees of freedom for the overall chi-squared test.</span>
<span class="sd">    - expected (ndarray): Expected frequencies for the overall chi-squared test.</span>
<span class="sd">    - raw_counts (DataFrame): Contingency table of observed counts.</span>
<span class="sd">    - fig (Figure): The generated plot.</span>
<span class="sd">    - pairwise_results (list): Pairwise test results from `chi_pairwise`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="kn">from</span> <span class="nn">.sp_stats</span> <span class="kn">import</span> <span class="n">chi_pairwise</span>
    
    <span class="c1"># Calculate contingency table for overall chi-squared test</span>
    <span class="n">raw_counts</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">group_column</span><span class="p">,</span> <span class="n">bin_column</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">chi2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">dof</span><span class="p">,</span> <span class="n">expected</span> <span class="o">=</span> <span class="n">chi2_contingency</span><span class="p">(</span><span class="n">raw_counts</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chi-squared test statistic (raw data): </span><span class="si">{</span><span class="n">chi2</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p-value (raw data): </span><span class="si">{</span><span class="n">p</span><span class="si">:</span><span class="s2">.4e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Perform pairwise comparisons</span>
    <span class="n">pairwise_results</span> <span class="o">=</span> <span class="n">chi_pairwise</span><span class="p">(</span><span class="n">raw_counts</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;verbose&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>

    <span class="c1"># Plot based on level setting</span>
    <span class="k">if</span> <span class="n">level</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">,</span> <span class="s1">&#39;plateID&#39;</span><span class="p">]:</span>
        <span class="c1"># Aggregate by well for mean ± SD visualization</span>
        <span class="n">well_proportions</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">group_column</span><span class="p">,</span> <span class="n">prc_column</span><span class="p">,</span> <span class="n">bin_column</span><span class="p">])</span>
            <span class="o">.</span><span class="n">size</span><span class="p">()</span>
            <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">/</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
            <span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">mean_proportions</span> <span class="o">=</span> <span class="n">well_proportions</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">group_column</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">std_proportions</span> <span class="o">=</span> <span class="n">well_proportions</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">group_column</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">mean_proportions</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">std_proportions</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Proportion of Volume Bins by Group (Mean ± SD across wells)&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Object-level plotting without aggregation</span>
        <span class="n">group_counts</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">group_column</span><span class="p">,</span> <span class="n">bin_column</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
        <span class="n">group_totals</span> <span class="o">=</span> <span class="n">group_counts</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">proportions</span> <span class="o">=</span> <span class="n">group_counts</span> <span class="o">/</span> <span class="n">group_totals</span>
        <span class="n">proportion_df</span> <span class="o">=</span> <span class="n">proportions</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">proportion_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Proportion of Volume Bins by Group&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Group&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Proportion&#39;</span><span class="p">)</span>

    <span class="c1"># Update legend with formatted labels, maintaining correct order</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Classes&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
    
    <span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;chi_squared_stat&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">chi2</span><span class="p">],</span>
        <span class="s1">&#39;p_value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">p</span><span class="p">],</span>
        <span class="s1">&#39;degrees_of_freedom&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">dof</span><span class="p">]</span>
    <span class="p">})</span>

    <span class="k">return</span> <span class="n">results_df</span><span class="p">,</span> <span class="n">pairwise_results</span><span class="p">,</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="create_venn_diagram">
<a class="viewcode-back" href="../../api/spacr/plot/index.html#spacr.plot.create_venn_diagram">[docs]</a>
<span class="k">def</span> <span class="nf">create_venn_diagram</span><span class="p">(</span><span class="n">file1</span><span class="p">,</span> <span class="n">file2</span><span class="p">,</span> <span class="n">gene_column</span><span class="o">=</span><span class="s2">&quot;gene&quot;</span><span class="p">,</span> <span class="n">filter_coeff</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads two CSV files, extracts the `gene` column, and creates a Venn diagram</span>
<span class="sd">    to show overlapping and non-overlapping genes.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        file1 (str): Path to the first CSV file.</span>
<span class="sd">        file2 (str): Path to the second CSV file.</span>
<span class="sd">        gene_column (str): Name of the column containing gene data (default: &quot;gene&quot;).</span>
<span class="sd">        filter_coeff (float): Coefficient threshold for filtering genes.</span>
<span class="sd">        save (bool): Whether to save the plot.</span>
<span class="sd">        save_path (str): Path to save the Venn diagram figure.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Overlapping and non-overlapping genes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Read CSV files</span>
    <span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file1</span><span class="p">)</span>
    <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file2</span><span class="p">)</span>

    <span class="c1"># Filter based on coefficient</span>
    <span class="k">if</span> <span class="n">filter_coeff</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="p">[</span><span class="n">df1</span><span class="p">[</span><span class="s1">&#39;coefficient&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">filter_coeff</span><span class="p">]</span> <span class="k">if</span> <span class="n">filter_coeff</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">df1</span><span class="p">[</span><span class="n">df1</span><span class="p">[</span><span class="s1">&#39;coefficient&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">filter_coeff</span><span class="p">]</span>
        <span class="n">df2</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;coefficient&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">filter_coeff</span><span class="p">]</span> <span class="k">if</span> <span class="n">filter_coeff</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">df2</span><span class="p">[</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;coefficient&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">filter_coeff</span><span class="p">]</span>

    <span class="c1"># Extract gene columns and drop NaN values</span>
    <span class="n">genes1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">df1</span><span class="p">[</span><span class="n">gene_column</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>
    <span class="n">genes2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="n">gene_column</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>

    <span class="c1"># Calculate overlapping and non-overlapping genes</span>
    <span class="n">overlapping_genes</span> <span class="o">=</span> <span class="n">genes1</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">genes2</span><span class="p">)</span>
    <span class="n">unique_to_file1</span> <span class="o">=</span> <span class="n">genes1</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">genes2</span><span class="p">)</span>
    <span class="n">unique_to_file2</span> <span class="o">=</span> <span class="n">genes2</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">genes1</span><span class="p">)</span>

    <span class="c1"># Create a Venn diagram</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">venn</span> <span class="o">=</span> <span class="n">venn2</span><span class="p">([</span><span class="n">genes1</span><span class="p">,</span> <span class="n">genes2</span><span class="p">],</span> <span class="p">(</span><span class="s1">&#39;File 1 Genes&#39;</span><span class="p">,</span> <span class="s1">&#39;File 2 Genes&#39;</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Venn Diagram of Overlapping Genes&quot;</span><span class="p">)</span>

    <span class="c1"># Save or show the figure</span>
    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;save_path must be provided when save=True.&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Venn diagram saved to </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Return the results</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;overlap&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">overlapping_genes</span><span class="p">),</span>
        <span class="s2">&quot;unique_to_file1&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">unique_to_file1</span><span class="p">),</span>
        <span class="s2">&quot;unique_to_file2&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">unique_to_file2</span><span class="p">)</span>
    <span class="p">}</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>