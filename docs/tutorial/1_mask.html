<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>1. Generate Segmentation Masks</title>
    <style>
        @font-face {
            font-family: 'Open Sans';
            src: url("../resources/font/open_sans/static/OpenSans-Regular.ttf") format('truetype');
        }

        body {
            background-color: #1e1e1e;
            color: white;
            font-family: 'Open Sans', sans-serif;
            margin: 0;
            padding: 2em;
        }

        h1 {
            text-align: center;
            font-size: 2em;
            margin-bottom: 40px;
        }

        .output-block {
            margin-bottom: 60px;
        }

        .img-container {
            text-align: center;
            margin-bottom: 20px;
        }

        .img-container img {
            max-width: 90%;
            border-radius: 10px;
            cursor: pointer;
        }

        .console {
            background-color: #2d2d2d;
            padding: 1em;
            border-radius: 10px;
            overflow-x: auto;
            margin-bottom: 10px;
        }

        .comment-box {
            background-color: #333;
            padding: 0.8em;
            border-left: 5px solid #007bff;
            border-radius: 6px;
            color: #ccc;
        }

        .lightbox {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 999;
            justify-content: center;
            align-items: center;
        }

        .lightbox img {
            max-width: 90vw;
            max-height: 90vh;
            border-radius: 10px;
        }

        .lightbox-close {
            position: absolute;
            top: 20px;
            right: 30px;
            font-size: 2em;
            color: white;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <h1>1. Generate Segmentation Masks</h1>
    <div class='output-block'>
        <div class="img-container"
            onclick="openLightbox('../resources/tutorial/1_mask/notebook/1_spacr_generate_masks-ipynb/cell_01_out_03.png')">
            <img src="../resources/tutorial/1_mask/notebook/1_spacr_generate_masks-ipynb/cell_01_out_03.png"
                alt="Notebook output 1">
        </div>
        <div class='console'>
            <pre><code>Processing folder: /home/olafsson/datasets/plate1
Found path: /home/olafsson/datasets/plate1
Saving settings to /home/olafsson/datasets/plate1/settings/gen_mask_settings.csv
Starting Test mode ...
Found 208 tif files
Image_format: tif
regex mode:cellvoyager regex:(?P<plateID>.*)_(?P<wellID>.*)_T(?P<timeID>.*)F(?P<fieldID>.*)L(?P<laserID>..)A(?P<AID>..)Z(?P<sliceID>.*)C(?P<chanID>.*).tif
Running spacr in test mode
Found 208 files
Using 10 random image set(s) for test model
All files: 40 in /home/olafsson/datasets/plate1/test
All unique FOV: 40 in /home/olafsson/datasets/plate1/test
Progress: 1/40, operation_type: Preprocessing filenames, Time/batch: 0.434sec, Time/image: 0.009sec, Time_left: 0.282 min.
...
Progress: 40/40, operation_type: Preprocessing filenames, Time/batch: 0.553sec, Time/image: 0.011sec, Time_left: 0.000 min.
List of folders in src: ['1', '2', '3', '4']. Single channel folders.
Generated folder with merged arrays: /home/olafsson/datasets/plate1/test/stack
Progress: 1/10, operation_type: Merging channels into npy stacks, Time/image: 0.220sec, Time_left: 0.033 min.
...
Progress: 10/10, operation_type: Merging channels into npy stacks, Time/image: 0.196sec, Time_left: 0.000 min.
plotting 1 images from /home/olafsson/datasets/plate1/test/stack
Image path:/home/olafsson/datasets/plate1/test/stack/plate1_E02_21_1.npy
</code></pre>
        </div>
        <div class='comment-box'><strong>Comment:</strong> <em>[Add your commentary here]</em></div>
    </div>
    <div class='output-block'>
        <div class="img-container"
            onclick="openLightbox('../resources/tutorial/1_mask/notebook/1_spacr_generate_masks-ipynb/cell_01_out_07.png')">
            <img src="../resources/tutorial/1_mask/notebook/1_spacr_generate_masks-ipynb/cell_01_out_07.png"
                alt="Notebook output 2">
        </div>
        <div class='console'>
            <pre><code>Progress: 1/10, operation_type: Concatinating, Time/image: 0.005sec, Time_left: 0.001 min.
Progress: 1/10, operation_type: Concatinating, Time/image: 0.005sec, Time_left: 0.001 min.
...
Progress: 10/10, operation_type: Concatinating, Time/image: 0.005sec, Time_left: 0.000 min.
Processing channel 0: background=200, signal_threshold=1000, remove_background=False
Channel 0: global_lower=12.0, global_upper=3825.0, Signal-to-noise=318.75
Progress: 1/3, operation_type: Normalizing, Time/image: 0.697sec, Time_left: 0.023 min.
Processing channel 3: background=100, signal_threshold=1000, remove_background=False
Channel 3: global_lower=113.0, global_upper=2195.0, Signal-to-noise=19.424778761061948
Progress: 2/3, operation_type: Normalizing, Time/image: 0.636sec, Time_left: 0.011 min.
Processing channel 2: background=400, signal_threshold=2000, remove_background=True
Channel 2: global_lower=423.0, global_upper=6262.0, Signal-to-noise=14.803782505910165
Progress: 3/3, operation_type: Normalizing, Time/image: 0.518sec, Time_left: 0.000 min.
All files concatenated and normalized. Saved to: /home/olafsson/datasets/plate1/test/masks
{'diameter': 160, 'minimum_size': 6400.0, 'maximum_size': 256000, 'merge': False, 'resample': True, 'remove_border_objects': False, 'model_name': 'cyto2', 'filter_size': False, 'filter_intensity': False, 'restore_type': None}
{'nucleus': [0, 0], 'pathogen': [0, 2], 'cell': [0, 1]}
Device 0: NVIDIA GeForce RTX 3090, VRAM: 23.56 GB, cellpose batch size: 48
Number of objects, : 27
</code></pre>
        </div>
        <div class='comment-box'><strong>Comment:</strong> <em>[Add your commentary here]</em></div>
    </div>
    <div class='output-block'>
        <div class="img-container"
            onclick="openLightbox('../resources/tutorial/1_mask/notebook/1_spacr_generate_masks-ipynb/cell_01_out_09.png')">
            <img src="../resources/tutorial/1_mask/notebook/1_spacr_generate_masks-ipynb/cell_01_out_09.png"
                alt="Notebook output 3">
        </div>
        <div class='console'>
            <pre><code>object_size:cell: 17147.916 px2
</code></pre>
        </div>
        <div class='comment-box'><strong>Comment:</strong> <em>[Add your commentary here]</em></div>
    </div>
    <div class='output-block'>
        Progress: 1/3, operation_type: cell_mask_gen, Time/image: 35.657sec, Time_left: 1.189 min.
        {'diameter': 75, 'minimum_size': 1406.25, 'maximum_size': 56250, 'merge': False, 'resample': True,
        'remove_border_objects': False, 'model_name': 'nuclei', 'filter_size': False, 'filter_intensity': False,
        'restore_type': None}
        {'nucleus': [0, 0], 'pathogen': [0, 2], 'cell': [0, 1]}
        Device 0: NVIDIA GeForce RTX 3090, VRAM: 23.56 GB, cellpose batch size: 48
        Number of objects, : 34
        </code></pre>
    </div>
    <div class='comment-box'><strong>Comment:</strong> <em>[Add your commentary here]</em></div>
    </div>
    <div class='output-block'>
        <div class="img-container"
            onclick="openLightbox('../resources/tutorial/1_mask/notebook/1_spacr_generate_masks-ipynb/cell_01_out_24.png')">
            <img src="../resources/tutorial/1_mask/notebook/1_spacr_generate_masks-ipynb/cell_01_out_24.png"
                alt="Notebook output 14">
        </div>
        <div class='console'>
            <pre><code>object_size:nucleus: 6683.251 px2
</code></pre>
        </div>
        <div class='comment-box'><strong>Comment:</strong> <em>[Add your commentary here]</em></div>
    </div>
    <div class='output-block'>
        Progress: 2/3, operation_type: nucleus_mask_gen, Time/image: 23.892sec, Time_left: 0.398 min.
        {'diameter': 40, 'minimum_size': 400.0, 'maximum_size': 16000, 'merge': False, 'resample': False,
        'remove_border_objects': False, 'model_name': 'cyto', 'filter_size': False, 'filter_intensity': False,
        'restore_type': None}
        {'nucleus': [0, 0], 'pathogen': [0, 2], 'cell': [0, 1]}
        Device 0: NVIDIA GeForce RTX 3090, VRAM: 23.56 GB, cellpose batch size: 48
        Number of objects, : 22
        </code></pre>
    </div>
    <div class='comment-box'><strong>Comment:</strong> <em>[Add your commentary here]</em></div>
    </div>
    <div class='output-block'>
        <div class="img-container"
            onclick="openLightbox('../resources/tutorial/1_mask/notebook/1_spacr_generate_masks-ipynb/cell_01_out_39.png')">
            <img src="../resources/tutorial/1_mask/notebook/1_spacr_generate_masks-ipynb/cell_01_out_39.png"
                alt="Notebook output 25">
        </div>
        <div class='console'>
            <pre><code>object_size:pathogen: 1697.431 px2
</code></pre>
        </div>
        <div class='comment-box'><strong>Comment:</strong> <em>[Add your commentary here]</em></div>
    </div>
    <div class='output-block'>
        Progress: 3/3, operation_type: pathogen_mask_gen, Time/image: 19.432sec, Time_left: 0.000 min.
        Adjusting cell masks with nuclei and pathogen masks
        Progress: 1/10, operation_type: adjust_cell_masks, Time/image: 0.422sec, Time_left: 0.063 min.
        ...
        Progress: 10/10, operation_type: adjust_cell_masks, Time/image: 0.577sec, Time_left: 0.000 min.
        Cell mask adjustment: 0.09624974330266317 min.
        Progress: 1/10, operation_type: Merging Arrays, Time/image: 0.076sec, Time_left: 0.011 min.
        ...
        Progress: 10/10, operation_type: Merging Arrays, Time/image: 0.075sec, Time_left: 0.000 min.
        </code></pre>
    </div>
    <div class='comment-box'><strong>Comment:</strong> <em>[Add your commentary here]</em></div>
    </div>
    <div class='output-block'>
        <div class="img-container"
            onclick="openLightbox('../resources/tutorial/1_mask/notebook/1_spacr_generate_masks-ipynb/cell_01_out_52.png')">
            <img src="../resources/tutorial/1_mask/notebook/1_spacr_generate_masks-ipynb/cell_01_out_52.png"
                alt="Notebook output 36">
        </div>
        <div class='console'>
            <pre><code>Progress: 1/42, operation_type: Plot mask outlines, Time/image: 3.719sec, Time_left: 2.541 min.
</code></pre>
        </div>
        <div class='comment-box'><strong>Comment:</strong> <em>[Add your commentary here]</em></div>
    </div>
    <div class='output-block'>
        <div class="lightbox" id="lightbox" onclick="closeLightbox()">
            <span class="lightbox-close" onclick="closeLightbox()">×</span>
            <img id="lightbox-img" src="">
        </div>
        <script>
            function openLightbox(src) {
                const lightbox = document.getElementById('lightbox');
                const lightboxImg = document.getElementById('lightbox-img');
                lightboxImg.src = src;
                lightbox.style.display = 'flex';
            }
            function closeLightbox() {
                const lightbox = document.getElementById('lightbox');
                lightbox.style.display = 'none';
            }
        </script>
</body>

</html>